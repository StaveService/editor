/**
 * alphaTab v1.1.0 (, build 3)
 * 
 * Copyright Â© 2020, Daniel Kuschny and Contributors, All rights reserved.
 * 
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/.
 * 
 * SoundFont loading and Audio Synthesis based on TinySoundFont (licensed under MIT)
 * Copyright (C) 2017, 2018 Bernhard Schelling (https://github.com/schellingb/TinySoundFont)
 * 
 * TinySoundFont is based on SFZero (licensed under MIT)
 * Copyright (C) 2012 Steve Folta (https://github.com/stevefolta/SFZero)
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).alphaTab={})}(this,(function(t){"use strict";var e,i,n=(e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,i)},function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)});(i=t.AlphaTabErrorType||(t.AlphaTabErrorType={}))[i.General=0]="General",i[i.Format=1]="Format",i[i.AlphaTex=2]="AlphaTex";var r,a,o,s,h,c=function(t){function e(i,n,r){var a=t.call(this,n)||this;return a.type=i,a.inner=null!=r?r:null,Object.setPrototypeOf(a,e.prototype),a}return n(e,t),e}(Error),l=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),u=function(e){function i(n){var r=e.call(this,t.AlphaTabErrorType.Format,n)||this;return Object.setPrototypeOf(r,i.prototype),r}return l(i,e),i}(c),p=function(){function t(){}return t.getValue=function(e){return t._values||(t._values=new Map),e=e.toLowerCase().split(" ").join(""),t._values.has(e)?t._values.get(e):0},t.isPiano=function(t){return t<=7||t>=16&&t<=23},t.isGuitar=function(t){return t>=24&&t<=39||105===t||43===t},t._values=new Map([["acousticgrandpiano",0],["brightacousticpiano",1],["electricgrandpiano",2],["honkytonkpiano",3],["electricpiano1",4],["electricpiano2",5],["harpsichord",6],["clavinet",7],["celesta",8],["glockenspiel",9],["musicbox",10],["vibraphone",11],["marimba",12],["xylophone",13],["tubularbells",14],["dulcimer",15],["drawbarorgan",16],["percussiveorgan",17],["rockorgan",18],["churchorgan",19],["reedorgan",20],["accordion",21],["harmonica",22],["tangoaccordion",23],["acousticguitarnylon",24],["acousticguitarsteel",25],["electricguitarjazz",26],["electricguitarclean",27],["electricguitarmuted",28],["overdrivenguitar",29],["distortionguitar",30],["guitarharmonics",31],["acousticbass",32],["electricbassfinger",33],["electricbasspick",34],["fretlessbass",35],["slapbass1",36],["slapbass2",37],["synthbass1",38],["synthbass2",39],["violin",40],["viola",41],["cello",42],["contrabass",43],["tremolostrings",44],["pizzicatostrings",45],["orchestralharp",46],["timpani",47],["stringensemble1",48],["stringensemble2",49],["synthstrings1",50],["synthstrings2",51],["choiraahs",52],["voiceoohs",53],["synthvoice",54],["orchestrahit",55],["trumpet",56],["trombone",57],["tuba",58],["mutedtrumpet",59],["frenchhorn",60],["brasssection",61],["synthbrass1",62],["synthbrass2",63],["sopranosax",64],["altosax",65],["tenorsax",66],["baritonesax",67],["oboe",68],["englishhorn",69],["bassoon",70],["clarinet",71],["piccolo",72],["flute",73],["recorder",74],["panflute",75],["blownbottle",76],["shakuhachi",77],["whistle",78],["ocarina",79],["lead1square",80],["lead2sawtooth",81],["lead3calliope",82],["lead4chiff",83],["lead5charang",84],["lead6voice",85],["lead7fifths",86],["lead8bassandlead",87],["pad1newage",88],["pad2warm",89],["pad3polysynth",90],["pad4choir",91],["pad5bowed",92],["pad6metallic",93],["pad7halo",94],["pad8sweep",95],["fx1rain",96],["fx2soundtrack",97],["fx3crystal",98],["fx4atmosphere",99],["fx5brightness",100],["fx6goblins",101],["fx7echoes",102],["fx8scifi",103],["sitar",104],["banjo",105],["shamisen",106],["koto",107],["kalimba",108],["bagpipe",109],["fiddle",110],["shanai",111],["tinklebell",112],["agogo",113],["steeldrums",114],["woodblock",115],["taikodrum",116],["melodictom",117],["synthdrum",118],["reversecymbal",119],["guitarfretnoise",120],["breathnoise",121],["seashore",122],["birdtweet",123],["telephonering",124],["helicopter",125],["applause",126],["gunshot",127]]),t}();!function(t){t[t.Unknown=-2]="Unknown",t[t.NoOrDead=-1]="NoOrDead",t[t.Thumb=0]="Thumb",t[t.IndexFinger=1]="IndexFinger",t[t.MiddleFinger=2]="MiddleFinger",t[t.AnnularFinger=3]="AnnularFinger",t[t.LittleFinger=4]="LittleFinger"}(r||(r={})),(a=t.TabRhythmMode||(t.TabRhythmMode={}))[a.Hidden=0]="Hidden",a[a.ShowWithBeams=1]="ShowWithBeams",a[a.ShowWithBars=2]="ShowWithBars",(o=t.FingeringMode||(t.FingeringMode={}))[o.ScoreDefault=0]="ScoreDefault",o[o.ScoreForcePiano=1]="ScoreForcePiano",o[o.SingleNoteEffectBand=2]="SingleNoteEffectBand",o[o.SingleNoteEffectBandForcePiano=3]="SingleNoteEffectBandForcePiano",(s=t.NotationMode||(t.NotationMode={}))[s.GuitarPro=0]="GuitarPro",s[s.SongBook=1]="SongBook",function(t){t[t.ScoreTitle=0]="ScoreTitle",t[t.ScoreSubTitle=1]="ScoreSubTitle",t[t.ScoreArtist=2]="ScoreArtist",t[t.ScoreAlbum=3]="ScoreAlbum",t[t.ScoreWords=4]="ScoreWords",t[t.ScoreMusic=5]="ScoreMusic",t[t.ScoreWordsAndMusic=6]="ScoreWordsAndMusic",t[t.ScoreCopyright=7]="ScoreCopyright",t[t.GuitarTuning=8]="GuitarTuning",t[t.TrackNames=9]="TrackNames",t[t.ChordDiagrams=10]="ChordDiagrams",t[t.ParenthesisOnTiedBends=11]="ParenthesisOnTiedBends",t[t.TabNotesOnTiedBends=12]="TabNotesOnTiedBends",t[t.ZerosOnDiveWhammys=13]="ZerosOnDiveWhammys",t[t.EffectAlternateEndings=14]="EffectAlternateEndings",t[t.EffectCapo=15]="EffectCapo",t[t.EffectChordNames=16]="EffectChordNames",t[t.EffectCrescendo=17]="EffectCrescendo",t[t.EffectDynamics=18]="EffectDynamics",t[t.EffectFadeIn=19]="EffectFadeIn",t[t.EffectFermata=20]="EffectFermata",t[t.EffectFingering=21]="EffectFingering",t[t.EffectHarmonics=22]="EffectHarmonics",t[t.EffectLetRing=23]="EffectLetRing",t[t.EffectLyrics=24]="EffectLyrics",t[t.EffectMarker=25]="EffectMarker",t[t.EffectOttavia=26]="EffectOttavia",t[t.EffectPalmMute=27]="EffectPalmMute",t[t.EffectPickSlide=28]="EffectPickSlide",t[t.EffectPickStroke=29]="EffectPickStroke",t[t.EffectSlightBeatVibrato=30]="EffectSlightBeatVibrato",t[t.EffectSlightNoteVibrato=31]="EffectSlightNoteVibrato",t[t.EffectTap=32]="EffectTap",t[t.EffectTempo=33]="EffectTempo",t[t.EffectText=34]="EffectText",t[t.EffectTrill=35]="EffectTrill",t[t.EffectTripletFeel=36]="EffectTripletFeel",t[t.EffectWhammyBar=37]="EffectWhammyBar",t[t.EffectWideBeatVibrato=38]="EffectWideBeatVibrato",t[t.EffectWideNoteVibrato=39]="EffectWideNoteVibrato",t[t.EffectLeftHandTap=40]="EffectLeftHandTap"}(h||(h={}));var d,f=function(){function e(){this.notationMode=t.NotationMode.GuitarPro,this.fingeringMode=t.FingeringMode.ScoreDefault,this.elements=new Map,this.rhythmMode=t.TabRhythmMode.Hidden,this.rhythmHeight=15,this.transpositionPitches=[],this.displayTranspositionPitches=[],this.smallGraceTabNotes=!0,this.extendBendArrowsOnTiedNotes=!0,this.extendLineEffectsToBeatEnd=!1,this.slurHeight=5}return e.prototype.isNotationElementVisible=function(t){return this.elements.has(t)?this.elements.get(t):!e.defaultElements.has(t)||e.defaultElements.get(t)},e.toJson=function(t){var e={};return t.fillToJson(e),e},e.prototype.fillToJson=function(t){t.notationMode=this.notationMode,t.fingeringMode=this.fingeringMode,t.elements={},this.elements.forEach((function(e,i){t.elements[i]=e})),t.rhythmMode=this.rhythmMode,t.rhythmHeight=this.rhythmHeight,t.transpositionPitches=this.transpositionPitches.slice(),t.displayTranspositionPitches=this.displayTranspositionPitches.slice(),t.smallGraceTabNotes=this.smallGraceTabNotes,t.extendBendArrowsOnTiedNotes=this.extendBendArrowsOnTiedNotes,t.extendLineEffectsToBeatEnd=this.extendLineEffectsToBeatEnd,t.slurHeight=this.slurHeight},e.fromJson=function(t){if(!t)return null;var i=new e;return i.fillFromJson(t),i},e.prototype.fillFromJson=function(t){if(t)for(var e in t)this.setProperty(e.toLowerCase(),t[e])},e.prototype.setProperty=function(e,i){switch(e){case"notationmode":return this.notationMode=isNaN(parseInt(i))?t.NotationMode[Object.keys(t.NotationMode).find((function(t){return t.toLowerCase()===i.toLowerCase()}))]:parseInt(i),!0;case"fingeringmode":return this.fingeringMode=isNaN(parseInt(i))?t.FingeringMode[Object.keys(t.FingeringMode).find((function(t){return t.toLowerCase()===i.toLowerCase()}))]:parseInt(i),!0;case"elements":for(var n in this.elements=new Map,i)i.hasOwnProperty(n)&&this.elements.set(isNaN(parseInt(n))?h[Object.keys(h).find((function(t){return t.toLowerCase()===n.toLowerCase()}))]:parseInt(n),i[n]);return!0;case"rhythmmode":return this.rhythmMode=isNaN(parseInt(i))?t.TabRhythmMode[Object.keys(t.TabRhythmMode).find((function(t){return t.toLowerCase()===i.toLowerCase()}))]:parseInt(i),!0;case"rhythmheight":return this.rhythmHeight=i,!0;case"transpositionpitches":return this.transpositionPitches=i.slice(),!0;case"displaytranspositionpitches":return this.displayTranspositionPitches=i.slice(),!0;case"smallgracetabnotes":return this.smallGraceTabNotes=i,!0;case"extendbendarrowsontiednotes":return this.extendBendArrowsOnTiedNotes=i,!0;case"extendlineeffectstobeatend":return this.extendLineEffectsToBeatEnd=i,!0;case"slurheight":return this.slurHeight=i,!0}return!1},e.defaultElements=new Map([[h.ZerosOnDiveWhammys,!1]]),e}(),y=function(){function t(){this.note=null,this.noteValue=0,this.octave=0}return Object.defineProperty(t.prototype,"realValue",{get:function(){return 12*this.octave+this.noteValue},enumerable:!1,configurable:!0}),t}(),g=function(){function e(){}return e.getIndex=function(t){return t<0?0:0|Math.log2(t)},e.keySignatureIsFlat=function(t){return t<0},e.keySignatureIsNatural=function(t){return 0===t},e.keySignatureIsSharp=function(t){return t>0},e.applyPitchOffsets=function(t,e){for(var i=0;i<e.tracks.length;i++){if(i<t.notation.displayTranspositionPitches.length)for(var n=0,r=e.tracks[i].staves;n<r.length;n++){r[n].displayTranspositionPitch=-t.notation.displayTranspositionPitches[i]}if(i<t.notation.transpositionPitches.length)for(var a=0,o=e.tracks[i].staves;a<o.length;a++){o[a].transpositionPitch=-t.notation.transpositionPitches[i]}}},e.fingerToString=function(e,i,n,a){if(e.notation.fingeringMode===t.FingeringMode.ScoreForcePiano||e.notation.fingeringMode===t.FingeringMode.SingleNoteEffectBandForcePiano||p.isPiano(i.voice.bar.staff.track.playbackInfo.program))switch(n){case r.Unknown:case r.NoOrDead:return null;case r.Thumb:return"1";case r.IndexFinger:return"2";case r.MiddleFinger:return"3";case r.AnnularFinger:return"4";case r.LittleFinger:return"5";default:return null}if(a)switch(n){case r.Unknown:case r.NoOrDead:return"0";case r.Thumb:return"T";case r.IndexFinger:return"1";case r.MiddleFinger:return"2";case r.AnnularFinger:return"3";case r.LittleFinger:return"4";default:return null}switch(n){case r.Unknown:case r.NoOrDead:return null;case r.Thumb:return"p";case r.IndexFinger:return"i";case r.MiddleFinger:return"m";case r.AnnularFinger:return"a";case r.LittleFinger:return"c";default:return null}},e.isTuning=function(t){return!!e.parseTuning(t)},e.parseTuning=function(t){for(var i="",n="",r=0;r<t.length;r++){var a=t.charCodeAt(r);if(a>=48&&a<=57){if(!i)return null;n+=String.fromCharCode(a)}else{if(!(a>=65&&a<=90||a>=97&&a<=122||35===a))return null;i+=String.fromCharCode(a)}}if(!n||!i)return null;var o=new y;return o.octave=parseInt(n)+1,o.note=i.toLowerCase(),o.noteValue=e.getToneForText(o.note),o},e.getTuningForText=function(t){var i=e.parseTuning(t);return i?i.realValue:-1},e.getToneForText=function(t){var e=0;switch(t.toLowerCase()){case"c":e=0;break;case"c#":case"db":e=1;break;case"d":e=2;break;case"d#":case"eb":e=3;break;case"e":e=4;break;case"f":e=5;break;case"f#":case"gb":e=6;break;case"g":e=7;break;case"g#":case"ab":e=8;break;case"a":e=9;break;case"a#":case"bb":e=10;break;case"b":e=11;break;default:return 0}return e},e.newGuid=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)+Math.floor(65536*(1+Math.random())).toString(16).substring(1)+"-"+Math.floor(65536*(1+Math.random())).toString(16).substring(1)+"-"+Math.floor(65536*(1+Math.random())).toString(16).substring(1)+"-"+Math.floor(65536*(1+Math.random())).toString(16).substring(1)+"-"+Math.floor(65536*(1+Math.random())).toString(16).substring(1)+Math.floor(65536*(1+Math.random())).toString(16).substring(1)+Math.floor(65536*(1+Math.random())).toString(16).substring(1)},e.isAlmostEqualTo=function(t,e){return Math.abs(t-e)<1e-5},e.toHexString=function(t,e){void 0===e&&(e=0);var i="";do{i=String.fromCharCode("0123456789ABCDEF".charCodeAt(15&t))+i,t>>=4}while(t>0);for(;i.length<e;)i="0"+i;return i},e}(),m=function(){function t(t,e,i,n){void 0===n&&(n=255),this.raw=0,this.raw=0,this.raw=(255&n)<<24|(255&t)<<16|(255&e)<<8|255&i,this.updateRgba()}return t.prototype.updateRgba=function(){255===this.a?this.rgba="#"+g.toHexString(this.r,2)+g.toHexString(this.g,2)+g.toHexString(this.b,2):this.rgba="rgba("+this.r+","+this.g+","+this.b+","+this.a/255+")"},Object.defineProperty(t.prototype,"a",{get:function(){return this.raw>>24&255},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this.raw>>16&255},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this.raw>>8&255},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return 255&this.raw},enumerable:!1,configurable:!0}),t.random=function(e){return void 0===e&&(e=100),new t(255*Math.random()|0,255*Math.random()|0,255*Math.random()|0,e)},t.fromJson=function(e){if(!e)return null;if(e instanceof t)return e;switch(typeof e){case"number":var i=new t(0,0,0,0);return i.raw=0|e,i.updateRgba(),i;case"string":if(e.startsWith("#")){if(4===e.length)return new t(17*parseInt(e.substring(1,1),16),17*parseInt(e.substring(2,1),16),17*parseInt(e.substring(3,1),16));if(5===e.length)return new t(17*parseInt(e.substring(1,1),16),17*parseInt(e.substring(2,1),16),17*parseInt(e.substring(3,1),16),17*parseInt(e.substring(4,1),16));if(7===e.length)return new t(parseInt(e.substring(1,2),16),parseInt(e.substring(3,2),16),parseInt(e.substring(5,2),16));if(9===e.length)return new t(parseInt(e.substring(1,2),16),parseInt(e.substring(3,2),16),parseInt(e.substring(5,2),16),parseInt(e.substring(7,2),16))}else if(e.startsWith("rgba")||e.startsWith("rgb")){var n=e.indexOf("("),r=e.lastIndexOf(")");if(-1===n||-1===r)throw new u("No values specified for rgb/rgba function");var a=e.substring(n+1,r-n-1).split(",");if(3===a.length)return new t(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]));if(4===a.length)return new t(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]),255*parseFloat(a[3]))}}throw new u("Unsupported format for color")},t.toJson=function(t){return t.raw},t.BlackRgb="#000000",t}();!function(t){t[t.Plain=0]="Plain",t[t.Bold=1]="Bold",t[t.Italic=2]="Italic"}(d||(d={}));var b,v,_=function(){function t(t,e,i){void 0===i&&(i=d.Plain),this._cssScale=0,this.family=t,this.size=e,this.style=i,this._css=this.toCssString(1)}return Object.defineProperty(t.prototype,"isBold",{get:function(){return 0!=(this.style&d.Bold)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isItalic",{get:function(){return 0!=(this.style&d.Italic)},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return new t(this.family,this.size,this.style)},t.prototype.toCssString=function(t){if(!(this._css&&Math.abs(t-this._cssScale)<.01)){var e="";this.isBold&&(e+="bold "),this.isItalic&&(e+="italic "),e+=this.size*t,e+="px ",e+="'",e+=this.family,e+="'",this._css=e,this._cssScale=t}return this._css},t.fromJson=function(e){if(!e)return null;if(e instanceof t)return e;if("object"==typeof e&&e.family)return new t(e.family,e.size,e.style);if("string"==typeof e&&!qh.isRunningInWorker){var i=document.createElement("span");i.setAttribute("style","font: "+e);var n=i.style;n.fontFamily||(n.fontFamily="sans-serif");var r=n.fontFamily;(r.startsWith("'")&&r.endsWith("'")||r.startsWith('"')&&r.endsWith('"'))&&(r=r.substr(1,r.length-2));var a=n.fontSize.toLowerCase(),o=0;switch(a){case"xx-small":o=7;break;case"x-small":o=10;break;case"small":case"smaller":o=13;break;case"medium":o=16;break;case"large":case"larger":o=18;break;case"x-large":o=24;break;case"xx-large":o=32;break;default:try{o=a.endsWith("em")?16*parseFloat(a.substr(0,a.length-2)):a.endsWith("pt")?16*parseFloat(a.substr(0,a.length-2))/12:a.endsWith("px")?parseFloat(a.substr(0,a.length-2)):12}catch(t){o=12}}var s=d.Plain;switch("italic"===n.fontStyle&&(s|=d.Italic),n.fontWeight.toLowerCase()){case"normal":case"lighter":break;default:s|=d.Bold}return new t(r,o,s)}return null},t.toJson=function(t){return{family:t.family,size:t.size,style:t.style}},t}(),w=function(){function t(){this.copyrightFont=new _(t.sansFont,12,d.Bold),this.titleFont=new _(t.serifFont,32,d.Plain),this.subTitleFont=new _(t.serifFont,20,d.Plain),this.wordsFont=new _(t.serifFont,15,d.Plain),this.effectFont=new _(t.serifFont,12,d.Italic),this.fretboardNumberFont=new _(t.sansFont,11,d.Plain),this.tablatureFont=new _(t.sansFont,13,d.Plain),this.graceFont=new _(t.sansFont,11,d.Plain),this.staffLineColor=new m(165,165,165,255),this.barSeparatorColor=new m(34,34,17,255),this.barNumberFont=new _(t.sansFont,11,d.Plain),this.barNumberColor=new m(200,0,0,255),this.fingeringFont=new _(t.serifFont,14,d.Plain),this.markerFont=new _(t.serifFont,14,d.Bold),this.mainGlyphColor=new m(0,0,0,255),this.secondaryGlyphColor=new m(0,0,0,100),this.scoreInfoColor=new m(0,0,0,255)}return t.toJson=function(t){var e={};return t.fillToJson(e),e},t.prototype.fillToJson=function(t){t.copyrightFont=_.toJson(this.copyrightFont),t.titleFont=_.toJson(this.titleFont),t.subTitleFont=_.toJson(this.subTitleFont),t.wordsFont=_.toJson(this.wordsFont),t.effectFont=_.toJson(this.effectFont),t.fretboardNumberFont=_.toJson(this.fretboardNumberFont),t.tablatureFont=_.toJson(this.tablatureFont),t.graceFont=_.toJson(this.graceFont),t.staffLineColor=m.toJson(this.staffLineColor),t.barSeparatorColor=m.toJson(this.barSeparatorColor),t.barNumberFont=_.toJson(this.barNumberFont),t.barNumberColor=m.toJson(this.barNumberColor),t.fingeringFont=_.toJson(this.fingeringFont),t.markerFont=_.toJson(this.markerFont),t.mainGlyphColor=m.toJson(this.mainGlyphColor),t.secondaryGlyphColor=m.toJson(this.secondaryGlyphColor),t.scoreInfoColor=m.toJson(this.scoreInfoColor)},t.fromJson=function(e){if(!e)return null;var i=new t;return i.fillFromJson(e),i},t.prototype.fillFromJson=function(t){if(t)for(var e in t)this.setProperty(e.toLowerCase(),t[e])},t.prototype.setProperty=function(t,e){switch(t){case"copyrightfont":return this.copyrightFont=_.fromJson(e),!0;case"titlefont":return this.titleFont=_.fromJson(e),!0;case"subtitlefont":return this.subTitleFont=_.fromJson(e),!0;case"wordsfont":return this.wordsFont=_.fromJson(e),!0;case"effectfont":return this.effectFont=_.fromJson(e),!0;case"fretboardnumberfont":return this.fretboardNumberFont=_.fromJson(e),!0;case"tablaturefont":return this.tablatureFont=_.fromJson(e),!0;case"gracefont":return this.graceFont=_.fromJson(e),!0;case"stafflinecolor":return this.staffLineColor=m.fromJson(e),!0;case"barseparatorcolor":return this.barSeparatorColor=m.fromJson(e),!0;case"barnumberfont":return this.barNumberFont=_.fromJson(e),!0;case"barnumbercolor":return this.barNumberColor=m.fromJson(e),!0;case"fingeringfont":return this.fingeringFont=_.fromJson(e),!0;case"markerfont":return this.markerFont=_.fromJson(e),!0;case"mainglyphcolor":return this.mainGlyphColor=m.fromJson(e),!0;case"secondaryglyphcolor":return this.secondaryGlyphColor=m.fromJson(e),!0;case"scoreinfocolor":return this.scoreInfoColor=m.fromJson(e),!0}return!1},t.sansFont="Arial",t.serifFont="Georgia",t}();(b=t.StaveProfile||(t.StaveProfile={}))[b.Default=0]="Default",b[b.ScoreTab=1]="ScoreTab",b[b.Score=2]="Score",b[b.Tab=3]="Tab",b[b.TabMixed=4]="TabMixed",(v=t.LayoutMode||(t.LayoutMode={}))[v.Page=0]="Page",v[v.Horizontal=1]="Horizontal";var S,B,T=function(){function e(){this.scale=1,this.stretchForce=1,this.layoutMode=t.LayoutMode.Page,this.staveProfile=t.StaveProfile.Default,this.barsPerRow=-1,this.startBar=1,this.barCount=-1,this.barCountPerPartial=10,this.resources=new w,this.padding=null}return e.toJson=function(t){var e={};return t.fillToJson(e),e},e.prototype.fillToJson=function(t){t.scale=this.scale,t.stretchForce=this.stretchForce,t.layoutMode=this.layoutMode,t.staveProfile=this.staveProfile,t.barsPerRow=this.barsPerRow,t.startBar=this.startBar,t.barCount=this.barCount,t.barCountPerPartial=this.barCountPerPartial,t.resources?this.resources.fillToJson(t.resources):t.resources=w.toJson(this.resources),t.padding=this.padding?this.padding.slice():null},e.fromJson=function(t){if(!t)return null;var i=new e;return i.fillFromJson(t),i},e.prototype.fillFromJson=function(t){if(t)for(var e in t)this.setProperty(e.toLowerCase(),t[e])},e.prototype.setProperty=function(e,i){switch(e){case"scale":return this.scale=i,!0;case"stretchforce":return this.stretchForce=i,!0;case"layoutmode":return this.layoutMode=isNaN(parseInt(i))?t.LayoutMode[Object.keys(t.LayoutMode).find((function(t){return t.toLowerCase()===i.toLowerCase()}))]:parseInt(i),!0;case"staveprofile":return this.staveProfile=isNaN(parseInt(i))?t.StaveProfile[Object.keys(t.StaveProfile).find((function(t){return t.toLowerCase()===i.toLowerCase()}))]:parseInt(i),!0;case"barsperrow":return this.barsPerRow=i,!0;case"startbar":return this.startBar=i,!0;case"barcount":return this.barCount=i,!0;case"barcountperpartial":return this.barCountPerPartial=i,!0;case"padding":return this.padding=i?i.slice():null,!0}if(["resources"].indexOf(e)>=0)return this.resources?this.resources.fillFromJson(i):this.resources=w.fromJson(i),!0;for(var n=0,r=["resources"];n<r.length;n++){var a=r[n];if(0===e.indexOf(a)&&(this.resources||(this.resources=new w),this.resources.setProperty(e.substring(a.length),i)))return!0}return!1},e}(),k=function(){function t(){}return t.prototype.init=function(t,e){this.data=t,this.settings=e},t}(),P=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),N=function(e){function i(n,r){void 0===n&&(n="Unsupported format"),void 0===r&&(r=null);var a=e.call(this,t.AlphaTabErrorType.Format,n)||this;return a.inner=r,Object.setPrototypeOf(a,i.prototype),a}return P(i,e),i}(c);!function(t){t[t.None=0]="None",t[t.Normal=1]="Normal",t[t.Heavy=2]="Heavy"}(S||(S={})),function(t){t[t.Tempo=0]="Tempo",t[t.Volume=1]="Volume",t[t.Instrument=2]="Instrument",t[t.Balance=3]="Balance"}(B||(B={}));var O,x,C,F=function(){function t(){this.isLinear=!1,this.type=B.Tempo,this.value=0,this.ratioPosition=0,this.text=""}return t.buildTempoAutomation=function(e,i,n,r){(r<1||r>5)&&(r=2);var a=new Float32Array([1,.5,1,1.5,2,3]),o=new t;return o.type=B.Tempo,o.isLinear=e,o.ratioPosition=i,o.value=n*a[r],o},t.copyTo=function(t,e){e.isLinear=t.isLinear,e.ratioPosition=t.ratioPosition,e.text=t.text,e.type=t.type,e.value=t.value},t.prototype.clone=function(){var e=new t;return t.copyTo(this,e),e},t}();!function(t){t[t.Neutral=0]="Neutral",t[t.C3=1]="C3",t[t.C4=2]="C4",t[t.F4=3]="F4",t[t.G2=4]="G2"}(O||(O={})),function(t){t[t._15ma=0]="_15ma",t[t._8va=1]="_8va",t[t.Regular=2]="Regular",t[t._8vb=3]="_8vb",t[t._15mb=4]="_15mb"}(x||(x={})),function(t){t[t.None=0]="None",t[t.Simple=1]="Simple",t[t.FirstOfDouble=2]="FirstOfDouble",t[t.SecondOfDouble=3]="SecondOfDouble"}(C||(C={}));var L,E,M,D,A,I,R,G,j,V,H,W,U=function(){function t(){this.id=t._globalBarId++,this.index=0,this.nextBar=null,this.previousBar=null,this.clef=O.G2,this.clefOttava=x.Regular,this.voices=[],this.simileMark=C.None}return Object.defineProperty(t.prototype,"masterBar",{get:function(){return this.staff.track.score.masterBars[this.index]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){for(var t=0,e=this.voices.length;t<e;t++)if(!this.voices[t].isEmpty)return!1;return!0},enumerable:!1,configurable:!0}),t.copyTo=function(t,e){e.id=t.id,e.index=t.index,e.clef=t.clef,e.clefOttava=t.clefOttava,e.simileMark=t.simileMark},t.prototype.addVoice=function(t){t.bar=this,t.index=this.voices.length,this.voices.push(t)},t.prototype.finish=function(t){for(var e=0,i=this.voices.length;e<i;e++){this.voices[e].finish(t)}},t.prototype.calculateDuration=function(){for(var t=0,e=0,i=this.voices;e<i.length;e++){var n=i[e].calculateDuration();n>t&&(t=n)}return t},t._globalBarId=0,t}(),z=function(){function t(){}return t.ticksToMillis=function(e,i){return e*(6e4/(i*t.QuarterTime))|0},t.millisToTicks=function(e,i){return e/(6e4/(i*t.QuarterTime))|0},t.toTicks=function(e){return t.valueToTicks(e)},t.valueToTicks=function(e){var i=e;return i<0&&(i=1/-i),t.QuarterTime*(4/i)|0},t.applyDot=function(t,e){return e?t+3*(t/4|0):t+(t/2|0)},t.applyTuplet=function(t,e,i){return t*i/e|0},t.removeTuplet=function(t,e,i){return t*e/i|0},t.dynamicToVelocity=function(e){return t.MinVelocity+e*t.VelocityIncrement},t.QuarterTime=960,t.MinVelocity=15,t.VelocityIncrement=16,t}(),X=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.offset=t,this.value=e}return t.copyTo=function(t,e){e.offset=t.offset,e.value=t.value},t.prototype.clone=function(){var e=new t(0,0);return t.copyTo(this,e),e},t.MaxPosition=60,t.MaxValue=12,t}();!function(t){t[t.Default=0]="Default",t[t.Gradual=1]="Gradual",t[t.Fast=2]="Fast"}(L||(L={})),function(t){t[t.None=0]="None",t[t.Custom=1]="Custom",t[t.Bend=2]="Bend",t[t.Release=3]="Release",t[t.BendRelease=4]="BendRelease",t[t.Hold=5]="Hold",t[t.Prebend=6]="Prebend",t[t.PrebendBend=7]="PrebendBend",t[t.PrebendRelease=8]="PrebendRelease"}(E||(E={})),function(t){t[t.None=0]="None",t[t.BrushUp=1]="BrushUp",t[t.BrushDown=2]="BrushDown",t[t.ArpeggioUp=3]="ArpeggioUp",t[t.ArpeggioDown=4]="ArpeggioDown"}(M||(M={})),function(t){t[t.None=0]="None",t[t.Crescendo=1]="Crescendo",t[t.Decrescendo=2]="Decrescendo"}(D||(D={})),function(t){t[t.QuadrupleWhole=-4]="QuadrupleWhole",t[t.DoubleWhole=-2]="DoubleWhole",t[t.Whole=1]="Whole",t[t.Half=2]="Half",t[t.Quarter=4]="Quarter",t[t.Eighth=8]="Eighth",t[t.Sixteenth=16]="Sixteenth",t[t.ThirtySecond=32]="ThirtySecond",t[t.SixtyFourth=64]="SixtyFourth",t[t.OneHundredTwentyEighth=128]="OneHundredTwentyEighth",t[t.TwoHundredFiftySixth=256]="TwoHundredFiftySixth"}(A||(A={})),function(t){t[t.PPP=0]="PPP",t[t.PP=1]="PP",t[t.P=2]="P",t[t.MP=3]="MP",t[t.MF=4]="MF",t[t.F=5]="F",t[t.FF=6]="FF",t[t.FFF=7]="FFF"}(I||(I={})),function(t){t[t.None=0]="None",t[t.OnBeat=1]="OnBeat",t[t.BeforeBeat=2]="BeforeBeat",t[t.BendGrace=3]="BendGrace"}(R||(R={})),function(t){t[t.None=0]="None",t[t.Natural=1]="Natural",t[t.Artificial=2]="Artificial",t[t.Pinch=3]="Pinch",t[t.Tap=4]="Tap",t[t.Semi=5]="Semi",t[t.Feedback=6]="Feedback"}(G||(G={})),function(t){t[t.Default=0]="Default",t[t.SwapAccidentals=1]="SwapAccidentals",t[t.ForceNone=2]="ForceNone",t[t.ForceNatural=3]="ForceNatural",t[t.ForceSharp=4]="ForceSharp",t[t.ForceDoubleSharp=5]="ForceDoubleSharp",t[t.ForceFlat=6]="ForceFlat",t[t.ForceDoubleFlat=7]="ForceDoubleFlat"}(j||(j={})),function(t){t[t.None=0]="None",t[t.IntoFromBelow=1]="IntoFromBelow",t[t.IntoFromAbove=2]="IntoFromAbove"}(V||(V={})),function(t){t[t.None=0]="None",t[t.Shift=1]="Shift",t[t.Legato=2]="Legato",t[t.OutUp=3]="OutUp",t[t.OutDown=4]="OutDown",t[t.PickSlideDown=5]="PickSlideDown",t[t.PickSlideUp=6]="PickSlideUp"}(H||(H={})),function(t){t[t.None=0]="None",t[t.Slight=1]="Slight",t[t.Wide=2]="Wide"}(W||(W={}));var Y,J=function(){function t(t){this._value=void 0,this._factory=t}return Object.defineProperty(t.prototype,"value",{get:function(){return void 0===this._value&&(this._value=this._factory()),this._value},enumerable:!1,configurable:!0}),t}();(Y=t.LogLevel||(t.LogLevel={}))[Y.None=0]="None",Y[Y.Debug=1]="Debug",Y[Y.Info=2]="Info",Y[Y.Warning=3]="Warning",Y[Y.Error=4]="Error";var q,Q,K,Z,$=function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),r=0;for(e=0;e<i;e++)for(var a=arguments[e],o=0,s=a.length;o<s;o++,r++)n[r]=a[o];return n},tt=function(){function e(){}return e.format=function(t,e){return"[AlphaTab]["+t+"] "+e},e.prototype.debug=function(t,i){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];console.debug.apply(console,$([e.format(t,i)],n))},e.prototype.warning=function(t,i){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];console.warn.apply(console,$([e.format(t,i)],n))},e.prototype.info=function(t,i){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];console.info.apply(console,$([e.format(t,i)],n))},e.prototype.error=function(t,i){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];console.error.apply(console,$([e.format(t,i)],n))},e.logLevel=t.LogLevel.Info,e}(),et=function(){function e(){}return e.shouldLog=function(i){return e.logLevel!==t.LogLevel.None&&i>=e.logLevel},e.debug=function(i,n){for(var r,a=[],o=2;o<arguments.length;o++)a[o-2]=arguments[o];e.shouldLog(t.LogLevel.Debug)&&(r=e.log).debug.apply(r,$([i,n],a))},e.warning=function(i,n){for(var r,a=[],o=2;o<arguments.length;o++)a[o-2]=arguments[o];e.shouldLog(t.LogLevel.Warning)&&(r=e.log).warning.apply(r,$([i,n],a))},e.info=function(i,n){for(var r,a=[],o=2;o<arguments.length;o++)a[o-2]=arguments[o];e.shouldLog(t.LogLevel.Info)&&(r=e.log).info.apply(r,$([i,n],a))},e.error=function(i,n){for(var r,a=[],o=2;o<arguments.length;o++)a[o-2]=arguments[o];e.shouldLog(t.LogLevel.Error)&&(r=e.log).error.apply(r,$([i,n],a))},e.logLevel=t.LogLevel.Info,e.log=new tt,e}();!function(t){t[t.None=0]="None",t[t.Up=1]="Up",t[t.Down=2]="Down"}(q||(q={})),function(t){t[t.None=-1]="None",t[t.GClef=57424]="GClef",t[t.CClef=57436]="CClef",t[t.FClef=57442]="FClef",t[t.UnpitchedPercussionClef1=57449]="UnpitchedPercussionClef1",t[t.SixStringTabClef=57453]="SixStringTabClef",t[t.FourStringTabClef=57454]="FourStringTabClef",t[t.TimeSig0=57472]="TimeSig0",t[t.TimeSig1=57473]="TimeSig1",t[t.TimeSig2=57474]="TimeSig2",t[t.TimeSig3=57475]="TimeSig3",t[t.TimeSig4=57476]="TimeSig4",t[t.TimeSig5=57477]="TimeSig5",t[t.TimeSig6=57478]="TimeSig6",t[t.TimeSig7=57479]="TimeSig7",t[t.TimeSig8=57480]="TimeSig8",t[t.TimeSig9=57481]="TimeSig9",t[t.TimeSigCommon=57482]="TimeSigCommon",t[t.TimeSigCutCommon=57483]="TimeSigCutCommon",t[t.NoteheadDoubleWholeSquare=57505]="NoteheadDoubleWholeSquare",t[t.NoteheadDoubleWhole=57504]="NoteheadDoubleWhole",t[t.NoteheadWhole=57506]="NoteheadWhole",t[t.NoteheadHalf=57507]="NoteheadHalf",t[t.NoteheadBlack=57508]="NoteheadBlack",t[t.NoteheadNull=57509]="NoteheadNull",t[t.NoteheadXOrnate=57514]="NoteheadXOrnate",t[t.NoteheadTriangleUpWhole=57531]="NoteheadTriangleUpWhole",t[t.NoteheadTriangleUpHalf=57532]="NoteheadTriangleUpHalf",t[t.NoteheadTriangleUpBlack=57534]="NoteheadTriangleUpBlack",t[t.NoteheadDiamondBlackWide=57564]="NoteheadDiamondBlackWide",t[t.NoteheadDiamondWhite=57565]="NoteheadDiamondWhite",t[t.NoteheadDiamondWhiteWide=57566]="NoteheadDiamondWhiteWide",t[t.NoteheadCircleX=57523]="NoteheadCircleX",t[t.NoteheadXWhole=57511]="NoteheadXWhole",t[t.NoteheadXHalf=57512]="NoteheadXHalf",t[t.NoteheadXBlack=57513]="NoteheadXBlack",t[t.NoteheadParenthesis=57550]="NoteheadParenthesis",t[t.NoteheadSlashedBlack2=57552]="NoteheadSlashedBlack2",t[t.NoteheadCircleSlash=57591]="NoteheadCircleSlash",t[t.NoteheadHeavyX=57592]="NoteheadHeavyX",t[t.NoteheadHeavyXHat=57593]="NoteheadHeavyXHat",t[t.NoteQuarterUp=57813]="NoteQuarterUp",t[t.NoteEighthUp=57815]="NoteEighthUp",t[t.Tremolo3=57890]="Tremolo3",t[t.Tremolo2=57889]="Tremolo2",t[t.Tremolo1=57888]="Tremolo1",t[t.FlagEighthUp=57920]="FlagEighthUp",t[t.FlagEighthDown=57921]="FlagEighthDown",t[t.FlagSixteenthUp=57922]="FlagSixteenthUp",t[t.FlagSixteenthDown=57923]="FlagSixteenthDown",t[t.FlagThirtySecondUp=57924]="FlagThirtySecondUp",t[t.FlagThirtySecondDown=57925]="FlagThirtySecondDown",t[t.FlagSixtyFourthUp=57926]="FlagSixtyFourthUp",t[t.FlagSixtyFourthDown=57927]="FlagSixtyFourthDown",t[t.FlagOneHundredTwentyEighthUp=57928]="FlagOneHundredTwentyEighthUp",t[t.FlagOneHundredTwentyEighthDown=57929]="FlagOneHundredTwentyEighthDown",t[t.FlagTwoHundredFiftySixthUp=57930]="FlagTwoHundredFiftySixthUp",t[t.FlagTwoHundredFiftySixthDown=57931]="FlagTwoHundredFiftySixthDown",t[t.AccidentalFlat=57952]="AccidentalFlat",t[t.AccidentalNatural=57953]="AccidentalNatural",t[t.AccidentalSharp=57954]="AccidentalSharp",t[t.AccidentalDoubleSharp=57955]="AccidentalDoubleSharp",t[t.AccidentalDoubleFlat=57956]="AccidentalDoubleFlat",t[t.AccidentalQuarterToneFlatArrowUp=57968]="AccidentalQuarterToneFlatArrowUp",t[t.AccidentalQuarterToneSharpArrowUp=57972]="AccidentalQuarterToneSharpArrowUp",t[t.AccidentalQuarterToneNaturalArrowUp=57970]="AccidentalQuarterToneNaturalArrowUp",t[t.ArticAccentAbove=58528]="ArticAccentAbove",t[t.ArticStaccatoAbove=58530]="ArticStaccatoAbove",t[t.ArticMarcatoAbove=58540]="ArticMarcatoAbove",t[t.FermataAbove=58560]="FermataAbove",t[t.FermataShortAbove=58564]="FermataShortAbove",t[t.FermataLongAbove=58566]="FermataLongAbove",t[t.RestLonga=58593]="RestLonga",t[t.RestDoubleWhole=58594]="RestDoubleWhole",t[t.RestWhole=58595]="RestWhole",t[t.RestHalf=58596]="RestHalf",t[t.RestQuarter=58597]="RestQuarter",t[t.RestEighth=58598]="RestEighth",t[t.RestSixteenth=58599]="RestSixteenth",t[t.RestThirtySecond=58600]="RestThirtySecond",t[t.RestSixtyFourth=58601]="RestSixtyFourth",t[t.RestOneHundredTwentyEighth=58602]="RestOneHundredTwentyEighth",t[t.RestTwoHundredFiftySixth=58603]="RestTwoHundredFiftySixth",t[t.Repeat1Bar=58624]="Repeat1Bar",t[t.Repeat2Bars=58625]="Repeat2Bars",t[t.Ottava=58640]="Ottava",t[t.OttavaAlta=58641]="OttavaAlta",t[t.OttavaBassaVb=58652]="OttavaBassaVb",t[t.Quindicesima=58644]="Quindicesima",t[t.QuindicesimaAlta=58645]="QuindicesimaAlta",t[t.DynamicPPP=58666]="DynamicPPP",t[t.DynamicPP=58667]="DynamicPP",t[t.DynamicPiano=58656]="DynamicPiano",t[t.DynamicMP=58668]="DynamicMP",t[t.DynamicMF=58669]="DynamicMF",t[t.DynamicForte=58658]="DynamicForte",t[t.DynamicFF=58671]="DynamicFF",t[t.DynamicFFF=58672]="DynamicFFF",t[t.OrnamentTrill=58726]="OrnamentTrill",t[t.StringsDownBow=58896]="StringsDownBow",t[t.StringsUpBow=58898]="StringsUpBow",t[t.PictEdgeOfCymbal=59177]="PictEdgeOfCymbal",t[t.GuitarGolpe=59458]="GuitarGolpe",t[t.FretboardX=59481]="FretboardX",t[t.FretboardO=59482]="FretboardO",t[t.WiggleTrill=60068]="WiggleTrill",t[t.WiggleVibratoMediumFast=60126]="WiggleVibratoMediumFast",t[t.OctaveBaselineM=60565]="OctaveBaselineM",t[t.OctaveBaselineB=60563]="OctaveBaselineB"}(Q||(Q={})),function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"}(K||(K={})),function(t){t[t.Top=0]="Top",t[t.Middle=1]="Middle",t[t.Bottom=2]="Bottom"}(Z||(Z={}));var it,nt,rt=function(){function t(t,e,i,n,r,a,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=Q.None),void 0===n&&(n=Q.None),void 0===r&&(r=Q.None),void 0===a&&(a=Q.None),void 0===o&&(o=Z.Middle),this.outputMidiNumber=e,this.staffLine=t,this.noteHeadDefault=i,this.noteHeadHalf=n!==Q.None?n:i,this.noteHeadWhole=r!==Q.None?r:i,this.techniqueSymbol=a,this.techniqueSymbolPlacement=o}return t.copyTo=function(t,e){e.outputMidiNumber=t.outputMidiNumber,e.staffLine=t.staffLine,e.noteHeadDefault=t.noteHeadDefault,e.noteHeadHalf=t.noteHeadHalf,e.noteHeadWhole=t.noteHeadWhole,e.techniqueSymbol=t.techniqueSymbol,e.techniqueSymbolPlacement=t.techniqueSymbolPlacement},t.prototype.getSymbol=function(t){switch(t){case A.Whole:return this.noteHeadWhole;case A.Half:return this.noteHeadHalf;default:return this.noteHeadDefault}},t}(),at=function(){function t(){}return t.articulationFromElementVariation=function(e,i){return e<t.gp6ElementAndVariationToArticulation.length?(i>=t.gp6ElementAndVariationToArticulation.length&&(i=0),t.gp6ElementAndVariationToArticulation[e][i]):38},t.getArticulation=function(e){var i=e.percussionArticulation,n=e.beat.voice.bar.staff.track.percussionArticulations;return i<n.length?n[i]:t.getArticulationByValue(i)},t.getElementAndVariation=function(e){var i=t.getArticulation(e);if(!i)return[-1,-1];for(var n=0;n<t.gp6ElementAndVariationToArticulation.length;n++)for(var r=t.gp6ElementAndVariationToArticulation[n],a=0;a<r.length;a++){var o=t.getArticulationByValue(r[a]);if((null==o?void 0:o.outputMidiNumber)===i.outputMidiNumber)return[n,a]}return[-1,-1]},t.getArticulationByValue=function(e){return t.instrumentArticulations.has(e)?t.instrumentArticulations.get(e):null},t.gp6ElementAndVariationToArticulation=[[35,35,35],[38,91,37],[99,100,99],[56,100,56],[102,103,102],[43,43,43],[45,45,45],[47,47,47],[48,48,48],[50,50,50],[42,92,46],[44,44,44],[57,98,57],[49,97,49],[55,95,55],[51,93,127],[52,96,52]],t.instrumentArticulations=new Map([[38,new rt(3,38,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[37,new rt(3,37,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadXBlack)],[91,new rt(3,38,Q.NoteheadDiamondWhite,Q.NoteheadDiamondWhite,Q.NoteheadDiamondWhite)],[42,new rt(-1,42,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadXBlack)],[92,new rt(-1,46,Q.NoteheadCircleSlash,Q.NoteheadCircleSlash,Q.NoteheadCircleSlash)],[46,new rt(-1,46,Q.NoteheadCircleX,Q.NoteheadCircleX,Q.NoteheadCircleX)],[44,new rt(9,44,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadXBlack)],[35,new rt(8,35,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[36,new rt(7,36,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[50,new rt(1,50,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[48,new rt(2,48,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[47,new rt(4,47,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[45,new rt(5,45,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[43,new rt(6,43,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[93,new rt(0,51,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.PictEdgeOfCymbal,Z.Bottom)],[51,new rt(0,51,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadXBlack)],[53,new rt(0,53,Q.NoteheadDiamondWhite,Q.NoteheadDiamondWhite,Q.NoteheadDiamondWhite)],[94,new rt(0,51,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.ArticStaccatoAbove,Z.Top)],[55,new rt(-2,55,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadXBlack)],[95,new rt(-2,55,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.ArticStaccatoAbove,Z.Bottom)],[52,new rt(-3,52,Q.NoteheadHeavyXHat,Q.NoteheadHeavyXHat,Q.NoteheadHeavyXHat)],[96,new rt(-3,52,Q.NoteheadHeavyXHat,Q.NoteheadHeavyXHat,Q.NoteheadHeavyXHat)],[49,new rt(-2,49,Q.NoteheadHeavyX,Q.NoteheadHeavyX,Q.NoteheadHeavyX)],[97,new rt(-2,49,Q.NoteheadHeavyX,Q.NoteheadHeavyX,Q.NoteheadHeavyX,Q.ArticStaccatoAbove,Z.Bottom)],[57,new rt(-1,57,Q.NoteheadHeavyX,Q.NoteheadHeavyX,Q.NoteheadHeavyX)],[98,new rt(-1,57,Q.NoteheadHeavyX,Q.NoteheadHeavyX,Q.NoteheadHeavyX,Q.ArticStaccatoAbove,Z.Bottom)],[99,new rt(1,56,Q.NoteheadTriangleUpBlack,Q.NoteheadTriangleUpHalf,Q.NoteheadTriangleUpWhole)],[100,new rt(1,56,Q.NoteheadXBlack,Q.NoteheadXHalf,Q.NoteheadXWhole)],[56,new rt(0,56,Q.NoteheadTriangleUpBlack,Q.NoteheadTriangleUpHalf,Q.NoteheadTriangleUpWhole)],[101,new rt(0,56,Q.NoteheadXBlack,Q.NoteheadXHalf,Q.NoteheadXWhole)],[102,new rt(-1,56,Q.NoteheadTriangleUpBlack,Q.NoteheadTriangleUpHalf,Q.NoteheadTriangleUpWhole)],[103,new rt(-1,56,Q.NoteheadXBlack,Q.NoteheadXHalf,Q.NoteheadXWhole)],[77,new rt(-9,77,Q.NoteheadTriangleUpBlack,Q.NoteheadTriangleUpBlack,Q.NoteheadTriangleUpBlack)],[76,new rt(-10,76,Q.NoteheadTriangleUpBlack,Q.NoteheadTriangleUpBlack,Q.NoteheadTriangleUpBlack)],[60,new rt(-4,60,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[104,new rt(-5,60,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole,Q.NoteheadParenthesis,Z.Middle)],[105,new rt(-6,60,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadXBlack)],[61,new rt(-7,61,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[106,new rt(-8,61,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole,Q.NoteheadParenthesis,Z.Middle)],[107,new rt(-16,61,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadXBlack)],[66,new rt(10,66,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[65,new rt(9,65,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[68,new rt(12,68,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[67,new rt(11,67,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[64,new rt(17,64,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[108,new rt(16,64,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadXBlack)],[109,new rt(15,64,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole,Q.NoteheadParenthesis,Z.Middle)],[63,new rt(14,63,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[110,new rt(13,63,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadXBlack)],[62,new rt(19,62,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole,Q.NoteheadParenthesis,Z.Middle)],[72,new rt(-11,72,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[71,new rt(-17,71,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[73,new rt(38,73,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[74,new rt(37,74,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[86,new rt(36,86,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[87,new rt(35,87,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadParenthesis,Z.Middle)],[54,new rt(3,54,Q.NoteheadTriangleUpBlack,Q.NoteheadTriangleUpBlack,Q.NoteheadTriangleUpBlack)],[111,new rt(2,54,Q.NoteheadTriangleUpBlack,Q.NoteheadTriangleUpBlack,Q.NoteheadTriangleUpBlack,Q.StringsUpBow,Z.Bottom)],[112,new rt(1,54,Q.NoteheadTriangleUpBlack,Q.NoteheadTriangleUpBlack,Q.NoteheadTriangleUpBlack,Q.StringsDownBow,Z.Bottom)],[113,new rt(-7,54,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadXBlack)],[79,new rt(30,79,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[78,new rt(29,78,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadXBlack)],[58,new rt(28,58,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[81,new rt(27,81,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[80,new rt(26,80,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadParenthesis,Z.Middle)],[114,new rt(25,43,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[115,new rt(18,49,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[116,new rt(24,49,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadXBlack)],[69,new rt(23,69,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[117,new rt(22,69,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole,Q.StringsUpBow,Z.Bottom)],[85,new rt(21,85,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[75,new rt(20,75,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[70,new rt(-12,70,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[118,new rt(-13,70,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole,Q.StringsUpBow,Z.Bottom)],[119,new rt(-14,70,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[120,new rt(-15,70,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole,Q.StringsUpBow,Z.Bottom)],[82,new rt(-23,54,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[122,new rt(-24,54,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole,Q.StringsUpBow,Z.Bottom)],[84,new rt(-18,53,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[123,new rt(-19,53,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole,Q.StringsUpBow,Z.Bottom)],[83,new rt(-20,53,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[124,new rt(-21,62,Q.NoteheadNull,Q.NoteheadNull,Q.NoteheadNull,Q.GuitarGolpe,Z.Top)],[125,new rt(-22,62,Q.NoteheadNull,Q.NoteheadNull,Q.NoteheadNull,Q.GuitarGolpe,Z.Bottom)],[39,new rt(3,39,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[40,new rt(3,40,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[31,new rt(3,40,Q.NoteheadSlashedBlack2,Q.NoteheadSlashedBlack2,Q.NoteheadSlashedBlack2)],[41,new rt(5,41,Q.NoteheadBlack,Q.NoteheadHalf,Q.NoteheadWhole)],[59,new rt(2,59,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.PictEdgeOfCymbal,Z.Bottom)],[126,new rt(2,59,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadXBlack)],[127,new rt(2,59,Q.NoteheadDiamondWhite,Q.NoteheadDiamondWhite,Q.NoteheadDiamondWhite)],[29,new rt(2,59,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.ArticStaccatoAbove,Z.Top)],[30,new rt(-3,49,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadXBlack)],[33,new rt(3,37,Q.NoteheadXBlack,Q.NoteheadXBlack,Q.NoteheadXBlack)],[34,new rt(3,38,Q.NoteheadBlack,Q.NoteheadBlack,Q.NoteheadBlack)]]),t}(),ot=function(){function e(){this.id=e.GlobalNoteId++,this.index=0,this.accentuated=S.None,this.bendType=E.None,this.bendStyle=L.Default,this.bendOrigin=null,this.isContinuedBend=!1,this.bendPoints=[],this.maxBendPoint=null,this.fret=-1,this.string=-1,this.octave=-1,this.tone=-1,this.percussionArticulation=-1,this.isVisible=!0,this.isLeftHandTapped=!1,this.isHammerPullOrigin=!1,this.hammerPullOrigin=null,this.hammerPullDestination=null,this.isSlurDestination=!1,this.slurOrigin=null,this.slurDestination=null,this.harmonicType=G.None,this.harmonicValue=0,this.isGhost=!1,this.isLetRing=!1,this.letRingDestination=null,this.isPalmMute=!1,this.palmMuteDestination=null,this.isDead=!1,this.isStaccato=!1,this.slideInType=V.None,this.slideOutType=H.None,this.slideTarget=null,this.slideOrigin=null,this.vibrato=W.None,this.tieOrigin=null,this.tieDestination=null,this.isTieDestination=!1,this.leftHandFinger=r.Unknown,this.rightHandFinger=r.Unknown,this.isFingering=!1,this.trillValue=-1,this.trillSpeed=A.ThirtySecond,this.durationPercent=1,this.accidentalMode=j.Default,this.dynamics=I.F,this.isEffectSlurOrigin=!1,this.hasEffectSlur=!1,this.effectSlurOrigin=null,this.effectSlurDestination=null}return Object.defineProperty(e.prototype,"hasBend",{get:function(){return this.bendType!==E.None},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isStringed",{get:function(){return this.string>=0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPiano",{get:function(){return!this.isStringed&&this.octave>=0&&this.tone>=0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPercussion",{get:function(){return!this.isStringed&&this.percussionArticulation>=0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"element",{get:function(){return this.isPercussion?at.getElementAndVariation(this)[0]:-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"variation",{get:function(){return this.isPercussion?at.getElementAndVariation(this)[1]:-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHammerPullDestination",{get:function(){return!!this.hammerPullOrigin},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSlurOrigin",{get:function(){return!!this.slurDestination},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHarmonic",{get:function(){return this.harmonicType!==G.None},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isTieOrigin",{get:function(){return!!this.tieDestination},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trillFret",{get:function(){return this.trillValue-this.stringTuning},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isTrill",{get:function(){return this.trillValue>=0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEffectSlurDestination",{get:function(){return!!this.effectSlurOrigin},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stringTuning",{get:function(){return this.beat.voice.bar.staff.capo+e.getStringTuning(this.beat.voice.bar.staff,this.string)},enumerable:!1,configurable:!0}),e.getStringTuning=function(t,e){return t.tuning.length>0?t.tuning[t.tuning.length-(e-1)-1]:0},Object.defineProperty(e.prototype,"realValue",{get:function(){return this.isPercussion?this.percussionArticulation:this.isStringed?this.harmonicType===G.Natural?this.harmonicPitch+this.stringTuning-this.beat.voice.bar.staff.transpositionPitch:this.fret+this.stringTuning-this.beat.voice.bar.staff.transpositionPitch+this.harmonicPitch:this.isPiano?12*this.octave+this.tone-this.beat.voice.bar.staff.transpositionPitch:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"harmonicPitch",{get:function(){if(this.harmonicType===G.None||!this.isStringed)return 0;var t=this.harmonicValue;return g.isAlmostEqualTo(t,2.4)?36:g.isAlmostEqualTo(t,2.7)?34:t<3?0:t<=3.5?31:t<=4?28:t<=5?24:t<=6?34:t<=7?19:t<=8.5?36:t<=9?28:t<=10?34:t<=11?0:t<=12?12:t<14?0:t<=15?34:t<=16?28:t<=17?36:t<=18?0:t<=19?19:t<=21?0:t<=22?36:t<=24?24:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"initialBendValue",{get:function(){return this.hasBend?this.bendPoints[0].value/2|0:this.bendOrigin?this.bendOrigin.bendPoints[this.bendOrigin.bendPoints.length-1].value/2|0:this.isTieDestination&&this.tieOrigin.bendOrigin?this.tieOrigin.bendOrigin.bendPoints[this.tieOrigin.bendOrigin.bendPoints.length-1].value/2|0:this.beat.hasWhammyBar?this.beat.whammyBarPoints[0].value/2|0:this.beat.isContinuedWhammy?this.beat.previousBeat.whammyBarPoints[this.beat.previousBeat.whammyBarPoints.length-1].value/2|0:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"displayValue",{get:function(){return this.displayValueWithoutBend+this.initialBendValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"displayValueWithoutBend",{get:function(){var t=this.realValue;switch(this.harmonicType!==G.Natural&&this.harmonicType!==G.None&&(t-=this.harmonicPitch),this.beat.ottava){case x._15ma:t-=24;break;case x._8va:t-=12;break;case x.Regular:break;case x._8vb:t+=12;break;case x._15mb:t+=24}switch(this.beat.voice.bar.clefOttava){case x._15ma:t-=24;break;case x._8va:t-=12;break;case x.Regular:break;case x._8vb:t+=12;break;case x._15mb:t+=24}return t-this.beat.voice.bar.staff.displayTranspositionPitch},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasQuarterToneOffset",{get:function(){return this.hasBend?this.bendPoints[0].value%2!=0:this.bendOrigin?this.bendOrigin.bendPoints[this.bendOrigin.bendPoints.length-1].value%2!=0:this.beat.hasWhammyBar?this.beat.whammyBarPoints[0].value%2!=0:!!this.beat.isContinuedWhammy&&this.beat.previousBeat.whammyBarPoints[this.beat.previousBeat.whammyBarPoints.length-1].value%2!=0},enumerable:!1,configurable:!0}),e.copyTo=function(t,e){e.id=t.id,e.accentuated=t.accentuated,e.fret=t.fret,e.string=t.string,e.harmonicValue=t.harmonicValue,e.harmonicType=t.harmonicType,e.isGhost=t.isGhost,e.isLetRing=t.isLetRing,e.isPalmMute=t.isPalmMute,e.isDead=t.isDead,e.isStaccato=t.isStaccato,e.slideInType=t.slideInType,e.slideOutType=t.slideOutType,e.vibrato=t.vibrato,e.isTieDestination=t.isTieDestination,e.isSlurDestination=t.isSlurDestination,e.isHammerPullOrigin=t.isHammerPullOrigin,e.leftHandFinger=t.leftHandFinger,e.rightHandFinger=t.rightHandFinger,e.isFingering=t.isFingering,e.trillValue=t.trillValue,e.trillSpeed=t.trillSpeed,e.durationPercent=t.durationPercent,e.accidentalMode=t.accidentalMode,e.dynamics=t.dynamics,e.octave=t.octave,e.tone=t.tone,e.percussionArticulation=t.percussionArticulation,e.bendType=t.bendType,e.bendStyle=t.bendStyle,e.isContinuedBend=t.isContinuedBend,e.isVisible=t.isVisible,e.isLeftHandTapped=t.isLeftHandTapped},e.prototype.clone=function(){var t=new e,i=t.id;e.copyTo(this,t);for(var n=0,r=this.bendPoints.length;n<r;n++)t.addBendPoint(this.bendPoints[n].clone());return t.id=i,t},e.prototype.addBendPoint=function(t){this.bendPoints.push(t),(!this.maxBendPoint||t.value>this.maxBendPoint.value)&&(this.maxBendPoint=t),this.bendType===E.None&&(this.bendType=E.Custom)},e.prototype.finish=function(i){var n=this,r=new J((function(){return e.nextNoteOnSameLine(n)})),a=i&&i.notation.notationMode===t.NotationMode.SongBook;switch(this.isTieDestination&&(this.chain(),a&&this.tieOrigin&&this.tieOrigin.isLetRing&&(this.isLetRing=!0)),this.isLetRing&&(r.value&&r.value.isLetRing?this.letRingDestination=r.value:this.letRingDestination=this,a&&this.isTieDestination&&!this.tieOrigin.hasBend&&(this.isVisible=!1)),this.isPalmMute&&(r.value&&r.value.isPalmMute?this.palmMuteDestination=r.value:this.palmMuteDestination=this),this.isHammerPullOrigin&&(this.hammerPullDestination=e.findHammerPullDestination(this),this.hammerPullDestination?this.hammerPullDestination.hammerPullOrigin=this:this.isHammerPullOrigin=!1),this.slideOutType){case H.Shift:case H.Legato:this.slideTarget=r.value,this.slideTarget?this.slideTarget.slideOrigin=this:this.slideOutType=H.None}var o=null;if(this.isHammerPullOrigin&&this.hammerPullDestination?o=this.hammerPullDestination:this.slideOutType===H.Legato&&this.slideTarget&&(o=this.slideTarget),o&&(this.hasEffectSlur=!0,this.effectSlurOrigin&&this.beat.pickStroke===q.None?(this.effectSlurOrigin.effectSlurDestination=o,this.effectSlurOrigin.effectSlurDestination.effectSlurOrigin=this.effectSlurOrigin,this.effectSlurOrigin=null):(this.isEffectSlurOrigin=!0,this.effectSlurDestination=o,this.effectSlurDestination.effectSlurOrigin=this)),this.bendPoints.length>0&&this.bendType===E.Custom){var s=this.isContinuedBend=!!this.tieOrigin&&this.tieOrigin.hasBend;if(4===this.bendPoints.length){var h=this.bendPoints[0],c=this.bendPoints[1],l=this.bendPoints[2],u=this.bendPoints[3];c.value===l.value?u.value>h.value?c.value>u.value?this.bendType=E.BendRelease:!s&&h.value>0?(this.bendType=E.PrebendBend,this.bendPoints.splice(2,1),this.bendPoints.splice(1,1)):(this.bendType=E.Bend,this.bendPoints.splice(2,1),this.bendPoints.splice(1,1)):u.value<h.value?s?(this.bendType=E.Release,this.bendPoints.splice(2,1),this.bendPoints.splice(1,1)):(this.bendType=E.PrebendRelease,this.bendPoints.splice(2,1),this.bendPoints.splice(1,1)):c.value>h.value?this.bendType=E.BendRelease:h.value>0&&!s?(this.bendType=E.Prebend,this.bendPoints.splice(2,1),this.bendPoints.splice(1,1)):(this.bendType=E.Hold,this.bendPoints.splice(2,1),this.bendPoints.splice(1,1)):et.warning("Model","Unsupported bend type detected, fallback to custom",null)}else if(2===this.bendPoints.length){var p=this.bendPoints[0];(u=this.bendPoints[1]).value>p.value?!s&&p.value>0?this.bendType=E.PrebendBend:this.bendType=E.Bend:u.value<p.value?this.bendType=s?E.Release:E.PrebendRelease:this.bendType=E.Hold}}else 0===this.bendPoints.length&&(this.bendType=E.None);this.initialBendValue>0&&(this.accidentalMode=j.Default)},e.nextNoteOnSameLine=function(t){for(var i=t.beat.nextBeat;i&&i.voice.bar.index<=t.beat.voice.bar.index+e.MaxOffsetForSameLineSearch;){var n=i.getNoteOnString(t.string);if(n)return n;i=i.nextBeat}return null},e.findHammerPullDestination=function(t){for(var i=t.beat.nextBeat;i&&i.voice.bar.index<=t.beat.voice.bar.index+e.MaxOffsetForSameLineSearch;){var n=i.getNoteOnString(t.string);if(n)return n;for(var r=t.string;r>0;r--)if(n=i.getNoteOnString(r)){if(n.isLeftHandTapped)return n;break}for(r=t.string;r<=t.beat.voice.bar.staff.tuning.length;r++)if(n=i.getNoteOnString(r)){if(n.isLeftHandTapped)return n;break}i=i.nextBeat}return null},e.findTieOrigin=function(t){for(var i=t.beat.previousBeat;i&&i.voice.bar.index>=t.beat.voice.bar.index-e.MaxOffsetForSameLineSearch;){if(t.isStringed){var n=i.getNoteOnString(t.string);if(n)return n}else if(-1===t.octave&&-1===t.tone){if(t.index<i.notes.length)return i.notes[t.index]}else{var r=i.getNoteWithRealValue(t.realValue);if(r)return r}i=i.previousBeat}return null},e.prototype.chain=function(){this.isTieDestination&&(this.tieOrigin||(this.tieOrigin=e.findTieOrigin(this)),this.tieOrigin?(this.tieOrigin.tieDestination=this,this.fret=this.tieOrigin.fret,this.octave=this.tieOrigin.octave,this.tone=this.tieOrigin.tone,this.tieOrigin.hasBend&&(this.bendOrigin=this.tieOrigin)):this.isTieDestination=!1)},e.GlobalNoteId=0,e.MaxOffsetForSameLineSearch=3,e}(),st=function(){function t(t){this._isEqualLengthTuplet=!0,this.totalDuration=0,this.beats=[],this.isFull=!1,this.voice=t}return t.prototype.check=function(e){if(0===this.beats.length)return this.beats.push(e),this.totalDuration+=e.playbackDuration,!0;if(e.graceType!==R.None)return!0;if(e.voice!==this.voice||this.isFull||e.tupletNumerator!==this.beats[0].tupletNumerator||e.tupletDenominator!==this.beats[0].tupletDenominator)return!1;if(e.playbackDuration!==this.beats[0].playbackDuration&&(this._isEqualLengthTuplet=!1),this.beats.push(e),this.totalDuration+=e.playbackDuration,this._isEqualLengthTuplet)this.beats.length===this.beats[0].tupletNumerator&&(this.isFull=!0);else for(var i=this.beats[0].tupletNumerator/this.beats[0].tupletDenominator|0,n=0,r=t.AllTicks;n<r.length;n++){var a=r[n];if(this.totalDuration===a*i){this.isFull=!0;break}}return!0},t.HalfTicks=1920,t.QuarterTicks=960,t.EighthTicks=480,t.SixteenthTicks=240,t.ThirtySecondTicks=120,t.SixtyFourthTicks=60,t.OneHundredTwentyEighthTicks=30,t.TwoHundredFiftySixthTicks=15,t.AllTicks=[t.HalfTicks,t.QuarterTicks,t.EighthTicks,t.SixteenthTicks,t.ThirtySecondTicks,t.SixtyFourthTicks,t.OneHundredTwentyEighthTicks,t.TwoHundredFiftySixthTicks],t}();!function(t){t[t.None=0]="None",t[t.Custom=1]="Custom",t[t.Dive=2]="Dive",t[t.Dip=3]="Dip",t[t.Hold=4]="Hold",t[t.Predive=5]="Predive",t[t.PrediveDive=6]="PrediveDive"}(it||(it={})),function(t){t[t.Auto=0]="Auto",t[t.ForceSplitToNext=1]="ForceSplitToNext",t[t.ForceMergeWithNext=2]="ForceMergeWithNext"}(nt||(nt={}));var ht,ct=function(){function e(){this.id=e._globalBeatId++,this.index=0,this.previousBeat=null,this.nextBeat=null,this.notes=[],this.noteStringLookup=new Map,this.noteValueLookup=new Map,this.isEmpty=!1,this.whammyStyle=L.Default,this.ottava=x.Regular,this.fermata=null,this.isLegatoOrigin=!1,this.minNote=null,this.maxNote=null,this.maxStringNote=null,this.minStringNote=null,this.duration=A.Quarter,this.isLetRing=!1,this.isPalmMute=!1,this.automations=[],this.dots=0,this.fadeIn=!1,this.lyrics=null,this.hasRasgueado=!1,this.pop=!1,this.slap=!1,this.tap=!1,this.text=null,this.brushType=M.None,this.brushDuration=0,this.tupletDenominator=-1,this.tupletNumerator=-1,this.tupletGroup=null,this.isContinuedWhammy=!1,this.whammyBarType=it.None,this.whammyBarPoints=[],this.maxWhammyPoint=null,this.minWhammyPoint=null,this.vibrato=W.None,this.chordId=null,this.graceType=R.None,this.pickStroke=q.None,this.tremoloSpeed=null,this.crescendo=D.None,this.displayStart=0,this.playbackStart=0,this.displayDuration=0,this.playbackDuration=0,this.dynamics=I.F,this.invertBeamDirection=!1,this.preferredBeamDirection=null,this.isEffectSlurOrigin=!1,this.effectSlurOrigin=null,this.effectSlurDestination=null,this.beamingMode=nt.Auto}return Object.defineProperty(e.prototype,"isLastOfVoice",{get:function(){return this.index===this.voice.beats.length-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLegatoDestination",{get:function(){return!!this.previousBeat&&this.previousBeat.isLegatoOrigin},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isRest",{get:function(){return this.isEmpty||0===this.notes.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasTuplet",{get:function(){return!(-1===this.tupletDenominator&&-1===this.tupletNumerator||1===this.tupletDenominator&&1===this.tupletNumerator)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasWhammyBar",{get:function(){return this.whammyBarType!==it.None},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasChord",{get:function(){return!!this.chordId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"chord",{get:function(){return this.chordId?this.voice.bar.staff.chords.get(this.chordId):null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isTremolo",{get:function(){return!!this.tremoloSpeed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"absoluteDisplayStart",{get:function(){return this.voice.bar.masterBar.start+this.displayStart},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"absolutePlaybackStart",{get:function(){return this.voice.bar.masterBar.start+this.playbackStart},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEffectSlurDestination",{get:function(){return!!this.effectSlurOrigin},enumerable:!1,configurable:!0}),e.copyTo=function(t,e){if(e.id=t.id,e.index=t.index,e.isEmpty=t.isEmpty,e.duration=t.duration,e.dots=t.dots,e.fadeIn=t.fadeIn,t.lyrics){e.lyrics=new Array(t.lyrics.length);for(var i=0;i<t.lyrics.length;i++)e.lyrics[i]=t.lyrics[i]}e.pop=t.pop,e.hasRasgueado=t.hasRasgueado,e.slap=t.slap,e.tap=t.tap,e.text=t.text,e.brushType=t.brushType,e.brushDuration=t.brushDuration,e.tupletDenominator=t.tupletDenominator,e.tupletNumerator=t.tupletNumerator,e.vibrato=t.vibrato,e.chordId=t.chordId,e.graceType=t.graceType,e.pickStroke=t.pickStroke,e.tremoloSpeed=t.tremoloSpeed,e.crescendo=t.crescendo,e.displayStart=t.displayStart,e.displayDuration=t.displayDuration,e.playbackStart=t.playbackStart,e.playbackDuration=t.playbackDuration,e.dynamics=t.dynamics,e.isLegatoOrigin=t.isLegatoOrigin,e.invertBeamDirection=t.invertBeamDirection,e.preferredBeamDirection=t.preferredBeamDirection,e.whammyBarType=t.whammyBarType,e.isContinuedWhammy=t.isContinuedWhammy,e.ottava=t.ottava,e.whammyStyle=t.whammyStyle,e.beamingMode=t.beamingMode},e.prototype.clone=function(){for(var t=new e,i=t.id,n=0,r=this.whammyBarPoints;n<r.length;n++){var a=r[n];t.addWhammyBarPoint(a.clone())}for(var o=0,s=this.notes;o<s.length;o++){var h=s[o];t.addNoteInternal(h.clone(),h.realValue)}e.copyTo(this,t);for(var c=0,l=this.automations;c<l.length;c++){var u=l[c];t.automations.push(u.clone())}return t.id=i,t},e.prototype.addWhammyBarPoint=function(t){this.whammyBarPoints.push(t),(!this.maxWhammyPoint||t.value>this.maxWhammyPoint.value)&&(this.maxWhammyPoint=t),(!this.minWhammyPoint||t.value<this.minWhammyPoint.value)&&(this.minWhammyPoint=t),this.whammyBarType===it.None&&(this.whammyBarType=it.Custom)},e.prototype.removeWhammyBarPoint=function(t){if(!(t<0||t>=this.whammyBarPoints.length)){this.whammyBarPoints.splice(t,1);var e=this.whammyBarPoints[t];if(e===this.maxWhammyPoint){this.maxWhammyPoint=null;for(var i=0,n=this.whammyBarPoints;i<n.length;i++){var r=n[i];(!this.maxWhammyPoint||r.value>this.maxWhammyPoint.value)&&(this.maxWhammyPoint=r)}}if(e===this.minWhammyPoint){this.minWhammyPoint=null;for(var a=0,o=this.whammyBarPoints;a<o.length;a++){r=o[a];(!this.minWhammyPoint||r.value<this.minWhammyPoint.value)&&(this.minWhammyPoint=r)}}}},e.prototype.addNote=function(t){this.addNoteInternal(t,-1)},e.prototype.addNoteInternal=function(t,e){void 0===e&&(e=-1),t.beat=this,t.index=this.notes.length,this.notes.push(t),t.isStringed&&this.noteStringLookup.set(t.string,t),-1===e&&(e=t.realValue),this.noteValueLookup.set(e,t)},e.prototype.removeNote=function(t){var e=this.notes.indexOf(t);e>=0&&this.notes.splice(e,1)},e.prototype.getAutomation=function(t){for(var e=0,i=this.automations.length;e<i;e++){var n=this.automations[e];if(n.type===t)return n}return null},e.prototype.getNoteOnString=function(t){return this.noteStringLookup.has(t)?this.noteStringLookup.get(t):null},e.prototype.calculateDuration=function(){var t=z.toTicks(this.duration);return 2===this.dots?t=z.applyDot(t,!0):1===this.dots&&(t=z.applyDot(t,!1)),this.tupletDenominator>0&&this.tupletNumerator>=0&&(t=z.applyTuplet(t,this.tupletNumerator,this.tupletDenominator)),t},e.prototype.updateDurations=function(){var t=this.calculateDuration();switch(this.playbackDuration=t,this.displayDuration=t,this.graceType){case R.BeforeBeat:case R.OnBeat:switch(this.duration){case A.Sixteenth:this.playbackDuration=z.toTicks(A.SixtyFourth);break;case A.ThirtySecond:this.playbackDuration=z.toTicks(A.OneHundredTwentyEighth);break;default:this.playbackDuration=z.toTicks(A.ThirtySecond)}break;case R.BendGrace:this.playbackDuration/=2;break;default:var e=this.previousBeat;if(e&&e.graceType===R.BendGrace)this.playbackDuration=e.playbackDuration;else for(;e&&e.graceType===R.OnBeat;)this.playbackDuration-=e.playbackDuration,e=e.previousBeat}},e.prototype.finishTuplet=function(){var t=this.previousBeat,e=t?t.tupletGroup:null;(this.hasTuplet||this.graceType!==R.None&&e)&&(t&&e&&e.check(this)||(e=new st(this.voice)).check(this),this.tupletGroup=e)},e.prototype.finish=function(i){var n=i?i.notation.notationMode:t.NotationMode.GuitarPro,r="grad"===this.text||"grad."===this.text;r&&n===t.NotationMode.SongBook&&(this.text="");var a=!1;this.minNote=null,this.maxNote=null,this.minStringNote=null,this.maxStringNote=null;for(var o=0,s=!1,h=0,c=this.notes.length;h<c;h++){if((b=this.notes[h]).finish(i),b.isLetRing&&(this.isLetRing=!0),b.isPalmMute&&(this.isPalmMute=!0),n===t.NotationMode.SongBook&&b.hasBend&&this.graceType!==R.BendGrace){if(!b.isTieOrigin)switch(b.bendType){case E.Bend:case E.PrebendRelease:case E.PrebendBend:a=!0}r||b.bendStyle===L.Gradual?(r=!0,b.bendStyle=L.Gradual,a=!1):b.bendStyle=L.Fast}b.isVisible&&(o++,(!this.minNote||b.realValue<this.minNote.realValue)&&(this.minNote=b),(!this.maxNote||b.realValue>this.maxNote.realValue)&&(this.maxNote=b),(!this.minStringNote||b.string<this.minStringNote.string)&&(this.minStringNote=b),(!this.maxStringNote||b.string>this.maxStringNote.string)&&(this.maxStringNote=b),b.hasEffectSlur&&(s=!0))}if(s&&(this.effectSlurOrigin?(this.effectSlurOrigin.effectSlurDestination=this.nextBeat,this.effectSlurOrigin.effectSlurDestination&&(this.effectSlurOrigin.effectSlurDestination.effectSlurOrigin=this.effectSlurOrigin),this.effectSlurOrigin=null):(this.isEffectSlurOrigin=!0,this.effectSlurDestination=this.nextBeat,this.effectSlurDestination&&(this.effectSlurDestination.effectSlurOrigin=this))),this.notes.length>0&&0===o&&(this.isEmpty=!0),this.isRest||this.isLetRing&&this.isPalmMute)this.isRest&&this.previousBeat&&i&&i.notation.notationMode===t.NotationMode.GuitarPro&&(this.previousBeat.isLetRing&&(this.isLetRing=!0),this.previousBeat.isPalmMute&&(this.isPalmMute=!0));else for(var l=this.previousBeat;l&&l.isRest;)this.isLetRing||(l.isLetRing=!1),this.isPalmMute||(l.isPalmMute=!1),l=l.previousBeat;if(this.whammyBarPoints.length>0&&this.whammyBarType===it.Custom){n===t.NotationMode.SongBook&&(this.whammyStyle=r?L.Gradual:L.Fast);var u=!!this.previousBeat&&this.previousBeat.hasWhammyBar;if(this.isContinuedWhammy=u,4===this.whammyBarPoints.length){var p=this.whammyBarPoints[0],d=this.whammyBarPoints[1],f=this.whammyBarPoints[2],y=this.whammyBarPoints[3];d.value===f.value?p.value<d.value&&d.value<y.value||p.value>d.value&&d.value>y.value?(0===p.value||u?this.whammyBarType=it.Dive:this.whammyBarType=it.PrediveDive,this.whammyBarPoints.splice(2,1),this.whammyBarPoints.splice(1,1)):p.value>d.value&&d.value<y.value||p.value<d.value&&d.value>y.value?(this.whammyBarType=it.Dip,d.offset!==f.offset&&n!==t.NotationMode.SongBook||this.whammyBarPoints.splice(2,1)):p.value===d.value&&d.value===y.value?(0===p.value||u?this.whammyBarType=it.Hold:this.whammyBarType=it.Predive,this.whammyBarPoints.splice(2,1),this.whammyBarPoints.splice(1,1)):et.warning("Model","Unsupported whammy type detected, fallback to custom",null):et.warning("Model","Unsupported whammy type detected, fallback to custom",null)}}if(this.updateDurations(),a){var g=this.clone();g.id=e._globalBeatId++,g.pickStroke=q.None;for(h=0,c=g.notes.length;h<c;h++){var m=g.notes[h],b=this.notes[h];if(m.bendType=E.None,m.maxBendPoint=null,m.bendPoints=[],m.bendStyle=L.Default,m.id=ot.GlobalNoteId++,b.isTieOrigin&&(m.tieDestination=b.tieDestination,b.tieDestination.tieOrigin=m),b.isTieDestination&&(m.tieOrigin=b.tieOrigin,b.tieOrigin.tieDestination=m),b.hasBend&&b.isTieOrigin){var v=ot.findTieOrigin(b);if(v&&v.hasBend){m.bendType=E.Hold;var _=b.bendPoints[b.bendPoints.length-1];m.addBendPoint(new X(0,_.value)),m.addBendPoint(new X(X.MaxPosition,_.value))}}m.isTieDestination=!0}this.graceType=R.BendGrace,this.updateDurations(),this.voice.insertBeat(this,g)}},e.prototype.isBefore=function(t){return this.voice.bar.index<t.voice.bar.index||t.voice.bar.index===this.voice.bar.index&&this.index<t.index},e.prototype.isAfter=function(t){return this.voice.bar.index>t.voice.bar.index||t.voice.bar.index===this.voice.bar.index&&this.index>t.index},e.prototype.hasNoteOnString=function(t){return this.noteStringLookup.has(t)},e.prototype.getNoteWithRealValue=function(t){return this.noteValueLookup.has(t)?this.noteValueLookup.get(t):null},e.prototype.chain=function(){for(var t=0,e=this.notes;t<e.length;t++){e[t].chain()}},e._globalBeatId=0,e}(),lt=function(){function t(){this.name="",this.firstFret=1,this.strings=[],this.barreFrets=[],this.showName=!0,this.showDiagram=!0,this.showFingering=!0}return t.copyTo=function(t,e){e.firstFret=t.firstFret,e.name=t.name,e.strings=t.strings.slice(0),e.barreFrets=t.barreFrets.slice(0),e.showName=t.showName,e.showDiagram=t.showDiagram,e.showFingering=t.showFingering},t}();!function(t){t[t.IgnoreSpaces=0]="IgnoreSpaces",t[t.Begin=1]="Begin",t[t.Text=2]="Text",t[t.Comment=3]="Comment",t[t.Dash=4]="Dash"}(ht||(ht={}));var ut,pt,dt,ft=function(){function t(){this.startBar=0,this.text=""}return t.prototype.finish=function(){this.chunks=[],this.parse(this.text,0,this.chunks)},t.prototype.parse=function(e,i,n){if(e){for(var r=ht.Begin,a=ht.Begin,o=!1,s=0;i<e.length;){var h=e.charCodeAt(i);switch(r){case ht.IgnoreSpaces:switch(h){case t.CharCodeLF:case t.CharCodeCR:case t.CharCodeTab:break;case t.CharCodeSpace:if(!o){r=a;continue}break;default:o=!1,r=a;continue}break;case ht.Begin:switch(h){case t.CharCodeBrackedOpen:r=ht.Comment;break;default:s=i,r=ht.Text;continue}break;case ht.Comment:switch(h){case t.CharCodeBrackedClose:r=ht.Begin}break;case ht.Text:switch(h){case t.CharCodeDash:r=ht.Dash;break;case t.CharCodeCR:case t.CharCodeLF:case t.CharCodeSpace:var c=e.substr(s,i-s);n.push(this.prepareChunk(c)),r=ht.IgnoreSpaces,a=ht.Begin}break;case ht.Dash:switch(h){case t.CharCodeDash:break;default:c=e.substr(s,i-s);n.push(this.prepareChunk(c)),o=!0,r=ht.IgnoreSpaces,a=ht.Begin;continue}}i++}r===ht.Text&&i!==s&&n.push(e.substr(s,i-s))}},t.prototype.prepareChunk=function(t){return t.split("+").join(" ")},t.CharCodeLF=10,t.CharCodeTab=9,t.CharCodeCR=13,t.CharCodeSpace=32,t.CharCodeBrackedClose=93,t.CharCodeBrackedOpen=91,t.CharCodeDash=45,t}();!function(t){t[t.Cb=-7]="Cb",t[t.Gb=-6]="Gb",t[t.Db=-5]="Db",t[t.Ab=-4]="Ab",t[t.Eb=-3]="Eb",t[t.Bb=-2]="Bb",t[t.F=-1]="F",t[t.C=0]="C",t[t.G=1]="G",t[t.D=2]="D",t[t.A=3]="A",t[t.E=4]="E",t[t.B=5]="B",t[t.FSharp=6]="FSharp",t[t.CSharp=7]="CSharp"}(ut||(ut={})),function(t){t[t.Major=0]="Major",t[t.Minor=1]="Minor"}(pt||(pt={})),function(t){t[t.NoTripletFeel=0]="NoTripletFeel",t[t.Triplet16th=1]="Triplet16th",t[t.Triplet8th=2]="Triplet8th",t[t.Dotted16th=3]="Dotted16th",t[t.Dotted8th=4]="Dotted8th",t[t.Scottish16th=5]="Scottish16th",t[t.Scottish8th=6]="Scottish8th"}(dt||(dt={}));var yt=function(){function t(){this.alternateEndings=0,this.nextMasterBar=null,this.previousMasterBar=null,this.index=0,this.keySignature=ut.C,this.keySignatureType=pt.Major,this.isDoubleBar=!1,this.isRepeatStart=!1,this.repeatCount=0,this.timeSignatureNumerator=4,this.timeSignatureDenominator=4,this.timeSignatureCommon=!1,this.tripletFeel=dt.NoTripletFeel,this.section=null,this.tempoAutomation=null,this.fermata=new Map,this.start=0,this.isAnacrusis=!1}return Object.defineProperty(t.prototype,"isRepeatEnd",{get:function(){return this.repeatCount>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSectionStart",{get:function(){return!!this.section},enumerable:!1,configurable:!0}),t.copyTo=function(t,e){e.isAnacrusis=t.isAnacrusis,e.alternateEndings=t.alternateEndings,e.index=t.index,e.keySignature=t.keySignature,e.keySignatureType=t.keySignatureType,e.isDoubleBar=t.isDoubleBar,e.isRepeatStart=t.isRepeatStart,e.repeatCount=t.repeatCount,e.timeSignatureNumerator=t.timeSignatureNumerator,e.timeSignatureDenominator=t.timeSignatureDenominator,e.timeSignatureCommon=t.timeSignatureCommon,e.tripletFeel=t.tripletFeel,e.start=t.start},t.prototype.calculateDuration=function(t){if(void 0===t&&(t=!0),this.isAnacrusis&&t){for(var e=0,i=0,n=this.score.tracks;i<n.length;i++)for(var r=0,a=n[i].staves;r<a.length;r++){var o=a[r],s=this.index<o.bars.length?o.bars[this.index].calculateDuration():0;s>e&&(e=s)}return e}return this.timeSignatureNumerator*z.valueToTicks(this.timeSignatureDenominator)},t.prototype.addFermata=function(t,e){this.fermata.set(t,e)},t.prototype.getFermata=function(t){return this.fermata.has(t.playbackStart)?this.fermata.get(t.playbackStart):null},t.MaxAlternateEndings=8,t}(),gt=function(){function t(){this.hideDynamics=!1}return t.copyTo=function(t,e){e.hideDynamics=t.hideDynamics},t}(),mt=function(){function t(){this.masterBars=[],this.openings=[],this.closings=[],this.isOpened=!1,this.isClosed=!1}return t.prototype.addMasterBar=function(t){0===this.openings.length&&this.openings.push(t),this.masterBars.push(t),t.repeatGroup=this,t.isRepeatEnd?(this.closings.push(t),this.isClosed=!0,this.isOpened||(this.masterBars[0].isRepeatStart=!0,this.isOpened=!0)):this.isClosed&&(this.isClosed=!1,this.openings.push(t))},t}(),bt=function(){function t(){this._currentRepeatGroup=new mt,this.album="",this.artist="",this.copyright="",this.instructions="",this.music="",this.notices="",this.subTitle="",this.title="",this.words="",this.tab="",this.tempo=120,this.tempoLabel="",this.masterBars=[],this.tracks=[],this.stylesheet=new gt}return t.copyTo=function(t,e){e.album=t.album,e.artist=t.artist,e.copyright=t.copyright,e.instructions=t.instructions,e.music=t.music,e.notices=t.notices,e.subTitle=t.subTitle,e.title=t.title,e.words=t.words,e.tab=t.tab,e.tempo=t.tempo,e.tempoLabel=t.tempoLabel},t.prototype.rebuildRepeatGroups=function(){for(var t=new mt,e=0,i=this.masterBars;e<i.length;e++){var n=i[e];(n.isRepeatStart||this._currentRepeatGroup.isClosed&&n.alternateEndings<=0)&&(t=new mt),t.addMasterBar(n)}},t.prototype.addMasterBar=function(t){t.score=this,t.index=this.masterBars.length,0!==this.masterBars.length&&(t.previousMasterBar=this.masterBars[this.masterBars.length-1],t.previousMasterBar.nextMasterBar=t,t.start=t.previousMasterBar.start+t.previousMasterBar.calculateDuration()),(t.isRepeatStart||this._currentRepeatGroup.isClosed&&t.alternateEndings<=0)&&(this._currentRepeatGroup=new mt),this._currentRepeatGroup.addMasterBar(t),this.masterBars.push(t)},t.prototype.addTrack=function(t){t.score=this,t.index=this.tracks.length,this.tracks.push(t)},t.prototype.finish=function(t){for(var e=0,i=this.tracks.length;e<i;e++)this.tracks[e].finish(t)},t}(),vt=function(){function t(){this.marker="",this.text=""}return t.copyTo=function(t,e){e.marker=t.marker,e.text=t.text},t}(),_t=function(){function t(){this.volume=15,this.balance=8,this.port=1,this.program=0,this.primaryChannel=0,this.secondaryChannel=0,this.isMute=!1,this.isSolo=!1}return t.copyTo=function(t,e){e.volume=t.volume,e.balance=t.balance,e.port=t.port,e.program=t.program,e.primaryChannel=t.primaryChannel,e.secondaryChannel=t.secondaryChannel,e.isMute=t.isMute,e.isSolo=t.isSolo},t}(),wt=function(){function t(){this.index=0,this.bars=[],this.chords=new Map,this.capo=0,this.transpositionPitch=0,this.displayTranspositionPitch=0,this.tuning=[],this.tuningName="",this.showTablature=!0,this.showStandardNotation=!0,this.isPercussion=!1,this.standardNotationLineCount=5}return Object.defineProperty(t.prototype,"isStringed",{get:function(){return this.tuning.length>0},enumerable:!1,configurable:!0}),t.copyTo=function(t,e){e.capo=t.capo,e.index=t.index,e.tuning=t.tuning.slice(),e.transpositionPitch=t.transpositionPitch,e.displayTranspositionPitch=t.displayTranspositionPitch,e.showStandardNotation=t.showStandardNotation,e.showTablature=t.showTablature,e.isPercussion=t.isPercussion,e.standardNotationLineCount=t.standardNotationLineCount},t.prototype.finish=function(t){for(var e=0,i=this.bars.length;e<i;e++)this.bars[e].finish(t)},t.prototype.addChord=function(t,e){e.staff=this,this.chords.set(t,e)},t.prototype.addBar=function(t){var e=this.bars;t.staff=this,t.index=e.length,e.length>0&&(t.previousBar=e[e.length-1],t.previousBar.nextBar=t),e.push(t)},t}(),St=function(){function t(){this.index=0,this.staves=[],this.playbackInfo=new _t,this.color=new m(200,0,0,255),this.name="",this.shortName="",this.percussionArticulations=[]}return t.prototype.ensureStaveCount=function(t){for(;this.staves.length<t;)this.addStaff(new wt)},t.prototype.addStaff=function(t){t.index=this.staves.length,t.track=this,this.staves.push(t)},t.copyTo=function(t,e){e.name=t.name,e.shortName=t.shortName,e.index=t.index,e.color.raw=t.color.raw,e.color.rgba=t.color.rgba},t.prototype.finish=function(e){this.shortName||(this.shortName=this.name,this.shortName.length>t.ShortNameMaxLength&&(this.shortName=this.shortName.substr(0,t.ShortNameMaxLength)));for(var i=0,n=this.staves.length;i<n;i++)this.staves[i].finish(e)},t.prototype.applyLyrics=function(t){for(var e=0,i=t;e<i.length;e++){(a=i[e]).finish()}for(var n=this.staves[0],r=0;r<t.length;r++){var a;if((a=t[r]).startBar>=0&&a.startBar<n.bars.length)for(var o=n.bars[a.startBar].voices[0].beats[0],s=0;s<a.chunks.length&&o;s++){for(;o&&(o.isEmpty||o.isRest);)o=o.nextBeat;o&&(o.lyrics||(o.lyrics=new Array(t.length)),o.lyrics[r]=a.chunks[s],o=o.nextBeat)}}},t.ShortNameMaxLength=10,t}(),Bt=function(){function t(t,e,i){this.isStandard=i,this.name=t,this.tunings=e}return t.getTextForTuning=function(t,e){var i=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"][t%12];return e&&(i+=(t/12|0)-1),i},t.getDefaultTuningFor=function(e){return t._defaultTunings.has(e)?t._defaultTunings.get(e):null},t.getPresetsFor=function(e){switch(e){case 7:return t._sevenStrings;case 6:return t._sixStrings;case 5:return t._fiveStrings;case 4:return t._fourStrings}return[]},t.initialize=function(){t._defaultTunings.set(7,new t("Guitar 7 strings",[64,59,55,50,45,40,35],!0)),t._sevenStrings.push(t._defaultTunings.get(7)),t._defaultTunings.set(6,new t("Guitar Standard Tuning",[64,59,55,50,45,40],!0)),t._sixStrings.push(t._defaultTunings.get(6)),t._sixStrings.push(new t("Guitar Tune down Â½ step",[63,58,54,49,44,39],!1)),t._sixStrings.push(new t("Guitar Tune down 1 step",[62,57,53,48,43,38],!1)),t._sixStrings.push(new t("Guitar Tune down 2 step",[60,55,51,46,41,36],!1)),t._sixStrings.push(new t("Guitar Dropped D Tuning",[64,59,55,50,45,38],!1)),t._sixStrings.push(new t("Guitar Dropped D Tuning variant",[64,57,55,50,45,38],!1)),t._sixStrings.push(new t("Guitar Double Dropped D Tuning",[62,59,55,50,45,38],!1)),t._sixStrings.push(new t("Guitar Dropped E Tuning",[66,61,57,52,47,40],!1)),t._sixStrings.push(new t("Guitar Dropped C Tuning",[62,57,53,48,43,36],!1)),t._sixStrings.push(new t("Guitar Open C Tuning",[64,60,55,48,43,36],!1)),t._sixStrings.push(new t("Guitar Open Cm Tuning",[63,60,55,48,43,36],!1)),t._sixStrings.push(new t("Guitar Open C6 Tuning",[64,57,55,48,43,36],!1)),t._sixStrings.push(new t("Guitar Open Cmaj7 Tuning",[64,59,55,52,43,36],!1)),t._sixStrings.push(new t("Guitar Open D Tuning",[62,57,54,50,45,38],!1)),t._sixStrings.push(new t("Guitar Open Dm Tuning",[62,57,53,50,45,38],!1)),t._sixStrings.push(new t("Guitar Open D5 Tuning",[62,57,50,50,45,38],!1)),t._sixStrings.push(new t("Guitar Open D6 Tuning",[62,59,54,50,45,38],!1)),t._sixStrings.push(new t("Guitar Open Dsus4 Tuning",[62,57,55,50,45,38],!1)),t._sixStrings.push(new t("Guitar Open E Tuning",[64,59,56,52,47,40],!1)),t._sixStrings.push(new t("Guitar Open Em Tuning",[64,59,55,52,47,40],!1)),t._sixStrings.push(new t("Guitar Open Esus11 Tuning",[64,59,55,52,45,40],!1)),t._sixStrings.push(new t("Guitar Open F Tuning",[65,60,53,48,45,41],!1)),t._sixStrings.push(new t("Guitar Open G Tuning",[62,59,55,50,43,38],!1)),t._sixStrings.push(new t("Guitar Open Gm Tuning",[62,58,55,50,43,38],!1)),t._sixStrings.push(new t("Guitar Open G6 Tuning",[64,59,55,50,43,38],!1)),t._sixStrings.push(new t("Guitar Open Gsus4 Tuning",[62,60,55,50,43,38],!1)),t._sixStrings.push(new t("Guitar Open A Tuning",[64,61,57,52,45,40],!1)),t._sixStrings.push(new t("Guitar Open Am Tuning",[64,60,57,52,45,40],!1)),t._sixStrings.push(new t("Guitar Nashville Tuning",[64,59,67,62,57,52],!1)),t._sixStrings.push(new t("Bass 6 Strings Tuning",[48,43,38,33,28,23],!1)),t._sixStrings.push(new t("Lute or Vihuela Tuning",[64,59,54,50,45,40],!1)),t._defaultTunings.set(5,new t("Bass 5 Strings Tuning",[43,38,33,28,23],!0)),t._fiveStrings.push(t._defaultTunings.get(5)),t._fiveStrings.push(new t("Banjo Dropped C Tuning",[62,59,55,48,67],!1)),t._fiveStrings.push(new t("Banjo Open D Tuning",[62,57,54,50,69],!1)),t._fiveStrings.push(new t("Banjo Open G Tuning",[62,59,55,50,67],!1)),t._fiveStrings.push(new t("Banjo G Minor Tuning",[62,58,55,50,67],!1)),t._fiveStrings.push(new t("Banjo G Modal Tuning",[62,57,55,50,67],!1)),t._defaultTunings.set(4,new t("Bass Standard Tuning",[43,38,33,28],!0)),t._fourStrings.push(t._defaultTunings.get(4)),t._fourStrings.push(new t("Bass Tune down Â½ step",[42,37,32,27],!1)),t._fourStrings.push(new t("Bass Tune down 1 step",[41,36,31,26],!1)),t._fourStrings.push(new t("Bass Tune down 2 step",[39,34,29,24],!1)),t._fourStrings.push(new t("Bass Dropped D Tuning",[43,38,33,26],!1)),t._fourStrings.push(new t("Ukulele C Tuning",[45,40,36,43],!1)),t._fourStrings.push(new t("Ukulele G Tuning",[52,47,43,38],!1)),t._fourStrings.push(new t("Mandolin Standard Tuning",[64,57,50,43],!1)),t._fourStrings.push(new t("Mandolin or Violin Tuning",[76,69,62,55],!1)),t._fourStrings.push(new t("Viola Tuning",[69,62,55,48],!1)),t._fourStrings.push(new t("Cello Tuning",[57,50,43,36],!1))},t.findTuning=function(e){for(var i=t.getPresetsFor(e.length),n=0,r=i.length;n<r;n++){for(var a=i[n],o=!0,s=0,h=e.length;s<h;s++)if(e[s]!==a.tunings[s]){o=!1;break}if(o)return a}return null},t._sevenStrings=[],t._sixStrings=[],t._fiveStrings=[],t._fourStrings=[],t._defaultTunings=new Map,t}();Bt.initialize();var Tt,kt=function(){function t(){this.index=0,this.beats=[],this.isEmpty=!0}return t.copyTo=function(t,e){e.index=t.index,e.isEmpty=t.isEmpty},t.prototype.insertBeat=function(t,e){e.nextBeat=t.nextBeat,e.nextBeat&&(e.nextBeat.previousBeat=e),e.previousBeat=t,e.voice=this,t.nextBeat=e,this.beats.splice(t.index+1,0,e)},t.prototype.addBeat=function(t){t.voice=this,t.index=this.beats.length,this.beats.push(t),t.isEmpty||(this.isEmpty=!1)},t.prototype.chain=function(t){if(this.bar){if(t.index<this.beats.length-1)t.nextBeat=this.beats[t.index+1],t.nextBeat.previousBeat=t;else if(t.isLastOfVoice&&t.voice.bar.nextBar){var e=this.bar.nextBar.voices[this.index];e.beats.length>0?(t.nextBeat=e.beats[0],t.nextBeat.previousBeat=t):t.nextBeat.previousBeat=t}t.chain()}},t.prototype.addGraceBeat=function(t){if(0!==this.beats.length){var e=this.beats[this.beats.length-1];this.beats.splice(this.beats.length-1,1),this.addBeat(t),this.addBeat(e),this.isEmpty=!1}else this.addBeat(t)},t.prototype.getBeatAtDisplayStart=function(t){return this._beatLookup.has(t)?this._beatLookup.get(t):null},t.prototype.finish=function(t){this._beatLookup=new Map;for(var e=0;e<this.beats.length;e++){(a=this.beats[e]).index=e,this.chain(a)}for(var i=0,n=0,r=0;r<this.beats.length;r++){var a;if((a=this.beats[r]).index=r,a.finish(t),a.graceType===R.None||a.graceType===R.BendGrace)a.displayStart=i,a.playbackStart=n,i+=a.displayDuration,n+=a.playbackDuration;else{if(!a.previousBeat||a.previousBeat.graceType===R.None){for(var o=a,s=0;o&&o.graceType!==R.None;)o=o.nextBeat,s++;var h=A.Eighth,c=0;h=1===s?A.Eighth:2===s?A.Sixteenth:A.ThirtySecond,o&&o.updateDurations();for(var l=a.previousBeat?(a.previousBeat.displayDuration/4|0)/s|0:z.toTicks(A.ThirtySecond),u=this.beats[r],p=0;p<s&&u;p++)u.duration=h,u.updateDurations(),u.displayStart=i-(s-p+1)*l,u.displayDuration=l,c+=u.playbackDuration,u=u.nextBeat;a.graceType===R.BeforeBeat?(a.previousBeat&&(a.previousBeat.playbackDuration-=c),n-=c):o&&a.graceType===R.OnBeat&&(o.playbackDuration-=c)}a.playbackStart=n,n=a.playbackStart+a.playbackDuration}a.fermata?this.bar.masterBar.addFermata(a.playbackStart,a.fermata):a.fermata=this.bar.masterBar.getFermata(a),a.finishTuplet(),this._beatLookup.set(a.displayStart,a)}},t.prototype.calculateDuration=function(){if(this.isEmpty||0===this.beats.length)return 0;var t=this.beats[this.beats.length-1],e=this.beats[0];return t.playbackStart+t.playbackDuration-e.playbackStart},t}(),Pt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();!function(t){t[t.No=0]="No",t[t.Eof=1]="Eof",t[t.Number=2]="Number",t[t.DoubleDot=3]="DoubleDot",t[t.Dot=4]="Dot",t[t.String=5]="String",t[t.Tuning=6]="Tuning",t[t.LParensis=7]="LParensis",t[t.RParensis=8]="RParensis",t[t.LBrace=9]="LBrace",t[t.RBrace=10]="RBrace",t[t.Pipe=11]="Pipe",t[t.MetaCommand=12]="MetaCommand",t[t.Multiply=13]="Multiply",t[t.LowerThan=14]="LowerThan",t[t.Property=15]="Property"}(Tt||(Tt={}));var Nt,Ot=function(e){function i(n){var r=e.call(this,t.AlphaTabErrorType.AlphaTex,n)||this;return r.position=0,r.nonTerm="",r.expected=Tt.No,r.symbol=Tt.No,Object.setPrototypeOf(r,i.prototype),r}return Pt(i,e),i.symbolError=function(t,e,n,r,a){void 0===a&&(a=null);var o=new i(a?"MalFormed AlphaTex: @"+t+": Error on block "+e+", invalid value: "+a:"MalFormed AlphaTex: @"+t+": Error on block "+e+", expected a "+Tt[n]+" found a "+Tt[r]+": '"+a+"'");return o.position=t,o.nonTerm=e,o.expected=n,o.symbol=r,o.symbolData=a,o},i.errorMessage=function(t,e){var n=new i(e="MalFormed AlphaTex: @"+t+": "+e);return n.position=t,n},i}(c),xt=function(t){function e(){var e=t.call(this)||this;return e._trackChannel=0,e._ch=0,e._curChPos=0,e._sy=Tt.No,e._allowNegatives=!1,e._allowTuning=!1,e._currentDuration=A.QuadrupleWhole,e._currentDynamics=I.PPP,e._currentTuplet=0,e}return Pt(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"AlphaTex"},enumerable:!1,configurable:!0}),e.prototype.readScore=function(){var t=this;try{if(this._allowTuning=!0,this._lyrics=new Map,this.createDefaultScore(),this._curChPos=0,this._currentDuration=A.Quarter,this._currentDynamics=I.F,this._currentTuplet=1,this._ch=this.nextChar(),this._sy=this.newSy(),this._sy===Tt.LowerThan)throw new N("Unknown start sign <");return this.score(),this.consolidate(),this._score.finish(this.settings),this._score.rebuildRepeatGroups(),this._lyrics.forEach((function(e,i){t._score.tracks[i].applyLyrics(e)})),this._score}catch(t){throw t instanceof Ot?new N(t.message):t}},e.prototype.consolidate=function(){for(var t=0,e=this._score.tracks;t<e.length;t++)for(var i=0,n=e[t].staves;i<n.length;i++)for(var r=n[i];r.bars.length<this._score.masterBars.length;){var a=this.newBar(r),o=new ct;o.isEmpty=!0,a.voices[0].addBeat(o)}},e.prototype.error=function(t,e,i){var n;throw void 0===i&&(i=!0),n=i?Ot.symbolError(this._curChPos,t,e,this._sy,null):Ot.symbolError(this._curChPos,t,e,e,this._syData),et.error(this.name,n.message),n},e.prototype.errorMessage=function(t){var e=Ot.errorMessage(this._curChPos,t);throw et.error(this.name,e.message),e},e.prototype.createDefaultScore=function(){this._score=new bt,this._score.tempo=120,this._score.tempoLabel="",this.newTrack()},e.prototype.newTrack=function(){this._currentTrack=new St,this._currentTrack.ensureStaveCount(1),this._currentTrack.playbackInfo.program=25,this._currentTrack.playbackInfo.primaryChannel=this._trackChannel++,this._currentTrack.playbackInfo.secondaryChannel=this._trackChannel++,this._currentStaff=this._currentTrack.staves[0],this._currentStaff.displayTranspositionPitch=-12,this._currentStaff.tuning=Bt.getDefaultTuningFor(6).tunings,this._score.addTrack(this._currentTrack),this._lyrics.set(this._currentTrack.index,[]),this._currentDynamics=I.F},e.prototype.parseClefFromString=function(t){switch(t.toLowerCase()){case"g2":case"treble":return O.G2;case"f4":case"bass":return O.F4;case"c3":case"tenor":return O.C3;case"c4":case"alto":return O.C4;case"n":case"neutral":return O.Neutral;default:return O.G2}},e.prototype.parseClefFromInt=function(t){switch(t){case 43:return O.G2;case 65:return O.F4;case 48:return O.C3;case 60:return O.C4;default:return O.G2}},e.prototype.parseTripletFeelFromString=function(t){switch(t.toLowerCase()){case"no":case"none":return dt.NoTripletFeel;case"t16":case"triplet-16th":return dt.Triplet16th;case"t8":case"triplet-8th":return dt.Triplet8th;case"d16":case"dotted-16th":return dt.Dotted16th;case"d8":case"dotted-8th":return dt.Dotted8th;case"s16":case"scottish-16th":return dt.Scottish16th;case"s8":case"scottish-8th":return dt.Scottish8th;default:return dt.NoTripletFeel}},e.prototype.parseTripletFeelFromInt=function(t){switch(t){case 0:return dt.NoTripletFeel;case 1:return dt.Triplet16th;case 2:return dt.Triplet8th;case 3:return dt.Dotted16th;case 4:return dt.Dotted8th;case 5:return dt.Scottish16th;case 6:return dt.Scottish8th;default:return dt.NoTripletFeel}},e.prototype.parseKeySignature=function(t){switch(t.toLowerCase()){case"cb":return-7;case"gb":return-6;case"db":return-5;case"ab":return-4;case"eb":return-3;case"bb":return-2;case"f":return-1;case"c":return 0;case"g":return 1;case"d":return 2;case"a":return 3;case"e":return 4;case"b":return 5;case"f#":return 6;case"c#":return 7;default:return 0}},e.prototype.nextChar=function(){var t=this.data.readByte();return-1===t?this._ch=0:(this._ch=t,this._curChPos++),this._ch},e.prototype.newSy=function(){this._sy=Tt.No;do{if(this._ch===e.Eof)this._sy=Tt.Eof;else if(32===this._ch||11===this._ch||13===this._ch||10===this._ch||9===this._ch)this._ch=this.nextChar();else if(47===this._ch)if(this._ch=this.nextChar(),47===this._ch)for(;13!==this._ch&&10!==this._ch&&this._ch!==e.Eof;)this._ch=this.nextChar();else if(42===this._ch)for(;0!==this._ch;)if(42===this._ch){if(this._ch=this.nextChar(),47===this._ch){this._ch=this.nextChar();break}}else this._ch=this.nextChar();else this.error("symbol",Tt.String,!1);else if(34===this._ch||39===this._ch){var t=this._ch;this._ch=this.nextChar();var i="";for(this._sy=Tt.String;this._ch!==t&&this._ch!==e.Eof;)i+=String.fromCharCode(this._ch),this._ch=this.nextChar();this._syData=i,this._ch=this.nextChar()}else if(45===this._ch)if(this._allowNegatives&&this.isDigit(this._ch)){var n=this.readNumber();this._sy=Tt.Number,this._syData=n}else this._sy=Tt.String,this._syData=this.readName();else if(46===this._ch)this._sy=Tt.Dot,this._ch=this.nextChar();else if(58===this._ch)this._sy=Tt.DoubleDot,this._ch=this.nextChar();else if(40===this._ch)this._sy=Tt.LParensis,this._ch=this.nextChar();else if(92===this._ch){this._ch=this.nextChar();var r=this.readName();this._sy=Tt.MetaCommand,this._syData=r}else if(41===this._ch)this._sy=Tt.RParensis,this._ch=this.nextChar();else if(123===this._ch)this._sy=Tt.LBrace,this._ch=this.nextChar();else if(125===this._ch)this._sy=Tt.RBrace,this._ch=this.nextChar();else if(124===this._ch)this._sy=Tt.Pipe,this._ch=this.nextChar();else if(42===this._ch)this._sy=Tt.Multiply,this._ch=this.nextChar();else if(60===this._ch)this._sy=Tt.LowerThan,this._ch=this.nextChar();else if(this.isDigit(this._ch)){n=this.readNumber();this._sy=Tt.Number,this._syData=n}else if(e.isLetter(this._ch)){var a=this.readName(),o=this._allowTuning?g.parseTuning(a):null;o?(this._sy=Tt.Tuning,this._syData=o):(this._sy=Tt.String,this._syData=a)}else this.error("symbol",Tt.String,!1)}while(this._sy===Tt.No);return this._sy},e.isLetter=function(t){return!e.isTerminal(t)&&(t>=33&&t<=47||t>=58&&t<=126||t>128)},e.isTerminal=function(t){return 46===t||123===t||125===t||91===t||93===t||40===t||41===t||124===t||39===t||34===t||92===t},e.prototype.isDigit=function(t){return t>=48&&t<=57||45===t&&this._allowNegatives},e.prototype.readName=function(){var t="";do{t+=String.fromCharCode(this._ch),this._ch=this.nextChar()}while(e.isLetter(this._ch)||this.isDigit(this._ch)||35===this._ch);return t},e.prototype.readNumber=function(){var t="";do{t+=String.fromCharCode(this._ch),this._ch=this.nextChar()}while(this.isDigit(this._ch));return parseInt(t)},e.prototype.score=function(){this.metaData(),this.bars()},e.prototype.metaData=function(){for(var t=!1,e=!0;this._sy===Tt.MetaCommand&&e;){switch(this._syData.toLowerCase()){case"title":this._sy=this.newSy(),this._sy===Tt.String?this._score.title=this._syData:this.error("title",Tt.String,!0),this._sy=this.newSy(),t=!0;break;case"subtitle":this._sy=this.newSy(),this._sy===Tt.String?this._score.subTitle=this._syData:this.error("subtitle",Tt.String,!0),this._sy=this.newSy(),t=!0;break;case"artist":this._sy=this.newSy(),this._sy===Tt.String?this._score.artist=this._syData:this.error("artist",Tt.String,!0),this._sy=this.newSy(),t=!0;break;case"album":this._sy=this.newSy(),this._sy===Tt.String?this._score.album=this._syData:this.error("album",Tt.String,!0),this._sy=this.newSy(),t=!0;break;case"words":this._sy=this.newSy(),this._sy===Tt.String?this._score.words=this._syData:this.error("words",Tt.String,!0),this._sy=this.newSy(),t=!0;break;case"music":this._sy=this.newSy(),this._sy===Tt.String?this._score.music=this._syData:this.error("music",Tt.String,!0),this._sy=this.newSy(),t=!0;break;case"copyright":this._sy=this.newSy(),this._sy===Tt.String?this._score.copyright=this._syData:this.error("copyright",Tt.String,!0),this._sy=this.newSy(),t=!0;break;case"tempo":this._sy=this.newSy(),this._sy===Tt.Number?this._score.tempo=this._syData:this.error("tempo",Tt.Number,!0),this._sy=this.newSy(),t=!0;break;default:this.handleStaffMeta()?t=!0:t?this.error("metaDataTags",Tt.String,!1):e=!1}}t?(this._sy!==Tt.Dot&&this.error("song",Tt.Dot,!0),this._sy=this.newSy()):this._sy===Tt.Dot&&(this._sy=this.newSy())},e.prototype.handleStaffMeta=function(){switch(this._syData.toLowerCase()){case"capo":return this._sy=this.newSy(),this._sy===Tt.Number?this._currentStaff.capo=this._syData:this.error("capo",Tt.Number,!0),this._sy=this.newSy(),!0;case"tuning":this._sy=this.newSy();var t=this._currentStaff.tuning.length;switch(this._sy){case Tt.String:var e=this._syData.toLowerCase();"piano"===e||"none"===e||"voice"===e?this._currentStaff.tuning=[]:this.error("tuning",Tt.Tuning,!0),this._sy=this.newSy();break;case Tt.Tuning:var i=[];do{var n=this._syData;i.push(n.realValue),this._sy=this.newSy()}while(this._sy===Tt.Tuning);this._currentStaff.tuning=i;break;default:this.error("tuning",Tt.Tuning,!0)}return t!==this._currentStaff.tuning.length&&this._currentStaff.chords.size>0&&this.errorMessage("Tuning must be defined before any chord"),!0;case"instrument":if(this._sy=this.newSy(),this._sy===Tt.Number){var r=this._syData;r>=0&&r<=128?this._currentTrack.playbackInfo.program=this._syData:this.error("instrument",Tt.Number,!1)}else if(this._sy===Tt.String){var a=this._syData.toLowerCase();this._currentTrack.playbackInfo.program=p.getValue(a)}else this.error("instrument",Tt.Number,!0);return this._currentStaff.displayTranspositionPitch=p.isGuitar(this._currentTrack.playbackInfo.program)?-12:0,this._sy=this.newSy(),!0;case"lyrics":this._sy=this.newSy();var o=new ft;return o.startBar=0,o.text="",this._sy===Tt.Number&&(o.startBar=this._syData,this._sy=this.newSy()),this._sy===Tt.String?(o.text=this._syData,this._sy=this.newSy()):this.error("lyrics",Tt.String,!0),this._lyrics.get(this._currentTrack.index).push(o),!0;case"chord":this._sy=this.newSy();var s=new lt;this.chordProperties(s),this._sy===Tt.String?(s.name=this._syData,this._sy=this.newSy()):this.error("chord-name",Tt.Number,!0);for(var h=0;h<this._currentStaff.tuning.length;h++)this._sy===Tt.Number?s.strings.push(this._syData):this._sy===Tt.String&&"x"===this._syData.toLowerCase()&&s.strings.push(-1),this._sy=this.newSy();return this._currentStaff.addChord(s.name.toLowerCase(),s),!0;default:return!1}},e.prototype.chordProperties=function(t){if(this._sy===Tt.LBrace){for(this._sy=this.newSy();this._sy===Tt.String;)switch(this._syData.toLowerCase()){case"firstfret":switch(this._sy=this.newSy(),this._sy){case Tt.Number:t.firstFret=this._syData;break;default:this.error("chord-firstfret",Tt.Number,!0)}this._sy=this.newSy();break;case"showdiagram":switch(this._sy=this.newSy(),this._sy){case Tt.String:t.showDiagram="false"!==this._syData.toLowerCase();break;case Tt.Number:t.showDiagram=0!==this._syData;break;default:this.error("chord-showdiagram",Tt.String,!0)}this._sy=this.newSy();break;case"showfingering":switch(this._sy=this.newSy(),this._sy){case Tt.String:t.showDiagram="false"!==this._syData.toLowerCase();break;case Tt.Number:t.showFingering=0!==this._syData;break;default:this.error("chord-showfingering",Tt.String,!0)}this._sy=this.newSy();break;case"showname":switch(this._sy=this.newSy(),this._sy){case Tt.String:t.showName="false"!==this._syData.toLowerCase();break;case Tt.Number:t.showName=0!==this._syData;break;default:this.error("chord-showname",Tt.String,!0)}this._sy=this.newSy();break;case"barre":for(this._sy=this.newSy();this._sy===Tt.Number;)t.barreFrets.push(this._syData),this._sy=this.newSy();break;default:this.error("chord-properties",Tt.String,!1)}this._sy!==Tt.RBrace&&this.error("chord-properties",Tt.RBrace,!0),this._sy=this.newSy()}},e.prototype.bars=function(){for(this.bar();this._sy!==Tt.Eof;)if(this._sy===Tt.Pipe)this._sy=this.newSy(),this.bar();else{if(this._sy!==Tt.MetaCommand)break;this.bar()}},e.prototype.trackStaffMeta=function(){if(this._sy===Tt.MetaCommand){var t=this._syData.toLowerCase();"track"===t&&(this._sy=this.newSy(),this._score.masterBars.length>0&&this.newTrack(),this._sy===Tt.String&&(this._currentTrack.name=this._syData,this._sy=this.newSy()),this._sy===Tt.String&&(this._currentTrack.shortName=this._syData,this._sy=this.newSy())),this._sy===Tt.MetaCommand&&"staff"===(t=this._syData.toLowerCase())&&(this._sy=this.newSy(),this._currentTrack.staves[0].bars.length>0&&(this._currentTrack.ensureStaveCount(this._currentTrack.staves.length+1),this._currentStaff=this._currentTrack.staves[this._currentTrack.staves.length-1],this._currentDynamics=I.F),this.staffProperties())}},e.prototype.staffProperties=function(){if(this._sy===Tt.LBrace){this._sy=this.newSy();for(var t=!1,e=!1;this._sy===Tt.String;)switch(this._syData.toLowerCase()){case"score":t=!0,this._sy=this.newSy();break;case"tabs":e=!0,this._sy=this.newSy();break;default:this.error("staff-properties",Tt.String,!1)}(t||e)&&(this._currentStaff.showStandardNotation=t,this._currentStaff.showTablature=e),this._sy!==Tt.RBrace&&this.error("staff-properties",Tt.RBrace,!0),this._sy=this.newSy()}},e.prototype.bar=function(){this.trackStaffMeta();var t=this.newBar(this._currentStaff);if(this._currentStaff.bars.length>this._score.masterBars.length){var e=new yt;this._score.addMasterBar(e),e.index>0&&(e.keySignature=e.previousMasterBar.keySignature,e.keySignatureType=e.previousMasterBar.keySignatureType,e.timeSignatureDenominator=e.previousMasterBar.timeSignatureDenominator,e.timeSignatureNumerator=e.previousMasterBar.timeSignatureNumerator,e.tripletFeel=e.previousMasterBar.tripletFeel)}this.barMeta(t);for(var i=t.voices[0];this._sy!==Tt.Pipe&&this._sy!==Tt.Eof&&this.beat(i););if(0===i.beats.length){var n=new ct;n.isEmpty=!0,i.addBeat(n)}},e.prototype.newBar=function(t){var e=new U;t.addBar(e),e.index>0&&(e.clef=e.previousBar.clef);var i=new kt;return e.addVoice(i),e},e.prototype.beat=function(t){this.beatDuration();var e=new ct;if(t.addBeat(e),t.bar.masterBar.tempoAutomation&&1===t.beats.length&&e.automations.push(t.bar.masterBar.tempoAutomation),this._sy===Tt.LParensis){for(this._sy=this.newSy(),this.note(e);this._sy!==Tt.RParensis&&this._sy!==Tt.Eof&&this.note(e););this._sy!==Tt.RParensis&&this.error("note-list",Tt.RParensis,!0),this._sy=this.newSy()}else if(this._sy===Tt.String&&"r"===this._syData.toLowerCase())this._sy=this.newSy();else if(!this.note(e))return t.beats.splice(t.beats.length-1,1),!1;this._sy===Tt.Dot&&(this._allowNegatives=!0,this._sy=this.newSy(),this._allowNegatives=!1,this._sy!==Tt.Number&&this.error("duration",Tt.Number,!0),this._currentDuration=this.parseDuration(this._syData),this._sy=this.newSy()),e.duration=this._currentDuration,e.dynamics=this._currentDynamics,1===this._currentTuplet||e.hasTuplet||this.applyTuplet(e,this._currentTuplet);var i=1;this._sy===Tt.Multiply&&(this._sy=this.newSy(),this._sy!==Tt.Number?this.error("multiplier",Tt.Number,!0):i=this._syData,this._sy=this.newSy()),this.beatEffects(e);for(var n=0;n<i-1;n++)t.addBeat(e.clone());return!0},e.prototype.beatDuration=function(){if(this._sy===Tt.DoubleDot&&(this._allowNegatives=!0,this._sy=this.newSy(),this._allowNegatives=!1,this._sy!==Tt.Number&&this.error("duration",Tt.Number,!0),this._currentDuration=this.parseDuration(this._syData),this._currentTuplet=1,this._sy=this.newSy(),this._sy===Tt.LBrace)){for(this._sy=this.newSy();this._sy===Tt.String;){switch(this._syData.toLowerCase()){case"tu":this._sy=this.newSy(),this._sy!==Tt.Number&&this.error("duration-tuplet",Tt.Number,!0),this._currentTuplet=this._syData,this._sy=this.newSy();break;default:this.error("beat-duration",Tt.String,!1)}}this._sy!==Tt.RBrace&&this.error("beat-duration",Tt.RBrace,!0),this._sy=this.newSy()}},e.prototype.beatEffects=function(t){if(this._sy===Tt.LBrace){for(this._sy=this.newSy();this._sy===Tt.String;)this._syData=this._syData.toLowerCase(),this.applyBeatEffect(t)||this.error("beat-effects",Tt.String,!1);this._sy!==Tt.RBrace&&this.error("beat-effects",Tt.RBrace,!0),this._sy=this.newSy()}},e.prototype.applyBeatEffect=function(t){var e=this._syData.toLowerCase();if("f"===e)return t.fadeIn=!0,this._sy=this.newSy(),!0;if("v"===e)return t.vibrato=W.Slight,this._sy=this.newSy(),!0;if("s"===e)return t.slap=!0,this._sy=this.newSy(),!0;if("p"===e)return t.pop=!0,this._sy=this.newSy(),!0;if("tt"===e)return t.tap=!0,this._sy=this.newSy(),!0;if("dd"===e)return t.dots=2,this._sy=this.newSy(),!0;if("d"===e)return t.dots=1,this._sy=this.newSy(),!0;if("su"===e)return t.pickStroke=q.Up,this._sy=this.newSy(),!0;if("sd"===e)return t.pickStroke=q.Down,this._sy=this.newSy(),!0;if("tu"===e)return this._sy=this.newSy(),this._sy!==Tt.Number?(this.error("tuplet",Tt.Number,!0),!1):(this.applyTuplet(t,this._syData),this._sy=this.newSy(),!0);if("tb"===e||"tbe"===e){var i="tbe"===e;if(this._sy=this.newSy(),this._sy!==Tt.LParensis)return this.error("tremolobar-effect",Tt.LParensis,!0),!1;for(this._allowNegatives=!0,this._sy=this.newSy();this._sy!==Tt.RParensis&&this._sy!==Tt.Eof;){var n=0,r=0;if(i){if(this._sy!==Tt.Number)return this.error("tremolobar-effect",Tt.Number,!0),!1;if(n=this._syData,this._sy=this.newSy(),this._sy!==Tt.Number)return this.error("tremolobar-effect",Tt.Number,!0),!1;r=this._syData}else{if(this._sy!==Tt.Number)return this.error("tremolobar-effect",Tt.Number,!0),!1;n=0,r=this._syData}t.addWhammyBarPoint(new X(n,r)),this._sy=this.newSy()}for(;t.whammyBarPoints.length>60;)t.removeWhammyBarPoint(t.whammyBarPoints.length-1);if(i)t.whammyBarPoints.sort((function(t,e){return t.offset-e.offset}));else for(var a=t.whammyBarPoints.length,o=60/a|0,s=0;s<a;)t.whammyBarPoints[s].offset=Math.min(60,s*o),s++;return this._allowNegatives=!1,this._sy!==Tt.RParensis?(this.error("tremolobar-effect",Tt.RParensis,!0),!1):(this._sy=this.newSy(),!0)}if("ch"===e){this._sy=this.newSy();var h=this._syData,c=h.toLowerCase();if(!this._currentStaff.chords.has(c)){var l=new lt;l.showDiagram=!1,l.name=h,this._currentStaff.addChord(c,l)}return t.chordId=c,this._sy=this.newSy(),!0}if("gr"===e)return this._sy=this.newSy(),"ob"===this._syData.toLowerCase()?(t.graceType=R.OnBeat,this._sy=this.newSy()):"b"===this._syData.toLowerCase()?(t.graceType=R.BendGrace,this._sy=this.newSy()):t.graceType=R.BeforeBeat,!0;if("dy"===e){switch(this.newSy(),this._syData.toLowerCase()){case"ppp":t.dynamics=I.PPP;break;case"pp":t.dynamics=I.PP;break;case"p":t.dynamics=I.P;break;case"mp":t.dynamics=I.MP;break;case"mf":t.dynamics=I.MF;break;case"f":t.dynamics=I.F;break;case"ff":t.dynamics=I.FF;break;case"fff":t.dynamics=I.FFF}return this._currentDynamics=t.dynamics,this.newSy(),!0}if("cre"===e)return t.crescendo=D.Crescendo,this.newSy(),!0;if("dec"===e)return t.crescendo=D.Decrescendo,this.newSy(),!0;if("tp"===e){this._sy=this.newSy();var u=A.Eighth;if(this._sy===Tt.Number){switch(this._syData){case 8:u=A.Eighth;break;case 16:u=A.Sixteenth;break;case 32:u=A.ThirtySecond;break;default:u=A.Eighth}this._sy=this.newSy()}return t.tremoloSpeed=u,!0}return!1},e.prototype.applyTuplet=function(t,e){switch(e){case 3:t.tupletNumerator=3,t.tupletDenominator=2;break;case 5:t.tupletNumerator=5,t.tupletDenominator=4;break;case 6:t.tupletNumerator=6,t.tupletDenominator=4;break;case 7:t.tupletNumerator=7,t.tupletDenominator=4;break;case 9:t.tupletNumerator=9,t.tupletDenominator=8;break;case 10:t.tupletNumerator=10,t.tupletDenominator=8;break;case 11:t.tupletNumerator=11,t.tupletDenominator=8;break;case 12:t.tupletNumerator=12,t.tupletDenominator=8;break;default:t.tupletNumerator=1,t.tupletDenominator=1}},e.prototype.note=function(t){var e=!1,i=!1,n=-1,r=-1,a=-1;switch(this._sy){case Tt.Number:n=this._syData;break;case Tt.String:e="x"===this._syData,(i="-"===this._syData)||e?n=0:this.error("note-fret",Tt.Number,!0);break;case Tt.Tuning:var o=this._syData;r=o.octave,a=o.noteValue;break;default:return!1}this._sy=this.newSy();var s=-1===r&&this._currentStaff.tuning.length>0,h=-1;s&&(this._sy!==Tt.Dot&&this.error("note",Tt.Dot,!0),this._sy=this.newSy(),this._sy!==Tt.Number&&this.error("note-string",Tt.Number,!0),((h=this._syData)<1||h>this._currentStaff.tuning.length)&&this.error("note-string",Tt.Number,!1),this._sy=this.newSy());var c=new ot;return s?(c.string=this._currentStaff.tuning.length-(h-1),c.isDead=e,c.isTieDestination=i,i||(c.fret=n)):(c.octave=r,c.tone=a,c.isTieDestination=i),t.addNote(c),this.noteEffects(c),!0},e.prototype.noteEffects=function(t){if(this._sy===Tt.LBrace){for(this._sy=this.newSy();this._sy===Tt.String;){var e=this._syData.toLowerCase();if(this._syData=e,"b"===e||"be"===e){var i="be"===this._syData;for(this._sy=this.newSy(),this._sy!==Tt.LParensis&&this.error("bend-effect",Tt.LParensis,!0),this._sy=this.newSy();this._sy!==Tt.RParensis&&this._sy!==Tt.Eof;){var n=0,a=0;i?(this._sy!==Tt.Number&&this.error("bend-effect-value",Tt.Number,!0),n=this._syData,this._sy=this.newSy(),this._sy!==Tt.Number&&this.error("bend-effect-value",Tt.Number,!0),a=this._syData):(this._sy!==Tt.Number&&this.error("bend-effect-value",Tt.Number,!0),a=this._syData),t.addBendPoint(new X(n,a)),this._sy=this.newSy()}for(;t.bendPoints.length>60;)t.bendPoints.splice(t.bendPoints.length-1,1);if(i)t.bendPoints.sort((function(t,e){return t.offset-e.offset}));else for(var o=t.bendPoints.length,s=60/(o-1)|0,h=0;h<o;)t.bendPoints[h].offset=Math.min(60,h*s),h++;this._sy!==Tt.RParensis&&this.error("bend-effect",Tt.RParensis,!0),this._sy=this.newSy()}else if("nh"===e)t.harmonicType=G.Natural,this._sy=this.newSy();else if("ah"===e)t.harmonicType=G.Artificial,this._sy=this.newSy();else if("th"===e)t.harmonicType=G.Tap,this._sy=this.newSy();else if("ph"===e)t.harmonicType=G.Pinch,this._sy=this.newSy();else if("sh"===e)t.harmonicType=G.Semi,this._sy=this.newSy();else if("tr"===e){this._sy=this.newSy(),this._sy!==Tt.Number&&this.error("trill-effect",Tt.Number,!0);var c=this._syData;this._sy=this.newSy();var l=A.Sixteenth;if(this._sy===Tt.Number){switch(this._syData){case 16:l=A.Sixteenth;break;case 32:l=A.ThirtySecond;break;case 64:l=A.SixtyFourth;break;default:l=A.Sixteenth}this._sy=this.newSy()}t.trillValue=c+t.stringTuning,t.trillSpeed=l}else if("v"===e)this._sy=this.newSy(),t.vibrato=W.Slight;else if("sl"===e)this._sy=this.newSy(),t.slideOutType=H.Legato;else if("ss"===e)this._sy=this.newSy(),t.slideOutType=H.Shift;else if("sib"===e)this._sy=this.newSy(),t.slideInType=V.IntoFromBelow;else if("sia"===e)this._sy=this.newSy(),t.slideInType=V.IntoFromAbove;else if("sou"===e)this._sy=this.newSy(),t.slideOutType=H.OutUp;else if("sod"===e)this._sy=this.newSy(),t.slideOutType=H.OutDown;else if("psd"===e)this._sy=this.newSy(),t.slideOutType=H.PickSlideDown;else if("psu"===e)this._sy=this.newSy(),t.slideOutType=H.PickSlideUp;else if("h"===e)this._sy=this.newSy(),t.isHammerPullOrigin=!0;else if("lht"===e)this._sy=this.newSy(),t.isLeftHandTapped=!0;else if("g"===e)this._sy=this.newSy(),t.isGhost=!0;else if("ac"===e)this._sy=this.newSy(),t.accentuated=S.Normal;else if("hac"===e)this._sy=this.newSy(),t.accentuated=S.Heavy;else if("pm"===e)this._sy=this.newSy(),t.isPalmMute=!0;else if("st"===e)this._sy=this.newSy(),t.isStaccato=!0;else if("lr"===e)this._sy=this.newSy(),t.isLetRing=!0;else if("x"===e)this._sy=this.newSy(),t.fret=0,t.isDead=!0;else if("-"===e||"t"===e)this._sy=this.newSy(),t.isTieDestination=!0;else if("lf"===e){this._sy=this.newSy();var u=r.Thumb;this._sy===Tt.Number&&(u=this.toFinger(this._syData),this._sy=this.newSy()),t.leftHandFinger=u}else if("rf"===e){this._sy=this.newSy();u=r.Thumb;this._sy===Tt.Number&&(u=this.toFinger(this._syData),this._sy=this.newSy()),t.rightHandFinger=u}else this.applyBeatEffect(t.beat)||this.error(e,Tt.String,!1)}this._sy!==Tt.RBrace&&this.error("note-effect",Tt.RBrace,!1),this._sy=this.newSy()}},e.prototype.toFinger=function(t){switch(t){case 1:return r.Thumb;case 2:return r.IndexFinger;case 3:return r.MiddleFinger;case 4:return r.AnnularFinger;case 5:return r.LittleFinger}return r.Thumb},e.prototype.parseDuration=function(t){switch(t){case-4:return A.QuadrupleWhole;case-2:return A.DoubleWhole;case 1:return A.Whole;case 2:return A.Half;case 4:return A.Quarter;case 8:return A.Eighth;case 16:return A.Sixteenth;case 32:return A.ThirtySecond;case 64:return A.SixtyFourth;case 128:return A.OneHundredTwentyEighth;default:return A.Quarter}},e.prototype.barMeta=function(t){for(var e=t.masterBar;this._sy===Tt.MetaCommand;){var i=this._syData.toLowerCase();if("ts"===i)this._sy=this.newSy(),this._sy!==Tt.Number&&this.error("timesignature-numerator",Tt.Number,!0),e.timeSignatureNumerator=this._syData,this._sy=this.newSy(),this._sy!==Tt.Number&&this.error("timesignature-denominator",Tt.Number,!0),e.timeSignatureDenominator=this._syData,this._sy=this.newSy();else if("ro"===i)e.isRepeatStart=!0,this._sy=this.newSy();else if("rc"===i)this._sy=this.newSy(),this._sy!==Tt.Number&&this.error("repeatclose",Tt.Number,!0),e.repeatCount=this._syData,this._sy=this.newSy();else if("ks"===i)this._sy=this.newSy(),this._sy!==Tt.String&&this.error("keysignature",Tt.String,!0),e.keySignature=this.parseKeySignature(this._syData.toLowerCase()),this._sy=this.newSy();else if("clef"===i){switch(this._sy=this.newSy(),this._sy){case Tt.String:t.clef=this.parseClefFromString(this._syData.toLowerCase());break;case Tt.Number:t.clef=this.parseClefFromInt(this._syData);break;case Tt.Tuning:var n=this._syData;t.clef=this.parseClefFromInt(n.realValue);break;default:this.error("clef",Tt.String,!0)}this._sy=this.newSy()}else if("tempo"===i){this._sy=this.newSy(),this._sy!==Tt.Number&&this.error("tempo",Tt.Number,!0);var r=new F;r.isLinear=!0,r.type=B.Tempo,r.value=this._syData,e.tempoAutomation=r,this._sy=this.newSy()}else if("section"===i){this._sy=this.newSy(),this._sy!==Tt.String&&this.error("section",Tt.String,!0);var a=this._syData;this._sy=this.newSy();var o="";this._sy===Tt.String&&(o=a,a=this._syData,this._sy=this.newSy());var s=new vt;s.marker=o,s.text=a,e.section=s}else if("tf"===i){switch(this._allowTuning=!1,this._sy=this.newSy(),this._allowTuning=!0,this._sy){case Tt.String:e.tripletFeel=this.parseTripletFeelFromString(this._syData.toLowerCase());break;case Tt.Number:e.tripletFeel=this.parseTripletFeelFromInt(this._syData);break;default:this.error("triplet-feel",Tt.String,!0)}this._sy=this.newSy()}else"ac"===i?(e.isAnacrusis=!0,this._sy=this.newSy()):0!==t.index||this.handleStaffMeta()||this.error("measure-effects",Tt.String,!1)}},e.Eof=0,e}(k),Ct=function(){function t(){}return t.uint16ToInt16=function(e){return t._dataView.setUint16(0,e,!0),t._dataView.getInt16(0,!0)},t.int16ToUint32=function(e){return t._dataView.setInt16(0,e,!0),t._dataView.getUint32(0,!0)},t.int32ToUint16=function(e){return t._dataView.setInt32(0,e,!0),t._dataView.getUint16(0,!0)},t.int32ToInt16=function(e){return t._dataView.setInt32(0,e,!0),t._dataView.getInt16(0,!0)},t.int32ToUint32=function(e){return t._dataView.setInt32(0,e,!0),t._dataView.getUint32(0,!0)},t.uint8ToInt8=function(e){return t._dataView.setUint8(0,e),t._dataView.getInt8(0)},t._conversionBuffer=new ArrayBuffer(8),t._dataView=new DataView(t._conversionBuffer),t}(),Ft=function(){function t(){}return t.readInt32BE=function(t){return t.readByte()<<24|t.readByte()<<16|t.readByte()<<8|t.readByte()},t.readInt32LE=function(t){var e=t.readByte(),i=t.readByte(),n=t.readByte();return t.readByte()<<24|n<<16|i<<8|e},t.readUInt32LE=function(t){var e=t.readByte(),i=t.readByte(),n=t.readByte();return t.readByte()<<24|n<<16|i<<8|e},t.readUInt16LE=function(t){var e=t.readByte(),i=t.readByte();return Ct.int32ToUint16(i<<8|e)},t.readInt16LE=function(t){var e=t.readByte(),i=t.readByte();return Ct.int32ToInt16(i<<8|e)},t.readUInt32BE=function(t){var e=t.readByte(),i=t.readByte(),n=t.readByte(),r=t.readByte();return Ct.int32ToUint32(e<<24|i<<16|n<<8|r)},t.readUInt16BE=function(t){var e=t.readByte(),i=t.readByte();return Ct.int32ToInt16(e<<8|i)},t.readInt16BE=function(t){var e=t.readByte(),i=t.readByte();return Ct.int32ToInt16(e<<8|i)},t.readByteArray=function(t,e){var i=new Uint8Array(e);return t.read(i,0,e),i},t.read8BitChars=function(e,i){var n=new Uint8Array(i);return e.read(n,0,n.length),t.toString(n,"utf-8")},t.read8BitString=function(t){for(var e="",i=t.readByte();0!==i;)e+=String.fromCharCode(i),i=t.readByte();return e},t.read8BitStringLength=function(t,e){for(var i="",n=-1,r=0;r<e;r++){var a=t.readByte();0===a&&-1===n&&(n=r),i+=String.fromCharCode(a)}var o=i;return n>=0?o.substr(0,n):o},t.readSInt8=function(t){var e=t.readByte();return-256*((255&e)>>7)+(255&e)},t.readInt24=function(t,e){var i=t[e]|t[e+1]<<8|t[e+2]<<16;return 8388608==(8388608&i)&&(i|=255<<24),i},t.readInt16=function(t,e){return Ct.int32ToInt16(t[e]|t[e+1]<<8)},t.toString=function(e,i){if(qh.supportsTextDecoder){var n=t.detectEncoding(e);return n&&(i=n),i||(i="utf-8"),new TextDecoder(i).decode(e.buffer)}for(var r="",a=0;a<e.length;){var o=e[a++];if(o<128){if(0===o)break;r+=String.fromCharCode(o)}else if(o<224)r+=String.fromCharCode((63&o)<<6|127&e[a++]);else if(o<240)r+=String.fromCharCode((31&o)<<12|(127&e[a++])<<6|127&e[a++]);else{var s=(15&o)<<18|(127&e[a++])<<12|(127&e[a++])<<6|127&e[a++];r+=String.fromCharCode(55232+(s>>18)),r+=String.fromCharCode(1023&s|56320)}}return r},t.detectEncoding=function(t){return t.length>2&&254===t[0]&&255===t[1]?"utf-16be":t.length>2&&255===t[0]&&254===t[1]?"utf-16le":t.length>4&&0===t[0]&&0===t[1]&&254===t[2]&&255===t[3]?"utf-32be":t.length>4&&255===t[0]&&254===t[1]&&0===t[2]&&0===t[3]?"utf-32le":null},t}(),Lt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Et=function(t){function e(){var e=t.call(this)||this;return e._versionNumber=0,e._globalTripletFeel=dt.NoTripletFeel,e._lyricsTrack=0,e._lyrics=[],e._barCount=0,e._trackCount=0,e._playbackInfos=[],e}return Lt(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"Guitar Pro 3-5"},enumerable:!1,configurable:!0}),e.prototype.readScore=function(){return this.readVersion(),this._score=new bt,this.readScoreInformation(),this._versionNumber<500&&(this._globalTripletFeel=Mt.gpReadBool(this.data)?dt.Triplet8th:dt.NoTripletFeel),this._versionNumber>=400&&this.readLyrics(),this._versionNumber>=510&&this.data.skip(19),this._versionNumber>=500&&(this.readPageSetup(),this._score.tempoLabel=Mt.gpReadStringIntByte(this.data,this.settings.importer.encoding)),this._score.tempo=Ft.readInt32LE(this.data),this._versionNumber>=510&&Mt.gpReadBool(this.data),Ft.readInt32LE(this.data),this._versionNumber>=400&&this.data.readByte(),this.readPlaybackInfos(),this._versionNumber>=500&&(this.data.skip(38),this.data.skip(4)),this._barCount=Ft.readInt32LE(this.data),this._trackCount=Ft.readInt32LE(this.data),this.readMasterBars(),this.readTracks(),this.readBars(),this._score.finish(this.settings),this._lyrics&&this._lyricsTrack>=0&&this._score.tracks[this._lyricsTrack].applyLyrics(this._lyrics),this._score},e.prototype.readVersion=function(){var t=Mt.gpReadStringByteLength(this.data,30,this.settings.importer.encoding);if(!t.startsWith(e.VersionString))throw new N("Unsupported format");var i=(t=t.substr(e.VersionString.length+1)).indexOf(String.fromCharCode(46));this._versionNumber=100*parseInt(t.substr(0,i))+parseInt(t.substr(i+1)),et.debug(this.name,"Guitar Pro version "+t+" detected")},e.prototype.readScoreInformation=function(){var t;this._score.title=Mt.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.subTitle=Mt.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.artist=Mt.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.album=Mt.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.words=Mt.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.music=this._versionNumber>=500?Mt.gpReadStringIntUnused(this.data,this.settings.importer.encoding):this._score.words,this._score.copyright=Mt.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.tab=Mt.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.instructions=Mt.gpReadStringIntUnused(this.data,this.settings.importer.encoding);for(var e=Ft.readInt32LE(this.data),i="",n=0;n<e;n++)n>0&&(i+="\r\n"),i+=null===(t=Mt.gpReadStringIntUnused(this.data,this.settings.importer.encoding))||void 0===t?void 0:t.toString();this._score.notices=i},e.prototype.readLyrics=function(){this._lyrics=[],this._lyricsTrack=Ft.readInt32LE(this.data)-1;for(var t=0;t<5;t++){var e=new ft;e.startBar=Ft.readInt32LE(this.data)-1,e.text=Mt.gpReadStringInt(this.data,this.settings.importer.encoding),this._lyrics.push(e)}},e.prototype.readPageSetup=function(){this.data.skip(30);for(var t=0;t<10;t++)Mt.gpReadStringIntByte(this.data,this.settings.importer.encoding)},e.prototype.readPlaybackInfos=function(){this._playbackInfos=[];for(var t=0;t<64;t++){var e=new _t;e.primaryChannel=t,e.secondaryChannel=t,e.program=Ft.readInt32LE(this.data),e.volume=this.data.readByte(),e.balance=this.data.readByte(),this.data.skip(6),this._playbackInfos.push(e)}},e.prototype.readMasterBars=function(){for(var t=0;t<this._barCount;t++)this.readMasterBar()},e.prototype.readMasterBar=function(){var t=null;this._score.masterBars.length>0&&(t=this._score.masterBars[this._score.masterBars.length-1]);var e=new yt,i=this.data.readByte();if(0!=(1&i)?e.timeSignatureNumerator=this.data.readByte():t&&(e.timeSignatureNumerator=t.timeSignatureNumerator),0!=(2&i)?e.timeSignatureDenominator=this.data.readByte():t&&(e.timeSignatureDenominator=t.timeSignatureDenominator),e.isRepeatStart=0!=(4&i),0!=(8&i)&&(e.repeatCount=this.data.readByte()+(this._versionNumber>=500?0:1)),0!=(16&i))if(this._versionNumber<500){for(var n=t,r=0;n&&(!n.isRepeatEnd||n===t)&&!n.isRepeatStart;)r|=n.alternateEndings,n=n.previousMasterBar;for(var a=0,o=this.data.readByte(),s=0;s<8;s++){var h=1<<s;o>s&&0==(r&h)&&(a|=h)}e.alternateEndings=a}else e.alternateEndings=this.data.readByte();if(0!=(32&i)){var c=new vt;c.text=Mt.gpReadStringIntByte(this.data,this.settings.importer.encoding),c.marker="",Mt.gpReadColor(this.data,!1),e.section=c}if(0!=(64&i)?(e.keySignature=Ft.readSInt8(this.data),e.keySignatureType=this.data.readByte()):t&&(e.keySignature=t.keySignature,e.keySignatureType=t.keySignatureType),this._versionNumber>=500&&0!=(3&i)&&this.data.skip(4),this._versionNumber>=500&&0==(16&i)&&(e.alternateEndings=this.data.readByte()),this._versionNumber>=500){switch(this.data.readByte()){case 1:e.tripletFeel=dt.Triplet8th;break;case 2:e.tripletFeel=dt.Triplet16th}this.data.readByte()}else e.tripletFeel=this._globalTripletFeel;e.isDoubleBar=0!=(128&i),this._score.addMasterBar(e)},e.prototype.readTracks=function(){for(var t=0;t<this._trackCount;t++)this.readTrack()},e.prototype.readTrack=function(){var t=new St;t.ensureStaveCount(1),this._score.addTrack(t);var e=t.staves[0],i=this.data.readByte();t.name=Mt.gpReadStringByteLength(this.data,40,this.settings.importer.encoding),0!=(1&i)&&(e.isPercussion=!0);for(var n=Ft.readInt32LE(this.data),r=[],a=0;a<7;a++){var o=Ft.readInt32LE(this.data);n>a&&r.push(o)}e.tuning=r;var s=Ft.readInt32LE(this.data),h=Ft.readInt32LE(this.data)-1,c=Ft.readInt32LE(this.data)-1;if(this.data.skip(4),h>=0&&h<this._playbackInfos.length){var l=this._playbackInfos[h];l.port=s,l.isSolo=0!=(16&i),l.isMute=0!=(32&i),l.secondaryChannel=c,p.isGuitar(l.program)&&(e.displayTranspositionPitch=-12),t.playbackInfo=l}e.capo=Ft.readInt32LE(this.data),t.color=Mt.gpReadColor(this.data,!1),this._versionNumber>=500&&(this.data.readByte(),this.data.readByte(),this.data.skip(43)),this._versionNumber>=510&&(this.data.skip(4),Mt.gpReadStringIntByte(this.data,this.settings.importer.encoding),Mt.gpReadStringIntByte(this.data,this.settings.importer.encoding))},e.prototype.readBars=function(){for(var t=0;t<this._barCount;t++)for(var e=0;e<this._trackCount;e++)this.readBar(this._score.tracks[e])},e.prototype.readBar=function(t){var e=new U,i=t.staves[0];i.isPercussion&&(e.clef=O.Neutral),i.addBar(e);var n=1;this._versionNumber>=500&&(this.data.readByte(),n=2);for(var r=0;r<n;r++)this.readVoice(t,e)},e.prototype.readVoice=function(t,e){var i=Ft.readInt32LE(this.data);if(0!==i){var n=new kt;e.addVoice(n);for(var r=0;r<i;r++)this.readBeat(t,e,n)}},e.prototype.readBeat=function(t,e,i){var n=new ct,r=this.data.readByte();if(0!=(1&r)&&(n.dots=1),0!=(64&r)){var a=this.data.readByte();n.isEmpty=0==(2&a)}switch(i.addBeat(n),Ft.readSInt8(this.data)){case-2:n.duration=A.Whole;break;case-1:n.duration=A.Half;break;case 0:n.duration=A.Quarter;break;case 1:n.duration=A.Eighth;break;case 2:n.duration=A.Sixteenth;break;case 3:n.duration=A.ThirtySecond;break;case 4:n.duration=A.SixtyFourth;break;default:n.duration=A.Quarter}if(0!=(32&r))switch(n.tupletNumerator=Ft.readInt32LE(this.data),n.tupletNumerator){case 1:n.tupletDenominator=1;break;case 3:n.tupletDenominator=2;break;case 5:case 6:case 7:n.tupletDenominator=4;break;case 9:case 10:case 11:case 12:case 13:n.tupletDenominator=8;break;case 2:case 4:case 8:break;default:n.tupletNumerator=1,n.tupletDenominator=1}0!=(2&r)&&this.readChord(n),0!=(4&r)&&(n.text=Mt.gpReadStringIntUnused(this.data,this.settings.importer.encoding));var o=G.None;0!=(8&r)&&(o=this.readBeatEffects(n)),0!=(16&r)&&this.readMixTableChange(n);for(var s=this.data.readByte(),h=6;h>=0;h--)if(0!=(s&1<<h)&&6-h<e.staff.tuning.length){var c=this.readNote(t,e,i,n,6-h);o!==G.None&&(c.harmonicType=o,c.harmonicType===G.Natural&&(c.harmonicValue=this.deltaFretToHarmonicValue(c.fret)))}this._versionNumber>=500&&(this.data.readByte(),0!=(8&this.data.readByte())&&this.data.readByte())},e.prototype.readChord=function(t){var e=new lt,i=g.newGuid();if(this._versionNumber>=500){this.data.skip(17),e.name=Mt.gpReadStringByteLength(this.data,21,this.settings.importer.encoding),this.data.skip(4),e.firstFret=Ft.readInt32LE(this.data);for(var n=0;n<7;n++){var r=Ft.readInt32LE(this.data);n<t.voice.bar.staff.tuning.length&&e.strings.push(r)}var a=this.data.readByte(),o=new Uint8Array(5);this.data.read(o,0,o.length);for(n=0;n<a;n++)e.barreFrets.push(o[n]);this.data.skip(26)}else if(0!==this.data.readByte())if(this._versionNumber>=400){this.data.skip(16),e.name=Mt.gpReadStringByteLength(this.data,21,this.settings.importer.encoding),this.data.skip(4),e.firstFret=Ft.readInt32LE(this.data);for(n=0;n<7;n++){r=Ft.readInt32LE(this.data);n<t.voice.bar.staff.tuning.length&&e.strings.push(r)}a=this.data.readByte(),o=new Uint8Array(5);this.data.read(o,0,o.length);for(n=0;n<a;n++)e.barreFrets.push(o[n]);this.data.skip(26)}else{this.data.skip(25),e.name=Mt.gpReadStringByteLength(this.data,34,this.settings.importer.encoding),e.firstFret=Ft.readInt32LE(this.data);for(n=0;n<6;n++){r=Ft.readInt32LE(this.data);n<t.voice.bar.staff.tuning.length&&e.strings.push(r)}this.data.skip(36)}else{var s=this._versionNumber>=406?7:6;if(e.name=Mt.gpReadStringIntByte(this.data,this.settings.importer.encoding),e.firstFret=Ft.readInt32LE(this.data),e.firstFret>0)for(n=0;n<s;n++){r=Ft.readInt32LE(this.data);n<t.voice.bar.staff.tuning.length&&e.strings.push(r)}}e.name&&(t.chordId=i,t.voice.bar.staff.addChord(t.chordId,e))},e.prototype.readBeatEffects=function(t){var i=this.data.readByte(),n=0;if(this._versionNumber>=400&&(n=this.data.readByte()),t.fadeIn=0!=(16&i),(this._versionNumber<400&&0!=(1&i)||0!=(2&i))&&(t.vibrato=W.Slight),t.hasRasgueado=0!=(1&n),0!=(32&i)&&this._versionNumber>=400)switch(Ft.readSInt8(this.data)){case 1:t.tap=!0;break;case 2:t.slap=!0;break;case 3:t.pop=!0}else if(0!=(32&i)){switch(Ft.readSInt8(this.data)){case 1:t.tap=!0;break;case 2:t.slap=!0;break;case 3:t.pop=!0}this.data.skip(4)}if(0!=(4&n)&&this.readTremoloBarEffect(t),0!=(64&i)){var r=0,a=0;this._versionNumber<500?(a=this.data.readByte(),r=this.data.readByte()):(r=this.data.readByte(),a=this.data.readByte()),r>0?(t.brushType=M.BrushUp,t.brushDuration=e.toStrokeValue(r)):a>0&&(t.brushType=M.BrushDown,t.brushDuration=e.toStrokeValue(a))}if(0!=(2&n))switch(Ft.readSInt8(this.data)){case 0:t.pickStroke=q.None;break;case 1:t.pickStroke=q.Up;break;case 2:t.pickStroke=q.Down}if(this._versionNumber<400){if(0!=(4&i))return G.Natural;if(0!=(8&i))return G.Artificial}return G.None},e.prototype.readTremoloBarEffect=function(t){this.data.readByte(),Ft.readInt32LE(this.data);var i=Ft.readInt32LE(this.data);if(i>0)for(var n=0;n<i;n++){var r=new X(0,0);r.offset=Ft.readInt32LE(this.data),r.value=Ft.readInt32LE(this.data)/e.BendStep|0,Mt.gpReadBool(this.data),t.addWhammyBarPoint(r)}},e.toStrokeValue=function(t){switch(t){case 1:case 2:return 30;case 3:return 60;case 4:return 120;case 5:return 240;case 6:return 480;default:return 0}},e.prototype.readMixTableChange=function(t){var e=new Dt;e.instrument=Ft.readSInt8(this.data),this._versionNumber>=500&&this.data.skip(16),e.volume=Ft.readSInt8(this.data),e.balance=Ft.readSInt8(this.data);var i=Ft.readSInt8(this.data),n=Ft.readSInt8(this.data),r=Ft.readSInt8(this.data),a=Ft.readSInt8(this.data);if(this._versionNumber>=500&&(e.tempoName=Mt.gpReadStringIntByte(this.data,this.settings.importer.encoding)),e.tempo=Ft.readInt32LE(this.data),e.volume>=0&&this.data.readByte(),e.balance>=0&&this.data.readByte(),i>=0&&this.data.readByte(),n>=0&&this.data.readByte(),r>=0&&this.data.readByte(),a>=0&&this.data.readByte(),e.tempo>=0&&(e.duration=Ft.readSInt8(this.data),this._versionNumber>=510&&this.data.readByte()),this._versionNumber>=400&&this.data.readByte(),this._versionNumber>=500&&this.data.readByte(),this._versionNumber>=510&&(Mt.gpReadStringIntByte(this.data,this.settings.importer.encoding),Mt.gpReadStringIntByte(this.data,this.settings.importer.encoding)),e.volume>=0){var o=new F;o.isLinear=!0,o.type=B.Volume,o.value=e.volume,t.automations.push(o)}if(e.balance>=0){var s=new F;s.isLinear=!0,s.type=B.Balance,s.value=e.balance,t.automations.push(s)}if(e.instrument>=0){var h=new F;h.isLinear=!0,h.type=B.Instrument,h.value=e.instrument,t.automations.push(h)}if(e.tempo>=0){var c=new F;c.isLinear=!0,c.type=B.Tempo,c.value=e.tempo,t.automations.push(c),t.voice.bar.masterBar.tempoAutomation=c}},e.prototype.readNote=function(t,e,i,n,r){var a=new ot;a.string=e.staff.tuning.length-r;var o=this.data.readByte();if(0!=(2&o)?a.accentuated=S.Heavy:0!=(64&o)&&(a.accentuated=S.Normal),a.isGhost=0!=(4&o),0!=(32&o)){var s=this.data.readByte();3===s?a.isDead=!0:2===s&&(a.isTieDestination=!0)}if(0!=(1&o)&&this._versionNumber<500&&(this.data.readByte(),this.data.readByte()),0!=(16&o)){var h=Ft.readSInt8(this.data);a.dynamics=this.toDynamicValue(h),n.dynamics=a.dynamics}if(0!=(32&o)&&(a.fret=Ft.readSInt8(this.data)),0!=(128&o)&&(a.leftHandFinger=Ft.readSInt8(this.data),a.rightHandFinger=Ft.readSInt8(this.data),a.isFingering=!0),this._versionNumber>=500){0!=(1&o)&&(a.durationPercent=Mt.gpReadDouble(this.data));var c=this.data.readByte();a.accidentalMode=0!=(2&c)?j.SwapAccidentals:j.Default}return n.addNote(a),0!=(8&o)&&this.readNoteEffects(t,i,n,a),e.staff.isPercussion&&(a.percussionArticulation=a.fret,a.string=-1,a.fret=-1),a},e.prototype.toDynamicValue=function(t){switch(t){case 1:return I.PPP;case 2:return I.PP;case 3:return I.P;case 4:return I.MP;case 5:return I.MF;case 6:return I.F;case 7:return I.FF;case 8:return I.FFF;default:return I.F}},e.prototype.readNoteEffects=function(t,e,i,n){var r=this.data.readByte(),a=0;this._versionNumber>=400&&(a=this.data.readByte()),0!=(1&r)&&this.readBend(n),0!=(16&r)&&this.readGrace(e,n),0!=(4&a)&&this.readTremoloPicking(i),0!=(8&a)?this.readSlide(n):this._versionNumber<400&&0!=(4&r)&&(n.slideOutType=H.Shift),0!=(16&a)&&this.readArtificialHarmonic(n),0!=(32&a)&&this.readTrill(n),n.isLetRing=0!=(8&r),n.isHammerPullOrigin=0!=(2&r),0!=(64&a)&&(n.vibrato=W.Slight),n.isPalmMute=0!=(2&a),n.isStaccato=0!=(1&a)},e.prototype.readBend=function(t){this.data.readByte(),Ft.readInt32LE(this.data);var i=Ft.readInt32LE(this.data);if(i>0)for(var n=0;n<i;n++){var r=new X(0,0);r.offset=Ft.readInt32LE(this.data),r.value=Ft.readInt32LE(this.data)/e.BendStep|0,Mt.gpReadBool(this.data),t.addBendPoint(r)}},e.prototype.readGrace=function(t,e){var i=new ct,n=new ot;switch(n.string=e.string,n.fret=Ft.readSInt8(this.data),i.duration=A.ThirtySecond,i.dynamics=this.toDynamicValue(Ft.readSInt8(this.data)),Ft.readSInt8(this.data)){case 0:break;case 1:n.slideOutType=H.Legato,n.slideTarget=e;break;case 2:break;case 3:n.isHammerPullOrigin=!0}if(n.dynamics=i.dynamics,this.data.skip(1),this._versionNumber<500)i.graceType=R.BeforeBeat;else{var r=this.data.readByte();n.isDead=0!=(1&r),i.graceType=0!=(2&r)?R.OnBeat:R.BeforeBeat}t.addGraceBeat(i),i.addNote(n)},e.prototype.readTremoloPicking=function(t){switch(this.data.readByte()){case 1:t.tremoloSpeed=A.Eighth;break;case 2:t.tremoloSpeed=A.Sixteenth;break;case 3:t.tremoloSpeed=A.ThirtySecond}},e.prototype.readSlide=function(t){var e;if(this._versionNumber>=500)0!=(1&(e=Ft.readSInt8(this.data)))?t.slideOutType=H.Shift:0!=(2&e)?t.slideOutType=H.Legato:0!=(4&e)?t.slideOutType=H.OutDown:0!=(8&e)&&(t.slideOutType=H.OutUp),0!=(16&e)?t.slideInType=V.IntoFromBelow:0!=(32&e)&&(t.slideInType=V.IntoFromAbove);else switch(e=Ft.readSInt8(this.data)){case 1:t.slideOutType=H.Shift;break;case 2:t.slideOutType=H.Legato;break;case 3:t.slideOutType=H.OutDown;break;case 4:t.slideOutType=H.OutUp;break;case-1:t.slideInType=V.IntoFromBelow;break;case-2:t.slideInType=V.IntoFromAbove}},e.prototype.readArtificialHarmonic=function(t){var e=this.data.readByte();if(this._versionNumber>=500)switch(e){case 1:t.harmonicType=G.Natural,t.harmonicValue=this.deltaFretToHarmonicValue(t.fret);break;case 2:this.data.readByte(),this.data.readByte(),this.data.readByte(),t.harmonicType=G.Artificial;break;case 3:t.harmonicType=G.Tap,t.harmonicValue=this.deltaFretToHarmonicValue(this.data.readByte());break;case 4:t.harmonicType=G.Pinch,t.harmonicValue=12;break;case 5:t.harmonicType=G.Semi,t.harmonicValue=12}else if(this._versionNumber>=400)switch(e){case 1:t.harmonicType=G.Natural;break;case 3:t.harmonicType=G.Tap;break;case 4:t.harmonicType=G.Pinch;break;case 5:t.harmonicType=G.Semi;break;case 15:case 17:case 22:t.harmonicType=G.Artificial}},e.prototype.deltaFretToHarmonicValue=function(t){switch(t){case 2:return 2.4;case 3:return 3.2;case 4:case 5:case 7:case 9:case 12:case 16:case 17:case 19:case 24:return t;case 8:return 8.2;case 10:return 9.6;case 14:case 15:return 14.7;case 21:case 22:return 21.7;default:return 12}},e.prototype.readTrill=function(t){switch(t.trillValue=this.data.readByte()+t.stringTuning,this.data.readByte()){case 1:t.trillSpeed=A.Sixteenth;break;case 2:t.trillSpeed=A.ThirtySecond;break;case 3:t.trillSpeed=A.SixtyFourth}},e.VersionString="FICHIER GUITAR PRO ",e.BendStep=25,e}(k),Mt=function(){function t(){}return t.gpReadDouble=function(t){var e=new Uint8Array(8);return t.read(e,0,e.length),new Float64Array(e.buffer)[0]},t.gpReadFloat=function(t){var e=new Uint8Array(4);return e[3]=t.readByte(),e[2]=t.readByte(),e[2]=t.readByte(),e[1]=t.readByte(),new Float32Array(e.buffer)[0]},t.gpReadColor=function(t,e){void 0===e&&(e=!1);var i=t.readByte(),n=t.readByte(),r=t.readByte(),a=255;return e?a=t.readByte():t.skip(1),new m(i,n,r,a)},t.gpReadBool=function(t){return 0!==t.readByte()},t.gpReadStringIntUnused=function(e,i){return e.skip(4),t.gpReadString(e,e.readByte(),i)},t.gpReadStringInt=function(e,i){return t.gpReadString(e,Ft.readInt32LE(e),i)},t.gpReadStringIntByte=function(e,i){var n=Ft.readInt32LE(e)-1;return e.readByte(),t.gpReadString(e,n,i)},t.gpReadString=function(t,e,i){var n=new Uint8Array(e);return t.read(n,0,n.length),Ft.toString(n,i)},t.gpReadStringByteLength=function(e,i,n){var r=e.readByte(),a=t.gpReadString(e,r,n);return r<i&&e.skip(i-r),a},t}(),Dt=function(){this.volume=-1,this.balance=-1,this.instrument=-1,this.tempoName="",this.tempo=-1,this.duration=-1},At=function(){function t(){this._capacity=0,this.length=0,this.position=0}return t.prototype.getBuffer=function(){return this._buffer},t.empty=function(){return t.withCapactiy(0)},t.withCapactiy=function(e){var i=new t;return i._buffer=new Uint8Array(e),i._capacity=e,i},t.fromBuffer=function(e){var i=new t;return i._buffer=e,i._capacity=i.length=e.length,i},t.fromString=function(e){for(var i=new Uint8Array(e.length),n=0;n<e.length;n++)i[n]=e.charCodeAt(n);return t.fromBuffer(i)},t.prototype.reset=function(){this.position=0},t.prototype.skip=function(t){this.position+=t},t.prototype.setCapacity=function(t){if(t!==this._capacity){if(t>0){var e=new Uint8Array(t);this.length>0&&e.set(this._buffer.subarray(0,0+this.length),0),this._buffer=e}this._capacity=t}},t.prototype.readByte=function(){return this.length-this.position<=0?-1:this._buffer[this.position++]},t.prototype.read=function(t,e,i){var n=this.length-this.position;if(n>i&&(n=i),n<=0)return 0;if(n<=8)for(var r=n;--r>=0;)t[e+r]=this._buffer[this.position+r];else t.set(this._buffer.subarray(this.position,this.position+n),e);return this.position+=n,n},t.prototype.writeByte=function(t){var e=new Uint8Array(1);e[0]=t,this.write(e,0,1)},t.prototype.write=function(t,e,i){var n=this.position+i;if(n>this.length&&(n>this._capacity&&this.ensureCapacity(n),this.length=n),i<=8&&t!==this._buffer)for(var r=i;--r>=0;)this._buffer[this.position+r]=t[e+r];else{var a=Math.min(i,t.length-e);this._buffer.set(t.subarray(e,e+a),this.position)}this.position=n},t.prototype.ensureCapacity=function(t){if(t>this._capacity){var e=t;e<256&&(e=256),e<2*this._capacity&&(e=2*this._capacity),this.setCapacity(e)}},t.prototype.readAll=function(){return this.toArray()},t.prototype.toArray=function(){var t=new Uint8Array(this.length);return t.set(this._buffer.subarray(0,0+this.length),0),t},t}(),It=function(){this.x=0,this.y=0,this.w=0,this.h=0};!function(t){t[t.Boolean=0]="Boolean",t[t.Integer=1]="Integer",t[t.Float=2]="Float",t[t.String=3]="String",t[t.Point=4]="Point",t[t.Size=5]="Size",t[t.Rectangle=6]="Rectangle",t[t.Color=7]="Color"}(Nt||(Nt={}));var Rt,Gt=function(){function t(t){this.raw=new Map;for(var e=At.fromBuffer(t),i=Ft.readInt32BE(e),n=0;n<i;n++){var r=Mt.gpReadString(e,e.readByte(),"utf-8");switch(e.readByte()){case Nt.Boolean:var a=1===e.readByte();this.addValue(r,a);break;case Nt.Integer:var o=Ft.readInt32BE(e);this.addValue(r,o);break;case Nt.Float:var s=Mt.gpReadFloat(e);this.addValue(r,s);break;case Nt.String:var h=Mt.gpReadString(e,Ft.readInt16BE(e),"utf-8");this.addValue(r,h);break;case Nt.Point:var c=Ft.readInt32BE(e),l=Ft.readInt32BE(e);this.addValue(r,new X(c,l));break;case Nt.Size:var u=Ft.readInt32BE(e),p=Ft.readInt32BE(e);this.addValue(r,new X(u,p));break;case Nt.Rectangle:var d=new It;d.x=Ft.readInt32BE(e),d.y=Ft.readInt32BE(e),d.w=Ft.readInt32BE(e),d.h=Ft.readInt32BE(e),this.addValue(r,d);break;case Nt.Color:var f=Mt.gpReadColor(e,!0);this.addValue(r,f)}}}return t.prototype.apply=function(t){this.raw.forEach((function(e,i){switch(i){case"StandardNotation/hideDynamics":t.stylesheet.hideDynamics=e}}))},t.prototype.addValue=function(t,e){this.raw.set(t,e)},t}();!function(t){t[t.Short=0]="Short",t[t.Medium=1]="Medium",t[t.Long=2]="Long"}(Rt||(Rt={}));var jt,Vt=function(){function t(){this.type=Rt.Short,this.length=0}return t.copyTo=function(t,e){e.type=t.type,e.length=t.length},t}();!function(t){t[t.None=0]="None",t[t.Element=1]="Element",t[t.Attribute=2]="Attribute",t[t.Text=3]="Text",t[t.CDATA=4]="CDATA",t[t.EntityReference=5]="EntityReference",t[t.Entity=6]="Entity",t[t.ProcessingInstruction=7]="ProcessingInstruction",t[t.Comment=8]="Comment",t[t.Document=9]="Document",t[t.DocumentType=10]="DocumentType",t[t.DocumentFragment=11]="DocumentFragment",t[t.Notation=12]="Notation",t[t.Whitespace=13]="Whitespace",t[t.SignificantWhitespace=14]="SignificantWhitespace",t[t.EndElement=15]="EndElement",t[t.EndEntity=16]="EndEntity",t[t.XmlDeclaration=17]="XmlDeclaration"}(jt||(jt={}));var Ht,Wt=function(){function t(){this.nodeType=jt.None,this.localName=null,this.value=null,this.childNodes=[],this.attributes=new Map,this.firstChild=null,this.firstElement=null}return t.prototype.addChild=function(t){this.childNodes.push(t),this.firstChild=t,t.nodeType===jt.Element&&(this.firstElement=t)},t.prototype.getAttribute=function(t){return this.attributes.has(t)?this.attributes.get(t):""},t.prototype.getElementsByTagName=function(t,e){void 0===e&&(e=!1);var i=[];return this.searchElementsByTagName(this.childNodes,i,t,e),i},t.prototype.searchElementsByTagName=function(t,e,i,n){void 0===n&&(n=!1);for(var r=0,a=t;r<a.length;r++){var o=a[r];o&&o.nodeType===jt.Element&&o.localName===i&&e.push(o),n&&this.searchElementsByTagName(o.childNodes,e,i,!0)}},t.prototype.findChildElement=function(t){for(var e=0,i=this.childNodes;e<i.length;e++){var n=i[e];if(n&&n.nodeType===jt.Element&&n.localName===t)return n}return null},Object.defineProperty(t.prototype,"innerText",{get:function(){var t,e;if(this.nodeType===jt.Element||this.nodeType===jt.Document){for(var i="",n=0,r=this.childNodes;n<r.length;n++){i+=null===(t=r[n].innerText)||void 0===t?void 0:t.toString()}return i.trim()}return null!==(e=this.value)&&void 0!==e?e:""},enumerable:!1,configurable:!0}),t}(),Ut=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),zt=function(e){function i(n,r,a){var o=e.call(this,t.AlphaTabErrorType.Format,n)||this;return o.pos=0,o.xml=r,o.pos=a,Object.setPrototypeOf(o,i.prototype),o}return Ut(i,e),i}(c);!function(t){t[t.IgnoreSpaces=0]="IgnoreSpaces",t[t.Begin=1]="Begin",t[t.BeginNode=2]="BeginNode",t[t.TagName=3]="TagName",t[t.Body=4]="Body",t[t.AttribName=5]="AttribName",t[t.Equals=6]="Equals",t[t.AttvalBegin=7]="AttvalBegin",t[t.AttribVal=8]="AttribVal",t[t.Childs=9]="Childs",t[t.Close=10]="Close",t[t.WaitEnd=11]="WaitEnd",t[t.WaitEndRet=12]="WaitEndRet",t[t.Pcdata=13]="Pcdata",t[t.Header=14]="Header",t[t.Comment=15]="Comment",t[t.Doctype=16]="Doctype",t[t.Cdata=17]="Cdata",t[t.Escape=18]="Escape"}(Ht||(Ht={}));var Xt,Yt=function(){function t(){}return t.parse=function(e,i,n){for(var r,a=e.charCodeAt(i),o=Ht.Begin,s=Ht.Begin,h=0,c="",l=Ht.Begin,u=null,p=null,d=0,f=0;i<e.length;){switch(a=e.charCodeAt(i),o){case Ht.IgnoreSpaces:switch(a){case t.CharCodeLF:case t.CharCodeCR:case t.CharCodeTab:case t.CharCodeSpace:break;default:o=s;continue}break;case Ht.Begin:switch(a){case t.CharCodeLowerThan:o=Ht.IgnoreSpaces,s=Ht.BeginNode;break;default:h=i,o=Ht.Pcdata;continue}break;case Ht.Pcdata:if(a===t.CharCodeLowerThan)c+=e.substr(h,i-h),(y=new Wt).nodeType=jt.Text,y.value=c,c="",n.addChild(y),o=Ht.IgnoreSpaces,s=Ht.BeginNode;else a===t.CharCodeAmp&&(c+=e.substr(h,i-h),o=Ht.Escape,l=Ht.Pcdata,h=i+1);break;case Ht.Cdata:var y;if(a===t.CharCodeBrackedClose&&e.charCodeAt(i+1)===t.CharCodeBrackedClose&&e.charCodeAt(i+2)===t.CharCodeGreaterThan)(y=new Wt).nodeType=jt.CDATA,y.value=e.substr(h,i-h),n.addChild(y),i+=2,o=Ht.Begin;break;case Ht.BeginNode:switch(a){case t.CharCodeExclamation:if(e.charCodeAt(i+1)===t.CharCodeBrackedOpen){if(i+=2,"CDATA["!==e.substr(i,6).toUpperCase())throw new zt("Expected <![CDATA[",e,i);i+=5,o=Ht.Cdata,h=i+1}else if(e.charCodeAt(i+1)===t.CharCodeUpperD||e.charCodeAt(i+1)===t.CharCodeLowerD){if("OCTYPE"!==e.substr(i+2,6).toUpperCase())throw new zt("Expected <!DOCTYPE",e,i);i+=8,o=Ht.Doctype,h=i+1}else{if(e.charCodeAt(i+1)!==t.CharCodeMinus||e.charCodeAt(i+2)!==t.CharCodeMinus)throw new zt("Expected \x3c!--",e,i);i+=2,o=Ht.Comment,h=i+1}break;case t.CharCodeQuestion:o=Ht.Header,h=i;break;case t.CharCodeSlash:if(!n)throw new zt("Expected node name",e,i);h=i+1,o=Ht.IgnoreSpaces,s=Ht.Close;break;default:o=Ht.TagName,h=i;continue}break;case Ht.TagName:if(!t.isValidChar(a)){if(i===h)throw new zt("Expected node name",e,i);(u=new Wt).nodeType=jt.Element,u.localName=e.substr(h,i-h),n.addChild(u),o=Ht.IgnoreSpaces,s=Ht.Body;continue}break;case Ht.Body:switch(a){case t.CharCodeSlash:o=Ht.WaitEnd;break;case t.CharCodeGreaterThan:o=Ht.Childs;break;default:o=Ht.AttribName,h=i;continue}break;case Ht.AttribName:if(!t.isValidChar(a)){if(h===i)throw new zt("Expected attribute name",e,i);if(p=e.substr(h,i-h),u.attributes.has(p))throw new zt("Duplicate attribute ["+p+"]",e,i);o=Ht.IgnoreSpaces,s=Ht.Equals;continue}break;case Ht.Equals:switch(a){case t.CharCodeEquals:o=Ht.IgnoreSpaces,s=Ht.AttvalBegin;break;default:throw new zt("Expected =",e,i)}break;case Ht.AttvalBegin:switch(a){case t.CharCodeDoubleQuote:case t.CharCodeSingleQuote:c="",o=Ht.AttribVal,h=i+1,f=a}break;case Ht.AttribVal:switch(a){case t.CharCodeAmp:c+=e.substr(h,i-h),o=Ht.Escape,l=Ht.AttribVal,h=i+1;break;default:if(a===f){var g=c+=e.substr(h,i-h);c="",u.attributes.set(p,g),o=Ht.IgnoreSpaces,s=Ht.Body}}break;case Ht.Childs:h=i=t.parse(e,i,u),o=Ht.Begin;break;case Ht.WaitEnd:switch(a){case t.CharCodeGreaterThan:o=Ht.Begin;break;default:throw new zt("Expected >",e,i)}break;case Ht.WaitEndRet:switch(a){case t.CharCodeGreaterThan:return i;default:throw new zt("Expected >",e,i)}case Ht.Close:if(!t.isValidChar(a)){if(h===i)throw new zt("Expected node name",e,i);if(e.substr(h,i-h)!==n.localName)throw new zt("Expected </"+n.localName+">",e,i);o=Ht.IgnoreSpaces,s=Ht.WaitEndRet;continue}break;case Ht.Comment:a===t.CharCodeMinus&&e.charCodeAt(i+1)===t.CharCodeMinus&&e.charCodeAt(i+2)===t.CharCodeGreaterThan&&(i+=2,o=Ht.Begin);break;case Ht.Doctype:if(a===t.CharCodeBrackedOpen)d++;else if(a===t.CharCodeBrackedClose)d--;else if(a===t.CharCodeGreaterThan&&0===d){(v=new Wt).nodeType=jt.DocumentType,v.value=e.substr(h,i-h),n.addChild(v),o=Ht.Begin}break;case Ht.Header:a===t.CharCodeQuestion&&e.charCodeAt(i+1)===t.CharCodeGreaterThan&&(i++,o=Ht.Begin);break;case Ht.Escape:if(a===t.CharCodeSemi){var m=e.substr(h,i-h);if(m.charCodeAt(0)===t.CharCodeSharp){var b=m.charCodeAt(1)===t.CharCodeLowerX?parseInt("0"+m.substr(1,m.length-1)):parseInt(m.substr(1,m.length-1));c+=String.fromCharCode(b)}else t.Escapes.has(m)?c+=t.Escapes.get(m):c+=null===(r="&"+m+";")||void 0===r?void 0:r.toString();h=i+1,o=l}else t.isValidChar(a)||a===t.CharCodeSharp||(c+="&",c+=e.substr(h,i-h),h=--i+1,o=l)}i++}if(o===Ht.Begin&&(h=i,o=Ht.Pcdata),o===Ht.Pcdata){var v;if(i!==h)c+=e.substr(h,i-h),(v=new Wt).nodeType=jt.Text,v.value=c,n.addChild(v);return i}if(o===Ht.Escape&&l===Ht.Pcdata)return c+="&",c+=e.substr(h,i-h),(v=new Wt).nodeType=jt.Text,v.value=c,n.addChild(v),i;throw new zt("Unexpected end",e,i)},t.isValidChar=function(e){return e>=t.CharCodeLowerA&&e<=t.CharCodeLowerZ||e>=t.CharCodeUpperA&&e<=t.CharCodeUpperZ||e>=t.CharCode0&&e<=t.CharCode9||e===t.CharCodeColon||e===t.CharCodeDot||e===t.CharCodeUnderscore||e===t.CharCodeMinus},t.CharCodeLF=10,t.CharCodeTab=9,t.CharCodeCR=13,t.CharCodeSpace=32,t.CharCodeLowerThan=60,t.CharCodeAmp=38,t.CharCodeBrackedClose=93,t.CharCodeBrackedOpen=91,t.CharCodeGreaterThan=62,t.CharCodeExclamation=33,t.CharCodeUpperD=68,t.CharCodeLowerD=100,t.CharCodeMinus=45,t.CharCodeQuestion=63,t.CharCodeSlash=47,t.CharCodeEquals=61,t.CharCodeDoubleQuote=34,t.CharCodeSingleQuote=39,t.CharCodeSharp=35,t.CharCodeLowerX=120,t.CharCodeLowerA=97,t.CharCodeLowerZ=122,t.CharCodeUpperA=65,t.CharCodeUpperZ=90,t.CharCode0=48,t.CharCode9=57,t.CharCodeColon=58,t.CharCodeDot=46,t.CharCodeUnderscore=95,t.CharCodeSemi=59,t.Escapes=new Map([["lt","<"],["gt",">"],["amp","&"],["quot",'"'],["apos","'"]]),t}(),Jt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),qt=function(t){function e(e){var i=t.call(this)||this;i.documentElement=null,i.nodeType=jt.Document,Yt.parse(e,0,i);for(var n=0,r=i.childNodes;n<r.length;n++){var a=r[n];if(a.nodeType===jt.Element){i.documentElement=a;break}}return i}return Jt(e,t),e}(Wt);!function(t){t[t.Up=0]="Up",t[t.Down=1]="Down"}(Xt||(Xt={}));var Qt,Kt=function(){this.dots=0,this.tupletDenominator=-1,this.tupletNumerator=-1,this.value=A.Quarter},Zt=function(){function t(){this._hasAnacrusis=!1,this._skipApplyLyrics=!1}return t.prototype.parseXml=function(t,e){var i,n=this;this._masterTrackAutomations=new Map,this._tracksMapping=[],this._tracksById=new Map,this._masterBars=[],this._barsOfMasterBar=[],this._voicesOfBar=new Map,this._barsById=new Map,this._voiceById=new Map,this._beatsOfVoice=new Map,this._beatById=new Map,this._rhythmOfBeat=new Map,this._rhythmById=new Map,this._notesOfBeat=new Map,this._noteById=new Map,this._tappedNotes=new Map,this._lyricsByTrack=new Map,this._skipApplyLyrics=!1;try{i=new qt(t)}catch(t){throw new N("Could not parse XML",t)}this.parseDom(i),this.buildModel(),this.score.finish(e),!this._skipApplyLyrics&&this._lyricsByTrack.size>0&&this._lyricsByTrack.forEach((function(t,e){n._tracksById.get(e).applyLyrics(t)}))},t.prototype.parseDom=function(t){var e=t.documentElement;if(e){if("GPIF"!==e.localName)throw new N("Root node of XML was not GPIF");this.score=new bt;for(var i=0,n=e.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"Score":this.parseScoreNode(r);break;case"MasterTrack":this.parseMasterTrackNode(r);break;case"Tracks":this.parseTracksNode(r);break;case"MasterBars":this.parseMasterBarsNode(r);break;case"Bars":this.parseBars(r);break;case"Voices":this.parseVoices(r);break;case"Beats":this.parseBeats(r);break;case"Notes":this.parseNotes(r);break;case"Rhythms":this.parseRhythms(r)}}}},t.prototype.parseScoreNode=function(t){for(var e=0,i=t.childNodes;e<i.length;e++){var n=i[e];if(n.nodeType===jt.Element)switch(n.localName){case"Title":this.score.title=n.firstChild.innerText;break;case"SubTitle":this.score.subTitle=n.firstChild.innerText;break;case"Artist":this.score.artist=n.firstChild.innerText;break;case"Album":this.score.album=n.firstChild.innerText;break;case"Words":this.score.words=n.firstChild.innerText;break;case"Music":this.score.music=n.firstChild.innerText;break;case"WordsAndMusic":if(n.firstChild&&""!==n.firstChild.innerText){var r=n.firstChild.innerText;r&&!this.score.words&&(this.score.words=r),r&&!this.score.music&&(this.score.music=r)}break;case"Copyright":this.score.copyright=n.firstChild.innerText;break;case"Tabber":this.score.tab=n.firstChild.innerText;break;case"Instructions":this.score.instructions=n.firstChild.innerText;break;case"Notices":this.score.notices=n.firstChild.innerText}}},t.prototype.parseMasterTrackNode=function(t){for(var e=0,i=t.childNodes;e<i.length;e++){var n=i[e];if(n.nodeType===jt.Element)switch(n.localName){case"Automations":this.parseAutomations(n,this._masterTrackAutomations);break;case"Tracks":this._tracksMapping=n.innerText.split(" ");break;case"Anacrusis":this._hasAnacrusis=!0}}},t.prototype.parseAutomations=function(t,e){for(var i=0,n=t.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"Automation":this.parseAutomation(r,e)}}},t.prototype.parseAutomation=function(t,e){for(var i=null,n=!1,r=null,a=0,o=0,s=0,h=null,c=0,l=t.childNodes;c<l.length;c++){var u=l[c];if(u.nodeType===jt.Element)switch(u.localName){case"Type":i=u.innerText;break;case"Linear":n="true"===u.innerText.toLowerCase();break;case"Bar":r=u.innerText;break;case"Position":a=parseFloat(u.innerText);break;case"Value":var p=u.innerText.split(" ");1===p.length?(o=parseFloat(p[0]),s=1):(o=parseFloat(p[0]),s=parseInt(p[1]));break;case"Text":h=u.innerText}}if(i){var d=null;switch(i){case"Tempo":d=F.buildTempoAutomation(n,a,o,s)}d&&(h&&(d.text=h),r&&(e.has(r)||e.set(r,[]),e.get(r).push(d)))}},t.prototype.parseTracksNode=function(t){for(var e=0,i=t.childNodes;e<i.length;e++){var n=i[e];if(n.nodeType===jt.Element)switch(n.localName){case"Track":this.parseTrack(n)}}},t.prototype.parseTrack=function(t){this._articulationByName=new Map;var e=new St;e.ensureStaveCount(1),e.staves[0].showStandardNotation=!0;for(var i=t.getAttribute("id"),n=0,r=t.childNodes;n<r.length;n++){var a=r[n];if(a.nodeType===jt.Element)switch(a.localName){case"Name":e.name=a.innerText;break;case"Color":var o=a.innerText.split(" ");if(o.length>=3){var s=parseInt(o[0]),h=parseInt(o[1]),c=parseInt(o[2]);e.color=new m(s,h,c,255)}break;case"Instrument":var l=a.getAttribute("ref");(l.endsWith("-gs")||l.endsWith("GrandStaff"))&&(e.ensureStaveCount(2),e.staves[1].showStandardNotation=!0);break;case"InstrumentSet":this.parseInstrumentSet(e,a);break;case"NotationPatch":this.parseNotationPatch(e,a);break;case"ShortName":e.shortName=a.innerText;break;case"Lyrics":this.parseLyrics(i,a);break;case"Properties":this.parseTrackProperties(e,a);break;case"GeneralMidi":case"MidiConnection":case"MIDISettings":this.parseGeneralMidi(e,a);break;case"Sounds":this.parseSounds(e,a);break;case"PlaybackState":var u=a.innerText;e.playbackInfo.isSolo="Solo"===u,e.playbackInfo.isMute="Mute"===u;break;case"PartSounding":this.parsePartSounding(e,a);break;case"Staves":this.parseStaves(e,a);break;case"Transpose":this.parseTranspose(e,a)}}this._tracksById.set(i,e)},t.prototype.parseNotationPatch=function(t,e){for(var i=0,n=e.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"LineCount":for(var a=parseInt(r.innerText),o=0,s=t.staves;o<s.length;o++){s[o].standardNotationLineCount=a}break;case"Elements":this.parseElements(t,r)}}},t.prototype.parseInstrumentSet=function(t,e){for(var i=0,n=e.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"Type":switch(r.innerText){case"drumKit":for(var a=0,o=t.staves;a<o.length;a++){o[a].isPercussion=!0}}if("drumKit"===r.innerText)for(var s=0,h=t.staves;s<h.length;s++){h[s].isPercussion=!0}break;case"Elements":this.parseElements(t,r);break;case"LineCount":for(var c=parseInt(r.innerText),l=0,u=t.staves;l<u.length;l++){u[l].standardNotationLineCount=c}}}},t.prototype.parseElements=function(t,e){for(var i=0,n=e.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"Element":this.parseElement(t,r)}}},t.prototype.parseElement=function(t,e){for(var i=0,n=e.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"Articulations":this.parseArticulations(t,r)}}},t.prototype.parseArticulations=function(t,e){for(var i=0,n=e.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"Articulation":this.parseArticulation(t,r)}}},t.prototype.parseArticulation=function(t,e){var i=new rt;i.outputMidiNumber=-1;for(var n="",r=0,a=e.childNodes;r<a.length;r++){var o=a[r];if(o.nodeType===jt.Element){var s=o.innerText;switch(o.localName){case"Name":n=o.innerText;break;case"OutputMidiNumber":s.length>0&&(i.outputMidiNumber=parseInt(s));break;case"TechniqueSymbol":i.techniqueSymbol=this.parseTechniqueSymbol(s);break;case"TechniquePlacement":switch(s){case"outside":i.techniqueSymbolPlacement=Z.Bottom;break;case"inside":i.techniqueSymbolPlacement=Z.Middle;break;case"above":i.techniqueSymbolPlacement=Z.Bottom;break;case"below":i.techniqueSymbolPlacement=Z.Top}break;case"Noteheads":var h=s.split(" ");h.length>=1&&(i.noteHeadDefault=this.parseNoteHead(h[0])),h.length>=2&&(i.noteHeadHalf=this.parseNoteHead(h[1])),h.length>=3&&(i.noteHeadWhole=this.parseNoteHead(h[2])),i.noteHeadHalf==Q.None&&(i.noteHeadHalf=i.noteHeadDefault),i.noteHeadWhole==Q.None&&(i.noteHeadWhole=i.noteHeadDefault),h.length;break;case"StaffLine":s.length>0&&(i.staffLine=parseInt(s))}}}-1!==i.outputMidiNumber?(t.percussionArticulations.push(i),n.length>0&&this._articulationByName.set(n,i)):n.length>0&&this._articulationByName.has(n)&&(this._articulationByName.get(n).staffLine=i.staffLine)},t.prototype.parseTechniqueSymbol=function(t){switch(t){case"pictEdgeOfCymbal":return Q.PictEdgeOfCymbal;case"articStaccatoAbove":return Q.ArticStaccatoAbove;case"noteheadParenthesis":return Q.NoteheadParenthesis;case"stringsUpBow":return Q.StringsUpBow;case"stringsDownBow":return Q.StringsDownBow;case"guitarGolpe":return Q.GuitarGolpe;default:return Q.None}},t.prototype.parseNoteHead=function(t){switch(t){case"noteheadDoubleWholeSquare":return Q.NoteheadDoubleWholeSquare;case"noteheadDoubleWhole":return Q.NoteheadDoubleWhole;case"noteheadWhole":return Q.NoteheadWhole;case"noteheadHalf":return Q.NoteheadHalf;case"noteheadBlack":return Q.NoteheadBlack;case"noteheadNull":return Q.NoteheadNull;case"noteheadXOrnate":return Q.NoteheadXOrnate;case"noteheadTriangleUpWhole":return Q.NoteheadTriangleUpWhole;case"noteheadTriangleUpHalf":return Q.NoteheadTriangleUpHalf;case"noteheadTriangleUpBlack":return Q.NoteheadTriangleUpBlack;case"noteheadDiamondBlackWide":return Q.NoteheadDiamondBlackWide;case"noteheadDiamondWhite":return Q.NoteheadDiamondWhite;case"noteheadDiamondWhiteWide":return Q.NoteheadDiamondWhiteWide;case"noteheadCircleX":return Q.NoteheadCircleX;case"noteheadXWhole":return Q.NoteheadXWhole;case"noteheadXHalf":return Q.NoteheadXHalf;case"noteheadXBlack":return Q.NoteheadXBlack;case"noteheadParenthesis":return Q.NoteheadParenthesis;case"noteheadSlashedBlack2":return Q.NoteheadSlashedBlack2;case"noteheadCircleSlash":return Q.NoteheadCircleSlash;case"noteheadHeavyX":return Q.NoteheadHeavyX;case"noteheadHeavyXHat":return Q.NoteheadHeavyXHat;default:return Q.None}},t.prototype.parseStaves=function(t,e){for(var i=0,n=0,r=e.childNodes;n<r.length;n++){var a=r[n];if(a.nodeType===jt.Element)switch(a.localName){case"Staff":t.ensureStaveCount(i+1);var o=t.staves[i];this.parseStaff(o,a),i++}}},t.prototype.parseStaff=function(t,e){for(var i=0,n=e.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"Properties":this.parseStaffProperties(t,r)}}},t.prototype.parseStaffProperties=function(t,e){for(var i=0,n=e.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"Property":this.parseStaffProperty(t,r)}}},t.prototype.parseStaffProperty=function(t,e){switch(e.getAttribute("name")){case"Tuning":for(var i=e.findChildElement("Pitches").innerText.split(" "),n=new Array(i.length),r=0;r<n.length;r++)n[n.length-1-r]=parseInt(i[r]);t.tuning=n,t.isPercussion||(t.showTablature=!0);break;case"DiagramCollection":case"ChordCollection":this.parseDiagramCollection_Staff_XmlNode(t,e);break;case"CapoFret":var a=parseInt(e.findChildElement("Fret").innerText);t.capo=a}},t.prototype.parseLyrics=function(t,e){for(var i=[],n=0,r=e.childNodes;n<r.length;n++){var a=r[n];if(a.nodeType===jt.Element)switch(a.localName){case"Line":i.push(this.parseLyricsLine(a))}}this._lyricsByTrack.set(t,i)},t.prototype.parseLyricsLine=function(t){for(var e=new ft,i=0,n=t.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"Offset":e.startBar=parseInt(r.innerText);break;case"Text":e.text=r.innerText}}return e},t.prototype.parseDiagramCollection_Track_XmlNode=function(t,e){for(var i=0,n=e.findChildElement("Items").childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"Item":this.parseDiagramItem_Track_XmlNode(t,r)}}},t.prototype.parseDiagramCollection_Staff_XmlNode=function(t,e){for(var i=0,n=e.findChildElement("Items").childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"Item":this.parseDiagramItem_Staff_XmlNode(t,r)}}},t.prototype.parseDiagramItem_Track_XmlNode=function(t,e){for(var i=new lt,n=e.getAttribute("id"),r=0,a=t.staves;r<a.length;r++){a[r].addChord(n,i)}this.parseDiagramItem_Chord_XmlNode(i,e)},t.prototype.parseDiagramItem_Staff_XmlNode=function(t,e){var i=new lt,n=e.getAttribute("id");t.addChord(n,i),this.parseDiagramItem_Chord_XmlNode(i,e)},t.prototype.parseDiagramItem_Chord_XmlNode=function(t,e){t.name=e.getAttribute("name");var i=e.findChildElement("Diagram"),n=parseInt(i.getAttribute("stringCount")),a=parseInt(i.getAttribute("baseFret"));t.firstFret=a+1;for(var o=0;o<n;o++)t.strings.push(-1);for(var s=0,h=i.childNodes;s<h.length;s++){var c=h[s];if(c.nodeType===jt.Element)switch(c.localName){case"Fret":var l=parseInt(c.getAttribute("string"));t.strings[n-l-1]=a+parseInt(c.getAttribute("fret"));break;case"Fingering":for(var u=new Map,p=0,d=c.childNodes;p<d.length;p++){var f=d[p];if(f.nodeType===jt.Element)switch(f.localName){case"Position":var y=r.Unknown,g=a+parseInt(f.getAttribute("fret"));switch(f.getAttribute("finger")){case"Index":y=r.IndexFinger;break;case"Middle":y=r.MiddleFinger;break;case"Rank":y=r.AnnularFinger;break;case"Pinky":y=r.LittleFinger;break;case"Thumb":y=r.Thumb}y!==r.Unknown&&(u.has(y)?t.barreFrets.push(g):u.set(y,!0))}}break;case"Property":switch(c.getAttribute("name")){case"ShowName":t.showName="true"===c.getAttribute("value");break;case"ShowDiagram":t.showDiagram="true"===c.getAttribute("value");break;case"ShowFingering":t.showFingering="true"===c.getAttribute("value")}}}},t.prototype.parseTrackProperties=function(t,e){for(var i=0,n=e.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"Property":this.parseTrackProperty(t,r)}}},t.prototype.parseTrackProperty=function(t,e){switch(e.getAttribute("name")){case"Tuning":for(var i=e.findChildElement("Pitches").innerText.split(" "),n=new Array(i.length),r=0;r<n.length;r++)n[n.length-1-r]=parseInt(i[r]);for(var a=0,o=t.staves;a<o.length;a++){(l=o[a]).tuning=n,l.showStandardNotation=!0,l.showTablature=!0}break;case"DiagramCollection":case"ChordCollection":this.parseDiagramCollection_Track_XmlNode(t,e);break;case"CapoFret":for(var s=parseInt(e.findChildElement("Fret").innerText),h=0,c=t.staves;h<c.length;h++){var l;(l=c[h]).capo=s}}},t.prototype.parseGeneralMidi=function(t,e){for(var i=0,n=e.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"Program":t.playbackInfo.program=parseInt(r.innerText);break;case"Port":t.playbackInfo.port=parseInt(r.innerText);break;case"PrimaryChannel":t.playbackInfo.primaryChannel=parseInt(r.innerText);break;case"SecondaryChannel":t.playbackInfo.secondaryChannel=parseInt(r.innerText)}}if("Percussion"===e.getAttribute("table"))for(var a=0,o=t.staves;a<o.length;a++){o[a].isPercussion=!0}},t.prototype.parseSounds=function(t,e){for(var i=0,n=e.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"Sound":this.parseSound(t,r)}}},t.prototype.parseSound=function(t,e){for(var i=0,n=e.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"MIDI":this.parseSoundMidi(t,r)}}},t.prototype.parseSoundMidi=function(t,e){for(var i=0,n=e.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"Program":t.playbackInfo.program=parseInt(r.innerText)}}},t.prototype.parsePartSounding=function(t,e){for(var i=0,n=e.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"TranspositionPitch":for(var a=0,o=t.staves;a<o.length;a++){o[a].displayTranspositionPitch=parseInt(r.innerText)}}}},t.prototype.parseTranspose=function(t,e){for(var i=0,n=0,r=0,a=e.childNodes;r<a.length;r++){var o=a[r];if(o.nodeType===jt.Element)switch(o.localName){case"Chromatic":n=parseInt(o.innerText);break;case"Octave":i=parseInt(o.innerText)}}for(var s=0,h=t.staves;s<h.length;s++){h[s].displayTranspositionPitch=12*i+n}},t.prototype.parseMasterBarsNode=function(t){for(var e=0,i=t.childNodes;e<i.length;e++){var n=i[e];if(n.nodeType===jt.Element)switch(n.localName){case"MasterBar":this.parseMasterBar(n)}}},t.prototype.parseMasterBar=function(t){var e=new yt;0===this._masterBars.length&&this._hasAnacrusis&&(e.isAnacrusis=!0);for(var i=0,n=t.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"Time":var a=r.innerText.split("/");e.timeSignatureNumerator=parseInt(a[0]),e.timeSignatureDenominator=parseInt(a[1]);break;case"DoubleBar":e.isDoubleBar=!0;break;case"Section":e.section=new vt,e.section.marker=r.findChildElement("Letter").innerText,e.section.text=r.findChildElement("Text").innerText;break;case"Repeat":"true"===r.getAttribute("start").toLowerCase()&&(e.isRepeatStart=!0),"true"===r.getAttribute("end").toLowerCase()&&r.getAttribute("count")&&(e.repeatCount=parseInt(r.getAttribute("count")));break;case"AlternateEndings":for(var o=r.innerText.split(" "),s=0,h=0;h<o.length;h++)s|=1<<-1+parseInt(o[h]);e.alternateEndings=s;break;case"Bars":this._barsOfMasterBar.push(r.innerText.split(" "));break;case"TripletFeel":switch(r.innerText){case"NoTripletFeel":e.tripletFeel=dt.NoTripletFeel;break;case"Triplet8th":e.tripletFeel=dt.Triplet8th;break;case"Triplet16th":e.tripletFeel=dt.Triplet16th;break;case"Dotted8th":e.tripletFeel=dt.Dotted8th;break;case"Dotted16th":e.tripletFeel=dt.Dotted16th;break;case"Scottish8th":e.tripletFeel=dt.Scottish8th;break;case"Scottish16th":e.tripletFeel=dt.Scottish16th}break;case"Key":e.keySignature=parseInt(r.findChildElement("AccidentalCount").innerText);var c=r.findChildElement("Mode");if(c)switch(c.innerText.toLowerCase()){case"major":e.keySignatureType=pt.Major;break;case"minor":e.keySignatureType=pt.Minor}break;case"Fermatas":this.parseFermatas(e,r)}}this._masterBars.push(e)},t.prototype.parseFermatas=function(t,e){for(var i=0,n=e.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"Fermata":this.parseFermata(t,r)}}},t.prototype.parseFermata=function(t,e){for(var i=0,n=new Vt,r=0,a=e.childNodes;r<a.length;r++){var o=a[r];if(o.nodeType===jt.Element)switch(o.localName){case"Type":switch(o.innerText){case"Short":n.type=Rt.Short;break;case"Medium":n.type=Rt.Medium;break;case"Long":n.type=Rt.Long}break;case"Length":n.length=parseFloat(o.innerText);break;case"Offset":var s=o.innerText.split("/");if(2===s.length)i=parseInt(s[0])/parseInt(s[1])*z.QuarterTime|0}}t.addFermata(i,n)},t.prototype.parseBars=function(t){for(var e=0,i=t.childNodes;e<i.length;e++){var n=i[e];if(n.nodeType===jt.Element)switch(n.localName){case"Bar":this.parseBar(n)}}},t.prototype.parseBar=function(t){for(var e=new U,i=t.getAttribute("id"),n=0,r=t.childNodes;n<r.length;n++){var a=r[n];if(a.nodeType===jt.Element)switch(a.localName){case"Voices":this._voicesOfBar.set(i,a.innerText.split(" "));break;case"Clef":switch(a.innerText){case"Neutral":e.clef=O.Neutral;break;case"G2":e.clef=O.G2;break;case"F4":e.clef=O.F4;break;case"C4":e.clef=O.C4;break;case"C3":e.clef=O.C3}break;case"Ottavia":switch(a.innerText){case"8va":e.clefOttava=x._8va;break;case"15ma":e.clefOttava=x._15ma;break;case"8vb":e.clefOttava=x._8vb;break;case"15mb":e.clefOttava=x._15mb}break;case"SimileMark":switch(a.innerText){case"Simple":e.simileMark=C.Simple;break;case"FirstOfDouble":e.simileMark=C.FirstOfDouble;break;case"SecondOfDouble":e.simileMark=C.SecondOfDouble}}}this._barsById.set(i,e)},t.prototype.parseVoices=function(t){for(var e=0,i=t.childNodes;e<i.length;e++){var n=i[e];if(n.nodeType===jt.Element)switch(n.localName){case"Voice":this.parseVoice(n)}}},t.prototype.parseVoice=function(t){for(var e=new kt,i=t.getAttribute("id"),n=0,r=t.childNodes;n<r.length;n++){var a=r[n];if(a.nodeType===jt.Element)switch(a.localName){case"Beats":this._beatsOfVoice.set(i,a.innerText.split(" "))}}this._voiceById.set(i,e)},t.prototype.parseBeats=function(t){for(var e=0,i=t.childNodes;e<i.length;e++){var n=i[e];if(n.nodeType===jt.Element)switch(n.localName){case"Beat":this.parseBeat(n)}}},t.prototype.parseBeat=function(t){for(var e=new ct,i=t.getAttribute("id"),n=0,r=t.childNodes;n<r.length;n++){var a=r[n];if(a.nodeType===jt.Element)switch(a.localName){case"Notes":this._notesOfBeat.set(i,a.innerText.split(" "));break;case"Rhythm":this._rhythmOfBeat.set(i,a.getAttribute("ref"));break;case"Fadding":"FadeIn"===a.innerText&&(e.fadeIn=!0);break;case"Tremolo":switch(a.innerText){case"1/2":e.tremoloSpeed=A.Eighth;break;case"1/4":e.tremoloSpeed=A.Sixteenth;break;case"1/8":e.tremoloSpeed=A.ThirtySecond}break;case"Chord":e.chordId=a.innerText;break;case"Hairpin":switch(a.innerText){case"Crescendo":e.crescendo=D.Crescendo;break;case"Decrescendo":e.crescendo=D.Decrescendo}break;case"Arpeggio":"Up"===a.innerText?e.brushType=M.ArpeggioUp:e.brushType=M.ArpeggioDown;break;case"Properties":this.parseBeatProperties(a,e);break;case"XProperties":this.parseBeatXProperties(a,e);break;case"FreeText":e.text=a.innerText;break;case"TransposedPitchStemOrientation":switch(a.innerText){case"Upward":e.preferredBeamDirection=Xt.Up;break;case"Downward":e.preferredBeamDirection=Xt.Down}break;case"Dynamic":switch(a.innerText){case"PPP":e.dynamics=I.PPP;break;case"PP":e.dynamics=I.PP;break;case"P":e.dynamics=I.P;break;case"MP":e.dynamics=I.MP;break;case"MF":e.dynamics=I.MF;break;case"F":e.dynamics=I.F;break;case"FF":e.dynamics=I.FF;break;case"FFF":e.dynamics=I.FFF}break;case"GraceNotes":switch(a.innerText){case"OnBeat":e.graceType=R.OnBeat;break;case"BeforeBeat":e.graceType=R.BeforeBeat}break;case"Legato":"true"===a.getAttribute("origin")&&(e.isLegatoOrigin=!0);break;case"Whammy":var o=new X(0,0);o.value=this.toBendValue(parseFloat(a.getAttribute("originValue"))),o.offset=this.toBendOffset(parseFloat(a.getAttribute("originOffset"))),e.addWhammyBarPoint(o);var s=new X(0,0);s.value=this.toBendValue(parseFloat(a.getAttribute("middleValue"))),s.offset=this.toBendOffset(parseFloat(a.getAttribute("middleOffset1"))),e.addWhammyBarPoint(s);var h=new X(0,0);h.value=this.toBendValue(parseFloat(a.getAttribute("middleValue"))),h.offset=this.toBendOffset(parseFloat(a.getAttribute("middleOffset2"))),e.addWhammyBarPoint(h);var c=new X(0,0);c.value=this.toBendValue(parseFloat(a.getAttribute("destinationValue"))),c.offset=this.toBendOffset(parseFloat(a.getAttribute("destinationOffset"))),e.addWhammyBarPoint(c);break;case"Ottavia":switch(a.innerText){case"8va":e.ottava=x._8va;break;case"8vb":e.ottava=x._8vb;break;case"15ma":e.ottava=x._15ma;break;case"15mb":e.ottava=x._15mb}break;case"Lyrics":e.lyrics=this.parseBeatLyrics(a),this._skipApplyLyrics=!0}}this._beatById.set(i,e)},t.prototype.parseBeatLyrics=function(t){for(var e=[],i=0,n=t.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"Line":e.push(r.innerText)}}return e},t.prototype.parseBeatXProperties=function(t,e){for(var i=0,n=t.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"XProperty":var a=0;switch(r.getAttribute("id")){case"1124204545":a=parseInt(r.findChildElement("Int").innerText),e.invertBeamDirection=1===a;break;case"687935489":a=parseInt(r.findChildElement("Int").innerText),e.brushDuration=a}}}},t.prototype.parseBeatProperties=function(t,e){for(var i=!1,n=null,r=null,a=null,o=null,s=null,h=0,c=t.childNodes;h<c.length;h++){var l=c[h];if(l.nodeType===jt.Element)switch(l.localName){case"Property":switch(l.getAttribute("name")){case"Brush":"Up"===l.findChildElement("Direction").innerText?e.brushType=M.BrushUp:e.brushType=M.BrushDown;break;case"PickStroke":"Up"===l.findChildElement("Direction").innerText?e.pickStroke=q.Up:e.pickStroke=q.Down;break;case"Slapped":l.findChildElement("Enable")&&(e.slap=!0);break;case"Popped":l.findChildElement("Enable")&&(e.pop=!0);break;case"VibratoWTremBar":switch(l.findChildElement("Strength").innerText){case"Wide":e.vibrato=W.Wide;break;case"Slight":e.vibrato=W.Slight}break;case"WhammyBar":i=!0;break;case"WhammyBarExtend":break;case"WhammyBarOriginValue":n||(n=new X(0,0)),n.value=this.toBendValue(parseFloat(l.findChildElement("Float").innerText));break;case"WhammyBarOriginOffset":n||(n=new X(0,0)),n.offset=this.toBendOffset(parseFloat(l.findChildElement("Float").innerText));break;case"WhammyBarMiddleValue":r=this.toBendValue(parseFloat(l.findChildElement("Float").innerText));break;case"WhammyBarMiddleOffset1":a=this.toBendOffset(parseFloat(l.findChildElement("Float").innerText));break;case"WhammyBarMiddleOffset2":o=this.toBendOffset(parseFloat(l.findChildElement("Float").innerText));break;case"WhammyBarDestinationValue":s||(s=new X(X.MaxPosition,0)),s.value=this.toBendValue(parseFloat(l.findChildElement("Float").innerText));break;case"WhammyBarDestinationOffset":s||(s=new X(0,0)),s.offset=this.toBendOffset(parseFloat(l.findChildElement("Float").innerText))}}}i&&(n||(n=new X(0,0)),s||(s=new X(X.MaxPosition,0)),e.addWhammyBarPoint(n),a&&r&&e.addWhammyBarPoint(new X(a,r)),o&&r&&e.addWhammyBarPoint(new X(o,r)),a||o||!r||e.addWhammyBarPoint(new X(X.MaxPosition/2|0,r)),e.addWhammyBarPoint(s))},t.prototype.parseNotes=function(t){for(var e=0,i=t.childNodes;e<i.length;e++){var n=i[e];if(n.nodeType===jt.Element)switch(n.localName){case"Note":this.parseNote(n)}}},t.prototype.parseNote=function(t){for(var e=new ot,i=t.getAttribute("id"),n=0,a=t.childNodes;n<a.length;n++){var o=a[n];if(o.nodeType===jt.Element)switch(o.localName){case"Properties":this.parseNoteProperties(o,e,i);break;case"AntiAccent":"normal"===o.innerText.toLowerCase()&&(e.isGhost=!0);break;case"LetRing":e.isLetRing=!0;break;case"Trill":e.trillValue=parseInt(o.innerText),e.trillSpeed=A.Sixteenth;break;case"Accent":var s=parseInt(o.innerText);0!=(1&s)&&(e.isStaccato=!0),0!=(4&s)&&(e.accentuated=S.Heavy),0!=(8&s)&&(e.accentuated=S.Normal);break;case"Tie":"true"===o.getAttribute("destination").toLowerCase()&&(e.isTieDestination=!0);break;case"Vibrato":switch(o.innerText){case"Slight":e.vibrato=W.Slight;break;case"Wide":e.vibrato=W.Wide}break;case"LeftFingering":switch(e.isFingering=!0,o.innerText){case"P":e.leftHandFinger=r.Thumb;break;case"I":e.leftHandFinger=r.IndexFinger;break;case"M":e.leftHandFinger=r.MiddleFinger;break;case"A":e.leftHandFinger=r.AnnularFinger;break;case"C":e.leftHandFinger=r.LittleFinger}break;case"RightFingering":switch(e.isFingering=!0,o.innerText){case"P":e.rightHandFinger=r.Thumb;break;case"I":e.rightHandFinger=r.IndexFinger;break;case"M":e.rightHandFinger=r.MiddleFinger;break;case"A":e.rightHandFinger=r.AnnularFinger;break;case"C":e.rightHandFinger=r.LittleFinger}break;case"InstrumentArticulation":e.percussionArticulation=parseInt(o.innerText)}}this._noteById.set(i,e)},t.prototype.parseNoteProperties=function(t,e,i){for(var n=!1,r=null,a=null,o=null,s=null,h=null,c=-1,l=-1,u=0,p=t.childNodes;u<p.length;u++){var d=p[u];if(d.nodeType===jt.Element)switch(d.localName){case"Property":switch(d.getAttribute("name")){case"String":e.string=parseInt(d.findChildElement("String").innerText)+1;break;case"Fret":e.fret=parseInt(d.findChildElement("Fret").innerText);break;case"Element":c=parseInt(d.findChildElement("Element").innerText);break;case"Variation":l=parseInt(d.findChildElement("Variation").innerText);break;case"Tapped":this._tappedNotes.set(i,!0);break;case"HarmonicType":var f=d.findChildElement("HType");if(f)switch(f.innerText){case"NoHarmonic":e.harmonicType=G.None;break;case"Natural":e.harmonicType=G.Natural;break;case"Artificial":e.harmonicType=G.Artificial;break;case"Pinch":e.harmonicType=G.Pinch;break;case"Tap":e.harmonicType=G.Tap;break;case"Semi":e.harmonicType=G.Semi;break;case"Feedback":e.harmonicType=G.Feedback}break;case"HarmonicFret":var y=d.findChildElement("HFret");y&&(e.harmonicValue=parseFloat(y.innerText));break;case"Muted":d.findChildElement("Enable")&&(e.isDead=!0);break;case"PalmMuted":d.findChildElement("Enable")&&(e.isPalmMute=!0);break;case"Octave":e.octave=parseInt(d.findChildElement("Number").innerText);break;case"Tone":e.tone=parseInt(d.findChildElement("Step").innerText);break;case"ConcertPitch":this.parseConcertPitch(d,e);break;case"Bended":n=!0;break;case"BendOriginValue":r||(r=new X(0,0)),r.value=this.toBendValue(parseFloat(d.findChildElement("Float").innerText));break;case"BendOriginOffset":r||(r=new X(0,0)),r.offset=this.toBendOffset(parseFloat(d.findChildElement("Float").innerText));break;case"BendMiddleValue":a=this.toBendValue(parseFloat(d.findChildElement("Float").innerText));break;case"BendMiddleOffset1":o=this.toBendOffset(parseFloat(d.findChildElement("Float").innerText));break;case"BendMiddleOffset2":s=this.toBendOffset(parseFloat(d.findChildElement("Float").innerText));break;case"BendDestinationValue":h||(h=new X(X.MaxPosition,0)),h.value=this.toBendValue(parseFloat(d.findChildElement("Float").innerText));break;case"BendDestinationOffset":h||(h=new X(0,0)),h.offset=this.toBendOffset(parseFloat(d.findChildElement("Float").innerText));break;case"HopoOrigin":d.findChildElement("Enable")&&(e.isHammerPullOrigin=!0);break;case"HopoDestination":break;case"LeftHandTapped":e.isLeftHandTapped=!0;break;case"Slide":var g=parseInt(d.findChildElement("Flags").innerText);0!=(1&g)?e.slideOutType=H.Shift:0!=(2&g)?e.slideOutType=H.Legato:0!=(4&g)?e.slideOutType=H.OutDown:0!=(8&g)&&(e.slideOutType=H.OutUp),0!=(16&g)?e.slideInType=V.IntoFromBelow:0!=(32&g)&&(e.slideInType=V.IntoFromAbove),0!=(64&g)?e.slideOutType=H.PickSlideDown:0!=(128&g)&&(e.slideOutType=H.PickSlideUp)}}}n&&(r||(r=new X(0,0)),h||(h=new X(X.MaxPosition,0)),e.addBendPoint(r),o&&a&&e.addBendPoint(new X(o,a)),s&&a&&e.addBendPoint(new X(s,a)),o||s||!a||e.addBendPoint(new X(X.MaxPosition/2|0,a)),e.addBendPoint(h)),-1!==c&&-1!==l&&(e.percussionArticulation=at.articulationFromElementVariation(c,l))},t.prototype.parseConcertPitch=function(t,e){var i=t.findChildElement("Pitch");if(i)for(var n=0,r=i.childNodes;n<r.length;n++){var a=r[n];if(a.nodeType===jt.Element)switch(a.localName){case"Accidental":switch(a.innerText){case"x":e.accidentalMode=j.ForceDoubleSharp;break;case"#":e.accidentalMode=j.ForceSharp;break;case"b":e.accidentalMode=j.ForceFlat;break;case"bb":e.accidentalMode=j.ForceDoubleFlat}}}},t.prototype.toBendValue=function(e){return e*t.BendPointValueFactor|0},t.prototype.toBendOffset=function(e){return e*t.BendPointPositionFactor|0},t.prototype.parseRhythms=function(t){for(var e=0,i=t.childNodes;e<i.length;e++){var n=i[e];if(n.nodeType===jt.Element)switch(n.localName){case"Rhythm":this.parseRhythm(n)}}},t.prototype.parseRhythm=function(t){for(var e=new Kt,i=t.getAttribute("id"),n=0,r=t.childNodes;n<r.length;n++){var a=r[n];if(a.nodeType===jt.Element)switch(a.localName){case"NoteValue":switch(a.innerText){case"Long":e.value=A.QuadrupleWhole;break;case"DoubleWhole":e.value=A.DoubleWhole;break;case"Whole":e.value=A.Whole;break;case"Half":e.value=A.Half;break;case"Quarter":e.value=A.Quarter;break;case"Eighth":e.value=A.Eighth;break;case"16th":e.value=A.Sixteenth;break;case"32nd":e.value=A.ThirtySecond;break;case"64th":e.value=A.SixtyFourth;break;case"128th":e.value=A.OneHundredTwentyEighth;break;case"256th":e.value=A.TwoHundredFiftySixth}break;case"PrimaryTuplet":e.tupletNumerator=parseInt(a.getAttribute("num")),e.tupletDenominator=parseInt(a.getAttribute("den"));break;case"AugmentationDot":e.dots=parseInt(a.getAttribute("count"))}}this._rhythmById.set(i,e)},t.prototype.buildModel=function(){for(var e=this,i=0,n=this._masterBars.length;i<n;i++){var r=this._masterBars[i];this.score.addMasterBar(r)}for(var a=0,o=this._tracksMapping;a<o.length;a++){var s=o[a];if(s){var h=this._tracksById.get(s);this.score.addTrack(h)}}for(var c=0,l=this._barsOfMasterBar;c<l.length;c++)for(var u=l[c],p=0,d=0,f=0;d<u.length&&f<this.score.tracks.length;d++){var y=u[d];if(y!==t.InvalidId){var g=this._barsById.get(y),m=(h=this.score.tracks[f]).staves[p];if(m.addBar(g),this._voicesOfBar.has(y))for(var b=0,v=this._voicesOfBar.get(y);b<v.length;b++){var _=v[b];if(_!==t.InvalidId){var w=this._voiceById.get(_);if(g.addVoice(w),this._beatsOfVoice.has(_))for(var S=0,T=this._beatsOfVoice.get(_);S<T.length;S++){var k=T[S];if(k!==t.InvalidId){var P=this._beatById.get(k).clone();w.addBeat(P);var N=this._rhythmOfBeat.get(k),O=this._rhythmById.get(N);if(P.duration=O.value,P.dots=O.dots,P.tupletNumerator=O.tupletNumerator,P.tupletDenominator=O.tupletDenominator,this._notesOfBeat.has(k))for(var x=0,C=this._notesOfBeat.get(k);x<C.length;x++){var F=C[x];if(F!==t.InvalidId){var L=this._noteById.get(F).clone();m.isPercussion?(L.fret=-1,L.string=-1):L.percussionArticulation=-1,P.addNote(L),this._tappedNotes.has(F)&&(P.tap=!0)}}}}}else{w=new kt;g.addVoice(w),(P=new ct).isEmpty=!0,P.duration=A.Quarter,w.addBeat(P)}}p===h.staves.length-1?(f++,p=0):p++}else f++}this._masterTrackAutomations.forEach((function(t,i){for(var n=e.score.masterBars[parseInt(i)],r=0,a=t.length;r<a;r++){var o=t[r];o.type===B.Tempo&&("0"===i&&(e.score.tempo=0|o.value,o.text&&(e.score.tempoLabel=o.text)),n.tempoAutomation=o)}}))},t.InvalidId="-1",t.BendPointPositionFactor=X.MaxPosition/100,t.BendPointValueFactor=.04,t}(),$t=function(){this.isVisible=!1,this.showSlash=!1,this.showStandardNotation=!1,this.showTablature=!1},te=function(){this.isMultiRest=!1,this.tracks=[]},ee=function(){function t(t){this.parts=[],this.zoomLevel=0,this.layout=0;for(var e=At.fromBuffer(t),i=Ft.readInt32BE(e),n=0;n<i;n++){var r=new te;this.parts.push(r),r.isMultiRest=Mt.gpReadBool(e);for(var a=Ft.readInt32BE(e),o=0;o<a;o++){var s=e.readByte();0===s&&(s=1);var h=new $t;h.showStandardNotation=0!=(1&s),h.showTablature=0!=(2&s),h.showSlash=0!=(4&s),r.tracks.push(h)}}}return t.prototype.apply=function(t){for(var e=0,i=0,n=0,r=this.parts;n<r.length;n++)for(var a=0,o=r[n].tracks;a<o.length;a++){var s=o[a];if(i<t.tracks.length){var h=t.tracks[i];if(e<h.staves.length){var c=h.staves[e];c.showTablature=s.showTablature,c.showStandardNotation=s.showStandardNotation}}++i>=t.tracks.length&&(e++,i=0)}},t}(),ie=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ne=function(){},re=function(t){function e(e){var i=t.call(this)||this;return i.n=e,i}return ie(e,t),e}(ne),ae=function(t){function e(e,i){var n=t.call(this)||this;return n.left=e,n.right=i,n}return ie(e,t),e}(ne),oe=function(t){function e(e,i){var n=t.call(this)||this;return n.n=e,n.table=i,n}return ie(e,t),e}(ne),se=function(){function t(){}return t.make=function(e,i,n,r){var a=[],o=[];if(r>32)throw new u("Invalid huffman");for(var s=0;s<r;s++)a.push(0),o.push(0);for(s=0;s<n;s++){var h=e[s+i];if(h>=r)throw new u("Invalid huffman");a[h]++}var c=0;for(s=1;s<r-1;s++)c=c+a[s]<<1,o[s]=c;var l=new Map;for(s=0;s<n;s++){var p=e[s+i];if(0!==p){var d=o[p-1];o[p-1]=d+1,l.set(d<<5|p,s)}}return t.treeCompress(new ae(t.treeMake(l,r,0,1),t.treeMake(l,r,1,1)))},t.treeMake=function(e,i,n,r){if(r>i)throw new u("Invalid huffman");var a=n<<5|r;return e.has(a)?new re(e.get(a)):(n<<=1,r+=1,new ae(t.treeMake(e,i,n,r),t.treeMake(e,i,1|n,r)))},t.treeCompress=function(e){var i=t.treeDepth(e);if(0===i)return e;if(1===i){if(e instanceof ae)return new ae(t.treeCompress(e.left),t.treeCompress(e.right));throw new u("assert")}for(var n=1<<i,r=[],a=0;a<n;a++)r.push(new re(-1));return t.treeWalk(r,0,0,i,e),new oe(i,r)},t.treeWalk=function(e,i,n,r,a){a instanceof ae&&r>0?(t.treeWalk(e,i,n+1,r-1,a.left),t.treeWalk(e,i|1<<n,n+1,r-1,a.right)):e[i]=t.treeCompress(a)},t.treeDepth=function(e){if(e instanceof re)return 0;if(e instanceof oe)throw new u("assert");if(e instanceof ae){var i=t.treeDepth(e.left),n=t.treeDepth(e.right);return 1+(i<n?i:n)}return 0},t}();!function(t){t[t.Head=0]="Head",t[t.Block=1]="Block",t[t.CData=2]="CData",t[t.Flat=3]="Flat",t[t.Crc=4]="Crc",t[t.Dist=5]="Dist",t[t.DistOne=6]="DistOne",t[t.Done=7]="Done"}(Qt||(Qt={}));var he,ce=function(){function t(){this.buffer=new Uint8Array(t.BufferSize),this.pos=0}return t.prototype.slide=function(){var e=new Uint8Array(t.BufferSize);this.pos-=t.Size,e.set(this.buffer.subarray(t.Size,t.Size+this.pos),0),this.buffer=e},t.prototype.addBytes=function(e,i,n){this.pos+n>t.BufferSize&&this.slide(),this.buffer.set(e.subarray(i,i+n),this.pos),this.pos+=n},t.prototype.addByte=function(e){this.pos===t.BufferSize&&this.slide(),this.buffer[this.pos]=e,this.pos++},t.prototype.getLastChar=function(){return this.buffer[this.pos-1]},t.prototype.available=function(){return this.pos},t.Size=32768,t.BufferSize=65536,t}(),le=function(){function t(e){this._nbits=0,this._bits=0,this._state=Qt.Block,this._isFinal=!1,this._huffman=t._fixedHuffman,this._huffdist=null,this._len=0,this._dist=0,this._needed=0,this._output=null,this._outpos=0,this._lengths=[],this._window=new ce,this._input=e;for(var i=0;i<19;i++)this._lengths.push(-1)}return t.buildFixedHuffman=function(){for(var t=[],e=0;e<288;e++)t.push(e<=143?8:e<=255?9:e<=279?7:8);return se.make(t,0,288,10)},t.prototype.readBytes=function(t,e,i){if(this._needed=i,this._outpos=e,this._output=t,i>0)for(;this.inflateLoop(););return i-this._needed},t.prototype.inflateLoop=function(){switch(this._state){case Qt.Head:var e=this._input.readByte();if(8!==(15&e))throw new u("Invalid data");var i=this._input.readByte(),n=0!=(32&i);if(((e<<8)+i)%31!=0)throw new u("Invalid data");if(n)throw new u("Unsupported dictionary");return this._state=Qt.Block,!0;case Qt.Crc:return this._state=Qt.Done,!0;case Qt.Done:return!1;case Qt.Block:switch(this._isFinal=this.getBit(),this.getBits(2)){case 0:if(this._len=Ft.readUInt16LE(this._input),Ft.readUInt16LE(this._input)!==65535-this._len)throw new u("Invalid data");this._state=Qt.Flat;var r=this.inflateLoop();return this.resetBits(),r;case 1:return this._huffman=t._fixedHuffman,this._huffdist=null,this._state=Qt.CData,!0;case 2:for(var a=this.getBits(5)+257,o=this.getBits(5)+1,s=this.getBits(4)+4,h=0;h<s;h++)this._lengths[t.CodeLengthsPos[h]]=this.getBits(3);for(h=s;h<19;h++)this._lengths[t.CodeLengthsPos[h]]=0;this._huffman=se.make(this._lengths,0,19,8);var c=[];for(h=0;h<a+o;h++)c.push(0);return this.inflateLengths(c,a+o),this._huffdist=se.make(c,a,o,16),this._huffman=se.make(c,0,a,16),this._state=Qt.CData,!0;default:throw new u("Invalid data")}case Qt.Flat:var l=this._len<this._needed?this._len:this._needed,p=Ft.readByteArray(this._input,l);return this._len-=l,this.addBytes(p,0,l),0===this._len&&(this._state=this._isFinal?Qt.Crc:Qt.Block),this._needed>0;case Qt.DistOne:l=this._len<this._needed?this._len:this._needed;return this.addDistOne(l),this._len-=l,0===this._len&&(this._state=Qt.CData),this._needed>0;case Qt.Dist:for(;this._len>0&&this._needed>0;){var d=this._len<this._dist?this._len:this._dist;l=this._needed<d?this._needed:d;this.addDist(this._dist,l),this._len-=l}return 0===this._len&&(this._state=Qt.CData),this._needed>0;case Qt.CData:var f=this.applyHuffman(this._huffman);if(f<256)return this.addByte(f),this._needed>0;if(256===f)return this._state=this._isFinal?Qt.Crc:Qt.Block,!0;f=f-257&255;var y=t.LenExtraBitsTbl[f];if(-1===y)throw new u("Invalid data");this._len=t.LenBaseValTbl[f]+this.getBits(y);var g=this._huffdist,m=g?this.applyHuffman(g):this.getRevBits(5);if(-1===(y=t.DistExtraBitsTbl[m]))throw new u("Invalid data");if(this._dist=t.DistBaseValTbl[m]+this.getBits(y),this._dist>this._window.available())throw new u("Invalid data");return this._state=1===this._dist?Qt.DistOne:Qt.Dist,!0}return!1},t.prototype.addDistOne=function(t){for(var e=this._window.getLastChar(),i=0;i<t;i++)this.addByte(e)},t.prototype.addByte=function(t){this._window.addByte(t),this._output[this._outpos]=t,this._needed--,this._outpos++},t.prototype.addDist=function(t,e){this.addBytes(this._window.buffer,this._window.pos-t,e)},t.prototype.getBit=function(){0===this._nbits&&(this._nbits=8,this._bits=this._input.readByte());var t=1==(1&this._bits);return this._nbits--,this._bits=this._bits>>1,t},t.prototype.getBits=function(t){for(;this._nbits<t;)this._bits=this._bits|this._input.readByte()<<this._nbits,this._nbits+=8;var e=this._bits&(1<<t)-1;return this._nbits-=t,this._bits=this._bits>>t,e},t.prototype.getRevBits=function(t){return 0===t?0:this.getBit()?1<<t-1|this.getRevBits(t-1):this.getRevBits(t-1)},t.prototype.resetBits=function(){this._bits=0,this._nbits=0},t.prototype.addBytes=function(t,e,i){this._window.addBytes(t,e,i),this._output.set(t.subarray(e,e+i),this._outpos),this._needed-=i,this._outpos+=i},t.prototype.inflateLengths=function(t,e){for(var i=0,n=0;i<e;){var r=this.applyHuffman(this._huffman);switch(r){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:n=r,t[i]=r,i++;break;case 16:var a=i+3+this.getBits(2);if(a>e)throw new u("Invalid data");for(;i<a;)t[i]=n,i++;break;case 17:if((i+=3+this.getBits(3))>e)throw new u("Invalid data");break;case 18:if((i+=11+this.getBits(7))>e)throw new u("Invalid data");break;default:throw new u("Invalid data")}}},t.prototype.applyHuffman=function(t){if(t instanceof re)return t.n;if(t instanceof ae)return this.applyHuffman(this.getBit()?t.right:t.left);if(t instanceof oe)return this.applyHuffman(t.table[this.getBits(t.n)]);throw new u("Invalid data")},t.LenExtraBitsTbl=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,-1,-1],t.LenBaseValTbl=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],t.DistExtraBitsTbl=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,-1,-1],t.DistBaseValTbl=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],t.CodeLengthsPos=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],t._fixedHuffman=t.buildFixedHuffman(),t}(),ue=function(t,e){this.fullName=t;var i=t.lastIndexOf("/");this.fileName=-1===i||i===t.length-1?this.fullName:t.substr(i+1),this.data=e},pe=function(){function t(t){this._readable=t}return t.prototype.read=function(){for(var t=[];;){var e=this.readEntry();if(!e)break;t.push(e)}return t},t.prototype.readEntry=function(){var e=this._readable;if(Ft.readInt32LE(e)!==t.LocalFileHeaderSignature)return null;Ft.readUInt16LE(e);var i=Ft.readUInt16LE(e),n=Ft.readUInt16LE(e),r=0!==n;if(r&&n!==t.CompressionMethodDeflate)return null;Ft.readInt16LE(this._readable),Ft.readInt16LE(this._readable),Ft.readInt32LE(e),Ft.readInt32LE(e);var a,o=Ft.readInt32LE(e),s=Ft.readInt16LE(e),h=Ft.readInt16LE(e),c=Ft.toString(Ft.readByteArray(e,s),"utf-8");if(e.skip(h),r){for(var l=At.empty(),u=new le(this._readable),p=new Uint8Array(65536);;){var d=u.readBytes(p,0,p.length);if(l.write(p,0,d),d<p.length)break}a=l.toArray()}else a=Ft.readByteArray(this._readable,o);0!=(8&i)&&(Ft.readInt32LE(this._readable)===t.OptionalDataDescriptorSignature&&Ft.readInt32LE(this._readable),Ft.readInt32LE(this._readable),Ft.readInt32LE(this._readable));return new ue(c,a)},t.OptionalDataDescriptorSignature=134695760,t.CompressionMethodDeflate=8,t.LocalFileHeaderSignature=67324752,t}(),de=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),fe=function(t){function e(){return t.call(this)||this}return de(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"Guitar Pro 7"},enumerable:!1,configurable:!0}),e.prototype.readScore=function(){et.debug(this.name,"Loading ZIP entries");var t,e=new pe(this.data);try{t=e.read()}catch(t){throw new N("No Zip archive",t)}et.debug(this.name,"Zip entries loaded");for(var i=null,n=null,r=null,a=0,o=t;a<o.length;a++){var s=o[a];switch(s.fileName){case"score.gpif":i=Ft.toString(s.data,this.settings.importer.encoding);break;case"BinaryStylesheet":n=s.data;break;case"PartConfiguration":r=s.data}}if(!i)throw new N("No score.gpif found in zip archive");et.debug(this.name,"Start Parsing score.gpif");var h=new Zt;h.parseXml(i,this.settings),et.debug(this.name,"score.gpif parsed");var c=h.score;n&&(et.debug(this.name,"Start Parsing BinaryStylesheet"),new Gt(n).apply(c),et.debug(this.name,"BinaryStylesheet parsed"));r&&(et.debug(this.name,"Start Parsing Part Configuration"),new ee(r).apply(c),et.debug(this.name,"Part Configuration parsed"));return c},e}(k),ye=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ge=function(e){function i(){var n=e.call(this,t.AlphaTabErrorType.Format,"Unexpected end of data within reader")||this;return Object.setPrototypeOf(n,i.prototype),n}return ye(i,e),i}(c),me=function(){function t(e){this._currentByte=0,this._position=t.ByteSize,this._source=e}return t.prototype.readByte=function(){return this.readBits(8)},t.prototype.readBytes=function(t){for(var e=new Uint8Array(t),i=0;i<t;i++)e[i]=255&this.readByte();return e},t.prototype.readBits=function(t){for(var e=0,i=t-1;i>=0;)e|=this.readBit()<<i,i--;return e},t.prototype.readBitsReversed=function(t){for(var e=0,i=0;i<t;i++)e|=this.readBit()<<i;return e},t.prototype.readBit=function(){if(this._position>=8){if(this._currentByte=this._source.readByte(),-1===this._currentByte)throw new ge;this._position=0}var e=this._currentByte>>t.ByteSize-this._position-1&1;return this._position++,e},t.prototype.readAll=function(){var t=At.empty();try{for(;;)t.writeByte(255&this.readByte())}catch(t){if(!(t instanceof ge))throw t}return t.toArray()},t.ByteSize=8,t}(),be=function(){this.fileName="",this.fileSize=0,this.data=null},ve=function(){function t(){this.files=[],this.files=[],this.fileFilter=function(t){return!0}}return t.prototype.load=function(t){var e=new me(t);this.readBlock(e)},t.prototype.readHeader=function(t){return this.getString(t.readBytes(4),0,4)},t.prototype.decompress=function(t,e){void 0===e&&(e=!1);var i,n=At.empty(),r=this.getInteger(t.readBytes(4),0);try{for(;n.length<r;){if(1===t.readBits(1)){var a=t.readBits(4),o=t.readBitsReversed(a),s=t.readBitsReversed(a),h=n.length-o,c=Math.min(o,s);i=n.getBuffer(),n.write(i,h,c)}else{s=t.readBitsReversed(2);for(var l=0;l<s;l++)n.writeByte(t.readByte())}}}catch(t){if(!(t instanceof ge))throw t}i=n.getBuffer();var u=e?4:0,p=n.length-u,d=new Uint8Array(p),f=p;return d.set(i.subarray(u,u+f),0),d},t.prototype.readBlock=function(t){var e=this.readHeader(t);if("BCFZ"===e)this.readUncompressedBlock(this.decompress(t,!0));else{if("BCFS"!==e)throw new N("Unsupported format");this.readUncompressedBlock(t.readAll())}},t.prototype.readUncompressedBlock=function(t){for(var e=4096,i=e;i+3<t.length;){if(2===this.getInteger(t,i)){var n=new be;n.fileName=this.getString(t,i+4,127),n.fileSize=this.getInteger(t,i+140);var r=!this.fileFilter||this.fileFilter(n.fileName);r&&this.files.push(n);for(var a=i+148,o=0,s=0,h=r?At.withCapactiy(n.fileSize):null;0!==(o=this.getInteger(t,a+4*s++));)i=o*e,r&&h.write(t,i,e);if(r){n.data=new Uint8Array(Math.min(n.fileSize,h.length));var c=h.toArray();n.data.set(c.subarray(0,0+n.data.length),0)}}i+=e}},t.prototype.getString=function(t,e,i){for(var n="",r=0;r<i;r++){var a=255&t[e+r];if(0===a)break;n+=String.fromCharCode(a)}return n},t.prototype.getInteger=function(t,e){return t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]},t.HeaderBcFs="BCFS",t.HeaderBcFz="BCFZ",t.ScoreGpif="score.gpif",t.BinaryStylesheet="BinaryStylesheet",t.PartConfiguration="PartConfiguration",t}(),_e=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),we=function(t){function e(){return t.call(this)||this}return _e(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"Guitar Pro 6"},enumerable:!1,configurable:!0}),e.prototype.readScore=function(){et.debug(this.name,"Loading GPX filesystem");var t=new ve;t.fileFilter=function(t){return t.endsWith("score.gpif")||t.endsWith("BinaryStylesheet")||t.endsWith("PartConfiguration")},t.load(this.data),et.debug(this.name,"GPX filesystem loaded");for(var e=null,i=null,n=null,r=0,a=t.files;r<a.length;r++){var o=a[r];switch(o.fileName){case"score.gpif":e=Ft.toString(o.data,this.settings.importer.encoding);break;case"BinaryStylesheet":i=o.data;break;case"PartConfiguration":n=o.data}}if(!e)throw new N("No score.gpif found in GPX");et.debug(this.name,"Start Parsing score.gpif");var s=new Zt;s.parseXml(e,this.settings),et.debug(this.name,"score.gpif parsed");var h=s.score;i&&(et.debug(this.name,"Start Parsing BinaryStylesheet"),new Gt(i).apply(h),et.debug(this.name,"BinaryStylesheet parsed"));n&&(et.debug(this.name,"Start Parsing Part Configuration"),new ee(n).apply(h),et.debug(this.name,"Part Configuration parsed"));return h},e}(k),Se=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Be=function(t){function e(){var e=t.call(this)||this;return e._currentPartGroup=null,e._trackFirstMeasureNumber=0,e._maxVoices=0,e._currentDirection=null,e._currentChord=null,e._divisionsPerQuarterNote=0,e._voiceOfStaff=new Map,e._isBeamContinue=!1,e._previousBeatWasPulled=!1,e._previousBeat=null,e}return Se(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"MusicXML"},enumerable:!1,configurable:!0}),e.prototype.readScore=function(){this._trackById=new Map,this._partGroups=new Map,this._tieStarts=[],this._tieStartIds=new Map,this._slurStarts=new Map;var t,e=Ft.toString(this.data.readAll(),this.settings.importer.encoding);try{t=new qt(e)}catch(t){throw new N("Unsupported format")}return this._score=new bt,this._score.tempo=120,this.parseDom(t),this.settings.importer.mergePartGroupsInMusicXml&&this.mergePartGroups(),this._score.finish(this.settings),this._score.rebuildRepeatGroups(),this._score},e.prototype.mergePartGroups=function(){var t=this,e=!1;if(this._partGroups.forEach((function(i){i.length>1&&(t.mergeGroup(i),e=!0)})),e)for(var i=0;i<this._score.tracks.length;i++)this._score.tracks[i].index=i},e.prototype.mergeGroup=function(t){for(var e=t[0],i=1;i<t.length;i++){for(var n=t[i],r=0,a=n.staves;r<a.length;r++){var o=a[r];e.addStaff(o)}var s=this._score.tracks.indexOf(n);this._score.tracks.splice(s,1)}},e.prototype.parseDom=function(t){var e=t.documentElement;if(!e)throw new N("Unsupported format");switch(e.localName){case"score-partwise":this.parsePartwise(e);break;case"score-timewise":break;default:throw new N("Unsupported format")}},e.prototype.parsePartwise=function(t){for(var e=0,i=t.childNodes;e<i.length;e++){var n=i[e];if(n.nodeType===jt.Element)switch(n.localName){case"work":this.parseWork(n);break;case"movement-title":this._score.title=n.innerText;break;case"identification":this.parseIdentification(n);break;case"part-list":this.parsePartList(n);break;case"part":this.parsePart(n)}}},e.prototype.parseWork=function(t){for(var e=0,i=t.childNodes;e<i.length;e++){var n=i[e];if(n.nodeType===jt.Element)switch(n.localName){case"work-title":this._score.title=n.innerText}}},e.prototype.parsePart=function(t){var e=t.getAttribute("id");if(!this._trackById.has(e)){if(1!==this._trackById.size)return;if(this._trackById.forEach((function(t,i){0!==t.staves.length&&0!==t.staves[0].bars.length||(e=i)})),!this._trackById.has(e))return}var i=this._trackById.get(e),n=!0;this._maxVoices=0;for(var r=0,a=t.childNodes;r<a.length;r++){var o=a[r];if(o.nodeType===jt.Element)switch(o.localName){case"measure":this.parseMeasure(o,i,n)&&(n=!1)}}for(var s=0,h=i.staves;s<h.length;s++)for(var c=0,l=h[s].bars;c<l.length;c++){var u=l[c];this.ensureVoices(u)}},e.prototype.parseMeasure=function(t,e,i){if("yes"===t.getAttribute("implicit")&&0===t.getElementsByTagName("note",!1).length)return!1;var n=0;if(i)this._divisionsPerQuarterNote=0,this._trackFirstMeasureNumber=parseInt(t.getAttribute("number")),this._trackFirstMeasureNumber||(this._trackFirstMeasureNumber=0),n=0;else{if(!(n=parseInt(t.getAttribute("number"))))return!1;n-=this._trackFirstMeasureNumber}if(i){var r=t.getElementsByTagName("attributes",!1);if(r.length>0){var a=r[0].getElementsByTagName("staves",!1);if(a.length>0){var o=parseInt(a[0].innerText);e.ensureStaveCount(o)}}}for(var s=new Array(e.staves.length),h=null,c=e.staves[0].bars.length;c<=n;c++)for(var l=0;l<e.staves.length;l++){var u=s[l]=new U;if(e.staves[l].bars.length>0){var p=e.staves[l].bars[e.staves[l].bars.length-1];u.clef=p.clef}h=this.getOrCreateMasterBar(n),e.staves[l].addBar(u),this.ensureVoices(u)}for(var d=!1,f=0,y=t.childNodes;f<y.length;f++){var g=y[f];if(g.nodeType===jt.Element)switch(g.localName){case"note":this.parseNoteBeat(g,s);break;case"forward":this.parseForward(g,s);break;case"direction":this.parseDirection(g,h);break;case"attributes":d||(this.parseAttributes(g,s,h,e),d=!0);break;case"harmony":this.parseHarmony(g,e);break;case"sound":break;case"barline":this.parseBarline(g,h)}}return!0},e.prototype.ensureVoices=function(t){for(;t.voices.length<this._maxVoices;){var e=new kt;t.addVoice(e);var i=new ct;i.isEmpty=!0,i.chordId=this._currentChord,e.addBeat(i)}},e.prototype.getOrCreateBeat=function(t,e,i){var n=0,r=t.getElementsByTagName("voice",!1);r.length>0&&(n=parseInt(r[0].innerText)-1);var a=this._previousBeatWasPulled;this._previousBeatWasPulled=!1;var o,s,h=t.getElementsByTagName("staff",!1),c=1;if(h.length>0){c=parseInt(h[0].innerText),(this._isBeamContinue||a)&&this._previousBeat.voice.bar.staff.index!==c-1&&(c=this._previousBeat.voice.bar.staff.index+1,this._previousBeatWasPulled=!0);var l=e[0].staff.track.index+"-"+c;this._voiceOfStaff.has(l)||this._voiceOfStaff.set(l,n)}o=--c<0?e[0]:c>=e.length?e[e.length-1]:e[c];var u=this.getOrCreateVoice(o,n);return i&&u.beats.length>0||1===u.beats.length&&u.isEmpty?s=u.beats[u.beats.length-1]:((s=new ct).isEmpty=!1,u.addBeat(s)),this._isBeamContinue=!1,this._previousBeat=s,s},e.prototype.parseForward=function(t,e){for(var i=this.getOrCreateBeat(t,e,!1),n=parseInt(t.findChildElement("duration").innerText)*A.Quarter/this._divisionsPerQuarterNote,r=0,a=[A.SixtyFourth,A.ThirtySecond,A.Sixteenth,A.Eighth,A.Quarter,A.Half,A.Whole];r<a.length;r++){var o=a[r];if(n>=o){i.duration=o,n-=o;break}}i.isEmpty=!1},e.prototype.parseStaffDetails=function(t,e){for(var i=0,n=t.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"staff-lines":for(var a=0,o=e.staves;a<o.length;a++){(c=o[a]).tuning=new Array(parseInt(r.innerText)).fill(0)}break;case"staff-tuning":this.parseStaffTuning(r,e)}}for(var s=0,h=e.staves;s<h.length;s++){var c=h[s];this.isEmptyTuning(c.tuning)&&(c.tuning=[])}},e.prototype.parseStaffTuning=function(t,e){for(var i=parseInt(t.getAttribute("line")),n="C",r="",a=0,o=0,s=t.childNodes;o<s.length;o++){var h=s[o];if(h.nodeType===jt.Element)switch(h.localName){case"tuning-step":n=h.innerText;break;case"tuning-alter":a=parseInt(h.innerText);break;case"tuning-octave":r=h.innerText}}for(var c=g.getTuningForText(n+r)+a,l=0,u=e.staves;l<u.length;l++){var p=u[l];p.tuning[p.tuning.length-i]=c}},e.prototype.parseHarmony=function(t,e){for(var i=null,n="",r=0,a=t.childNodes;r<a.length;r++){var o=a[r];if(o.nodeType===jt.Element)switch(o.localName){case"root":for(var s=0,h=o.childNodes;s<h.length;s++){var c=h[s];if(c.nodeType===jt.Element)switch(c.localName){case"root-step":i=c.innerText;break;case"root-alter":switch(parseInt(o.innerText)){case-2:n=" bb";break;case-1:n=" b";break;case 0:n="";break;case 1:n=" #";break;case 2:n=" ##"}}}}}var l=new lt;l.name=i+n,this._currentChord=g.newGuid();for(var u=0,p=e.staves;u<p.length;u++){p[u].addChord(this._currentChord,l)}},e.prototype.parseBarline=function(t,e){for(var i=0,n=t.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"repeat":this.parseRepeat(r,e);break;case"ending":this.parseEnding(r,e)}}},e.prototype.parseEnding=function(t,e){var i=parseInt(t.getAttribute("number"));i>0&&(--i,e.alternateEndings|=1<<i&255)},e.prototype.parseRepeat=function(t,e){var i=t.getAttribute("direction"),n=parseInt(t.getAttribute("times"));(n<0||isNaN(n))&&(n=2),"backward"===i?e.repeatCount=n:"forward"===i&&(e.isRepeatStart=!0)},e.prototype.parseNoteBeat=function(t,e){var i=t.getElementsByTagName("chord",!1).length>0,n=this.getOrCreateBeat(t,e,i);!n.chordId&&this._currentChord&&(n.chordId=this._currentChord,this._currentChord=null),this._currentDirection&&(n.text=this._currentDirection,this._currentDirection=null);var r=new ot;n.voice.isEmpty=!1,n.isEmpty=!1,n.addNote(r),n.dots=0;for(var a=0,o=t.childNodes;a<o.length;a++){var s=o[a];if(s.nodeType===jt.Element)switch(s.localName){case"grace":n.graceType=R.BeforeBeat,n.duration=A.ThirtySecond;break;case"duration":if(n.isRest)switch(parseInt(s.innerText)){case 1:n.duration=A.Whole;break;case 2:n.duration=A.Half;break;case 4:n.duration=A.Quarter;break;case 8:n.duration=A.Eighth;break;case 16:n.duration=A.Sixteenth;break;case 32:n.duration=A.ThirtySecond;break;case 64:n.duration=A.SixtyFourth;break;default:n.duration=A.Quarter}break;case"tie":this.parseTied(s,r);break;case"cue":case"instrument":break;case"type":n.duration=this.getDuration(s.innerText),n.graceType!==R.None&&n.duration<A.Sixteenth&&(n.duration=A.Eighth);break;case"dot":n.dots++;break;case"accidental":this.parseAccidental(s,r);break;case"time-modification":this.parseTimeModification(s,n);break;case"stem":break;case"notehead":"yes"===s.getAttribute("parentheses")&&(r.isGhost=!0);break;case"beam":"continue"===s.innerText&&(this._isBeamContinue=!0);break;case"notations":this.parseNotations(s,n,r);break;case"lyric":this.parseLyric(s,n);break;case"pitch":this.parsePitch(s,r);break;case"unpitched":this.parseUnpitched(s,r);break;case"rest":n.isEmpty=!1,n.notes=[]}}if(r.isStringed)for(var h=0;h<n.notes.length;h++)if(n.notes[h].string===r.string&&n.notes[h]!==r){n.removeNote(r);break}},e.prototype.getDuration=function(t){switch(t){case"256th":case"128th":case"64th":return A.SixtyFourth;case"32nd":return A.ThirtySecond;case"16th":return A.Sixteenth;case"eighth":return A.Eighth;case"quarter":return A.Quarter;case"half":return A.Half;case"long":case"breve":case"whole":return A.Whole}return A.Quarter},e.prototype.parseLyric=function(t,e){for(var i=0,n=t.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"text":e.text?e.text+=" "+r.innerText:e.text=r.innerText}}},e.prototype.parseAccidental=function(t,e){switch(t.innerText){case"sharp":e.accidentalMode=j.ForceSharp;break;case"natural":e.accidentalMode=j.ForceNatural;break;case"flat":e.accidentalMode=j.ForceFlat}},e.prototype.parseTied=function(t,e){"start"===t.getAttribute("type")?this._tieStartIds.has(e.id)||(this._tieStartIds.set(e.id,!0),this._tieStarts.push(e)):"stop"===t.getAttribute("type")&&this._tieStarts.length>0&&!e.isTieDestination&&(e.isTieDestination=!0,e.tieOrigin=this._tieStarts[0],this._tieStarts.splice(0,1),this._tieStartIds.delete(e.id))},e.prototype.parseNotations=function(t,e,i){for(var n=0,r=t.childNodes;n<r.length;n++){var a=r[n];if(a.nodeType===jt.Element)switch(a.localName){case"articulations":this.parseArticulations(a,i);break;case"tied":this.parseTied(a,i);break;case"slide":case"glissando":"start"===a.getAttribute("type")&&(i.slideOutType=H.Shift);break;case"dynamics":this.parseDynamics(a,e);break;case"technical":this.parseTechnical(a,i);break;case"ornaments":this.parseOrnaments(a,i);break;case"slur":var o=a.getAttribute("number");switch(o||(o="1"),a.getAttribute("type")){case"start":this._slurStarts.set(o,i);break;case"stop":if(this._slurStarts.has(o))i.isSlurDestination=!0,this._slurStarts.get(o).slurDestination=i,i.slurOrigin=i}}}},e.prototype.parseOrnaments=function(t,e){for(var i=0,n=t.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"tremolo":switch(parseInt(r.innerText)){case 1:e.beat.tremoloSpeed=A.Eighth;break;case 2:e.beat.tremoloSpeed=A.Sixteenth;break;case 3:e.beat.tremoloSpeed=A.ThirtySecond}}}},e.prototype.parseTechnical=function(t,e){for(var i=0,n=t.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"string":e.string=parseInt(r.innerText),-2147483648!==e.string&&(e.string=e.beat.voice.bar.staff.tuning.length-e.string+1);break;case"fret":e.fret=parseInt(r.innerText);break;case"down-bow":e.beat.pickStroke=q.Down;break;case"up-bow":e.beat.pickStroke=q.Up}}-2147483648!==e.string&&-2147483648!==e.fret||(e.string=-1,e.fret=-1)},e.prototype.parseArticulations=function(t,e){for(var i=0,n=t.childNodes;i<n.length;i++){switch(n[i].localName){case"accent":e.accentuated=S.Normal;break;case"strong-accent":e.accentuated=S.Heavy;break;case"staccato":case"detached-legato":e.isStaccato=!0}}},e.prototype.parseDynamics=function(t,e){for(var i=0,n=t.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"p":e.dynamics=I.P;break;case"pp":e.dynamics=I.PP;break;case"ppp":e.dynamics=I.PPP;break;case"f":e.dynamics=I.F;break;case"ff":e.dynamics=I.FF;break;case"fff":e.dynamics=I.FFF;break;case"mp":e.dynamics=I.MP;break;case"mf":e.dynamics=I.MF}}},e.prototype.parseTimeModification=function(t,e){for(var i=0,n=t.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"actual-notes":e.tupletNumerator=parseInt(r.innerText);break;case"normal-notes":e.tupletDenominator=parseInt(r.innerText)}}},e.prototype.parseUnpitched=function(t,e){for(var i="",n=0,r=0,a=0,o=t.childNodes;a<o.length;a++){var s=o[a];if(s.nodeType===jt.Element)switch(s.localName){case"display-step":i=s.innerText;break;case"display-alter":n=parseInt(s.innerText);break;case"display-octave":r=parseInt(s.innerText)}}var h=12*r+g.getToneForText(i)+n;e.octave=h/12|0,e.tone=h-12*e.octave},e.prototype.parsePitch=function(t,e){for(var i="",n=0,r=0,a=0,o=t.childNodes;a<o.length;a++){var s=o[a];if(s.nodeType===jt.Element)switch(s.localName){case"step":i=s.innerText;break;case"alter":n=parseFloat(s.innerText),isNaN(n)&&(n=0);break;case"octave":r=parseInt(s.innerText)+1}}var h=12*r+g.getToneForText(i)+(0|n);e.octave=h/12|0,e.tone=h-12*e.octave},e.prototype.getOrCreateVoice=function(t,e){if(e<t.voices.length)return t.voices[e];for(var i=t.voices.length;i<=e;i++)t.addVoice(new kt);return this._maxVoices=Math.max(this._maxVoices,t.voices.length),t.voices[e]},e.prototype.parseDirection=function(t,e){for(var i=0,n=t.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"sound":var a=r.getAttribute("tempo");if(a){var o=new F;o.isLinear=!0,o.type=B.Tempo,o.value=parseInt(a),e.tempoAutomation=o}break;case"direction-type":var s=r.firstElement;switch(s.localName){case"words":this._currentDirection=s.innerText;break;case"metronome":this.parseMetronome(s,e)}}}},e.prototype.parseMetronome=function(t,e){for(var i=A.Quarter,n=120,r=0,a=t.childNodes;r<a.length;r++){var o=a[r];if(o.nodeType===jt.Element)switch(o.localName){case"beat-unit":i=this.getDuration(o.innerText);break;case"per-minute":n=parseInt(o.innerText)}}var s=e.tempoAutomation=new F;s.type=B.Tempo,s.value=n*(i/4|0)},e.prototype.parseAttributes=function(t,e,i,n){for(var r=0,a=!1,o=0,s=t.childNodes;o<s.length;o++){var h=s[o];if(h.nodeType===jt.Element)switch(h.localName){case"divisions":this._divisionsPerQuarterNote=parseInt(h.innerText);break;case"key":this.parseKey(h,i);break;case"time":this.parseTime(h,i),a=!0;break;case"clef":r=parseInt(h.getAttribute("number")),isNaN(r)&&(r=1),this.parseClef(h,e[r-1]);break;case"staff-details":this.parseStaffDetails(h,n);break;case"transpose":this.parseTranspose(h,n)}}a||(i.timeSignatureCommon=!0)},e.prototype.parseTranspose=function(t,e){for(var i=0,n=0,r=t.childNodes;n<r.length;n++){var a=r[n];if(a.nodeType===jt.Element)switch(a.localName){case"chromatic":i+=parseInt(a.innerText);break;case"octave-change":i+=12*parseInt(a.innerText)}}for(var o=0,s=e.staves;o<s.length;o++){s[o].transpositionPitch=i}},e.prototype.parseClef=function(t,e){for(var i="s",n=0,r=0,a=t.childNodes;r<a.length;r++){var o=a[r];if(o.nodeType===jt.Element)switch(o.localName){case"sign":i=o.innerText.toLowerCase();break;case"line":n=parseInt(o.innerText);break;case"clef-octave-change":switch(parseInt(o.innerText)){case-2:e.clefOttava=x._15mb;break;case-1:e.clefOttava=x._8vb;break;case 1:e.clefOttava=x._8va;break;case 2:e.clefOttava=x._15mb}}}switch(i){case"g":e.clef=O.G2;break;case"f":e.clef=O.F4;break;case"c":e.clef=3===n?O.C3:O.C4;break;case"percussion":e.clef=O.Neutral,e.staff.isPercussion=!0;break;case"tab":e.clef=O.G2,e.staff.showTablature=!0;break;default:e.clef=O.G2}},e.prototype.parseTime=function(t,e){"common"===t.getAttribute("symbol")&&(e.timeSignatureCommon=!0);for(var i=!1,n=!1,r=0,a=t.childNodes;r<a.length;r++){var o=a[r];if(o.nodeType===jt.Element){var s=o.innerText;switch(o.localName){case"beats":i||(-1===s.indexOf("+")?e.timeSignatureNumerator=parseInt(s):e.timeSignatureNumerator=4,i=!0);break;case"beat-type":n||(-1===s.indexOf("+")?e.timeSignatureDenominator=parseInt(s):e.timeSignatureDenominator=4,n=!0)}}}},e.prototype.parseKey=function(t,e){for(var i=-2147483648,n="",r=0,a=t.childNodes;r<a.length;r++){var o=a[r];if(o.nodeType===jt.Element)switch(o.localName){case"fifths":i=parseInt(o.innerText);break;case"key-step":case"key-alter":break;case"mode":n=o.innerText}}e.keySignature=-7<=i&&i<=7?i:ut.C,e.keySignatureType="minor"===n?pt.Minor:pt.Major},e.prototype.getOrCreateMasterBar=function(t){if(t<this._score.masterBars.length)return this._score.masterBars[t];for(var e=this._score.masterBars.length;e<=t;e++){var i=new yt;if(this._score.masterBars.length>0){var n=this._score.masterBars[this._score.masterBars.length-1];i.timeSignatureDenominator=n.timeSignatureDenominator,i.timeSignatureNumerator=n.timeSignatureNumerator,i.keySignature=n.keySignature,i.keySignatureType=n.keySignatureType}this._score.addMasterBar(i)}return this._score.masterBars[t]},e.prototype.parseIdentification=function(t){for(var e=0,i=t.childNodes;e<i.length;e++){var n=i[e];if(n.nodeType===jt.Element)switch(n.localName){case"creator":"composer"===n.getAttribute("type")&&(this._score.music=n.innerText);break;case"rights":this._score.copyright&&(this._score.copyright+="\n"),this._score.copyright+=n.innerText}}},e.prototype.parsePartList=function(t){for(var e=0,i=t.childNodes;e<i.length;e++){var n=i[e];if(n.nodeType===jt.Element)switch(n.localName){case"part-group":this.parsePartGroup(n);break;case"score-part":this.parseScorePart(n)}}},e.prototype.parsePartGroup=function(t){switch(t.getAttribute("type")){case"start":this._currentPartGroup=t.getAttribute("number"),this._partGroups.set(this._currentPartGroup,[]);break;case"stop":this._currentPartGroup=null}},e.prototype.parseScorePart=function(t){var e=t.getAttribute("id"),i=new St;i.ensureStaveCount(1),i.staves[0].showStandardNotation=!0,this._trackById.set(e,i),this._score.addTrack(i),this._currentPartGroup&&this._partGroups.get(this._currentPartGroup).push(i);for(var n=0,r=t.childNodes;n<r.length;n++){var a=r[n];if(a.nodeType===jt.Element)switch(a.localName){case"part-name":i.name=a.innerText;break;case"part-abbreviation":i.shortName=a.innerText;break;case"midi-instrument":this.parseMidiInstrument(a,i)}}this.isEmptyTuning(i.staves[0].tuning)&&(i.staves[0].tuning=[])},e.prototype.isEmptyTuning=function(t){if(!t)return!0;for(var e=0;e<t.length;e++)if(0!==t[e])return!1;return!0},e.prototype.parseMidiInstrument=function(t,e){for(var i=0,n=t.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"midi-channel":e.playbackInfo.primaryChannel=parseInt(r.innerText);break;case"midi-program":e.playbackInfo.program=parseInt(r.innerText);break;case"midi-volume":e.playbackInfo.volume=parseInt(r.innerText)}}},e}(k);!function(t){t[t.PerNotePitchBend=96]="PerNotePitchBend",t[t.NoteOff=128]="NoteOff",t[t.NoteOn=144]="NoteOn",t[t.NoteAftertouch=160]="NoteAftertouch",t[t.Controller=176]="Controller",t[t.ProgramChange=192]="ProgramChange",t[t.ChannelAftertouch=208]="ChannelAftertouch",t[t.PitchBend=224]="PitchBend",t[t.Meta=255]="Meta"}(he||(he={}));var Te,ke=function(){function t(t,e,i,n){this.tick=t,this.message=e|i<<8|n<<16}return Object.defineProperty(t.prototype,"channel",{get:function(){return 15&this.message},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"command",{get:function(){return 240&this.message},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"data1",{get:function(){return(65280&this.message)>>8},set:function(t){this.message&=-65281,this.message|=t<<8},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"data2",{get:function(){return(16711680&this.message)>>16},set:function(t){this.message&=-16711681,this.message|=t<<16},enumerable:!1,configurable:!0}),t.prototype.writeTo=function(t){var e=new Uint8Array([this.message>>24&255,this.message>>16&255,this.message>>8&255,255&this.message]);t.write(e,0,e.length)},t}(),Pe=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();!function(t){t[t.SequenceNumber=0]="SequenceNumber",t[t.TextEvent=1]="TextEvent",t[t.CopyrightNotice=2]="CopyrightNotice",t[t.SequenceOrTrackName=3]="SequenceOrTrackName",t[t.InstrumentName=4]="InstrumentName",t[t.LyricText=5]="LyricText",t[t.MarkerText=6]="MarkerText",t[t.CuePoint=7]="CuePoint",t[t.PatchName=8]="PatchName",t[t.PortName=9]="PortName",t[t.MidiChannel=32]="MidiChannel",t[t.MidiPort=33]="MidiPort",t[t.EndOfTrack=47]="EndOfTrack",t[t.Tempo=81]="Tempo",t[t.SmpteOffset=84]="SmpteOffset",t[t.TimeSignature=88]="TimeSignature",t[t.KeySignature=89]="KeySignature",t[t.SequencerSpecific=127]="SequencerSpecific"}(Te||(Te={}));var Ne,Oe=function(t){function e(e,i,n,r){return t.call(this,e,i,n,r)||this}return Pe(e,t),Object.defineProperty(e.prototype,"channel",{get:function(){return-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"command",{get:function(){return 255&this.message},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metaStatus",{get:function(){return this.data1},enumerable:!1,configurable:!0}),e}(ke),xe=function(){function t(t,e){this.isMetronome=!1,this.time=0,this.eventIndex=t,this.event=e}return t.newMetronomeEvent=function(e){var i=new t(e,null);return i.isMetronome=!0,i},t}(),Ce=function(){function t(){}return t.DefaultChannelCount=17,t.MetronomeChannel=t.DefaultChannelCount-1,t.AudioChannels=2,t.MinVolume=0,t.MaxVolume=1,t.MinProgram=0,t.MaxProgram=127,t.MinPlaybackSpeed=.125,t.MaxPlaybackSpeed=8,t.MaxPitchWheel=16384,t.MaxPitchWheel20=4294967296,t.DefaultPitchWheel=t.MaxPitchWheel/2,t.MicroBufferCount=32,t.MicroBufferSize=64,t}(),Fe=function(t,e,i){this.bpm=t,this.ticks=e,this.time=i},Le=function(){this.tempoChanges=[],this.firstProgramEventPerChannel=new Map,this.firstTimeSignatureNumerator=0,this.firstTimeSignatureDenominator=0,this.synthData=[],this.division=0,this.eventIndex=0,this.currentTime=0,this.playbackRange=null,this.playbackRangeStartTime=0,this.playbackRangeEndTime=0,this.endTick=0,this.endTime=0},Ee=function(){function t(t){this._oneTimeState=null,this._countInState=null,this.isLooping=!1,this.playbackSpeed=1,this._synthesizer=t,this._mainState=new Le,this._currentState=this._mainState}return Object.defineProperty(t.prototype,"isPlayingOneTimeMidi",{get:function(){return this._currentState==this._oneTimeState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPlayingCountIn",{get:function(){return this._currentState==this._countInState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playbackRange",{get:function(){return this._currentState.playbackRange},set:function(t){this._currentState.playbackRange=t,t&&(this._currentState.playbackRangeStartTime=this.tickPositionToTimePositionWithSpeed(t.startTick,1),this._currentState.playbackRangeEndTime=this.tickPositionToTimePositionWithSpeed(t.endTick,1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentTime",{get:function(){return this._currentState.currentTime},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"endTick",{get:function(){return this._currentState.endTick},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"endTime",{get:function(){return this._currentState.endTime/this.playbackSpeed},enumerable:!1,configurable:!0}),t.prototype.seek=function(t){if(t*=this.playbackSpeed,this.playbackRange&&(t<this._currentState.playbackRangeStartTime?t=this._currentState.playbackRangeStartTime:t>this._currentState.playbackRangeEndTime&&(t=this._currentState.playbackRangeEndTime)),t>this._currentState.currentTime)this.silentProcess(t-this._currentState.currentTime);else if(t<this._currentState.currentTime){this._currentState.currentTime=0,this._currentState.eventIndex=0;var e=this._synthesizer.metronomeVolume;this._synthesizer.noteOffAll(!0),this._synthesizer.resetSoft(),this._synthesizer.setupMetronomeChannel(e),this.silentProcess(t)}},t.prototype.silentProcess=function(t){if(!(t<=0)){for(var e=Date.now(),i=this._currentState.currentTime+t;this._currentState.currentTime<i;)this.fillMidiEventQueueLimited(i-this._currentState.currentTime)&&this._synthesizer.synthesizeSilent(Ce.MicroBufferSize);this._currentState.currentTime=i;var n=Date.now()-e;et.debug("Sequencer","Silent seek finished in "+n+"ms")}},t.prototype.loadOneTimeMidi=function(t){this._oneTimeState=this.createStateFromFile(t),this._currentState=this._oneTimeState},t.prototype.loadMidi=function(t){this._mainState=this.createStateFromFile(t),this._currentState=this._mainState},t.prototype.createStateFromFile=function(t){var e=new Le;e.tempoChanges=[],e.division=t.division,e.eventIndex=0,e.currentTime=0,e.synthData=[];for(var i=120,n=0,r=0,a=0,o=0,s=0,h=0,c=0,l=t.events;c<l.length;c++){var u=l[c],p=new xe(e.synthData.length,u);e.synthData.push(p);var d=u.tick-h;if(n+=d,r+=d*(6e4/(i*t.division)),p.time=r,h=u.tick,a>0)for(;o<n;){var f=xe.newMetronomeEvent(e.synthData.length);e.synthData.push(f),f.time=s,o+=a,s+=a*(6e4/(i*t.division))}if(u.command===he.Meta&&u.data1===Te.Tempo)i=6e7/(y=u).value,e.tempoChanges.push(new Fe(i,n,r));else if(u.command===he.Meta&&u.data1===Te.TimeSignature){var y=u,g=Math.pow(2,y.data[1]);a=e.division*(4/g)|0,0===e.firstTimeSignatureDenominator&&(e.firstTimeSignatureNumerator=y.data[0],e.firstTimeSignatureDenominator=g)}else if(u.command===he.ProgramChange){var m=u.channel;e.firstProgramEventPerChannel.has(m)||e.firstProgramEventPerChannel.set(m,p)}}return e.synthData.sort((function(t,e){return t.time>e.time?1:t.time<e.time?-1:t.eventIndex-e.eventIndex})),e.endTime=r,e.endTick=n,e},t.prototype.fillMidiEventQueue=function(){return this.fillMidiEventQueueLimited(-1)},t.prototype.fillMidiEventQueueLimited=function(t){var e=Ce.MicroBufferSize/this._synthesizer.outSampleRate*1e3*this.playbackSpeed,i=this.internalEndTime;t>0&&(t<e&&(e=t),i=Math.min(this.internalEndTime,this._currentState.currentTime+t));var n=!1;for(this._currentState.currentTime+=e;this._currentState.eventIndex<this._currentState.synthData.length&&this._currentState.synthData[this._currentState.eventIndex].time<this._currentState.currentTime&&this._currentState.currentTime<i;)this._synthesizer.dispatchEvent(this._currentState.synthData[this._currentState.eventIndex]),this._currentState.eventIndex++,n=!0;return n},t.prototype.tickPositionToTimePosition=function(t){return this.tickPositionToTimePositionWithSpeed(t,this.playbackSpeed)},t.prototype.timePositionToTickPosition=function(t){return this.timePositionToTickPositionWithSpeed(t,this.playbackSpeed)},t.prototype.tickPositionToTimePositionWithSpeed=function(t,e){for(var i=0,n=120,r=0,a=0,o=this._currentState.tempoChanges;a<o.length;a++){var s=o[a];if(t<s.ticks)break;i=s.time,n=s.bpm,r=s.ticks}return(i+=(t-=r)*(6e4/(n*this._currentState.division)))/e},t.prototype.timePositionToTickPositionWithSpeed=function(t,e){t*=e;for(var i=0,n=120,r=0,a=0,o=this._currentState.tempoChanges;a<o.length;a++){var s=o[a];if(t<s.time)break;i=s.ticks,n=s.bpm,r=s.time}return(i+=(t-=r)/(6e4/(n*this._currentState.division))|0)+1},Object.defineProperty(t.prototype,"internalEndTime",{get:function(){return this.playbackRange?this._currentState.playbackRangeEndTime:this._currentState.endTime},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isFinished",{get:function(){return this._currentState.currentTime>=this.internalEndTime},enumerable:!1,configurable:!0}),t.prototype.stop=function(){this.playbackRange?this.playbackRange&&(this._currentState.currentTime=this.playbackRange.startTick,this._currentState.eventIndex=0):(this._currentState.currentTime=0,this._currentState.eventIndex=0)},t.prototype.resetOneTimeMidi=function(){this._oneTimeState=null,this._currentState=this._mainState},t.prototype.resetCountIn=function(){this._countInState=null,this._currentState=this._mainState},t.prototype.startCountIn=function(){this.generateCountInMidi(),this._currentState=this._countInState,this.stop(),this._synthesizer.noteOffAll(!0)},t.prototype.generateCountInMidi=function(){var t=new Le;t.division=this._mainState.division;var e=120,i=4,n=4;0===this._mainState.eventIndex?(e=this._mainState.tempoChanges[0].bpm,i=this._mainState.firstTimeSignatureNumerator,n=this._mainState.firstTimeSignatureDenominator):(e=this._synthesizer.currentTempo,i=this._synthesizer.timeSignatureNumerator,n=this._synthesizer.timeSignatureDenominator),t.tempoChanges.push(new Fe(e,0,0));for(var r=t.division*(4/n)|0,a=0,o=0,s=0;s<i;s++){var h=xe.newMetronomeEvent(t.synthData.length);t.synthData.push(h),h.time=o,a+=r,o+=r*(6e4/(e*this._mainState.division))}t.synthData.sort((function(t,e){return t.time>e.time?1:t.time<e.time?-1:t.eventIndex-e.eventIndex})),t.endTime=o,t.endTick=a,this._countInState=t},t}();!function(t){t[t.Paused=0]="Paused",t[t.Playing=1]="Playing"}(Ne||(Ne={}));var Me,De,Ae=function(t,e){this.state=t,this.stopped=e},Ie=function(t,e,i,n){this.currentTime=t,this.endTime=e,this.currentTick=i,this.endTick=n},Re=function(){function t(){this.id="",this.size=0}return t.load=function(e,i,n){if(e&&t.HeaderSize>e.size)return!1;if(n.position+t.HeaderSize>=n.length)return!1;if(i.id=Ft.read8BitStringLength(n,4),i.id.charCodeAt(0)<=32||i.id.charCodeAt(0)>=122)return!1;if(i.size=Ft.readUInt32LE(n),e&&t.HeaderSize+i.size>e.size)return!1;e&&(e.size-=t.HeaderSize+i.size);var r="RIFF"===i.id,a="LIST"===i.id;return(!r||!e)&&(!r&&!a||(i.id=Ft.read8BitStringLength(n,4),!(i.id.charCodeAt(0)<=32||i.id.charCodeAt(0)>=122)&&(i.size-=4,!0)))},t.HeaderSize=8,t}(),Ge=function(){function t(){this.phdrs=[],this.pbags=[],this.pmods=[],this.pgens=[],this.insts=[],this.ibags=[],this.imods=[],this.igens=[],this.sHdrs=[],this.fontSamples=new Float32Array(0)}return t.prototype.load=function(e){var i=new Re,n=new Re;if(!Re.load(null,i,e)||"sfbk"!==i.id)throw new u("Soundfont is not a valid Soundfont2 file");for(;Re.load(i,n,e);){var r=new Re;if("pdta"===n.id)for(;Re.load(n,r,e);)switch(r.id){case"phdr":for(var a=0,o=r.size/Xe.SizeInFile|0;a<o;a++)this.phdrs.push(new Xe(e));break;case"pbag":for(a=0,o=r.size/Ue.SizeInFile|0;a<o;a++)this.pbags.push(new Ue(e));break;case"pmod":for(a=0,o=r.size/Ye.SizeInFile|0;a<o;a++)this.pmods.push(new Ye(e));break;case"pgen":for(a=0,o=r.size/ze.SizeInFile|0;a<o;a++)this.pgens.push(new ze(e));break;case"inst":for(a=0,o=r.size/We.SizeInFile|0;a<o;a++)this.insts.push(new We(e));break;case"ibag":for(a=0,o=r.size/je.SizeInFile|0;a<o;a++)this.ibags.push(new je(e));break;case"imod":for(a=0,o=r.size/Ve.SizeInFile|0;a<o;a++)this.imods.push(new Ve(e));break;case"igen":for(a=0,o=r.size/He.SizeInFile|0;a<o;a++)this.igens.push(new He(e));break;case"shdr":for(a=0,o=r.size/Je.SizeInFile|0;a<o;a++)this.sHdrs.push(new Je(e));break;default:e.position+=r.size}else if("sdta"===n.id)for(;Re.load(n,r,e);)switch(r.id){case"smpl":this.fontSamples=t.loadSamples(r,e);break;default:e.position+=r.size}else e.position+=n.size}},t.loadSamples=function(t,e){for(var i=t.size/2|0,n=new Float32Array(i),r=0,a=new Uint8Array(2048),o=new Int16Array(a.length/2|0);i>0;){var s=Math.min(i,a.length/2|0);e.read(a,0,2*s);for(var h=0;h<s;h++)o[h]=a[2*h+1]<<8|a[2*h],n[r+h]=o[h]/32767;i-=s,r+=s}return n},t}(),je=function(){function t(t){this.instGenNdx=Ft.readUInt16LE(t),this.instModNdx=Ft.readUInt16LE(t)}return t.SizeInFile=4,t}(),Ve=function(){function t(t){this.modSrcOper=Ft.readUInt16LE(t),this.modDestOper=Ft.readUInt16LE(t),this.modAmount=Ft.readInt16LE(t),this.modAmtSrcOper=Ft.readUInt16LE(t),this.modTransOper=Ft.readUInt16LE(t)}return t.SizeInFile=10,t}(),He=function(){function t(t){this.genOper=Ft.readUInt16LE(t),this.genAmount=new qe(t)}return t.SizeInFile=4,t}(),We=function(){function t(t){this.instName=Ft.read8BitStringLength(t,20),this.instBagNdx=Ft.readUInt16LE(t)}return t.SizeInFile=22,t}(),Ue=function(){function t(t){this.genNdx=Ft.readUInt16LE(t),this.modNdx=Ft.readUInt16LE(t)}return t.SizeInFile=4,t}(),ze=function(){function t(t){this.genOper=Ft.readUInt16LE(t),this.genAmount=new qe(t)}return t.SizeInFile=4,t.GenInstrument=41,t.GenKeyRange=43,t.GenVelRange=44,t.GenSampleId=53,t}(),Xe=function(){function t(t){this.presetName=Ft.read8BitStringLength(t,20),this.preset=Ft.readUInt16LE(t),this.bank=Ft.readUInt16LE(t),this.presetBagNdx=Ft.readUInt16LE(t),this.library=Ft.readUInt32LE(t),this.genre=Ft.readUInt32LE(t),this.morphology=Ft.readUInt32LE(t)}return t.SizeInFile=38,t}(),Ye=function(){function t(t){this.modSrcOper=Ft.readUInt16LE(t),this.modDestOper=Ft.readUInt16LE(t),this.modAmount=Ft.readUInt16LE(t),this.modAmtSrcOper=Ft.readUInt16LE(t),this.modTransOper=Ft.readUInt16LE(t)}return t.SizeInFile=10,t}(),Je=function(){function t(t){this.sampleName=Ft.read8BitStringLength(t,20),this.start=Ft.readUInt32LE(t),this.end=Ft.readUInt32LE(t),this.startLoop=Ft.readUInt32LE(t),this.endLoop=Ft.readUInt32LE(t),this.sampleRate=Ft.readUInt32LE(t),this.originalPitch=t.readByte(),this.pitchCorrection=Ft.readSInt8(t),this.sampleLink=Ft.readUInt16LE(t),this.sampleType=Ft.readUInt16LE(t)}return t.SizeInFile=46,t}(),qe=function(){function t(t){this.wordAmount=Ft.readUInt16LE(t)}return Object.defineProperty(t.prototype,"shortAmount",{get:function(){return Ct.uint16ToInt16(this.wordAmount)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lowByteAmount",{get:function(){return 255&this.wordAmount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highByteAmount",{get:function(){return(65280&this.wordAmount)>>8&255},enumerable:!1,configurable:!0}),t}(),Qe=function(){this.presetIndex=0,this.bank=0,this.pitchWheel=0,this.perNotePitchWheel=new Map,this.midiPan=0,this.midiVolume=0,this.midiExpression=0,this.midiRpn=0,this.midiData=0,this.panOffset=0,this.gainDb=0,this.pitchRange=0,this.tuning=0,this.mixVolume=0,this.mute=!1,this.solo=!1},Ke=function(){function t(){this.activeChannel=0,this.channelList=[]}return t.prototype.setupVoice=function(t,e){var i=this.channelList[this.activeChannel],n=e.region.pan+i.panOffset;e.playingChannel=this.activeChannel,e.mixVolume=i.mixVolume,e.noteGainDb+=i.gainDb,e.updatePitchRatio(i,t.outSampleRate),n<=-.5?(e.panFactorLeft=1,e.panFactorRight=0):n>=.5?(e.panFactorLeft=0,e.panFactorRight=1):(e.panFactorLeft=Math.sqrt(.5-n),e.panFactorRight=Math.sqrt(.5+n))},t}();!function(t){t[t.None=0]="None",t[t.Continuous=1]="Continuous",t[t.Sustain=2]="Sustain"}(Me||(Me={})),function(t){t[t.StereoInterleaved=0]="StereoInterleaved",t[t.StereoUnweaved=1]="StereoUnweaved",t[t.Mono=2]="Mono"}(De||(De={}));var Ze,$e=function(){this.name="",this.presetNumber=0,this.bank=0,this.regions=null,this.fontSamples=null},ti=function(){function t(){}return t.timecents2Secs=function(t){return Math.pow(2,t/1200)},t.decibelsToGain=function(t){return t>-100?Math.pow(10,.05*t):0},t.gainToDecibels=function(t){return t<=1e-5?-100:20*Math.log10(t)},t.cents2Hertz=function(t){return 8.176*Math.pow(2,t/1200)},t.clamp=function(t,e,i){return t<=e?e:t>=i?i:t},t}(),ei=function(){function t(t){this.delay=0,this.attack=0,this.hold=0,this.decay=0,this.sustain=0,this.release=0,this.keynumToHold=0,this.keynumToDecay=0,t&&(this.delay=t.delay,this.attack=t.attack,this.hold=t.hold,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.keynumToHold=t.keynumToHold,this.keynumToDecay=t.keynumToDecay)}return t.prototype.clear=function(){this.delay=0,this.attack=0,this.hold=0,this.decay=0,this.sustain=0,this.release=0,this.keynumToHold=0,this.keynumToDecay=0},t.prototype.envToSecs=function(t){this.delay=this.delay<-11950?0:ti.timecents2Secs(this.delay),this.attack=this.attack<-11950?0:ti.timecents2Secs(this.attack),this.release=this.release<-11950?0:ti.timecents2Secs(this.release),0===this.keynumToHold&&(this.hold=this.hold<-11950?0:ti.timecents2Secs(this.hold)),0===this.keynumToDecay&&(this.decay=this.decay<-11950?0:ti.timecents2Secs(this.decay)),this.sustain<0?this.sustain=0:this.sustain=t?ti.decibelsToGain(-this.sustain/10):1-this.sustain/1e3},t}();!function(t){t[t.StartAddrsOffset=0]="StartAddrsOffset",t[t.EndAddrsOffset=1]="EndAddrsOffset",t[t.StartloopAddrsOffset=2]="StartloopAddrsOffset",t[t.EndloopAddrsOffset=3]="EndloopAddrsOffset",t[t.StartAddrsCoarseOffset=4]="StartAddrsCoarseOffset",t[t.ModLfoToPitch=5]="ModLfoToPitch",t[t.VibLfoToPitch=6]="VibLfoToPitch",t[t.ModEnvToPitch=7]="ModEnvToPitch",t[t.InitialFilterFc=8]="InitialFilterFc",t[t.InitialFilterQ=9]="InitialFilterQ",t[t.ModLfoToFilterFc=10]="ModLfoToFilterFc",t[t.ModEnvToFilterFc=11]="ModEnvToFilterFc",t[t.EndAddrsCoarseOffset=12]="EndAddrsCoarseOffset",t[t.ModLfoToVolume=13]="ModLfoToVolume",t[t.Unused1=14]="Unused1",t[t.ChorusEffectsSend=15]="ChorusEffectsSend",t[t.ReverbEffectsSend=16]="ReverbEffectsSend",t[t.Pan=17]="Pan",t[t.Unused2=18]="Unused2",t[t.Unused3=19]="Unused3",t[t.Unused4=20]="Unused4",t[t.DelayModLFO=21]="DelayModLFO",t[t.FreqModLFO=22]="FreqModLFO",t[t.DelayVibLFO=23]="DelayVibLFO",t[t.FreqVibLFO=24]="FreqVibLFO",t[t.DelayModEnv=25]="DelayModEnv",t[t.AttackModEnv=26]="AttackModEnv",t[t.HoldModEnv=27]="HoldModEnv",t[t.DecayModEnv=28]="DecayModEnv",t[t.SustainModEnv=29]="SustainModEnv",t[t.ReleaseModEnv=30]="ReleaseModEnv",t[t.KeynumToModEnvHold=31]="KeynumToModEnvHold",t[t.KeynumToModEnvDecay=32]="KeynumToModEnvDecay",t[t.DelayVolEnv=33]="DelayVolEnv",t[t.AttackVolEnv=34]="AttackVolEnv",t[t.HoldVolEnv=35]="HoldVolEnv",t[t.DecayVolEnv=36]="DecayVolEnv",t[t.SustainVolEnv=37]="SustainVolEnv",t[t.ReleaseVolEnv=38]="ReleaseVolEnv",t[t.KeynumToVolEnvHold=39]="KeynumToVolEnvHold",t[t.KeynumToVolEnvDecay=40]="KeynumToVolEnvDecay",t[t.Instrument=41]="Instrument",t[t.Reserved1=42]="Reserved1",t[t.KeyRange=43]="KeyRange",t[t.VelRange=44]="VelRange",t[t.StartloopAddrsCoarseOffset=45]="StartloopAddrsCoarseOffset",t[t.Keynum=46]="Keynum",t[t.Velocity=47]="Velocity",t[t.InitialAttenuation=48]="InitialAttenuation",t[t.Reserved2=49]="Reserved2",t[t.EndloopAddrsCoarseOffset=50]="EndloopAddrsCoarseOffset",t[t.CoarseTune=51]="CoarseTune",t[t.FineTune=52]="FineTune",t[t.SampleID=53]="SampleID",t[t.SampleModes=54]="SampleModes",t[t.Reserved3=55]="Reserved3",t[t.ScaleTuning=56]="ScaleTuning",t[t.ExclusiveClass=57]="ExclusiveClass",t[t.OverridingRootKey=58]="OverridingRootKey",t[t.Unused5=59]="Unused5",t[t.EndOper=60]="EndOper"}(Ze||(Ze={}));var ii,ni=function(){function t(t){this.loopMode=Me.None,this.sampleRate=0,this.loKey=0,this.hiKey=0,this.loVel=0,this.hiVel=0,this.group=0,this.offset=0,this.end=0,this.loopStart=0,this.loopEnd=0,this.transpose=0,this.tune=0,this.pitchKeyCenter=0,this.pitchKeyTrack=0,this.attenuation=0,this.pan=0,this.ampEnv=new ei,this.modEnv=new ei,this.initialFilterQ=0,this.initialFilterFc=0,this.modEnvToPitch=0,this.modEnvToFilterFc=0,this.modLfoToFilterFc=0,this.modLfoToVolume=0,this.delayModLFO=0,this.freqModLFO=0,this.modLfoToPitch=0,this.delayVibLFO=0,this.freqVibLFO=0,this.vibLfoToPitch=0,t&&(this.loopMode=t.loopMode,this.sampleRate=t.sampleRate,this.loKey=t.loKey,this.hiKey=t.hiKey,this.loVel=t.loVel,this.hiVel=t.hiVel,this.group=t.group,this.offset=t.offset,this.end=t.end,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.transpose=t.transpose,this.tune=t.tune,this.pitchKeyCenter=t.pitchKeyCenter,this.pitchKeyTrack=t.pitchKeyTrack,this.attenuation=t.attenuation,this.pan=t.pan,this.ampEnv=new ei(t.ampEnv),this.modEnv=new ei(t.modEnv),this.initialFilterQ=t.initialFilterQ,this.initialFilterFc=t.initialFilterFc,this.modEnvToPitch=t.modEnvToPitch,this.modEnvToFilterFc=t.modEnvToFilterFc,this.modLfoToFilterFc=t.modLfoToFilterFc,this.modLfoToVolume=t.modLfoToVolume,this.delayModLFO=t.delayModLFO,this.freqModLFO=t.freqModLFO,this.modLfoToPitch=t.modLfoToPitch,this.delayVibLFO=t.delayVibLFO,this.freqVibLFO=t.freqVibLFO,this.vibLfoToPitch=t.vibLfoToPitch)}return t.prototype.clear=function(t){this.loopMode=0,this.sampleRate=0,this.loKey=0,this.hiKey=0,this.loVel=0,this.hiVel=0,this.group=0,this.offset=0,this.end=0,this.loopStart=0,this.loopEnd=0,this.transpose=0,this.tune=0,this.pitchKeyCenter=0,this.pitchKeyTrack=0,this.attenuation=0,this.pan=0,this.ampEnv.clear(),this.modEnv.clear(),this.initialFilterQ=0,this.initialFilterFc=0,this.modEnvToPitch=0,this.modEnvToFilterFc=0,this.modLfoToFilterFc=0,this.modLfoToVolume=0,this.delayModLFO=0,this.freqModLFO=0,this.modLfoToPitch=0,this.delayVibLFO=0,this.freqVibLFO=0,this.vibLfoToPitch=0,this.hiKey=this.hiVel=127,this.pitchKeyCenter=60,t||(this.pitchKeyTrack=100,this.pitchKeyCenter=-1,this.ampEnv.delay=this.ampEnv.attack=this.ampEnv.hold=this.ampEnv.decay=this.ampEnv.release=-12e3,this.modEnv.delay=this.modEnv.attack=this.modEnv.hold=this.modEnv.decay=this.modEnv.release=-12e3,this.initialFilterFc=13500,this.delayModLFO=-12e3,this.delayVibLFO=-12e3)},t.prototype.operator=function(t,e){switch(t){case Ze.StartAddrsOffset:this.offset+=Ct.int16ToUint32(e.shortAmount);break;case Ze.EndAddrsOffset:this.end+=Ct.int16ToUint32(e.shortAmount);break;case Ze.StartloopAddrsOffset:this.loopStart+=Ct.int16ToUint32(e.shortAmount);break;case Ze.EndloopAddrsOffset:this.loopEnd+=Ct.int16ToUint32(e.shortAmount);break;case Ze.StartAddrsCoarseOffset:this.offset+=32768*Ct.int16ToUint32(e.shortAmount);break;case Ze.ModLfoToPitch:this.modLfoToPitch=e.shortAmount;break;case Ze.VibLfoToPitch:this.vibLfoToPitch=e.shortAmount;break;case Ze.ModEnvToPitch:this.modEnvToPitch=e.shortAmount;break;case Ze.InitialFilterFc:this.initialFilterFc=e.shortAmount;break;case Ze.InitialFilterQ:this.initialFilterQ=e.shortAmount;break;case Ze.ModLfoToFilterFc:this.modLfoToFilterFc=e.shortAmount;break;case Ze.ModEnvToFilterFc:this.modEnvToFilterFc=e.shortAmount;break;case Ze.EndAddrsCoarseOffset:this.end+=32768*Ct.int16ToUint32(e.shortAmount);break;case Ze.ModLfoToVolume:this.modLfoToVolume=e.shortAmount;break;case Ze.Pan:this.pan=e.shortAmount/1e3;break;case Ze.DelayModLFO:this.delayModLFO=e.shortAmount;break;case Ze.FreqModLFO:this.freqModLFO=e.shortAmount;break;case Ze.DelayVibLFO:this.delayVibLFO=e.shortAmount;break;case Ze.FreqVibLFO:this.freqVibLFO=e.shortAmount;break;case Ze.DelayModEnv:this.modEnv.delay=e.shortAmount;break;case Ze.AttackModEnv:this.modEnv.attack=e.shortAmount;break;case Ze.HoldModEnv:this.modEnv.hold=e.shortAmount;break;case Ze.DecayModEnv:this.modEnv.decay=e.shortAmount;break;case Ze.SustainModEnv:this.modEnv.sustain=e.shortAmount;break;case Ze.ReleaseModEnv:this.modEnv.release=e.shortAmount;break;case Ze.KeynumToModEnvHold:this.modEnv.keynumToHold=e.shortAmount;break;case Ze.KeynumToModEnvDecay:this.modEnv.keynumToDecay=e.shortAmount;break;case Ze.DelayVolEnv:this.ampEnv.delay=e.shortAmount;break;case Ze.AttackVolEnv:this.ampEnv.attack=e.shortAmount;break;case Ze.HoldVolEnv:this.ampEnv.hold=e.shortAmount;break;case Ze.DecayVolEnv:this.ampEnv.decay=e.shortAmount;break;case Ze.SustainVolEnv:this.ampEnv.sustain=e.shortAmount;break;case Ze.ReleaseVolEnv:this.ampEnv.release=e.shortAmount;break;case Ze.KeynumToVolEnvHold:this.ampEnv.keynumToHold=e.shortAmount;break;case Ze.KeynumToVolEnvDecay:this.ampEnv.keynumToDecay=e.shortAmount;break;case Ze.KeyRange:this.loKey=e.lowByteAmount,this.hiKey=e.highByteAmount;break;case Ze.VelRange:this.loVel=e.lowByteAmount,this.hiVel=e.highByteAmount;break;case Ze.StartloopAddrsCoarseOffset:this.loopStart+=32768*Ct.int16ToUint32(e.shortAmount);break;case Ze.InitialAttenuation:this.attenuation+=.1*e.shortAmount;break;case Ze.EndloopAddrsCoarseOffset:this.loopEnd+=32768*Ct.int16ToUint32(e.shortAmount);break;case Ze.CoarseTune:this.transpose+=e.shortAmount;break;case Ze.FineTune:this.tune+=e.shortAmount;break;case Ze.SampleModes:this.loopMode=3==(3&e.wordAmount)?Me.Sustain:1==(3&e.wordAmount)?Me.Continuous:Me.None;break;case Ze.ScaleTuning:this.pitchKeyTrack=e.shortAmount;break;case Ze.ExclusiveClass:this.group=e.wordAmount;break;case Ze.OverridingRootKey:this.pitchKeyCenter=e.shortAmount}},t}();!function(t){t[t.None=0]="None",t[t.Delay=1]="Delay",t[t.Attack=2]="Attack",t[t.Hold=3]="Hold",t[t.Decay=4]="Decay",t[t.Sustain=5]="Sustain",t[t.Release=6]="Release",t[t.Done=7]="Done"}(ii||(ii={}));var ri,ai=function(){function t(){this.level=0,this.slope=0,this.samplesUntilNextSegment=0,this.segment=ii.None,this.midiVelocity=0,this.parameters=null,this.segmentIsExponential=!1,this.isAmpEnv=!1}return t.prototype.nextSegment=function(e,i){if(this.parameters)for(;;)switch(e){case ii.None:if(this.samplesUntilNextSegment=this.parameters.delay*i|0,this.samplesUntilNextSegment>0)return this.segment=ii.Delay,this.segmentIsExponential=!1,this.level=0,void(this.slope=0);e=ii.Delay;break;case ii.Delay:if(this.samplesUntilNextSegment=this.parameters.attack*i|0,this.samplesUntilNextSegment>0)return this.isAmpEnv||(this.samplesUntilNextSegment=this.parameters.attack*((145-this.midiVelocity)/144)*i|0),this.segment=ii.Attack,this.segmentIsExponential=!1,this.level=0,void(this.slope=1/this.samplesUntilNextSegment);e=ii.Attack;break;case ii.Attack:if(this.samplesUntilNextSegment=this.parameters.hold*i|0,this.samplesUntilNextSegment>0)return this.segment=ii.Hold,this.segmentIsExponential=!1,this.level=1,void(this.slope=0);e=ii.Hold;break;case ii.Hold:if(this.samplesUntilNextSegment=this.parameters.decay*i|0,this.samplesUntilNextSegment>0){if(this.segment=ii.Decay,this.level=1,this.isAmpEnv){var n=-9.226/this.samplesUntilNextSegment;this.slope=Math.exp(n),this.segmentIsExponential=!0,this.parameters.sustain>0&&(this.samplesUntilNextSegment=Math.log(this.parameters.sustain)/n|0)}else this.slope=-1/this.samplesUntilNextSegment,this.samplesUntilNextSegment=this.parameters.decay*(1-this.parameters.sustain)*i|0,this.segmentIsExponential=!1;return}e=ii.Decay;break;case ii.Decay:return this.segment=ii.Sustain,this.level=this.parameters.sustain,this.slope=0,this.samplesUntilNextSegment=2147483647,void(this.segmentIsExponential=!1);case ii.Sustain:if(this.segment=ii.Release,this.samplesUntilNextSegment=(this.parameters.release<=0?t.FastReleaseTime:this.parameters.release)*i|0,this.isAmpEnv){n=-9.226/this.samplesUntilNextSegment;this.slope=Math.exp(n),this.segmentIsExponential=!0}else this.slope=-this.level/this.samplesUntilNextSegment,this.segmentIsExponential=!1;return;case ii.Release:default:return this.segment=ii.Done,this.segmentIsExponential=!1,this.level=this.slope=0,void(this.samplesUntilNextSegment=134217727)}},t.prototype.setup=function(t,e,i,n,r){this.parameters=new ei(t),this.parameters.keynumToHold>0&&(this.parameters.hold+=this.parameters.keynumToHold*(60-e),this.parameters.hold=this.parameters.hold<-1e4?0:ti.timecents2Secs(this.parameters.hold)),this.parameters.keynumToDecay>0&&(this.parameters.decay+=this.parameters.keynumToDecay*(60-e),this.parameters.decay=this.parameters.decay<-1e4?0:ti.timecents2Secs(this.parameters.decay)),this.midiVelocity=0|i,this.isAmpEnv=n,this.nextSegment(ii.None,r)},t.prototype.process=function(t,e){this.slope>0&&(this.segmentIsExponential?this.level*=Math.pow(this.slope,t):this.level+=this.slope*t),(this.samplesUntilNextSegment-=t)<=0&&this.nextSegment(this.segment,e)},t.FastReleaseTime=.01,t}(),oi=function(){function t(){this.samplesUntil=0,this.level=0,this.delta=0}return t.prototype.setup=function(t,e,i){this.samplesUntil=t*i|0,this.delta=4*ti.cents2Hertz(e)/i,this.level=0},t.prototype.process=function(t){this.samplesUntil>t?this.samplesUntil-=t:(this.level+=this.delta*t,this.level>1?(this.delta=-this.delta,this.level=2-this.level):this.level<-1&&(this.delta=-this.delta,this.level=-2-this.level))},t}(),si=function(){function t(t){this.qInv=0,this.a0=0,this.a1=0,this.b1=0,this.b2=0,this.z1=0,this.z2=0,this.active=!1,t&&(this.qInv=t.qInv,this.a0=t.a0,this.a1=t.a1,this.b1=t.b1,this.b2=t.b2,this.z1=t.z1,this.z2=t.z2,this.active=t.active)}return t.prototype.setup=function(t){var e=Math.tan(Math.PI*t),i=e*e,n=1/(1+e*this.qInv+i);this.a0=i*n,this.a1=2*this.a0,this.b1=2*(i-1)*n,this.b2=(1-e*this.qInv+i)*n},t.prototype.process=function(t){var e=t*this.a0+this.z1;return this.z1=t*this.a1+this.z2-this.b1*e,this.z2=t*this.a0-this.b2*e,e},t}(),hi=function(){function t(){this.playingPreset=0,this.playingKey=0,this.playingChannel=0,this.region=null,this.pitchInputTimecents=0,this.pitchOutputFactor=0,this.sourceSamplePosition=0,this.noteGainDb=0,this.panFactorLeft=0,this.panFactorRight=0,this.playIndex=0,this.loopStart=0,this.loopEnd=0,this.ampEnv=new ai,this.modEnv=new ai,this.lowPass=new si,this.modLfo=new oi,this.vibLfo=new oi,this.mixVolume=0,this.mute=!1}return t.prototype.updatePitchRatio=function(t,e){var i=t.pitchWheel;t.perNotePitchWheel.has(this.playingKey)&&(i+=t.perNotePitchWheel.get(this.playingKey)-8192);var n=8192===i?t.tuning:i/16383*t.pitchRange*2-t.pitchRange+t.tuning;this.calcPitchRatio(n,e)},t.prototype.calcPitchRatio=function(t,e){if(this.region){var i=this.playingKey+this.region.transpose+this.region.tune/100,n=this.region.pitchKeyCenter+(i-this.region.pitchKeyCenter)*(this.region.pitchKeyTrack/100);0!==t&&(n+=t),this.pitchInputTimecents=100*n,this.pitchOutputFactor=this.region.sampleRate/(ti.timecents2Secs(100*this.region.pitchKeyCenter)*e)}},t.prototype.end=function(t){this.region&&(this.ampEnv.nextSegment(ii.Sustain,t),this.modEnv.nextSegment(ii.Sustain,t),this.region.loopMode===Me.Sustain&&(this.loopEnd=this.loopStart))},t.prototype.endQuick=function(t){this.ampEnv.parameters.release=0,this.ampEnv.nextSegment(ii.Sustain,t),this.modEnv.parameters.release=0,this.modEnv.nextSegment(ii.Sustain,t)},t.prototype.render=function(e,i,n,r,a){if(this.region){var o=this.region,s=e.presets[this.playingPreset].fontSamples,h=0,c=e.outputMode===De.StereoUnweaved?r:-1,l=0!==o.modEnvToPitch||0!==o.modEnvToFilterFc,u=this.modLfo.delta>0&&(0!==o.modLfoToPitch||0!==o.modLfoToFilterFc||0!==o.modLfoToVolume),p=this.vibLfo.delta>0&&0!==o.vibLfoToPitch,d=this.loopStart<this.loopEnd,f=this.loopStart,y=this.loopEnd,g=o.end,m=y+1,b=this.sourceSamplePosition,v=new si(this.lowPass),_=0!==o.modLfoToFilterFc||0!==o.modEnvToFilterFc,w=0,S=0,B=0,T=0,k=0!==o.modLfoToPitch||0!==o.modEnvToPitch||0!==o.vibLfoToPitch,P=0,N=0,O=0,x=0,C=0!==o.modLfoToVolume,F=0,L=0;for(_?(w=e.outSampleRate,S=o.initialFilterFc,B=o.modLfoToFilterFc,T=o.modEnvToFilterFc):(w=0,S=0,B=0,T=0),k?(P=0,N=o.modLfoToPitch,O=o.vibLfoToPitch,x=o.modEnvToPitch):(P=ti.timecents2Secs(this.pitchInputTimecents)*this.pitchOutputFactor,N=0,O=0,x=0),C?L=.1*o.modLfoToVolume:(F=ti.decibelsToGain(this.noteGainDb),L=0);r>0;){var E=void 0,M=void 0,D=0,A=r>t.RenderEffectSampleBlock?t.RenderEffectSampleBlock:r;if(r-=A,_){var I=S+this.modLfo.level*B+this.modEnv.level*T;v.active=I<=13500,v.active&&v.setup(ti.cents2Hertz(I)/w)}switch(k&&(P=ti.timecents2Secs(this.pitchInputTimecents+(this.modLfo.level*N+this.vibLfo.level*O+this.modEnv.level*x))*this.pitchOutputFactor),C&&(F=ti.decibelsToGain(this.noteGainDb+this.modLfo.level*L)),E=F*this.ampEnv.level,a?E=0:E*=this.mixVolume,this.ampEnv.process(A,e.outSampleRate),l&&this.modEnv.process(A,e.outSampleRate),u&&this.modLfo.process(A),p&&this.vibLfo.process(A),e.outputMode){case De.StereoInterleaved:for(M=E*this.panFactorLeft,D=E*this.panFactorRight;A-- >0&&b<g;){var R=(V=0|b)>=y&&d?f:V+1,G=b-V,j=s[V]*(1-G)+s[R]*G;v.active&&(j=v.process(j)),i[n+h]+=j*M,i[n+ ++h]+=j*D,h++,(b+=P)>=m&&d&&(b-=y-f+1)}break;case De.StereoUnweaved:for(M=E*this.panFactorLeft,D=E*this.panFactorRight;A-- >0&&b<g;){R=(V=0|b)>=y&&d?f:V+1,G=b-V,j=s[V]*(1-G)+s[R]*G;v.active&&(j=v.process(j)),i[n+h]+=j*M,h++,i[n+c]+=j*D,c++,(b+=P)>=m&&d&&(b-=y-f+1)}break;case De.Mono:for(;A-- >0&&b<g;){var V;R=(V=0|b)>=y&&d?f:V+1,G=b-V,j=s[V]*(1-G)+s[R]*G;v.active&&(j=v.process(j)),i[n+h]=j*E,h++,(b+=P)>=m&&d&&(b-=y-f+1)}}if(b>=g||this.ampEnv.segment===ii.Done)return void this.kill()}this.sourceSamplePosition=b,(v.active||_)&&(this.lowPass=v)}},t.prototype.kill=function(){this.playingPreset=-1},t.RenderEffectSampleBlock=Ce.MicroBufferSize,t}(),ci=function(){function t(t){this._midiEventQueue=[],this._midiEventCount=0,this._mutedChannels=new Map,this._soloChannels=new Map,this._isAnySolo=!1,this.currentTempo=0,this.timeSignatureNumerator=0,this.timeSignatureDenominator=0,this.presets=null,this._voices=[],this._channels=null,this._voicePlayIndex=0,this.outputMode=De.StereoInterleaved,this.outSampleRate=0,this.globalGainDb=0,this.outSampleRate=t}return t.prototype.synthesize=function(t,e,i){this.fillWorkingBuffer(t,e,i)},t.prototype.synthesizeSilent=function(t){this.fillWorkingBuffer(null,0,t)},t.prototype.channelGetMixVolume=function(t){return this._channels&&t<this._channels.channelList.length?this._channels.channelList[t].mixVolume:1},t.prototype.channelSetMixVolume=function(t,e){for(var i=this.channelInit(t),n=0,r=this._voices;n<r.length;n++){var a=r[n];a.playingChannel===t&&-1!==a.playingPreset&&(a.mixVolume=e)}i.mixVolume=e},t.prototype.channelSetMute=function(t,e){e?this._mutedChannels.set(t,!0):this._mutedChannels.delete(t)},t.prototype.channelSetSolo=function(t,e){e?this._soloChannels.set(t,!0):this._soloChannels.delete(t),this._isAnySolo=this._soloChannels.size>0},t.prototype.resetChannelStates=function(){this._mutedChannels=new Map,this._soloChannels=new Map,this._isAnySolo=!1},t.prototype.dispatchEvent=function(t){this._midiEventQueue.unshift(t),this._midiEventCount++},t.prototype.fillWorkingBuffer=function(t,e,i){var n=this._isAnySolo;if(this._midiEventQueue.length>0)for(var r=0;r<this._midiEventCount;r++){var a=this._midiEventQueue.pop();a&&(a.isMetronome&&this.metronomeVolume>0?(this.channelNoteOff(Ce.MetronomeChannel,33),this.channelNoteOn(Ce.MetronomeChannel,33,95/127)):a.event&&this.processMidiMessage(a.event))}for(var o=0,s=this._voices;o<s.length;o++){var h=s[o];if(-1!==h.playingPreset){var c=h.playingChannel,l=this._mutedChannels.has(c)||n&&c!=Ce.MetronomeChannel&&!this._soloChannels.has(c);t?h.render(this,t,e,i,l):h.kill()}}this._midiEventCount=0},t.prototype.processMidiMessage=function(t){et.debug("Midi","Processing midi "+t.command);var e=t.command,i=t.channel,n=t.data1,r=t.data2;switch(e){case he.NoteOff:this.channelNoteOff(i,n);break;case he.NoteOn:this.channelNoteOn(i,n,r/127);break;case he.NoteAftertouch:break;case he.Controller:this.channelMidiControl(i,n,r);break;case he.ProgramChange:this.channelSetPresetNumber(i,n,9===i);break;case he.ChannelAftertouch:break;case he.PitchBend:this.channelSetPitchWheel(i,n|r<<7);break;case he.PerNotePitchBend:var a=t,o=a.pitch;o=o*Ce.MaxPitchWheel/Ce.MaxPitchWheel20,this.channelSetPerNotePitchWheel(i,a.noteKey,o);break;case he.Meta:switch(t.data1){case Te.Tempo:this.currentTempo=6e7/t.value;break;case Te.TimeSignature:this.timeSignatureNumerator=t.data[0],this.timeSignatureDenominator=Math.pow(2,t.data[1])}}},Object.defineProperty(t.prototype,"metronomeVolume",{get:function(){return this.channelGetMixVolume(Ce.MetronomeChannel)},set:function(t){this.setupMetronomeChannel(t)},enumerable:!1,configurable:!0}),t.prototype.setupMetronomeChannel=function(t){this.channelSetMixVolume(Ce.MetronomeChannel,t),t>0&&(this.channelSetVolume(Ce.MetronomeChannel,1),this.channelSetPresetNumber(Ce.MetronomeChannel,0,!0))},Object.defineProperty(t.prototype,"masterVolume",{get:function(){return ti.decibelsToGain(this.globalGainDb)},set:function(t){var e=ti.gainToDecibels(t),i=e-this.globalGainDb;if(0!==i){for(var n=0,r=this._voices;n<r.length;n++){var a=r[n];-1!==a.playingPreset&&(a.noteGainDb+=i)}this.globalGainDb=e}},enumerable:!1,configurable:!0}),t.prototype.resetSoft=function(){for(var t=0,e=this._voices;t<e.length;t++){var i=e[t];-1!==i.playingPreset&&(i.ampEnv.segment<ii.Release||0!==i.ampEnv.parameters.release)&&i.endQuick(this.outSampleRate)}if(this._channels)for(var n=0,r=this._channels.channelList;n<r.length;n++){var a=r[n];a.presetIndex=a.bank=0,a.pitchWheel=a.midiPan=8192,a.perNotePitchWheel.clear(),a.midiVolume=a.midiExpression=16383,a.midiRpn=65535,a.midiData=0,a.panOffset=0,a.gainDb=0,a.pitchRange=2,a.tuning=0}},Object.defineProperty(t.prototype,"presetCount",{get:function(){var t,e;return null!==(e=null===(t=this.presets)||void 0===t?void 0:t.length)&&void 0!==e?e:0},enumerable:!1,configurable:!0}),t.prototype.reset=function(){for(var t=0,e=this._voices;t<e.length;t++){var i=e[t];-1!==i.playingPreset&&(i.ampEnv.segment<ii.Release||0!==i.ampEnv.parameters.release)&&i.endQuick(this.outSampleRate)}this._channels=null},t.prototype.setOutput=function(t,e,i){this.outputMode=t,this.outSampleRate=e>=1?e:44100,this.globalGainDb=i},t.prototype.noteOn=function(t,e,i){if(this.presets){var n=127*i|0;if(!(t<0||t>=this.presets.length))if(i<=0)this.noteOff(t,e);else for(var r=this._voicePlayIndex++,a=0,o=this.presets[t].regions;a<o.length;a++){var s=o[a];if(!(e<s.loKey||e>s.hiKey||n<s.loVel||n>s.hiVel)){var h=null;if(0!==s.group)for(var c=0,l=this._voices;c<l.length;c++){(d=l[c]).playingPreset===t&&d.region.group===s.group?d.endQuick(this.outSampleRate):-1!==d.playingPreset||h||(h=d)}else for(var u=0,p=this._voices;u<p.length;u++){var d;-1===(d=p[u]).playingPreset&&(h=d)}if(!h){for(var f=0;f<4;f++){var y=new hi;y.playingPreset=-1,this._voices.push(y)}h=this._voices[this._voices.length-4]}h.region=s,h.playingPreset=t,h.playingKey=e,h.playIndex=r,h.noteGainDb=this.globalGainDb-s.attenuation-ti.gainToDecibels(1/i),this._channels?this._channels.setupVoice(this,h):(h.calcPitchRatio(0,this.outSampleRate),h.panFactorLeft=Math.sqrt(.5-s.pan),h.panFactorRight=Math.sqrt(.5+s.pan)),h.sourceSamplePosition=s.offset;var g=s.loopMode!==Me.None&&s.loopStart<s.loopEnd;h.loopStart=g?s.loopStart:0,h.loopEnd=g?s.loopEnd:0,h.ampEnv.setup(s.ampEnv,e,n,!0,this.outSampleRate),h.modEnv.setup(s.modEnv,e,n,!1,this.outSampleRate);var m=s.initialFilterQ/10;h.lowPass.qInv=1/Math.pow(10,m/20),h.lowPass.z1=h.lowPass.z2=0,h.lowPass.active=s.initialFilterFc<=13500,h.lowPass.active&&h.lowPass.setup(ti.cents2Hertz(s.initialFilterFc)/this.outSampleRate),h.modLfo.setup(s.delayModLFO,s.freqModLFO,this.outSampleRate),h.vibLfo.setup(s.delayVibLFO,s.freqVibLFO,this.outSampleRate)}}}},t.prototype.bankNoteOn=function(t,e,i,n){var r=this.getPresetIndex(t,e);return-1!==r&&(this.noteOn(r,i,n),!0)},t.prototype.noteOff=function(t,e){for(var i=null,n=null,r=[],a=0,o=this._voices;a<o.length;a++){(c=o[a]).playingPreset!==t||c.playingKey!==e||c.ampEnv.segment>=ii.Release||(!i||c.playIndex<i.playIndex?(i=c,n=c,r.push(c)):c.playIndex===i.playIndex&&(n=c,r.push(c)))}if(i)for(var s=0,h=r;s<h.length;s++){var c;(c=h[s])!==i&&c!==n&&(c.playIndex!==i.playIndex||c.playingPreset!==t||c.playingKey!==e||c.ampEnv.segment>=ii.Release)||c.end(this.outSampleRate)}},t.prototype.bankNoteOff=function(t,e,i){var n=this.getPresetIndex(t,e);return-1!==n&&(this.noteOff(n,i),!0)},t.prototype.noteOffAll=function(t){for(var e=0,i=this._voices;e<i.length;e++){var n=i[e];-1!==n.playingPreset&&n.ampEnv.segment<ii.Release&&(t?n.endQuick(this.outSampleRate):n.end(this.outSampleRate))}},Object.defineProperty(t.prototype,"activeVoiceCount",{get:function(){for(var t=0,e=0,i=this._voices;e<i.length;e++){-1!==i[e].playingPreset&&t++}return t},enumerable:!1,configurable:!0}),t.prototype.channelInit=function(t){if(this._channels&&t<this._channels.channelList.length)return this._channels.channelList[t];this._channels||(this._channels=new Ke);for(var e=this._channels.channelList.length;e<=t;e++){var i=new Qe;i.presetIndex=i.bank=0,i.pitchWheel=i.midiPan=8192,i.midiVolume=i.midiExpression=16383,i.midiRpn=65535,i.midiData=0,i.panOffset=0,i.gainDb=0,i.pitchRange=2,i.tuning=0,i.mixVolume=1,this._channels.channelList.push(i)}return this._channels.channelList[t]},t.prototype.getPresetIndex=function(t,e){if(!this.presets)return-1;for(var i=this.presets.length-1;i>=0;i--){var n=this.presets[i];if(n.presetNumber===e&&n.bank===t)return i}return-1},t.prototype.getPresetName=function(t){return this.presets?t<0||t>=this.presets.length?null:this.presets[t].name:null},t.prototype.bankGetPresetName=function(t,e){return this.getPresetName(this.getPresetIndex(t,e))},t.prototype.channelNoteOn=function(t,e,i){!this._channels||t>this._channels.channelList.length||(this._channels.activeChannel=t,this.noteOn(this._channels.channelList[t].presetIndex,e,i))},t.prototype.channelNoteOff=function(t,e){for(var i=[],n=null,r=null,a=0,o=this._voices;a<o.length;a++){-1===(c=o[a]).playingPreset||c.playingChannel!==t||c.playingKey!==e||c.ampEnv.segment>=ii.Release||(!n||c.playIndex<n.playIndex?(n=r=c,i.push(c)):c.playIndex===n.playIndex&&(r=c,i.push(c)))}if(this.channelInit(t).perNotePitchWheel.delete(e),n)for(var s=0,h=i;s<h.length;s++){var c;(c=h[s])!==n&&c!==r&&(c.playIndex!==n.playIndex||-1===c.playingPreset||c.playingChannel!==t||c.playingKey!==e||c.ampEnv.segment>=ii.Release)||c.end(this.outSampleRate)}},t.prototype.channelNoteOffAll=function(t){this.channelInit(t).perNotePitchWheel.clear();for(var e=0,i=this._voices;e<i.length;e++){var n=i[e];-1!==n.playingPreset&&n.playingChannel===t&&n.ampEnv.segment<ii.Release&&n.end(this.outSampleRate)}},t.prototype.channelSoundsOffAll=function(t){this.channelInit(t).perNotePitchWheel.clear();for(var e=0,i=this._voices;e<i.length;e++){var n=i[e];-1!==n.playingPreset&&n.playingChannel===t&&(n.ampEnv.segment<ii.Release||0===n.ampEnv.parameters.release)&&n.endQuick(this.outSampleRate)}},t.prototype.channelSetPresetIndex=function(t,e){this.channelInit(t).presetIndex=Ct.int32ToUint16(e)},t.prototype.channelSetPresetNumber=function(t,e,i){void 0===i&&(i=!1);var n=this.channelInit(t),r=0;return i?(-1===(r=this.getPresetIndex(128|32767&n.bank,e))&&(r=this.getPresetIndex(128,e)),-1===r&&(r=this.getPresetIndex(128,0)),-1===r&&(r=this.getPresetIndex(2047&n.bank,e))):r=this.getPresetIndex(2047&n.bank,e),n.presetIndex=r,-1!==r},t.prototype.channelSetBank=function(t,e){this.channelInit(t).bank=Ct.int32ToUint16(e)},t.prototype.channelSetBankPreset=function(t,e,i){var n=this.channelInit(t),r=this.getPresetIndex(e,i);return-1!==r&&(n.presetIndex=Ct.int32ToUint16(r),n.bank=Ct.int32ToUint16(e),!0)},t.prototype.channelSetPan=function(t,e){for(var i=0,n=this._voices;i<n.length;i++){var r=n[i];if(r.playingChannel===t&&-1!==r.playingPreset){var a=r.region.pan+e-.5;a<=-.5?(r.panFactorLeft=1,r.panFactorRight=0):a>=.5?(r.panFactorLeft=0,r.panFactorRight=1):(r.panFactorLeft=Math.sqrt(.5-a),r.panFactorRight=Math.sqrt(.5+a))}}this.channelInit(t).panOffset=e-.5},t.prototype.channelSetVolume=function(t,e){var i=this.channelInit(t),n=ti.gainToDecibels(e),r=n-i.gainDb;if(0!==r){for(var a=0,o=this._voices;a<o.length;a++){var s=o[a];s.playingChannel===t&&-1!==s.playingPreset&&(s.noteGainDb+=r)}i.gainDb=n}},t.prototype.channelSetPitchWheel=function(t,e){var i=this.channelInit(t);i.pitchWheel!==e&&(i.pitchWheel=Ct.int32ToUint16(e),this.channelApplyPitch(t,i))},t.prototype.channelSetPerNotePitchWheel=function(t,e,i){var n=this.channelInit(t);n.perNotePitchWheel.has(e)&&n.perNotePitchWheel.get(e)===i||(n.perNotePitchWheel.set(e,i),this.channelApplyPitch(t,n,e))},t.prototype.channelApplyPitch=function(t,e,i){void 0===i&&(i=-1);for(var n=0,r=this._voices;n<r.length;n++){var a=r[n];a.playingChannel!==t||-1===a.playingPreset||-1!=i&&a.playingKey!==i||a.updatePitchRatio(e,this.outSampleRate)}},t.prototype.channelSetPitchRange=function(t,e){var i=this.channelInit(t);i.pitchRange!==e&&(i.pitchRange=e,8192!==i.pitchWheel&&this.channelApplyPitch(t,i))},t.prototype.channelSetTuning=function(t,e){var i=this.channelInit(t);i.tuning!==e&&(i.tuning=e,this.channelApplyPitch(t,i))},t.prototype.channelMidiControl=function(t,e,i){var n=this.channelInit(t);switch(e){case 5:case 96:case 97:case 64:case 65:case 66:case 122:case 124:case 125:case 126:case 127:return;case 38:return n.midiData=Ct.int32ToUint16(16256&n.midiData|i),void(0===n.midiRpn?this.channelSetPitchRange(t,(n.midiData>>7)+.01*(127&n.midiData)):1===n.midiRpn?this.channelSetTuning(t,(0|n.tuning)+(n.midiData-8192)/8192):2===n.midiRpn&&this.channelSetTuning(t,i-64+(n.tuning-(0|n.tuning))));case 7:return n.midiVolume=Ct.int32ToUint16(127&n.midiVolume|i<<7),void this.channelSetVolume(t,Math.pow(n.midiVolume/16383*(n.midiExpression/16383),3));case 39:return n.midiVolume=Ct.int32ToUint16(16256&n.midiVolume|i),void this.channelSetVolume(t,Math.pow(n.midiVolume/16383*(n.midiExpression/16383),3));case 11:return n.midiExpression=Ct.int32ToUint16(127&n.midiExpression|i<<7),void this.channelSetVolume(t,Math.pow(n.midiVolume/16383*(n.midiExpression/16383),3));case 43:return n.midiExpression=Ct.int32ToUint16(16256&n.midiExpression|i),void this.channelSetVolume(t,Math.pow(n.midiVolume/16383*(n.midiExpression/16383),3));case 10:return n.midiPan=Ct.int32ToUint16(127&n.midiPan|i<<7),void this.channelSetPan(t,n.midiPan/16383);case 42:return n.midiPan=Ct.int32ToUint16(16256&n.midiPan|i),void this.channelSetPan(t,n.midiPan/16383);case 6:return n.midiData=Ct.int32ToUint16(127&n.midiData|i<<7),void(0===n.midiRpn?this.channelSetPitchRange(t,(n.midiData>>7)+.01*(127&n.midiData)):1===n.midiRpn?this.channelSetTuning(t,(0|n.tuning)+(n.midiData-8192)/8192):2===n.midiRpn&&6===e&&this.channelSetTuning(t,i-64+(n.tuning-(0|n.tuning))));case 0:return void(n.bank=Ct.int32ToUint16(32768|i));case 32:return void(n.bank=Ct.int32ToUint16((0!=(32768&n.bank)?(127&n.bank)<<7:0)|i));case 101:return void(n.midiRpn=Ct.int32ToUint16(127&(65535===n.midiRpn?0:n.midiRpn)|i<<7));case 100:return void(n.midiRpn=Ct.int32ToUint16(16256&(65535===n.midiRpn?0:n.midiRpn)|i));case 98:case 99:return void(n.midiRpn=65535);case 120:return void this.channelSoundsOffAll(t);case 123:return void this.channelNoteOffAll(t);case 121:return n.midiVolume=n.midiExpression=16383,n.midiPan=8192,n.bank=0,this.channelSetVolume(t,1),this.channelSetPan(t,.5),void this.channelSetPitchRange(t,2)}},t.prototype.channelGetPresetIndex=function(t){return this._channels&&t<this._channels.channelList.length?this._channels.channelList[t].presetIndex:0},t.prototype.channelGetPresetBank=function(t){return this._channels&&t<this._channels.channelList.length?32767&this._channels.channelList[t].bank:0},t.prototype.channelGetPan=function(t){return this._channels&&t<this._channels.channelList.length?this._channels.channelList[t].panOffset-.5:.5},t.prototype.channelGetVolume=function(t){return this._channels&&t<this._channels.channelList.length?ti.decibelsToGain(this._channels.channelList[t].gainDb):1},t.prototype.channelGetPitchWheel=function(t){return this._channels&&t<this._channels.channelList.length?this._channels.channelList[t].pitchWheel:8192},t.prototype.channelGetPitchRange=function(t){return this._channels&&t<this._channels.channelList.length?this._channels.channelList[t].pitchRange:2},t.prototype.channelGetTuning=function(t){return this._channels&&t<this._channels.channelList.length?this._channels.channelList[t].tuning:0},t.prototype.resetPresets=function(){this.presets=[]},t.prototype.loadPresets=function(t,e){for(var i=new Array(t.phdrs.length-1),n=0;n<t.phdrs.length-1;n++){var r=t.phdrs[n],a=0;(M=i[n]=new $e).name=r.presetName,M.bank=r.bank,M.presetNumber=r.preset,M.fontSamples=t.fontSamples;for(var o=0,s=r.presetBagNdx;s<t.phdrs[n+1].presetBagNdx;s++)for(var h=0,c=127,l=0,u=127,p=(_=t.pbags[s]).genNdx;p<t.pbags[s+1].genNdx;p++){if((B=t.pgens[p]).genOper!==ze.GenKeyRange)if(B.genOper!==ze.GenVelRange){if(B.genOper===ze.GenInstrument&&!(B.genAmount.wordAmount>=t.insts.length))for(var d=t.insts[B.genAmount.wordAmount].instBagNdx;d<t.insts[B.genAmount.wordAmount+1].instBagNdx;d++)for(var f=0,y=127,g=0,m=127,b=(N=t.ibags[d]).instGenNdx;b<t.ibags[d+1].instGenNdx;b++){(C=t.igens[b]).genOper!==ze.GenKeyRange?C.genOper!==ze.GenVelRange?53===C.genOper&&y>=h&&f<=c&&m>=l&&g<=u&&o++:(g=C.genAmount.lowByteAmount,m=C.genAmount.highByteAmount):(f=C.genAmount.lowByteAmount,y=C.genAmount.highByteAmount)}}else l=B.genAmount.lowByteAmount,u=B.genAmount.highByteAmount;else h=B.genAmount.lowByteAmount,c=B.genAmount.highByteAmount}M.regions=new Array(o);var v=new ni;v.clear(!0);for(s=r.presetBagNdx;s<t.phdrs[n+1].presetBagNdx;s++){var _=t.pbags[s],w=new ni(v),S=!1;for(p=_.genNdx;p<t.pbags[s+1].genNdx;p++){var B;if((B=t.pgens[p]).genOper===ze.GenInstrument){var T=B.genAmount.wordAmount;if(T>=t.insts.length)continue;var k=new ni;k.clear(!1);var P=t.insts[T];for(d=P.instBagNdx;d<t.insts[T+1].instBagNdx;d++){var N=t.ibags[d],O=new ni(k),x=!1;for(b=N.instGenNdx;b<t.ibags[d+1].instGenNdx;b++){var C;if((C=t.igens[b]).genOper===ze.GenSampleId){if(O.hiKey<w.loKey||O.loKey>w.hiKey)continue;if(O.hiVel<w.loVel||O.loVel>w.hiVel)continue;w.loKey>O.loKey&&(O.loKey=w.loKey),w.hiKey<O.hiKey&&(O.hiKey=w.hiKey),w.loVel>O.loVel&&(O.loVel=w.loVel),w.hiVel<O.hiVel&&(O.hiVel=w.hiVel),O.offset+=w.offset,O.end+=w.end,O.loopStart+=w.loopStart,O.loopEnd+=w.loopEnd,O.transpose+=w.transpose,O.tune+=w.tune,O.pitchKeyTrack+=w.pitchKeyTrack,O.attenuation+=w.attenuation,O.pan+=w.pan,O.ampEnv.delay+=w.ampEnv.delay,O.ampEnv.attack+=w.ampEnv.attack,O.ampEnv.hold+=w.ampEnv.hold,O.ampEnv.decay+=w.ampEnv.decay,O.ampEnv.sustain+=w.ampEnv.sustain,O.ampEnv.release+=w.ampEnv.release,O.modEnv.delay+=w.modEnv.delay,O.modEnv.attack+=w.modEnv.attack,O.modEnv.hold+=w.modEnv.hold,O.modEnv.decay+=w.modEnv.decay,O.modEnv.sustain+=w.modEnv.sustain,O.modEnv.release+=w.modEnv.release,O.initialFilterQ+=w.initialFilterQ,O.initialFilterFc+=w.initialFilterFc,O.modEnvToPitch+=w.modEnvToPitch,O.modEnvToFilterFc+=w.modEnvToFilterFc,O.delayModLFO+=w.delayModLFO,O.freqModLFO+=w.freqModLFO,O.modLfoToPitch+=w.modLfoToPitch,O.modLfoToFilterFc+=w.modLfoToFilterFc,O.modLfoToVolume+=w.modLfoToVolume,O.delayVibLFO+=w.delayVibLFO,O.freqVibLFO+=w.freqVibLFO,O.vibLfoToPitch+=w.vibLfoToPitch,O.ampEnv.envToSecs(!0),O.modEnv.envToSecs(!1),O.delayModLFO=O.delayModLFO<-11950?0:ti.timecents2Secs(O.delayModLFO),O.delayVibLFO=O.delayVibLFO<-11950?0:ti.timecents2Secs(O.delayVibLFO),O.pan<-.5?O.pan=-.5:O.pan>.5&&(O.pan=.5),(O.initialFilterQ<1500||O.initialFilterQ>13500)&&(O.initialFilterQ=0);var F=t.sHdrs[C.genAmount.wordAmount];O.offset+=F.start,O.end+=F.end,O.loopStart+=F.startLoop,O.loopEnd+=F.endLoop,F.endLoop>0&&(O.loopEnd-=1),-1===O.pitchKeyCenter&&(O.pitchKeyCenter=F.originalPitch),O.tune+=F.pitchCorrection,O.sampleRate=F.sampleRate,0!==O.end&&O.end<M.fontSamples.length?O.end++:O.end=M.fontSamples.length,M.regions[a]=new ni(O),a++,x=!0}else O.operator(C.genOper,C.genAmount)}N!==t.ibags[P.instBagNdx]||x||(k=new ni(O))}S=!0}else w.operator(B.genOper,B.genAmount)}_!==t.pbags[r.presetBagNdx]||S||(v=w)}}if(e&&this.presets)for(var L=0,E=i;L<E.length;L++){var M=E[L];this.presets.push(M)}else this.presets=i},t}(),li=function(){function t(){this._listeners=[]}return t.prototype.on=function(t){this._listeners.push(t)},t.prototype.off=function(t){this._listeners=this._listeners.filter((function(e){return e!==t}))},t.prototype.trigger=function(){for(var t=0,e=this._listeners;t<e.length;t++){(0,e[t])()}},t}(),ui=function(){function t(){this._listeners=[]}return t.prototype.on=function(t){this._listeners.push(t)},t.prototype.off=function(t){this._listeners=this._listeners.filter((function(e){return e!==t}))},t.prototype.trigger=function(t){for(var e=0,i=this._listeners;e<i.length;e++){(0,i[e])(t)}},t}(),pi=function(){function t(t){var e=this;this._isSoundFontLoaded=!1,this._isMidiLoaded=!1,this._tickPosition=0,this._timePosition=0,this._metronomeVolume=0,this._countInVolume=0,this.isReady=!1,this.state=Ne.Paused,this.ready=new li,this.readyForPlayback=new li,this.finished=new li,this.soundFontLoaded=new li,this.soundFontLoadFailed=new ui,this.midiLoaded=new li,this.midiLoadFailed=new ui,this.stateChanged=new ui,this.positionChanged=new ui,et.debug("AlphaSynth","Initializing player"),this.state=Ne.Paused,et.debug("AlphaSynth","Creating output"),this.output=t,this.output.ready.on((function(){e.isReady=!0,e.ready.trigger(),e.checkReadyForPlayback()})),this.output.sampleRequest.on((function(){for(var t=new Float32Array(Ce.MicroBufferSize*Ce.MicroBufferCount*Ce.AudioChannels),i=0,n=0;n<Ce.MicroBufferCount&&(e._sequencer.fillMidiEventQueue(),e._synthesizer.synthesize(t,i,Ce.MicroBufferSize),i+=Ce.MicroBufferSize*Ce.AudioChannels,!e._sequencer.isFinished);n++);i<t.length&&(t=t.subarray(0,i)),e.output.addSamples(t)})),this.output.samplesPlayed.on(this.onSamplesPlayed.bind(this)),et.debug("AlphaSynth","Creating synthesizer"),this._synthesizer=new ci(this.output.sampleRate),this._sequencer=new Ee(this._synthesizer),et.debug("AlphaSynth","Opening output"),this.output.open()}return Object.defineProperty(t.prototype,"isReadyForPlayback",{get:function(){return this.isReady&&this._isSoundFontLoaded&&this._isMidiLoaded},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"logLevel",{get:function(){return et.logLevel},set:function(t){et.logLevel=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"masterVolume",{get:function(){return this._synthesizer.masterVolume},set:function(t){t=ti.clamp(t,Ce.MinVolume,Ce.MaxVolume),this._synthesizer.masterVolume=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metronomeVolume",{get:function(){return this._metronomeVolume},set:function(t){t=ti.clamp(t,Ce.MinVolume,Ce.MaxVolume),this._metronomeVolume=t,this._synthesizer.metronomeVolume=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"countInVolume",{get:function(){return this._countInVolume},set:function(t){t=ti.clamp(t,Ce.MinVolume,Ce.MaxVolume),this._countInVolume=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playbackSpeed",{get:function(){return this._sequencer.playbackSpeed},set:function(t){t=ti.clamp(t,Ce.MinPlaybackSpeed,Ce.MaxPlaybackSpeed);var e=this._sequencer.playbackSpeed;this._sequencer.playbackSpeed=t,this.updateTimePosition(this._timePosition*(e/t))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tickPosition",{get:function(){return this._tickPosition},set:function(t){this.timePosition=this._sequencer.tickPositionToTimePosition(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"timePosition",{get:function(){return this._timePosition},set:function(t){et.debug("AlphaSynth","Seeking to position "+t+"ms"),this._sequencer.seek(t),this.updateTimePosition(t),this.output.resetSamples()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playbackRange",{get:function(){return this._sequencer.playbackRange},set:function(t){this._sequencer.playbackRange=t,t&&(this.tickPosition=t.startTick)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLooping",{get:function(){return this._sequencer.isLooping},set:function(t){this._sequencer.isLooping=t},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){et.debug("AlphaSynth","Destroying player"),this.stop()},t.prototype.play=function(){return!(this.state!==Ne.Paused||!this._isMidiLoaded)&&(this.output.activate(),this.playInternal(),this._countInVolume>0&&(et.debug("AlphaSynth","Starting countin"),this._sequencer.startCountIn(),this._synthesizer.setupMetronomeChannel(this._countInVolume),this.tickPosition=0),this.output.play(),!0)},t.prototype.playInternal=function(){et.debug("AlphaSynth","Starting playback"),this._synthesizer.setupMetronomeChannel(this.metronomeVolume),this.state=Ne.Playing,this.stateChanged.trigger(new Ae(this.state,!1))},t.prototype.pause=function(){this.state!==Ne.Paused&&this._isMidiLoaded&&(et.debug("AlphaSynth","Pausing playback"),this.state=Ne.Paused,this.stateChanged.trigger(new Ae(this.state,!1)),this.output.pause(),this._synthesizer.noteOffAll(!1))},t.prototype.playPause=function(){this.state===Ne.Paused&&this._isMidiLoaded?this.play():this.pause()},t.prototype.stop=function(){this._isMidiLoaded&&(et.debug("AlphaSynth","Stopping playback"),this.state=Ne.Paused,this.output.pause(),this._sequencer.stop(),this._synthesizer.noteOffAll(!0),this.tickPosition=this._sequencer.playbackRange?this._sequencer.playbackRange.startTick:0,this.stateChanged.trigger(new Ae(this.state,!0)))},t.prototype.playOneTimeMidiFile=function(t){this.pause(),this._sequencer.loadOneTimeMidi(t),this._sequencer.stop(),this._synthesizer.noteOffAll(!0),this.tickPosition=0,this.output.play()},t.prototype.resetSoundFonts=function(){this.stop(),this._synthesizer.resetPresets(),this._isSoundFontLoaded=!1,this.soundFontLoaded.trigger()},t.prototype.loadSoundFont=function(t,e){this.pause();var i=At.fromBuffer(t);try{et.debug("AlphaSynth","Loading soundfont from bytes");var n=new Ge;n.load(i),this._synthesizer.loadPresets(n,e),this._isSoundFontLoaded=!0,this.soundFontLoaded.trigger(),et.debug("AlphaSynth","soundFont successfully loaded"),this.checkReadyForPlayback()}catch(t){et.error("AlphaSynth","Could not load soundfont from bytes "+t),this.soundFontLoadFailed.trigger(t)}},t.prototype.checkReadyForPlayback=function(){this.isReadyForPlayback&&(this._synthesizer.setupMetronomeChannel(this.metronomeVolume),this.readyForPlayback.trigger())},t.prototype.loadMidiFile=function(t){this.stop();try{et.debug("AlphaSynth","Loading midi from model"),this._sequencer.loadMidi(t),this._isMidiLoaded=!0,this.midiLoaded.trigger(),et.debug("AlphaSynth","Midi successfully loaded"),this.checkReadyForPlayback(),this.tickPosition=0}catch(t){et.error("AlphaSynth","Could not load midi from model "+t),this.midiLoadFailed.trigger(t)}},t.prototype.setChannelMute=function(t,e){this._synthesizer.channelSetMute(t,e)},t.prototype.resetChannelStates=function(){this._synthesizer.resetChannelStates()},t.prototype.setChannelSolo=function(t,e){this._synthesizer.channelSetSolo(t,e)},t.prototype.setChannelVolume=function(t,e){e=ti.clamp(e,Ce.MinVolume,Ce.MaxVolume),this._synthesizer.channelSetMixVolume(t,e)},t.prototype.onSamplesPlayed=function(t){var e=t/this._synthesizer.outSampleRate*1e3;this.updateTimePosition(this._timePosition+e),this.checkForFinish()},t.prototype.checkForFinish=function(){var t=0,e=0;this.playbackRange?(t=this.playbackRange.startTick,e=this.playbackRange.endTick):e=this._sequencer.endTick,this._tickPosition>=e&&(et.debug("AlphaSynth","Finished playback"),this._sequencer.isPlayingCountIn?(this._sequencer.resetCountIn(),this.timePosition=this._sequencer.currentTime,this.playInternal()):this._sequencer.isPlayingOneTimeMidi?(this._sequencer.resetOneTimeMidi(),this.state=Ne.Paused,this.output.pause(),this._synthesizer.noteOffAll(!1)):(this.finished.trigger(),this.isLooping?this.tickPosition=t:this.stop()))},t.prototype.updateTimePosition=function(t){var e=this._timePosition=t,i=this._tickPosition=this._sequencer.timePositionToTickPosition(e),n=this._sequencer.endTime,r=this._sequencer.endTick;this._sequencer.isPlayingOneTimeMidi||this._sequencer.isPlayingCountIn||(et.debug("AlphaSynth","Position changed: (time: "+e+"/"+n+", tick: "+i+"/"+r+", Active Voices: "+this._synthesizer.activeVoiceCount),this.positionChanged.trigger(new Ie(e,n,i,r)))},t}(),di=function(){function t(){this.division=z.QuarterTime,this.events=[]}return t.prototype.addEvent=function(t){if(0===this.events.length)this.events.push(t);else{for(var e=this.events.length;e>0;){if(!(this.events[e-1].tick>t.tick))break;e--}this.events.splice(e,0,t)}},t.prototype.toBinary=function(){var t=At.empty();return this.writeTo(t),t.toArray()},t.prototype.writeTo=function(e){var i=new Uint8Array([77,84,104,100]);e.write(i,0,i.length),i=new Uint8Array([0,0,0,6]),e.write(i,0,i.length),i=new Uint8Array([0,0]),e.write(i,0,i.length);var n=1;i=new Uint8Array([n>>8&255,255&n]),e.write(i,0,i.length),n=this.division,i=new Uint8Array([n>>8&255,255&n]),e.write(i,0,i.length);for(var r=At.empty(),a=0,o=0,s=this.events;o<s.length;o++){var h=s[o],c=h.tick-a;t.writeVariableInt(r,c),h.writeTo(r),a=h.tick}i=new Uint8Array([77,84,114,107]),e.write(i,0,i.length);var l=r.toArray(),u=l.length;i=new Uint8Array([u>>24&255,u>>16&255,u>>8&255,255&u]),e.write(i,0,i.length),e.write(l,0,l.length)},t.writeVariableInt=function(t,e){var i=new Uint8Array(4),n=0;do{i[n++]=127&e,e>>=7}while(e>0);for(;n>0;)--n>0?t.writeByte(128|i[n]):t.writeByte(i[n])},t}(),fi=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),yi=function(t){function e(e,i,n,r){var a=t.call(this,e,i,n,0)||this;return a.data=r,a}return fi(e,t),e.prototype.writeTo=function(t){t.writeByte(255),t.writeByte(this.metaStatus);var e=this.data.length;di.writeVariableInt(t,e),t.write(this.data,0,this.data.length)},e}(Oe),gi=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),mi=function(t){function e(e,i,n,r){var a=t.call(this,e,i,n,0)||this;return a.value=r,a}return gi(e,t),e.prototype.writeTo=function(t){t.writeByte(255),t.writeByte(this.metaStatus),di.writeVariableInt(t,3);var e=new Uint8Array([this.value>>16&255,this.value>>8&255,255&this.value]);t.write(e,0,e.length)},e}(Oe),bi=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();!function(t){t[t.SystemExclusive=240]="SystemExclusive",t[t.MtcQuarterFrame=241]="MtcQuarterFrame",t[t.SongPosition=242]="SongPosition",t[t.SongSelect=243]="SongSelect",t[t.TuneRequest=246]="TuneRequest",t[t.SystemExclusive2=247]="SystemExclusive2"}(ri||(ri={}));var vi,_i=function(t){function e(e,i,n,r){return t.call(this,e,i,n,r)||this}return bi(e,t),Object.defineProperty(e.prototype,"channel",{get:function(){return-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"command",{get:function(){return 255&this.message},enumerable:!1,configurable:!0}),e}(ke),wi=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Si=function(t){function e(e,i,n,r){var a=t.call(this,e,i,255&n,n>>8&255)||this;return a.data=r,a}return wi(e,t),Object.defineProperty(e.prototype,"manufacturerId",{get:function(){return this.message>>8},enumerable:!1,configurable:!0}),e.prototype.writeTo=function(t){t.writeByte(240);var e=this.data.length+2;t.writeByte(this.manufacturerId);var i=new Uint8Array([e>>24&255,e>>16&255,e>>8&255,255&e]);t.write(i,0,i.length),t.writeByte(247)},e}(_i),Bi=function(){function t(){this.encoding="utf-8",this.mergePartGroupsInMusicXml=!1}return t.toJson=function(t){var e={};return t.fillToJson(e),e},t.prototype.fillToJson=function(t){t.encoding=this.encoding,t.mergePartGroupsInMusicXml=this.mergePartGroupsInMusicXml},t.fromJson=function(e){if(!e)return null;var i=new t;return i.fillFromJson(e),i},t.prototype.fillFromJson=function(t){if(t)for(var e in t)this.setProperty(e.toLowerCase(),t[e])},t.prototype.setProperty=function(t,e){switch(t){case"encoding":return this.encoding=e,!0;case"mergepartgroupsinmusicxml":return this.mergePartGroupsInMusicXml=e,!0}return!1},t}();(vi=t.ScrollMode||(t.ScrollMode={}))[vi.Off=0]="Off",vi[vi.Continuous=1]="Continuous",vi[vi.OffScreen=2]="OffScreen";var Ti,ki=function(){function t(){this.noteWideLength=480,this.noteWideAmplitude=2,this.noteSlightLength=480,this.noteSlightAmplitude=2,this.beatWideLength=240,this.beatWideAmplitude=3,this.beatSlightLength=240,this.beatSlightAmplitude=3}return t.toJson=function(t){var e={};return t.fillToJson(e),e},t.prototype.fillToJson=function(t){t.noteWideLength=this.noteWideLength,t.noteWideAmplitude=this.noteWideAmplitude,t.noteSlightLength=this.noteSlightLength,t.noteSlightAmplitude=this.noteSlightAmplitude,t.beatWideLength=this.beatWideLength,t.beatWideAmplitude=this.beatWideAmplitude,t.beatSlightLength=this.beatSlightLength,t.beatSlightAmplitude=this.beatSlightAmplitude},t.fromJson=function(e){if(!e)return null;var i=new t;return i.fillFromJson(e),i},t.prototype.fillFromJson=function(t){if(t)for(var e in t)this.setProperty(e.toLowerCase(),t[e])},t.prototype.setProperty=function(t,e){switch(t){case"notewidelength":return this.noteWideLength=e,!0;case"notewideamplitude":return this.noteWideAmplitude=e,!0;case"noteslightlength":return this.noteSlightLength=e,!0;case"noteslightamplitude":return this.noteSlightAmplitude=e,!0;case"beatwidelength":return this.beatWideLength=e,!0;case"beatwideamplitude":return this.beatWideAmplitude=e,!0;case"beatslightlength":return this.beatSlightLength=e,!0;case"beatslightamplitude":return this.beatSlightAmplitude=e,!0}return!1},t}(),Pi=function(){function t(){this.simpleSlidePitchOffset=6,this.simpleSlideDurationRatio=.25,this.shiftSlideDurationRatio=.5}return t.toJson=function(t){var e={};return t.fillToJson(e),e},t.prototype.fillToJson=function(t){t.simpleSlidePitchOffset=this.simpleSlidePitchOffset,t.simpleSlideDurationRatio=this.simpleSlideDurationRatio,t.shiftSlideDurationRatio=this.shiftSlideDurationRatio},t.fromJson=function(e){if(!e)return null;var i=new t;return i.fillFromJson(e),i},t.prototype.fillFromJson=function(t){if(t)for(var e in t)this.setProperty(e.toLowerCase(),t[e])},t.prototype.setProperty=function(t,e){switch(t){case"simpleslidepitchoffset":return this.simpleSlidePitchOffset=e,!0;case"simpleslidedurationratio":return this.simpleSlideDurationRatio=e,!0;case"shiftslidedurationratio":return this.shiftSlideDurationRatio=e,!0}return!1},t}(),Ni=function(){function e(){this.soundFont=null,this.scrollElement="html,body",this.enablePlayer=!1,this.enableCursor=!0,this.enableUserInteraction=!0,this.scrollOffsetX=0,this.scrollOffsetY=0,this.scrollMode=t.ScrollMode.Continuous,this.scrollSpeed=300,this.songBookBendDuration=75,this.songBookDipDuration=150,this.vibrato=new ki,this.slide=new Pi,this.playTripletFeel=!0}return e.toJson=function(t){var e={};return t.fillToJson(e),e},e.prototype.fillToJson=function(t){t.soundFont=this.soundFont,t.scrollElement=this.scrollElement,t.enablePlayer=this.enablePlayer,t.enableCursor=this.enableCursor,t.enableUserInteraction=this.enableUserInteraction,t.scrollOffsetX=this.scrollOffsetX,t.scrollOffsetY=this.scrollOffsetY,t.scrollMode=this.scrollMode,t.scrollSpeed=this.scrollSpeed,t.songBookBendDuration=this.songBookBendDuration,t.songBookDipDuration=this.songBookDipDuration,t.vibrato?this.vibrato.fillToJson(t.vibrato):t.vibrato=ki.toJson(this.vibrato),t.slide?this.slide.fillToJson(t.slide):t.slide=Pi.toJson(this.slide),t.playTripletFeel=this.playTripletFeel},e.fromJson=function(t){if(!t)return null;var i=new e;return i.fillFromJson(t),i},e.prototype.fillFromJson=function(t){if(t)for(var e in t)this.setProperty(e.toLowerCase(),t[e])},e.prototype.setProperty=function(e,i){switch(e){case"soundfont":return this.soundFont=i,!0;case"scrollelement":return this.scrollElement=i,!0;case"enableplayer":return this.enablePlayer=i,!0;case"enablecursor":return this.enableCursor=i,!0;case"enableuserinteraction":return this.enableUserInteraction=i,!0;case"scrolloffsetx":return this.scrollOffsetX=i,!0;case"scrolloffsety":return this.scrollOffsetY=i,!0;case"scrollmode":return this.scrollMode=isNaN(parseInt(i))?t.ScrollMode[Object.keys(t.ScrollMode).find((function(t){return t.toLowerCase()===i.toLowerCase()}))]:parseInt(i),!0;case"scrollspeed":return this.scrollSpeed=i,!0;case"songbookbendduration":return this.songBookBendDuration=i,!0;case"songbookdipduration":return this.songBookDipDuration=i,!0;case"playtripletfeel":return this.playTripletFeel=i,!0}if(["vibrato"].indexOf(e)>=0)return this.vibrato?this.vibrato.fillFromJson(i):this.vibrato=ki.fromJson(i),!0;for(var n=0,r=["vibrato"];n<r.length;n++){var a=r[n];if(0===e.indexOf(a)&&(this.vibrato||(this.vibrato=new ki),this.vibrato.setProperty(e.substring(a.length),i)))return!0}if(["slide"].indexOf(e)>=0)return this.slide?this.slide.fillFromJson(i):this.slide=Pi.fromJson(i),!0;for(var o=0,s=["slide"];o<s.length;o++){a=s[o];if(0===e.indexOf(a)&&(this.slide||(this.slide=new Pi),this.slide.setProperty(e.substring(a.length),i)))return!0}return!1},e}(),Oi=function(){function e(){this.core=new Qh,this.display=new T,this.notation=new f,this.importer=new Bi,this.player=new Ni}return e.prototype.fillFromDataAttributes=function(t){var e=this;t.forEach((function(t,i){e.setProperty(i.toLowerCase(),t)}))},e.prototype.setSongBookModeSettings=function(){this.notation.notationMode=t.NotationMode.SongBook,this.notation.smallGraceTabNotes=!1,this.notation.fingeringMode=t.FingeringMode.SingleNoteEffectBand,this.notation.extendBendArrowsOnTiedNotes=!1,this.notation.elements.set(h.ParenthesisOnTiedBends,!1),this.notation.elements.set(h.TabNotesOnTiedBends,!1),this.notation.elements.set(h.ZerosOnDiveWhammys,!0)},Object.defineProperty(e,"songBook",{get:function(){var t=new e;return t.setSongBookModeSettings(),t},enumerable:!1,configurable:!0}),e.toJson=function(t){var e={};return t.fillToJson(e),e},e.prototype.fillToJson=function(t){t.core?this.core.fillToJson(t.core):t.core=Qh.toJson(this.core),t.display?this.display.fillToJson(t.display):t.display=T.toJson(this.display),t.notation?this.notation.fillToJson(t.notation):t.notation=f.toJson(this.notation),t.importer?this.importer.fillToJson(t.importer):t.importer=Bi.toJson(this.importer),t.player?this.player.fillToJson(t.player):t.player=Ni.toJson(this.player)},e.fromJson=function(t){if(!t)return null;var i=new e;return i.fillFromJson(t),i},e.prototype.fillFromJson=function(t){if(t)for(var e in t)this.setProperty(e.toLowerCase(),t[e])},e.prototype.setProperty=function(t,e){if(["core",""].indexOf(t)>=0)return this.core?this.core.fillFromJson(e):this.core=Qh.fromJson(e),!0;for(var i=0,n=["core",""];i<n.length;i++){var r=n[i];if(0===t.indexOf(r)&&(this.core||(this.core=new Qh),this.core.setProperty(t.substring(r.length),e)))return!0}if(["display",""].indexOf(t)>=0)return this.display?this.display.fillFromJson(e):this.display=T.fromJson(e),!0;for(var a=0,o=["display",""];a<o.length;a++){r=o[a];if(0===t.indexOf(r)&&(this.display||(this.display=new T),this.display.setProperty(t.substring(r.length),e)))return!0}if(["notation"].indexOf(t)>=0)return this.notation?this.notation.fillFromJson(e):this.notation=f.fromJson(e),!0;for(var s=0,h=["notation"];s<h.length;s++){r=h[s];if(0===t.indexOf(r)&&(this.notation||(this.notation=new f),this.notation.setProperty(t.substring(r.length),e)))return!0}if(["importer"].indexOf(t)>=0)return this.importer?this.importer.fillFromJson(e):this.importer=Bi.fromJson(e),!0;for(var c=0,l=["importer"];c<l.length;c++){r=l[c];if(0===t.indexOf(r)&&(this.importer||(this.importer=new Bi),this.importer.setProperty(t.substring(r.length),e)))return!0}if(["player"].indexOf(t)>=0)return this.player?this.player.fillFromJson(e):this.player=Ni.fromJson(e),!0;for(var u=0,p=["player"];u<p.length;u++){r=p[u];if(0===t.indexOf(r)&&(this.player||(this.player=new Ni),this.player.setProperty(t.substring(r.length),e)))return!0}return!1},e}(),xi=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ci=function(t){function e(e,i,n,r){var a=t.call(this,e,i,0,0)||this;return a.noteKey=n,a.pitch=r,a}return xi(e,t),e.prototype.writeTo=function(t){var e=new Uint8Array([64,255&this.message,255&this.noteKey,0,this.pitch>>24&255,this.pitch>>16&255,this.pitch>>8&255,255&this.pitch]);t.write(e,0,e.length)},e}(ke),Fi=function(){function t(){}return t.scoreToJson=function(e){var i=t.scoreToJsObject(e);return JSON.stringify(i,(function(t,e){return ArrayBuffer.isView(e)?Array.apply([],[e]):e}))},t.scoreToJsObject=function(e){var i={};return bt.copyTo(e,i),i.masterBars=[],i.tracks=[],i.stylesheet={},gt.copyTo(e.stylesheet,i.stylesheet),t.masterBarsToJsObject(e,i),t.tracksToJsObject(e,i),i},t.tracksToJsObject=function(e,i){for(var n=0;n<e.tracks.length;n++){var r=e.tracks[n],a={color:{}};St.copyTo(r,a),a.playbackInfo={},_t.copyTo(r.playbackInfo,a.playbackInfo),a.percussionArticulations=[];for(var o=0,s=r.percussionArticulations;o<s.length;o++){var h=s[o],c={};rt.copyTo(h,c),a.percussionArticulations.push(c)}t.stavesToJsObject(r,a),i.tracks.push(a)}},t.stavesToJsObject=function(e,i){i.staves=[];for(var n=function(n){var r=e.staves[n],a={};wt.copyTo(r,a),a.chords=new Map,r.chords.forEach((function(t,e){var i={};lt.copyTo(t,i),a.chords.set(e,i)})),t.barsToJsObject(r,a),i.staves.push(a)},r=0;r<e.staves.length;r++)n(r)},t.barsToJsObject=function(e,i){i.bars=[];for(var n=0;n<e.bars.length;n++){var r=e.bars[n],a={};U.copyTo(r,a),t.voicesToJsObject(r,a),i.bars.push(a)}},t.voicesToJsObject=function(e,i){i.voices=[];for(var n=0;n<e.voices.length;n++){var r=e.voices[n],a={};kt.copyTo(r,a),t.beatsToJsObject(r,a),i.voices.push(a)}},t.beatsToJsObject=function(e,i){i.beats=[];for(var n=0;n<e.beats.length;n++){var r=e.beats[n],a={};ct.copyTo(r,a),a.automations=[];for(var o=0;o<r.automations.length;o++){var s={};F.copyTo(r.automations[o],s),a.automations.push(s)}a.whammyBarPoints=[];for(var h=0;h<r.whammyBarPoints.length;h++){var c={};X.copyTo(r.whammyBarPoints[h],c),a.whammyBarPoints.push(c)}t.notesToJsObject(r,a),i.beats.push(a)}},t.notesToJsObject=function(t,e){e.notes=[];for(var i=0;i<t.notes.length;i++){var n=t.notes[i],r={},a=r;ot.copyTo(n,a),n.isTieDestination&&(r.tieOriginId=n.tieOrigin.id),n.isTieOrigin&&(r.tieDestinationId=n.tieDestination.id),n.isSlurDestination&&(r.slurOriginId=n.slurOrigin.id),n.isSlurOrigin&&(r.slurDestinationId=n.slurDestination.id),n.isHammerPullDestination&&(r.hammerPullOriginId=n.hammerPullOrigin.id),n.isHammerPullOrigin&&(r.hammerPullDestinationId=n.hammerPullDestination.id),a.bendPoints=[];for(var o=0;o<n.bendPoints.length;o++){var s={};X.copyTo(n.bendPoints[o],s),a.bendPoints.push(s)}e.notes.push(a)}},t.masterBarsToJsObject=function(t,e){for(var i=function(i){var n=t.masterBars[i],r={};yt.copyTo(n,r),n.tempoAutomation&&(r.tempoAutomation={},F.copyTo(n.tempoAutomation,r.tempoAutomation)),n.section&&(r.section={},vt.copyTo(n.section,r.section)),r.fermata=new Map,n.fermata.forEach((function(t,e){var i={};r.fermata.set(e,i),Vt.copyTo(t,i)})),e.masterBars.push(r)},n=0;n<t.masterBars.length;n++)i(n)},t.jsonToScore=function(e,i){return t.jsObjectToScore(t.jsObjectToScore(JSON.parse(e),i),i)},t.jsObjectToScore=function(e,i){var n=e,r=new bt;bt.copyTo(n,r),gt.copyTo(n.stylesheet,r.stylesheet);var a=new Map,o=[];t.jsObjectToMasterBars(n,r),t.jsObjectToTracks(n,r,a,o);for(var s=0,h=o;s<h.length;s++){var c=h[s],l=c;void 0!==l.tieOriginId&&(c.tieOrigin=a.get(l.tieOriginId)),void 0!==l.tieDestinationId&&(c.tieDestination=a.get(l.tieDestinationId)),void 0!==l.slurOriginId&&(c.slurOrigin=a.get(l.slurOriginId)),void 0!==l.slurDestinationId&&(c.slurDestination=a.get(l.slurDestinationId)),void 0!==l.hammerPullOriginId&&(c.hammerPullOrigin=a.get(l.hammerPullOriginId)),void 0!==l.hammerPullDestinationId&&(c.hammerPullDestination=a.get(l.hammerPullDestinationId))}return r.finish(null!=i?i:new Oi),r},t.jsObjectToTracks=function(e,i,n,r){for(var a=0;a<e.tracks.length;a++){var o=e.tracks[a],s=new St;s.ensureStaveCount(o.staves.length),St.copyTo(o,s),i.addTrack(s),_t.copyTo(o.playbackInfo,s.playbackInfo);for(var h=0,c=o.percussionArticulations;h<c.length;h++){var l=c[h],u=new rt;rt.copyTo(l,u),s.percussionArticulations.push(u)}t.jsObjectToStaves(o,s,n,r)}},t.jsObjectToStaves=function(e,i,n,r){for(var a=function(a){var o=e.staves[a],s=i.staves[a];wt.copyTo(o,s),t.jsObjectMapForEach(o.chords,(function(t,e){var i=new lt;lt.copyTo(t,i),s.addChord(e,i)})),t.jsObjectToBars(o,s,n,r)},o=0;o<e.staves.length;o++)a(o)},t.jsObjectMapForEach=function(t,e){if("forEach"in t)t.forEach(e);else for(var i in t)t.hasOwnProperty(i)&&e(t[i],i)},t.jsObjectToBars=function(e,i,n,r){for(var a=0;a<e.bars.length;a++){var o=e.bars[a],s=new U;U.copyTo(o,s),i.addBar(s),t.jsObjectToVoices(o,s,n,r)}},t.jsObjectToVoices=function(e,i,n,r){for(var a=0;a<e.voices.length;a++){var o=e.voices[a],s=new kt;kt.copyTo(o,s),i.addVoice(s),t.jsObjectToBeats(o,s,n,r)}},t.jsObjectToBeats=function(e,i,n,r){for(var a=0;a<e.beats.length;a++){var o=e.beats[a],s=new ct;ct.copyTo(o,s),i.addBeat(s);for(var h=0;h<o.automations.length;h++){var c=new F;F.copyTo(o.automations[h],c),s.automations.push(c)}for(var l=0;l<o.whammyBarPoints.length;l++){var u=new X(0,0);X.copyTo(o.whammyBarPoints[l],u),s.addWhammyBarPoint(u)}t.jsObjectToNotes(o,s,n,r)}},t.jsObjectToNotes=function(t,e,i,n){for(var r=0;r<t.notes.length;r++){var a=t.notes[r],o=new ot;ot.copyTo(a,o),e.addNote(o),i.set(o.id,o);var s=a,h=o;void 0!==s.tieOriginId&&(h.tieOriginId=s.tieOriginId,n.push(o)),void 0!==s.tieDestinationId&&(h.tieDestinationId=s.tieDestinationId,n.push(o)),void 0!==s.slurOriginId&&(h.slurOriginId=s.slurOriginId,n.push(o)),void 0!==s.slurDestinationId&&(h.slurDestinationId=s.slurDestinationId,n.push(o)),void 0!==s.hammerPullOriginId&&(h.hammerPullOriginId=s.hammerPullOriginId,n.push(o)),void 0!==s.hammerPullDestinationId&&(h.hammerPullDestinationId=s.hammerPullDestinationId,n.push(o));for(var c=0;c<a.bendPoints.length;c++){var l=new X(0,0);X.copyTo(a.bendPoints[c],l),o.addBendPoint(l)}}},t.jsObjectToMasterBars=function(e,i){for(var n=function(n){var r=e.masterBars[n],a=new yt;yt.copyTo(r,a),r.tempoAutomation&&(a.tempoAutomation=new F,F.copyTo(r.tempoAutomation,a.tempoAutomation)),r.section&&(a.section=new vt,vt.copyTo(r.section,a.section)),t.jsObjectMapForEach(r.fermata,(function(t,e){var i=new Vt;Vt.copyTo(t,i),a.addFermata("string"==typeof e?parseInt(e):e,i)})),i.addMasterBar(a)},r=0;r<e.masterBars.length;r++)n(r)},t.jsObjectToMidiFile=function(t){var e=new di;e.division=t.division;for(var i=0,n=t.events;i<n.length;i++){var r=n[i],a=r.tick,o=r.message,s=void 0;switch(r.type){case"SystemExclusiveEvent":(s=new Si(a,0,0,r.data)).message=o;break;case"MetaDataEvent":(s=new yi(a,0,0,r.data)).message=o;break;case"MetaNumberEvent":(s=new mi(a,0,0,r.value)).message=o;break;case"Midi20PerNotePitchBendEvent":(s=new Ci(a,0,r.noteKey,r.pitch)).message=o;break;default:(s=new ke(a,0,0,0)).message=o}e.events.push(s)}return e},t.midiFileToJsObject=function(t){var e={};e.division=t.division;var i=[];e.events=i;for(var n=0,r=t.events;n<r.length;n++){var a=r[n],o={};i.push(o),o.tick=a.tick,o.message=a.message,a instanceof Si?(o.type="SystemExclusiveEvent",o.data=a.data):a instanceof yi?(o.type="MetaDataEvent",o.data=a.data):a instanceof mi?(o.type="MetaNumberEvent",o.value=a.value):a instanceof Ci&&(o.type="Midi20PerNotePitchBendEvent",o.noteKey=a.noteKey,o.pitch=a.pitch)}return e},t}(),Li=function(){function t(){this.ready=new li,this.samplesPlayed=new ui,this.sampleRequest=new li}return Object.defineProperty(t.prototype,"sampleRate",{get:function(){return t.preferredSampleRate},enumerable:!1,configurable:!0}),t.prototype.open=function(){et.debug("AlphaSynth","Initializing webworker worker"),this._worker=qh.globalThis,this._worker.addEventListener("message",this.handleMessage.bind(this)),this.ready.trigger()},t.prototype.handleMessage=function(e){var i=e.data;switch(i.cmd){case t.CmdOutputSampleRequest:this.sampleRequest.trigger();break;case t.CmdOutputSamplesPlayed:this.samplesPlayed.trigger(i.samples)}},t.prototype.addSamples=function(t){this._worker.postMessage({cmd:"alphaSynth.output.addSamples",samples:t})},t.prototype.play=function(){this._worker.postMessage({cmd:"alphaSynth.output.play"})},t.prototype.pause=function(){this._worker.postMessage({cmd:"alphaSynth.output.pause"})},t.prototype.resetSamples=function(){this._worker.postMessage({cmd:"alphaSynth.output.resetSamples"})},t.prototype.activate=function(){},t.CmdOutputPrefix="alphaSynth.output.",t.CmdOutputAddSamples=t.CmdOutputPrefix+"addSamples",t.CmdOutputPlay=t.CmdOutputPrefix+"play",t.CmdOutputPause=t.CmdOutputPrefix+"pause",t.CmdOutputResetSamples=t.CmdOutputPrefix+"resetSamples",t.CmdOutputSampleRequest=t.CmdOutputPrefix+"sampleRequest",t.CmdOutputSamplesPlayed=t.CmdOutputPrefix+"samplesPlayed",t.preferredSampleRate=0,t}(),Ei=function(){function t(t){this._main=t,this._main.addEventListener("message",this.handleMessage.bind(this)),this._player=new pi(new Li),this._player.positionChanged.on(this.onPositionChanged.bind(this)),this._player.stateChanged.on(this.onPlayerStateChanged.bind(this)),this._player.finished.on(this.onFinished.bind(this)),this._player.soundFontLoaded.on(this.onSoundFontLoaded.bind(this)),this._player.soundFontLoadFailed.on(this.onSoundFontLoadFailed.bind(this)),this._player.soundFontLoadFailed.on(this.onSoundFontLoadFailed.bind(this)),this._player.midiLoaded.on(this.onMidiLoaded.bind(this)),this._player.midiLoadFailed.on(this.onMidiLoadFailed.bind(this)),this._player.readyForPlayback.on(this.onReadyForPlayback.bind(this)),this._main.postMessage({cmd:"alphaSynth.ready"})}return t.init=function(){var e=qh.globalThis;e.addEventListener("message",(function(i){var n=i.data;switch(n.cmd){case"alphaSynth.initialize":Li.preferredSampleRate=n.sampleRate,et.logLevel=n.logLevel,qh.globalThis.alphaSynthWebWorker=new t(e)}}))},t.prototype.handleMessage=function(t){var e=t.data;switch(e.cmd){case"alphaSynth.setLogLevel":et.logLevel=e.value;break;case"alphaSynth.setMasterVolume":this._player.masterVolume=e.value;break;case"alphaSynth.setMetronomeVolume":this._player.metronomeVolume=e.value;break;case"alphaSynth.setPlaybackSpeed":this._player.playbackSpeed=e.value;break;case"alphaSynth.setTickPosition":this._player.tickPosition=e.value;break;case"alphaSynth.setTimePosition":this._player.timePosition=e.value;break;case"alphaSynth.setPlaybackRange":this._player.playbackRange=e.value;break;case"alphaSynth.setIsLooping":this._player.isLooping=e.value;break;case"alphaSynth.setCountInVolume":this._player.countInVolume=e.value;break;case"alphaSynth.play":this._player.play();break;case"alphaSynth.pause":this._player.pause();break;case"alphaSynth.playPause":this._player.playPause();break;case"alphaSynth.stop":this._player.stop();break;case"alphaSynth.playOneTimeMidiFile":this._player.playOneTimeMidiFile(Fi.jsObjectToMidiFile(e.midi));break;case"alphaSynth.loadSoundFontBytes":this._player.loadSoundFont(e.data,e.append);break;case"alphaSynth.resetSoundFonts":this._player.resetSoundFonts();break;case"alphaSynth.loadMidi":this._player.loadMidiFile(Fi.jsObjectToMidiFile(e.midi));break;case"alphaSynth.setChannelMute":this._player.setChannelMute(e.channel,e.mute);break;case"alphaSynth.setChannelSolo":this._player.setChannelSolo(e.channel,e.solo);break;case"alphaSynth.setChannelVolume":this._player.setChannelVolume(e.channel,e.volume);break;case"alphaSynth.resetChannelStates":this._player.resetChannelStates()}},t.prototype.onPositionChanged=function(t){this._main.postMessage({cmd:"alphaSynth.positionChanged",currentTime:t.currentTime,endTime:t.endTime,currentTick:t.currentTick,endTick:t.endTick})},t.prototype.onPlayerStateChanged=function(t){this._main.postMessage({cmd:"alphaSynth.playerStateChanged",state:t.state,stopped:t.stopped})},t.prototype.onFinished=function(){this._main.postMessage({cmd:"alphaSynth.finished"})},t.prototype.onSoundFontLoaded=function(){this._main.postMessage({cmd:"alphaSynth.soundFontLoaded"})},t.prototype.onSoundFontLoadFailed=function(t){this._main.postMessage({cmd:"alphaSynth.soundFontLoadFailed",error:this.serializeException(t)})},t.prototype.serializeException=function(t){var e=JSON.parse(JSON.stringify(t));return t.message&&(e.message=t.message),t.stack&&(e.stack=t.stack),t.constructor&&t.constructor.name&&(e.type=t.constructor.name),e},t.prototype.onMidiLoaded=function(){this._main.postMessage({cmd:"alphaSynth.midiLoaded"})},t.prototype.onMidiLoadFailed=function(t){this._main.postMessage({cmd:"alphaSynth.midiLoaded",error:this.serializeException(t)})},t.prototype.onReadyForPlayback=function(){this._main.postMessage({cmd:"alphaSynth.readyForPlayback"})},t}(),Mi=function(){function t(){}return t.generateFontLookup=function(e){if(!t.FontSizeLookupTables.has(e))if(qh.isRunningInWorker)t.FontSizeLookupTables.set(e,new Uint8Array([8]));else{var i=document.createElement("canvas").getContext("2d");i.font="11px "+e;for(var n=[],r=32;r<255;r++){var a=String.fromCharCode(r);n.push(i.measureText(a).width)}var o=new Uint8Array(n);t.FontSizeLookupTables.set(e,o)}},t.measureString=function(e,i,n,r){var a;t.FontSizeLookupTables.has(i)||t.generateFontLookup(i),a=t.FontSizeLookupTables.get(i);var o=1;0!=(r&d.Italic)&&(o*=1.2),0!=(r&d.Bold)&&(o*=1.2);for(var s=0,h=0;h<e.length;h++){var c=Math.min(a.length-1,e.charCodeAt(h)-32);c>=0&&(s+=a[c]*n/11)}return s*o},t.Georgia=new Uint8Array([3,4,5,7,7,9,8,2,4,4,5,7,3,4,3,5,7,5,6,6,6,6,6,6,7,6,3,3,7,7,7,5,10,7,7,7,8,7,7,8,9,4,6,8,7,10,8,8,7,8,8,6,7,8,7,11,8,7,7,4,5,4,7,7,6,6,6,5,6,5,4,6,6,3,3,6,3,10,6,6,6,6,5,5,4,6,5,8,6,5,5,5,4,5,7,6,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,3,4,6,7,6,7,4,6,6,10,6,6,7,0,10,7,5,7,6,6,6,6,6,3,6,6,6,6,12,12,12,5,7,7,7,7,7,7,11,7,7,7,7,7,4,4,4,4,8,8,8,8,8,8,8,7,8,8,8,8,8,7,7,6,6,6,6,6,6,6,8,5,5,5,5,5,3,3,3,3,6,6,6,6,6,6,6,7,6,6,6,6,6,5,6]),t.Arial=new Uint8Array([3,3,4,6,6,10,7,2,4,4,4,6,3,4,3,3,6,6,6,6,6,6,6,6,6,6,3,3,6,6,6,6,11,7,7,8,8,7,7,9,8,3,6,7,6,9,8,9,7,9,8,7,7,8,7,10,7,7,7,3,3,3,5,6,4,6,6,6,6,6,3,6,6,2,2,6,2,9,6,6,6,6,4,6,3,6,6,8,6,6,6,4,3,4,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,6,6,6,6,3,6,4,8,4,6,6,0,8,6,4,6,4,4,4,6,6,4,4,4,4,6,9,9,9,7,7,7,7,7,7,7,11,8,7,7,7,7,3,3,3,3,8,8,9,9,9,9,9,6,9,8,8,8,8,7,7,7,6,6,6,6,6,6,10,6,6,6,6,6,3,3,3,3,6,6,6,6,6,6,6,6,7,6,6,6,6,6,6]),t.FontSizeLookupTables=new Map([["Arial",t.Arial],["'Arial'",t.Arial],['"Arial"',t.Arial],["Georgia",t.Georgia],["'Georgia'",t.Georgia],['"Georgia"',t.Georgia]]),t.ControlChars=32,t}(),Di=function(){this.width=0,this.height=0,this.totalWidth=0,this.totalHeight=0,this.firstMasterBarIndex=0,this.lastMasterBarIndex=0,this.renderResult=null},Ai=function(){function t(){this.beats=[]}return t.prototype.addBeat=function(t){t.barBounds=this,this.beats.push(t),this.masterBarBounds.addBeat(t)},t.prototype.findBeatAtPos=function(t){for(var e=null,i=0,n=this.beats;i<n.length;i++){var r=n[i];if(!e||r.realBounds.x<t)e=r;else if(r.realBounds.x>t)break}return e},t}(),Ii=function(){function t(){this.notes=null}return t.prototype.addNote=function(t){this.notes||(this.notes=[]),t.beatBounds=this,this.notes.push(t)},t.prototype.findNoteAtPos=function(t,e){if(!this.notes)return null;for(var i=0,n=this.notes;i<n.length;i++){var r=n[i],a=r.noteHeadBounds.y+r.noteHeadBounds.h,o=r.noteHeadBounds.x+r.noteHeadBounds.w;if(r.noteHeadBounds.x>=t&&r.noteHeadBounds.y>=e&&t<=o&&e<=a)return r.note}return null},t}(),Ri=function(){function t(){this.index=0,this.isFirstOfLine=!1,this.bars=[]}return t.prototype.addBar=function(t){t.masterBarBounds=this,this.bars.push(t)},t.prototype.findBeatAtPos=function(t,e){for(var i=null,n=0,r=this.bars;n<r.length;n++){var a=r[n].findBeatAtPos(t);a&&(!i||i.realBounds.x<a.realBounds.x)&&(i=a)}return i?i.beat:null},t.prototype.finish=function(){this.bars.sort((function(t,e){return t.realBounds.y<e.realBounds.y?-1:t.realBounds.y>e.realBounds.y?1:t.realBounds.x<e.realBounds.x?-1:t.realBounds.x>e.realBounds.x?1:0}))},t.prototype.addBeat=function(t){this.staveGroupBounds.boundsLookup.addBeat(t)},t}(),Gi=function(){},ji=function(){function t(){this.index=0,this.bars=[]}return t.prototype.finish=function(){for(var t=0,e=this.bars;t<e.length;t++){e[t].finish()}},t.prototype.addBar=function(t){this.boundsLookup.addMasterBar(t),t.staveGroupBounds=this,this.bars.push(t)},t.prototype.findBarAtPos=function(t){for(var e=null,i=0,n=this.bars;i<n.length;i++){var r=n[i];if(!e||r.realBounds.x<t)e=r;else if(t>r.realBounds.x+r.realBounds.w)break}return e},t}(),Vi=function(){function t(){this._beatLookup=new Map,this._masterBarLookup=new Map,this._currentStaveGroup=null,this.staveGroups=[],this.isFinished=!1}return t.prototype.toJson=function(){var t={},e=[];t.staveGroups=e;for(var i=0,n=this.staveGroups;i<n.length;i++){var r=n[i],a={};a.visualBounds=this.boundsToJson(r.visualBounds),a.realBounds=this.boundsToJson(r.realBounds),a.bars=[];for(var o=0,s=r.bars;o<s.length;o++){var h=s[o],c={};c.lineAlignedBounds=this.boundsToJson(h.lineAlignedBounds),c.visualBounds=this.boundsToJson(h.visualBounds),c.realBounds=this.boundsToJson(h.realBounds),c.index=h.index,c.bars=[];for(var l=0,u=h.bars;l<u.length;l++){var p=u[l],d={};d.visualBounds=this.boundsToJson(p.visualBounds),d.realBounds=this.boundsToJson(p.realBounds),d.beats=[];for(var f=0,y=p.beats;f<y.length;f++){var g=y[f],m={};m.visualBounds=this.boundsToJson(g.visualBounds),m.realBounds=this.boundsToJson(g.realBounds);var b=m;if(b.beatIndex=g.beat.index,b.voiceIndex=g.beat.voice.index,b.barIndex=g.beat.voice.bar.index,b.staffIndex=g.beat.voice.bar.staff.index,b.trackIndex=g.beat.voice.bar.staff.track.index,g.notes)for(var v=m.notes=[],_=0,w=g.notes;_<w.length;_++){var S=w[_],B={};B.index=S.note.index,B.noteHeadBounds=this.boundsToJson(S.noteHeadBounds),v.push(B)}d.beats.push(m)}c.bars.push(d)}a.bars.push(c)}e.push(a)}return t},t.fromJson=function(e,i){for(var n=new t,r=0,a=e.staveGroups;r<a.length;r++){var o=a[r],s=new ji;s.visualBounds=o.visualBounds,s.realBounds=o.realBounds,n.addStaveGroup(s);for(var h=0,c=o.bars;h<c.length;h++){var l=c[h],u=new Ri;u.index=l.index,u.isFirstOfLine=l.isFirstOfLine,u.lineAlignedBounds=l.lineAlignedBounds,u.visualBounds=l.visualBounds,u.realBounds=l.realBounds,s.addBar(u);for(var p=0,d=l.bars;p<d.length;p++){var f=d[p],y=new Ai;y.visualBounds=f.visualBounds,y.realBounds=f.realBounds,u.addBar(y);for(var g=0,m=f.beats;g<m.length;g++){var b=m[g],v=new Ii;v.visualBounds=b.visualBounds,v.realBounds=b.realBounds;var _=b;if(v.beat=i.tracks[_.trackIndex].staves[_.staffIndex].bars[_.barIndex].voices[_.voiceIndex].beats[_.beatIndex],b.notes){v.notes=[];for(var w=0,S=b.notes;w<S.length;w++){var B=S[w],T=new Gi,k=B;T.note=v.beat.notes[k.index],T.noteHeadBounds=B.noteHeadBounds,v.addNote(T)}}y.addBeat(v)}}}}return n},t.prototype.boundsToJson=function(t){var e={};return e.x=t.x,e.y=t.y,e.w=t.w,e.h=t.h,e},t.prototype.finish=function(){for(var t=0,e=this.staveGroups;t<e.length;t++){e[t].finish()}this.isFinished=!0},t.prototype.addNote=function(t){this.findBeat(t.note.beat).addNote(t)},t.prototype.addStaveGroup=function(t){t.index=this.staveGroups.length,t.boundsLookup=this,this.staveGroups.push(t),this._currentStaveGroup=t},t.prototype.addMasterBar=function(t){t.staveGroupBounds?this._masterBarLookup.set(t.index,t):(t.staveGroupBounds=this._currentStaveGroup,this._masterBarLookup.set(t.index,t),this._currentStaveGroup.addBar(t))},t.prototype.addBeat=function(t){this._beatLookup.set(t.beat.id,t)},t.prototype.findMasterBarByIndex=function(t){return this._masterBarLookup.has(t)?this._masterBarLookup.get(t):null},t.prototype.findMasterBar=function(t){var e=t.index;return this._masterBarLookup.has(e)?this._masterBarLookup.get(e):null},t.prototype.findBeat=function(t){var e=t.id;return this._beatLookup.has(e)?this._beatLookup.get(e):null},t.prototype.getBeatAtPos=function(t,e){for(var i=0,n=this.staveGroups.length-1,r=-1;i<=n;){var a=(n+i)/2|0,o=this.staveGroups[a];if(e>=o.realBounds.y&&e<=o.realBounds.y+o.realBounds.h){r=a;break}e<o.realBounds.y?n=a-1:i=a+1}if(-1===r)return null;var s=this.staveGroups[r].findBarAtPos(t);return s?s.findBeatAtPos(t,e):null},t.prototype.getNoteAtPos=function(t,e,i){var n=this.findBeat(t);return n?n.findNoteAtPos(e,i):null},t}(),Hi=function(){function e(e){this._currentLayoutMode=t.LayoutMode.Page,this._currentRenderEngine=null,this._renderedTracks=null,this.canvas=null,this.score=null,this.tracks=null,this.layout=null,this.boundsLookup=null,this.width=0,this.preRender=new ui,this.renderFinished=new ui,this.partialRenderFinished=new ui,this.postRenderFinished=new li,this.error=new ui,this.settings=e,this.recreateCanvas(),this.recreateLayout()}return e.prototype.destroy=function(){this.score=null,this.canvas=null,this.layout=null,this.boundsLookup=null,this.tracks=null},e.prototype.recreateCanvas=function(){return this._currentRenderEngine!==this.settings.core.engine&&(this.canvas=qh.getRenderEngineFactory(this.settings).createCanvas(),this._currentRenderEngine=this.settings.core.engine,!0)},e.prototype.recreateLayout=function(){return(!this.layout||this._currentLayoutMode!==this.settings.display.layoutMode)&&(this.layout=qh.getLayoutEngineFactory(this.settings).createLayout(this),this._currentLayoutMode=this.settings.display.layoutMode,!0)},e.prototype.renderScore=function(t,e){try{this.score=t;var i=void 0;if(e){i=[];for(var n=0,r=e;n<r.length;n++){var a=r[n];a>=0&&a<t.tracks.length&&i.push(t.tracks[a])}}else i=t.tracks.slice(0);0===i.length&&t.tracks.length>0&&i.push(t.tracks[0]),this.tracks=i,this.render()}catch(t){this.error.trigger(t)}},e.prototype.renderTracks=function(t){0===t.length?this.score=null:this.score=t[0].score,this.tracks=t,this.render()},e.prototype.updateSettings=function(t){this.settings=t},e.prototype.render=function(){if(0!==this.width){if(this.boundsLookup=new Vi,this.tracks&&0!==this.tracks.length){this.recreateCanvas(),this.canvas.lineWidth=this.settings.display.scale,this.canvas.settings=this.settings,et.debug("Rendering","Rendering "+this.tracks.length+" tracks");for(var t=0;t<this.tracks.length;t++){var e=this.tracks[t];et.debug("Rendering","Track "+t+": "+e.name)}this.preRender.trigger(!1),this.recreateLayout(),this.layoutAndRender(),this._renderedTracks=this.tracks,et.debug("Rendering","Rendering finished")}}else et.warning("Rendering","AlphaTab skipped rendering because of width=0 (element invisible)",null)},e.prototype.resizeRender=function(){this.recreateLayout()||this.recreateCanvas()||this._renderedTracks!==this.tracks||!this.tracks?(et.debug("Rendering","Starting full rerendering due to layout or canvas change",null),this.render()):this.layout.supportsResize?(et.debug("Rendering","Starting optimized rerendering for resize"),this.boundsLookup=new Vi,this.preRender.trigger(!0),this.canvas.settings=this.settings,this.layout.resize(),this.layout.renderAnnotation(),this.onRenderFinished(),this.postRenderFinished.trigger()):et.warning("Rendering","Current layout does not support dynamic resizing, nothing was done",null),et.debug("Rendering","Resize finished")},e.prototype.layoutAndRender=function(){et.debug("Rendering","Rendering at scale "+this.settings.display.scale+" with layout "+this.layout.name,null),this.layout.layoutAndRender(),this.layout.renderAnnotation(),this.onRenderFinished(),this.postRenderFinished.trigger()},e.prototype.onRenderFinished=function(){var t=new Di;t.totalHeight=this.layout.height,t.totalWidth=this.layout.width,t.renderResult=this.canvas.onRenderFinished(),this.renderFinished.trigger(t)},e}(),Wi=function(){function t(t){this._main=t,this._main.addEventListener("message",this.handleMessage.bind(this),!1)}return t.init=function(){qh.globalThis.alphaTabWebWorker=new t(qh.globalThis)},t.prototype.handleMessage=function(t){var e=this,i=t.data;switch(i?i.cmd:""){case"alphaTab.initialize":var n=new Oi;n.fillFromJson(i.settings),et.logLevel=n.core.logLevel,this._renderer=new Hi(n),this._renderer.partialRenderFinished.on((function(t){e._main.postMessage({cmd:"alphaTab.partialRenderFinished",result:t})})),this._renderer.renderFinished.on((function(t){e._main.postMessage({cmd:"alphaTab.renderFinished",result:t})})),this._renderer.postRenderFinished.on((function(){var t,i;e._main.postMessage({cmd:"alphaTab.postRenderFinished",boundsLookup:null!==(i=null===(t=e._renderer.boundsLookup)||void 0===t?void 0:t.toJson())&&void 0!==i?i:null})})),this._renderer.preRender.on((function(t){e._main.postMessage({cmd:"alphaTab.preRender",resize:t})})),this._renderer.error.on(this.error.bind(this));break;case"alphaTab.invalidate":this._renderer.render();break;case"alphaTab.resizeRender":this._renderer.resizeRender();break;case"alphaTab.setWidth":this._renderer.width=i.width;break;case"alphaTab.renderScore":this.updateFontSizes(i.fontSizes);var r=Fi.jsObjectToScore(i.score,this._renderer.settings);this.renderMultiple(r,i.trackIndexes);break;case"alphaTab.updateSettings":this.updateSettings(i.settings)}},t.prototype.updateFontSizes=function(t){if(t)for(var e in Mi.FontSizeLookupTables||(Mi.FontSizeLookupTables=new Map),t)Mi.FontSizeLookupTables.set(e,t[e])},t.prototype.updateSettings=function(t){this._renderer.settings.fillFromJson(t)},t.prototype.renderMultiple=function(t,e){try{this._renderer.renderScore(t,e)}catch(t){this.error(t)}},t.prototype.error=function(t){et.error("Worker","An unexpected error occurred in worker",t),this._main.postMessage({cmd:"alphaTab.error",error:t})},t}(),Ui=function(){function t(){this._canvas=null,this._color=new m(0,0,0,255),this._font=new _("Arial",10,d.Plain),this._lineWidth=0;var t=document.createElement("span");t.classList.add("at"),document.body.appendChild(t);var e=window.getComputedStyle(t),i=e.fontFamily;(i.startsWith('"')||i.startsWith("'"))&&(i=i.substr(1,i.length-2)),this._musicFont=new _(i,parseFloat(e.fontSize),d.Plain),this._measureCanvas=document.createElement("canvas"),this._measureCanvas.width=10,this._measureCanvas.height=10,this._measureCanvas.style.width="10px",this._measureCanvas.style.height="10px",this._measureContext=this._measureCanvas.getContext("2d"),this._measureContext.textBaseline="hanging"}return t.prototype.onRenderFinished=function(){return null},t.prototype.beginRender=function(t,e){this._canvas=document.createElement("canvas"),this._canvas.width=0|t,this._canvas.height=0|e,this._canvas.style.width=t+"px",this._canvas.style.height=e+"px",this._context=this._canvas.getContext("2d"),this._context.textBaseline="hanging",this._context.lineWidth=this._lineWidth},t.prototype.endRender=function(){var t=this._canvas;return this._canvas=null,t},Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(t){this._color.rgba!==t.rgba&&(this._color=t,this._context.strokeStyle=t.rgba,this._context.fillStyle=t.rgba)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this._context&&(this._context.lineWidth=t)},enumerable:!1,configurable:!0}),t.prototype.fillRect=function(t,e,i,n){i>0&&this._context.fillRect(0|t,0|e,i,n)},t.prototype.strokeRect=function(t,e,i,n){this._context.strokeRect(0|t,0|e,i,n)},t.prototype.beginPath=function(){this._context.beginPath()},t.prototype.closePath=function(){this._context.closePath()},t.prototype.moveTo=function(t,e){this._context.moveTo(t,e)},t.prototype.lineTo=function(t,e){this._context.lineTo(t,e)},t.prototype.quadraticCurveTo=function(t,e,i,n){this._context.quadraticCurveTo(t,e,i,n)},t.prototype.bezierCurveTo=function(t,e,i,n,r,a){this._context.bezierCurveTo(t,e,i,n,r,a)},t.prototype.fillCircle=function(t,e,i){this._context.beginPath(),this._context.arc(t,e,i,0,2*Math.PI,!0),this.fill()},t.prototype.strokeCircle=function(t,e,i){this._context.beginPath(),this._context.arc(t,e,i,0,2*Math.PI,!0),this.stroke()},t.prototype.fill=function(){this._context.fill()},t.prototype.stroke=function(){this._context.stroke()},Object.defineProperty(t.prototype,"font",{get:function(){return this._font},set:function(t){this._font=t,this._context&&(this._context.font=t.toCssString(this.settings.display.scale)),this._measureContext.font=t.toCssString(this.settings.display.scale)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textAlign",{get:function(){switch(this._context.textAlign){case"left":return K.Left;case"center":return K.Center;case"right":return K.Right;default:return K.Left}},set:function(t){switch(t){case K.Left:this._context.textAlign="left";break;case K.Center:this._context.textAlign="center";break;case K.Right:this._context.textAlign="right"}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textBaseline",{get:function(){switch(this._context.textBaseline){case"hanging":return Z.Top;case"middle":return Z.Middle;case"bottom":return Z.Bottom;default:return Z.Top}},set:function(t){switch(t){case Z.Top:this._context.textBaseline="hanging";break;case Z.Middle:this._context.textBaseline="middle";break;case Z.Bottom:this._context.textBaseline="bottom"}},enumerable:!1,configurable:!0}),t.prototype.beginGroup=function(t){},t.prototype.endGroup=function(){},t.prototype.fillText=function(t,e,i){this._context.fillText(t,e,i)},t.prototype.measureText=function(t){return this._measureContext.measureText(t).width},t.prototype.fillMusicFontSymbol=function(t,e,i,n,r){void 0===r&&(r=!1),n!==Q.None&&this.fillMusicFontSymbolText(t,e,i,String.fromCharCode(n),r)},t.prototype.fillMusicFontSymbols=function(t,e,i,n,r){void 0===r&&(r=!1);for(var a="",o=0,s=n;o<s.length;o++){var h=s[o];h!==Q.None&&(a+=String.fromCharCode(h))}this.fillMusicFontSymbolText(t,e,i,a,r)},t.prototype.fillMusicFontSymbolText=function(t,e,i,n,r){void 0===r&&(r=!1);var a=this._context.textAlign,o=this._context.textBaseline,s=this._context.font;this._context.font=this._musicFont.toCssString(i),this._context.textBaseline="middle",r&&(this._context.textAlign="center"),this._context.fillText(n,t,e),this._context.textBaseline=o,this._context.font=s,this._context.textAlign=a},t.prototype.beginRotate=function(t,e,i){this._context.save(),this._context.translate(t,e),this._context.rotate(i*Math.PI/180)},t.prototype.endRotate=function(){this._context.restore()},t}(),zi=function(){function t(t){this._midiFile=t}return t.prototype.addTimeSignature=function(t,e,i){for(var n=0;(i>>=1)>0;)n++;var r=new yi(t,255,Te.TimeSignature,new Uint8Array([255&e,255&n,48,8]));this._midiFile.addEvent(r)},t.prototype.addRest=function(t,e,i){var n=new Si(e,ri.SystemExclusive,0,new Uint8Array([255]));this._midiFile.addEvent(n)},t.prototype.addNote=function(e,i,n,r,a,o){var s=z.dynamicToVelocity(a),h=new ke(i,this.makeCommand(he.NoteOn,o),t.fixValue(r),t.fixValue(s));this._midiFile.addEvent(h);var c=new ke(i+n,this.makeCommand(he.NoteOff,o),t.fixValue(r),t.fixValue(s));this._midiFile.addEvent(c)},t.prototype.makeCommand=function(t,e){return 240&t|15&e},t.fixValue=function(t){return t>127?127:t<0?0:t},t.prototype.addControlChange=function(e,i,n,r,a){var o=new ke(i,this.makeCommand(he.Controller,n),t.fixValue(r),t.fixValue(a));this._midiFile.addEvent(o)},t.prototype.addProgramChange=function(e,i,n,r){var a=new ke(i,this.makeCommand(he.ProgramChange,n),t.fixValue(r),0);this._midiFile.addEvent(a)},t.prototype.addTempo=function(t,e){var i=6e7/e|0,n=new mi(t,255,Te.Tempo,i);this._midiFile.addEvent(n)},t.prototype.addBend=function(t,e,i,n){n=n>=Ce.MaxPitchWheel?Ce.MaxPitchWheel:Math.floor(n);var r=new ke(e,this.makeCommand(he.PitchBend,i),127&n,n>>7&127);this._midiFile.addEvent(r)},t.prototype.addNoteBend=function(t,e,i,n,r){r=(r=r>=Ce.MaxPitchWheel?Ce.MaxPitchWheel:Math.floor(r))*Ce.MaxPitchWheel20/Ce.MaxPitchWheel;var a=new Ci(e,this.makeCommand(he.PerNotePitchBend,i),n,r);this._midiFile.addEvent(a)},t.prototype.finishTrack=function(t,e){var i=new yi(e,255,Te.EndOfTrack,new Uint8Array(0));this._midiFile.addEvent(i)},t}(),Xi=function(){function t(){this._highlightedBeats=new Map,this.start=0,this.end=0,this.isEmptyBar=!1,this.beatsToHighlight=[]}return t.prototype.highlightBeat=function(t){this._highlightedBeats.has(t.id)||(this._highlightedBeats.set(t.id,!0),this.beatsToHighlight.push(t))},t}();!function(t){t[t.BankSelectCoarse=0]="BankSelectCoarse",t[t.ModulationCoarse=1]="ModulationCoarse",t[t.DataEntryCoarse=6]="DataEntryCoarse",t[t.VolumeCoarse=7]="VolumeCoarse",t[t.PanCoarse=10]="PanCoarse",t[t.ExpressionControllerCoarse=11]="ExpressionControllerCoarse",t[t.ModulationFine=33]="ModulationFine",t[t.DataEntryFine=38]="DataEntryFine",t[t.VolumeFine=39]="VolumeFine",t[t.PanFine=42]="PanFine",t[t.ExpressionControllerFine=43]="ExpressionControllerFine",t[t.HoldPedal=64]="HoldPedal",t[t.LegatoPedal=68]="LegatoPedal",t[t.NonRegisteredParameterFine=98]="NonRegisteredParameterFine",t[t.NonRegisteredParameterCourse=99]="NonRegisteredParameterCourse",t[t.RegisteredParameterFine=100]="RegisteredParameterFine",t[t.RegisteredParameterCourse=101]="RegisteredParameterCourse",t[t.ResetControllers=121]="ResetControllers",t[t.AllNotesOff=123]="AllNotesOff"}(Ti||(Ti={}));var Yi,Ji=function(){function t(t){this._repeatStartIndex=0,this._repeatNumber=0,this._repeatOpen=!1,this.shouldPlay=!0,this.index=0,this.currentTick=0,this._score=t}return Object.defineProperty(t.prototype,"finished",{get:function(){return this.index>=this._score.masterBars.length},enumerable:!1,configurable:!0}),t.prototype.processCurrent=function(){var t=this._score.masterBars[this.index],e=t.alternateEndings;t.repeatGroup.isClosed||t.repeatGroup.openings[t.repeatGroup.openings.length-1]!==t||(this._repeatNumber=0,this._repeatOpen=!1),!t.isRepeatStart&&0!==t.index||0!==this._repeatNumber?t.isRepeatStart&&(this.shouldPlay=!0):(this._repeatStartIndex=this.index,this._repeatOpen=!0),this._repeatOpen&&e>0&&(0==(e&1<<this._repeatNumber)?this.shouldPlay=!1:this.shouldPlay=!0),this.shouldPlay&&(this.currentTick+=t.calculateDuration())},t.prototype.moveNext=function(){var t=this._score.masterBars[this.index].repeatCount-1;this._repeatOpen&&t>0?this._repeatNumber<t?(this.index=this._repeatStartIndex,this._repeatNumber++):(this._repeatNumber=0,this._repeatOpen=!1,this.shouldPlay=!0,this.index++):this.index++},t}(),qi=function(){function t(){this.start=0,this.end=0,this.tempo=0,this.beats=[],this.nextMasterBar=null}return t.prototype.finish=function(){this.beats.sort((function(t,e){return t.start-e.start}))},t.prototype.addBeat=function(t){this.beats.push(t)},t}(),Qi=function(){this.nextBeat=null,this.duration=0},Ki=function(){function t(){this._currentMasterBar=null,this.masterBarLookup=new Map,this.masterBars=[]}return t.prototype.finish=function(){for(var t=null,e=[],i=0,n=this.masterBars;i<n.length;i++){var r=n[i];r.finish(),t&&(t.nextMasterBar=r);for(var a=0,o=r.beats;a<o.length;a++){for(var s=o[a],h=[],c=0,l=e;c<l.length;c++){var u=l[c];u.end>s.start&&(h.push(u),s.highlightBeat(u.beat),s.start<=u.start&&u.highlightBeat(s.beat))}h.push(s),e=h}t=r}},t.prototype.findBeat=function(t,e){var i=this.findMasterBar(e);if(!i)return null;for(var n=new Map,r=0,a=t;r<a.length;r++){var o=a[r];n.set(o.index,!0)}for(var s=null,h=0,c=i.beats,l=0;l<c.length;l++){var u=c[l];if(n.has(u.beat.voice.bar.staff.track.index))if(u.start<=e&&e<u.end)(!s||s.start<u.start)&&(s=c[l],h=l);else if(u.end>e)break}if(!s)return null;var p=null;for(l=h+1;l<c.length;l++){if((u=c[l]).start>s.start&&n.has(u.beat.voice.bar.staff.track.index)){p=u;break}}if(!p&&i.nextMasterBar){c=i.nextMasterBar.beats;for(l=0;l<c.length;l++){u=c[l];if(n.has(u.beat.voice.bar.staff.track.index)){p=u;break}}}var d=new Qi;return d.currentBeat=s.beat,d.nextBeat=p?p.beat:null,d.duration=p?z.ticksToMillis(p.start-s.start,i.tempo):z.ticksToMillis(s.end-s.start,i.tempo),d.beatsToHighlight=s.beatsToHighlight,d},t.prototype.findMasterBar=function(t){for(var e=this.masterBars,i=0,n=e.length-1;i<=n;){var r=(n+i)/2|0,a=e[r];if(t>=a.start&&t<a.end)return a;t<a.start?n=r-1:i=r+1}return null},t.prototype.getMasterBar=function(t){if(!this.masterBarLookup.has(t.index)){var e=new qi;return e.masterBar=t,e}return this.masterBarLookup.get(t.index)},t.prototype.getMasterBarStart=function(t){return this.masterBarLookup.has(t.index)?this.masterBarLookup.get(t.index).start:0},t.prototype.addMasterBar=function(t){this.masterBars.push(t),this._currentMasterBar=t,this.masterBarLookup.has(t.masterBar.index)||this.masterBarLookup.set(t.masterBar.index,t)},t.prototype.addBeat=function(t){var e;null===(e=this._currentMasterBar)||void 0===e||e.addBeat(t)},t}(),Zi=function(){this.noteOnly=0,this.untilTieOrSlideEnd=0,this.letRingEnd=0},$i=function(){this.firstBeatDuration=0,this.secondBeatStartOffset=0,this.secondBeatDuration=0},tn=function(){function e(t,e,i){this._currentTempo=0,this._currentBarRepeatLookup=null,this.tickLookup=new Ki,this._currentTripletFeel=null,this._score=t,this._settings=e||new Oi,this._currentTempo=this._score.tempo,this._handler=i}return e.prototype.generate=function(){for(var t=0,e=this._score.tracks;t<e.length;t++){var i=e[t];this.generateTrack(i)}et.debug("Midi","Begin midi generation");for(var n=new Ji(this._score),r=null;!n.finished;){var a=n.index,o=this._score.masterBars[a],s=n.currentTick;if(n.processCurrent(),n.shouldPlay){this.generateMasterBar(o,r,s);for(var h=0,c=this._score.tracks;h<c.length;h++)for(var l=0,u=(i=c[h]).staves;l<u.length;l++){var p=u[l];a<p.bars.length&&this.generateBar(p.bars[a],s)}}n.moveNext(),r=o}for(var d=0,f=this._score.tracks;d<f.length;d++){i=f[d];this._handler.finishTrack(i.index,n.currentTick)}this.tickLookup.finish(),et.debug("Midi","Midi generation done")},e.prototype.generateTrack=function(t){this.generateChannel(t,t.playbackInfo.primaryChannel,t.playbackInfo),t.playbackInfo.primaryChannel!==t.playbackInfo.secondaryChannel&&this.generateChannel(t,t.playbackInfo.secondaryChannel,t.playbackInfo)},e.prototype.generateChannel=function(t,i,n){var r=e.toChannelShort(n.volume),a=e.toChannelShort(n.balance);this._handler.addControlChange(t.index,0,i,Ti.VolumeCoarse,r),this._handler.addControlChange(t.index,0,i,Ti.PanCoarse,a),this._handler.addControlChange(t.index,0,i,Ti.ExpressionControllerCoarse,127),this._handler.addControlChange(t.index,0,i,Ti.RegisteredParameterFine,0),this._handler.addControlChange(t.index,0,i,Ti.RegisteredParameterCourse,0),this._handler.addControlChange(t.index,0,i,Ti.DataEntryFine,0),this._handler.addControlChange(t.index,0,i,Ti.DataEntryCoarse,e.PitchBendRangeInSemitones),this._handler.addProgramChange(t.index,0,i,n.program)},e.toChannelShort=function(t){var e=Math.max(-32768,Math.min(32767,8*t-1));return Math.max(e,-1)+1},e.prototype.generateMasterBar=function(t,e,i){e&&e.timeSignatureDenominator===t.timeSignatureDenominator&&e.timeSignatureNumerator===t.timeSignatureNumerator||this._handler.addTimeSignature(i,t.timeSignatureNumerator,t.timeSignatureDenominator),e?t.tempoAutomation&&(this._handler.addTempo(i,t.tempoAutomation.value),this._currentTempo=t.tempoAutomation.value):(this._handler.addTempo(i,t.score.tempo),this._currentTempo=t.score.tempo);var n=new qi;n.masterBar=t,n.start=i,n.tempo=this._currentTempo,n.end=n.start+t.calculateDuration(),this.tickLookup.addMasterBar(n)},e.prototype.generateBar=function(t,e){var i=this.getPlaybackBar(t);this._currentBarRepeatLookup=null;for(var n=0,r=i.voices;n<r.length;n++){var a=r[n];this.generateVoice(a,e,t)}},e.prototype.getPlaybackBar=function(t){switch(t.simileMark){case C.Simple:t.previousBar&&(t=this.getPlaybackBar(t.previousBar));break;case C.FirstOfDouble:case C.SecondOfDouble:t.previousBar&&t.previousBar.previousBar&&(t=this.getPlaybackBar(t.previousBar.previousBar))}return t},e.prototype.generateVoice=function(t,e,i){if(!t.isEmpty||t.bar.isEmpty&&0===t.index)for(var n=0,r=t.beats;n<r.length;n++){var a=r[n];this.generateBeat(a,e,i)}},e.prototype.generateBeat=function(t,i,n){var r=this,a=t.playbackStart,o=t.playbackDuration;t.voice.bar.isEmpty?o=t.voice.bar.masterBar.calculateDuration():t.voice.bar.masterBar.tripletFeel!==dt.NoTripletFeel&&this._settings.player.playTripletFeel&&(this._currentTripletFeel?(a-=this._currentTripletFeel.secondBeatStartOffset,o=this._currentTripletFeel.secondBeatDuration,this._currentTripletFeel=null):(this._currentTripletFeel=e.calculateTripletFeelInfo(a,o,t),this._currentTripletFeel&&(o=this._currentTripletFeel.firstBeatDuration)));var s=new Xi;s.start=i+a;var h=t.nextBeat?t.nextBeat.absolutePlaybackStart-t.absolutePlaybackStart:o;s.end=i+a,s.highlightBeat(t),s.end+=h>o?h:o,n===t.voice.bar?(s.beat=t,this.tickLookup.addBeat(s)):(s.isEmptyBar=!0,s.beat=n.voices[0].beats[0],this._currentBarRepeatLookup?this._currentBarRepeatLookup.end=s.end:(this._currentBarRepeatLookup=s,this.tickLookup.addBeat(this._currentBarRepeatLookup)));for(var c=t.voice.bar.staff.track,l=0,u=t.automations;l<u.length;l++){var p=u[l];this.generateAutomation(t,p,i)}if(t.isRest)this._handler.addRest(c.index,i+a,c.playbackInfo.primaryChannel);else for(var d=this.getBrushInfo(t),f=0,y=t.notes;f<y.length;f++){var g=y[f];this.generateNote(g,i+a,o,d)}if(t.vibrato!==W.None){var m=240,b=3;switch(t.vibrato){case W.Slight:m=this._settings.player.vibrato.beatSlightLength,b=this._settings.player.vibrato.beatSlightAmplitude;break;case W.Wide:m=this._settings.player.vibrato.beatWideLength,b=this._settings.player.vibrato.beatWideAmplitude}this.generateVibratorWithParams(i+a,t.playbackDuration,m,b,(function(e,i){r._handler.addBend(t.voice.bar.staff.track.index,e,c.playbackInfo.secondaryChannel,i)}))}},e.calculateTripletFeelInfo=function(t,e,i){var n;switch(i.voice.bar.masterBar.tripletFeel){case dt.Triplet8th:case dt.Dotted8th:case dt.Scottish8th:n=A.Eighth;break;case dt.Triplet16th:case dt.Dotted16th:case dt.Scottish16th:n=A.Sixteenth;break;default:return null}var r=z.toTicks(n);if(e!==r)return null;if(t%r!=0)return null;if(!i.nextBeat||i.nextBeat.voice!==i.voice||i.playbackDuration!==r)return null;var a=new $i;switch(i.voice.bar.masterBar.tripletFeel){case dt.Triplet8th:a.firstBeatDuration=z.applyTuplet(z.toTicks(A.Quarter),3,2),a.secondBeatDuration=z.applyTuplet(z.toTicks(A.Eighth),3,2);break;case dt.Dotted8th:a.firstBeatDuration=z.applyDot(z.toTicks(A.Eighth),!1),a.secondBeatDuration=z.toTicks(A.Sixteenth);break;case dt.Scottish8th:a.firstBeatDuration=z.toTicks(A.Sixteenth),a.secondBeatDuration=z.applyDot(z.toTicks(A.Eighth),!1);break;case dt.Triplet16th:a.firstBeatDuration=z.applyTuplet(z.toTicks(A.Eighth),3,2),a.secondBeatDuration=z.applyTuplet(z.toTicks(A.Sixteenth),3,2);break;case dt.Dotted16th:a.firstBeatDuration=z.applyDot(z.toTicks(A.Sixteenth),!1),a.secondBeatDuration=z.toTicks(A.ThirtySecond);break;case dt.Scottish16th:a.firstBeatDuration=z.toTicks(A.ThirtySecond),a.secondBeatDuration=z.applyDot(z.toTicks(A.Sixteenth),!1)}return a.secondBeatStartOffset=e-a.firstBeatDuration,a},e.prototype.generateNote=function(t,i,n,r){var a=t.beat.voice.bar.staff.track,o=t.beat.voice.bar.staff,s=t.realValue;if(t.isPercussion){var h=at.getArticulation(t);h&&(s=h.outputMidiNumber)}var c=t.isStringed&&t.string<=r.length?r[t.string-1]:0,l=i+c,u=this.getNoteDuration(t,n);u.untilTieOrSlideEnd-=c,u.noteOnly-=c,u.letRingEnd-=c;var p=e.getDynamicValue(t),d=t.hasBend||t.beat.hasWhammyBar||t.beat.vibrato!==W.None?a.playbackInfo.secondaryChannel:a.playbackInfo.primaryChannel,f=0;if((f=t.hasBend?e.getPitchWheel(t.bendPoints[0].value):t.beat.hasWhammyBar?e.getPitchWheel(t.beat.whammyBarPoints[0].value):t.isTieDestination||t.slideOrigin&&t.slideOrigin.slideOutType===H.Legato?-1:e.getPitchWheel(0))>=0&&this._handler.addBend(a.index,l,d,f),t.beat.fadeIn&&this.generateFadeIn(t,l,u),!t.isTrill||o.isPercussion){if(t.beat.isTremolo)this.generateTremoloPicking(t,l,u,s,p,d);else if(t.hasBend?this.generateBend(t,l,u,s,d):t.beat.hasWhammyBar&&0===t.index?this.generateWhammy(t.beat,l,u,d):t.slideInType!==V.None||t.slideOutType!==H.None?this.generateSlide(t,l,u,s,p,d):t.vibrato!==W.None&&this.generateVibrato(t,l,u,s,d),!(t.isTieDestination||t.slideOrigin&&t.slideOrigin.slideOutType===H.Legato)){var y=Math.max(u.untilTieOrSlideEnd,u.letRingEnd);this._handler.addNote(a.index,l,y,s,p,d)}}else this.generateTrill(t,l,u,s,p,d)},e.prototype.getNoteDuration=function(i,n){var r=new Zi;if(r.noteOnly=n,r.untilTieOrSlideEnd=n,r.letRingEnd=n,i.isDead)return r.noteOnly=this.applyStaticDuration(e.DefaultDurationDead,n),r.untilTieOrSlideEnd=r.noteOnly,r.letRingEnd=r.noteOnly,r;if(i.isPalmMute)return r.noteOnly=this.applyStaticDuration(e.DefaultDurationPalmMute,n),r.untilTieOrSlideEnd=r.noteOnly,r.letRingEnd=r.noteOnly,r;if(i.isStaccato)return r.noteOnly=n/2|0,r.untilTieOrSlideEnd=r.noteOnly,r.letRingEnd=r.noteOnly,r;if(i.isTieOrigin){if(h=i.tieDestination)if(i.isTieDestination){o=this.getNoteDuration(h,h.beat.playbackDuration);r.untilTieOrSlideEnd=n+o.untilTieOrSlideEnd}else{var a=i.beat.absolutePlaybackStart,o=this.getNoteDuration(h,h.beat.playbackDuration),s=h.beat.absolutePlaybackStart+o.untilTieOrSlideEnd;r.untilTieOrSlideEnd=s-a}}else if(i.slideOutType===H.Legato){var h;if(h=i.slideTarget){a=i.beat.absolutePlaybackStart;var c=this.getNoteDuration(h,h.beat.playbackDuration);s=h.beat.absolutePlaybackStart+c.untilTieOrSlideEnd;r.untilTieOrSlideEnd=s-a}}if(i.isLetRing&&this._settings.notation.notationMode===t.NotationMode.GuitarPro){for(var l=i.beat,u=0,p=i.beat.voice.bar.masterBar.calculateDuration();l.nextBeat;){var d=l.nextBeat;if(d.isRest)break;if(i.isStringed&&d.hasNoteOnString(i.string))break;if((u=(l=l.nextBeat).absolutePlaybackStart-i.beat.absolutePlaybackStart+l.playbackDuration)>p){u=p;break}}l===i.beat?r.letRingEnd=n:r.letRingEnd=u}else r.letRingEnd=r.untilTieOrSlideEnd;return r},e.prototype.applyStaticDuration=function(t,e){var i=this._currentTempo*t/X.MaxPosition|0;return Math.min(i,e)},e.getDynamicValue=function(t){var e=t.dynamics;switch(!t.beat.voice.bar.staff.isPercussion&&t.hammerPullOrigin&&e--,t.isGhost&&e--,t.accentuated){case S.Normal:e++;break;case S.Heavy:e+=2}return e},e.prototype.generateFadeIn=function(t,i,n){for(var r=t.beat.voice.bar.staff.track,a=e.toChannelShort(r.playbackInfo.volume)/n.noteOnly,o=n.noteOnly/120|0,s=i+n.noteOnly,h=o-1;h>=0;h--){var c=s-120*h,l=(c-i)*a;h===o-1&&(this._handler.addControlChange(r.index,i,r.playbackInfo.primaryChannel,Ti.VolumeCoarse,l),this._handler.addControlChange(r.index,i,r.playbackInfo.secondaryChannel,Ti.VolumeCoarse,l)),this._handler.addControlChange(r.index,c,r.playbackInfo.primaryChannel,Ti.VolumeCoarse,l),this._handler.addControlChange(r.index,c,r.playbackInfo.secondaryChannel,Ti.VolumeCoarse,l)}},e.prototype.generateVibrato=function(t,e,i,n,r){var a=this,o=0,s=0;switch(t.vibrato){case W.Slight:o=this._settings.player.vibrato.noteSlightLength,s=this._settings.player.vibrato.noteSlightAmplitude;break;case W.Wide:o=this._settings.player.vibrato.noteWideLength,s=this._settings.player.vibrato.noteWideAmplitude;break;default:return}var h=t.beat.voice.bar.staff.track;this.generateVibratorWithParams(e,i.noteOnly,o,s,(function(t,e){a._handler.addNoteBend(h.index,t,r,n,e)}))},e.prototype.generateVibratorWithParams=function(t,i,n,r,a){for(var o=n/2|0,s=(t+=n)+i;t<s;){for(var h=0,c=t+n<s?n:s-t;h<c;){var l=r*Math.sin(h*Math.PI/o);a(t+h|0,e.getPitchWheel(l)),h+=16}t+=n}},e.getPitchWheel=function(t){return Ce.DefaultPitchWheel+t/2*e.PitchValuePerSemitone},e.prototype.generateSlide=function(t,e,i,n,r,a){var o=this,s=t.slideOutType===H.Legato?i.noteOnly:i.untilTieOrSlideEnd,h=[],c=t.beat.voice.bar.staff.track,l=this._settings.player.slide.simpleSlidePitchOffset,u=Math.floor(X.MaxPosition*this._settings.player.slide.simpleSlideDurationRatio),p=Math.floor(X.MaxPosition*this._settings.player.slide.shiftSlideDurationRatio);switch(t.slideInType){case V.IntoFromAbove:h.push(new X(0,l)),h.push(new X(u,0));break;case V.IntoFromBelow:h.push(new X(0,-l)),h.push(new X(u,0))}switch(t.slideOutType){case H.Legato:case H.Shift:h.push(new X(p,0));var d=2*(t.slideTarget.realValue-t.realValue);h.push(new X(X.MaxPosition,d));break;case H.OutDown:h.push(new X(X.MaxPosition-u,0)),h.push(new X(X.MaxPosition,-l));break;case H.OutUp:h.push(new X(X.MaxPosition-u,0)),h.push(new X(X.MaxPosition,l))}this.generateWhammyOrBend(e,s,h,(function(t,e){o._handler.addNoteBend(c.index,t,a,n,e)}))},e.prototype.generateBend=function(t,i,n,r,a){var o,s=this,h=t.bendPoints,c=t.beat.voice.bar.staff.track,l=function(t,e){s._handler.addNoteBend(c.index,t,a,r,e)},u=null;if(t.isTieOrigin&&this._settings.notation.extendBendArrowsOnTiedNotes){for(var p=t;p.isTieOrigin&&!p.tieDestination.hasBend;)p=p.tieDestination;o=p.beat.absolutePlaybackStart-t.beat.absolutePlaybackStart+this.getNoteDuration(p,p.beat.playbackDuration).noteOnly}else if(t.isTieOrigin&&t.beat.graceType!==R.None){switch(t.tieDestination.bendType){case E.Bend:case E.BendRelease:case E.PrebendBend:u=t.tieDestination.bendPoints[1].value;break;case E.Prebend:case E.PrebendRelease:u=t.tieDestination.bendPoints[0].value}o=Math.max(n.noteOnly,z.millisToTicks(this._settings.player.songBookBendDuration,this._currentTempo))}else o=n.noteOnly;h[0].value>0&&!t.isContinuedBend&&i--;var d=Math.min(o,z.millisToTicks(this._settings.player.songBookBendDuration,this._currentTempo)),f=[];switch(t.bendType){case E.Custom:f=h;break;case E.Bend:case E.Release:switch(t.bendStyle){case L.Default:f=h;break;case L.Gradual:f.push(new X(0,t.bendPoints[0].value)),(!u||u<t.bendPoints[1].value)&&(u=t.bendPoints[1].value),f.push(new X(X.MaxPosition,u));break;case L.Fast:return(!u||u<t.bendPoints[1].value)&&(u=t.bendPoints[1].value),void(t.beat.graceType===R.BendGrace?this.generateSongBookWhammyOrBend(i,o,!0,[t.bendPoints[0].value,u],d,l):this.generateSongBookWhammyOrBend(i,o,!1,[t.bendPoints[0].value,u],d,l))}break;case E.BendRelease:switch(t.bendStyle){case L.Default:f=h;break;case L.Gradual:f.push(new X(0,t.bendPoints[0].value)),f.push(new X(X.MaxPosition/2|0,t.bendPoints[1].value)),f.push(new X(X.MaxPosition,t.bendPoints[2].value));break;case L.Fast:return void this.generateSongBookWhammyOrBend(i,o,!1,[t.bendPoints[0].value,t.bendPoints[1].value,t.bendPoints[2].value],d,l)}break;case E.Hold:case E.Prebend:f=h;break;case E.PrebendBend:switch(t.bendStyle){case L.Default:f=h;break;case L.Gradual:f.push(new X(0,t.bendPoints[0].value)),f.push(new X(X.MaxPosition,t.bendPoints[1].value));break;case L.Fast:var y=e.getPitchWheel(t.bendPoints[0].value);return this._handler.addBend(c.index,i,a,0|y),(!u||u<t.bendPoints[1].value)&&(u=t.bendPoints[1].value),void this.generateSongBookWhammyOrBend(i,o,!1,[t.bendPoints[0].value,u],d,l)}break;case E.PrebendRelease:switch(t.bendStyle){case L.Default:f=h;break;case L.Gradual:f.push(new X(0,t.bendPoints[0].value)),f.push(new X(X.MaxPosition,t.bendPoints[1].value));break;case L.Fast:y=e.getPitchWheel(t.bendPoints[0].value);return this._handler.addBend(c.index,i,a,0|y),void this.generateSongBookWhammyOrBend(i,o,!1,[t.bendPoints[0].value,t.bendPoints[1].value],d,l)}}this.generateWhammyOrBend(i,o,f,l)},e.prototype.generateSongBookWhammyOrBend=function(t,i,n,r,a,o){for(var s=n?t:t+i-a,h=a/(r.length-1),c=0;c<r.length-1;c++){var l=e.getPitchWheel(r[c]),u=e.getPitchWheel(r[c+1]),p=s+h*c;this.generateBendValues(p,h,l,u,o)}},e.prototype.generateWhammy=function(t,i,n,r){var a=this,o=t.whammyBarPoints,s=t.voice.bar.staff.track,h=n.noteOnly;o[0].value>0&&!t.isContinuedWhammy&&i--;var c=function(t,e){a._handler.addBend(s.index,t,r,e)},l=[];switch(t.whammyBarType){case it.Custom:l=o;break;case it.Dive:switch(t.whammyStyle){case L.Default:l=o;break;case L.Gradual:l.push(new X(0,o[0].value)),l.push(new X(X.MaxPosition,o[1].value));break;case L.Fast:var u=Math.min(h,z.millisToTicks(this._settings.player.songBookBendDuration,this._currentTempo));return void this.generateSongBookWhammyOrBend(i,h,!1,[o[0].value,o[1].value],u,c)}break;case it.Dip:switch(t.whammyStyle){case L.Default:l=o;break;case L.Gradual:l.push(new X(0,o[0].value)),l.push(new X(X.MaxPosition/2|0,o[1].value)),l.push(new X(X.MaxPosition,o[2].value));break;case L.Fast:u=Math.min(h,z.millisToTicks(this._settings.player.songBookDipDuration,this._currentTempo));return void this.generateSongBookWhammyOrBend(i,h,!0,[o[0].value,o[1].value,o[2].value],u,c)}break;case it.Hold:case it.Predive:l=o;break;case it.PrediveDive:switch(t.whammyStyle){case L.Default:l=o;break;case L.Gradual:l.push(new X(0,o[0].value)),l.push(new X(X.MaxPosition/2|0,o[0].value)),l.push(new X(X.MaxPosition,o[1].value));break;case L.Fast:var p=e.getPitchWheel(o[0].value);this._handler.addBend(s.index,i,r,0|p);u=Math.min(h,z.millisToTicks(this._settings.player.songBookBendDuration,this._currentTempo));return void this.generateSongBookWhammyOrBend(i,h,!1,[o[0].value,o[1].value],u,c)}}this.generateWhammyOrBend(i,h,l,c)},e.prototype.generateWhammyOrBend=function(t,i,n,r){for(var a=i/X.MaxPosition,o=0;o<n.length-1;o++){var s=n[o],h=n[o+1],c=e.getPitchWheel(s.value),l=e.getPitchWheel(h.value),u=a*(h.offset-s.offset),p=t+a*s.offset;this.generateBendValues(p,u,c,l,r)}},e.prototype.generateBendValues=function(t,i,n,r,a){for(var o=z.ticksToMillis(i,this._currentTempo),s=Math.abs(r-n)/e.PitchValuePerSemitone,h=Math.max(e.MinBreakpointsPerSemitone*s,o/e.MillisecondsPerBreakpoint),c=i/h,l=(r-n)/h,u=0;u<h;u++)a(0|t,Math.round(n)),n+=l,t+=c;n<r&&a(0|t,r)},e.prototype.generateTrill=function(t,e,i,n,r,a){for(var o=t.beat.voice.bar.staff.track,s=t.stringTuning+t.trillFret,h=z.toTicks(t.trillSpeed),c=!0,l=e,u=e+i.untilTieOrSlideEnd;l+10<u;)l+h>=u&&(h=u-l),this._handler.addNote(o.index,l,h,c?s:n,r,a),c=!c,l+=h},e.prototype.generateTremoloPicking=function(t,e,i,n,r,a){for(var o=t.beat.voice.bar.staff.track,s=z.toTicks(t.beat.tremoloSpeed),h=e,c=e+i.untilTieOrSlideEnd;h+10<c;)h+s>=c&&(s=c-h),this._handler.addNote(o.index,h,s,n,r,a),h+=s},e.prototype.getBrushInfo=function(t){var e=new Int32Array(t.voice.bar.staff.tuning.length);if(t.brushType!==M.None){for(var i=0,n=0,r=0,a=t.notes;r<a.length;r++){var o=a[r];o.isTieDestination||(i|=1<<o.string-1,n++)}if(t.notes.length>0)for(var s=0,h=t.brushDuration/(n-1)|0,c=0;c<t.voice.bar.staff.tuning.length;c++){var l=t.brushType===M.ArpeggioDown||t.brushType===M.BrushDown?c:e.length-1-c;0!=(i&1<<l)&&(e[l]=s,s+=h)}}return e},e.prototype.generateAutomation=function(t,i,n){switch(i.type){case B.Instrument:this._handler.addProgramChange(t.voice.bar.staff.track.index,t.playbackStart+n,t.voice.bar.staff.track.playbackInfo.primaryChannel,255&(0|i.value)),this._handler.addProgramChange(t.voice.bar.staff.track.index,t.playbackStart+n,t.voice.bar.staff.track.playbackInfo.secondaryChannel,255&(0|i.value));break;case B.Balance:var r=e.toChannelShort(i.value);this._handler.addControlChange(t.voice.bar.staff.track.index,t.playbackStart+n,t.voice.bar.staff.track.playbackInfo.primaryChannel,Ti.PanCoarse,r),this._handler.addControlChange(t.voice.bar.staff.track.index,t.playbackStart+n,t.voice.bar.staff.track.playbackInfo.secondaryChannel,Ti.PanCoarse,r);break;case B.Volume:var a=e.toChannelShort(i.value);this._handler.addControlChange(t.voice.bar.staff.track.index,t.playbackStart+n,t.voice.bar.staff.track.playbackInfo.primaryChannel,Ti.VolumeCoarse,a),this._handler.addControlChange(t.voice.bar.staff.track.index,t.playbackStart+n,t.voice.bar.staff.track.playbackInfo.secondaryChannel,Ti.VolumeCoarse,a)}},e.prototype.prepareSingleBeat=function(t){for(var i=-1,n=-1,r=t;r&&(-1===i||-1===n);){for(var a=0,o=t.automations;a<o.length;a++){var s=o[a];switch(s.type){case B.Instrument:n=s.value;break;case B.Tempo:i=s.value}}r=r.previousBeat}var h=t.voice.bar.staff.track,c=t.voice.bar.masterBar;-1===i&&(i=c.score.tempo),-1===n&&(n=h.playbackInfo.program);var l=h.playbackInfo.volume;this.generateTrack(h),this._handler.addTimeSignature(0,c.timeSignatureNumerator,c.timeSignatureDenominator),this._handler.addTempo(0,i);var u=e.toChannelShort(l);this._handler.addControlChange(0,0,h.playbackInfo.primaryChannel,Ti.VolumeCoarse,u),this._handler.addControlChange(0,0,h.playbackInfo.secondaryChannel,Ti.VolumeCoarse,u)},e.prototype.generateSingleBeat=function(t){this.prepareSingleBeat(t),this.generateBeat(t,-t.playbackStart,t.voice.bar)},e.prototype.generateSingleNote=function(t){this.prepareSingleBeat(t.beat),this.generateNote(t,-t.beat.playbackStart,t.beat.playbackDuration,new Int32Array(t.beat.voice.bar.staff.tuning.length))},e.DefaultDurationDead=30,e.DefaultDurationPalmMute=80,e.PitchBendRangeInSemitones=16,e.PitchValuePerSemitone=Ce.DefaultPitchWheel/e.PitchBendRangeInSemitones,e.MinBreakpointsPerSemitone=6,e.MillisecondsPerBreakpoint=150,e}(),en=function(){this.startTick=0,this.endTick=0},nn=function(){function t(t,e){this.width=0,this.x=t,this.y=e}return Object.defineProperty(t.prototype,"scale",{get:function(){return this.renderer.scale},enumerable:!1,configurable:!0}),t.prototype.doLayout=function(){},t.prototype.paint=function(t,e,i){},t}(),rn=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),an=function(t){function e(e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n=t.call(this,e,i)||this;return n.nextGlyph=null,n.previousGlyph=null,n.height=0,n}return rn(e,t),e}(nn),on=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),sn=function(t){function e(e,i,n,r){var a=t.call(this,e,i)||this;return a.glyphScale=0,a.glyphScale=n,a.symbol=r,a}return on(e,t),e.prototype.paint=function(t,e,i){i.fillMusicFontSymbol(t+this.x,e+this.y,this.glyphScale*this.scale,this.symbol,!1)},e}(an),hn=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),cn=function(t){function e(i,n,r,a){var o=t.call(this,i,n,a?e.GraceScale:1,e.getSymbol(r))||this;return o._isGrace=a,o._duration=r,o}return hn(e,t),e.prototype.paint=function(t,e,i){var n=this._isGrace?this.scale:0;i.fillMusicFontSymbol(t+this.x,e+this.y+n,this.glyphScale*this.scale,this.symbol,!1)},e.prototype.doLayout=function(){var t=(this._isGrace?e.GraceScale:1)*this.scale;switch(this._duration){case A.QuadrupleWhole:this.width=14*t;break;case A.DoubleWhole:case A.Whole:this.width=14*(this._isGrace?e.GraceScale:1)*this.scale;break;default:this.width=e.QuarterNoteHeadWidth*(this._isGrace?e.GraceScale:1)*this.scale}this.height=e.NoteHeadHeight*t},e.getSymbol=function(t){switch(t){case A.QuadrupleWhole:return Q.NoteheadDoubleWholeSquare;case A.DoubleWhole:return Q.NoteheadDoubleWhole;case A.Whole:return Q.NoteheadWhole;case A.Half:return Q.NoteheadHalf;default:return Q.NoteheadBlack}},e.GraceScale=.75,e.NoteHeadHeight=8,e.QuarterNoteHeadWidth=9,e}(sn),ln=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),un=function(t){function e(i,n,r,a,o){return t.call(this,i,n,o?cn.GraceScale:1,e.getSymbol(r,a,o))||this}return ln(e,t),e.prototype.doLayout=function(){this.width=0},e.getSymbol=function(t,e,i){if(i&&(t=A.Eighth),e===Xt.Up)switch(t){case A.Eighth:return Q.FlagEighthUp;case A.Sixteenth:return Q.FlagSixteenthUp;case A.ThirtySecond:return Q.FlagThirtySecondUp;case A.SixtyFourth:return Q.FlagSixtyFourthUp;case A.OneHundredTwentyEighth:return Q.FlagOneHundredTwentyEighthUp;case A.TwoHundredFiftySixth:return Q.FlagTwoHundredFiftySixthUp;default:return Q.FlagEighthUp}switch(t){case A.Eighth:return Q.FlagEighthDown;case A.Sixteenth:return Q.FlagSixteenthDown;case A.ThirtySecond:return Q.FlagThirtySecondDown;case A.SixtyFourth:return Q.FlagSixtyFourthDown;case A.OneHundredTwentyEighth:case A.TwoHundredFiftySixth:return Q.FlagOneHundredTwentyEighthDown;default:return Q.FlagEighthDown}},e.FlagWidth=11,e}(sn),pn=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),dn=function(t){function e(e,i){var n=t.call(this,0,0)||this;return n.ties=[],n.minWidth=0,n.beat=e,n.ties=[],n.voiceContainer=i,n}return pn(e,t),Object.defineProperty(e.prototype,"onTimeX",{get:function(){return this.onNotes.x+this.onNotes.centerX},enumerable:!1,configurable:!0}),e.prototype.registerLayoutingInfo=function(t){var e=this.onTimeX,i=this.onNotes.width-this.onNotes.centerX,n=this.renderer.helpers.getBeamingHelperForBeat(this.beat);n&&n.hasFlag&&(i+=un.FlagWidth*this.scale);for(var r=0,a=this.ties;r<a.length;r++){i+=a[r].width}t.addBeatSpring(this.beat,e,i),t.setPreBeatSize(this.beat,this.preNotes.width),t.setOnBeatSize(this.beat,this.onNotes.width),t.setBeatCenterX(this.beat,this.onNotes.centerX)},e.prototype.applyLayoutingInfo=function(t){var e=t.getBeatCenterX(this.beat)-this.onNotes.centerX;this.preNotes.x=e,this.preNotes.width=t.getPreBeatSize(this.beat),this.onNotes.width=t.getOnBeatSize(this.beat),this.onNotes.x=this.preNotes.x+this.preNotes.width,this.onNotes.updateBeamingHelper()},e.prototype.doLayout=function(){this.preNotes.x=0,this.preNotes.renderer=this.renderer,this.preNotes.container=this,this.preNotes.doLayout(),this.onNotes.x=this.preNotes.x+this.preNotes.width,this.onNotes.renderer=this.renderer,this.onNotes.container=this,this.onNotes.doLayout();for(var t=this.beat.notes.length-1;t>=0;)this.createTies(this.beat.notes[t--]);this.updateWidth()},e.prototype.updateWidth=function(){if(this.minWidth=this.preNotes.width+this.onNotes.width,!this.beat.isRest)if(1===this.onNotes.beamingHelper.beats.length)this.beat.duration>=A.Eighth&&(this.minWidth+=20*this.scale);else switch(this.beat.duration){case A.OneHundredTwentyEighth:case A.TwoHundredFiftySixth:this.minWidth+=10*this.scale}for(var t=0,e=0,i=this.ties;e<i.length;e++){var n=i[e];n.width>t&&(t=n.width)}this.minWidth+=t,this.width=this.minWidth},e.prototype.scaleToWidth=function(t){for(var e=0,i=this.ties;e<i.length;e++){i[e].doLayout()}this.onNotes.updateBeamingHelper(),this.width=t},e.prototype.createTies=function(t){},e.getGroupId=function(t){return"b"+t.id},e.prototype.paint=function(t,i,n){if(!this.beat.voice.isEmpty&&!(this.preNotes.isEmpty&&this.onNotes.isEmpty&&0===this.ties.length)){n.beginGroup(e.getGroupId(this.beat)),this.preNotes.paint(t+this.x,i+this.y,n),this.onNotes.paint(t+this.x,i+this.y,n);for(var r=t-this.voiceContainer.x-this.renderer.x,a=i-this.voiceContainer.y-this.renderer.y,o=0,s=this.ties.length;o<s;o++){var h=this.ties[o];h.renderer=this.renderer,h.paint(r,a,n)}n.endGroup()}},e.prototype.buildBoundingsLookup=function(t,e,i,n){var r=new Ii;r.beat=this.beat,r.visualBounds=new It,r.visualBounds.x=e+this.x+this.onNotes.x,r.visualBounds.y=t.visualBounds.y,r.visualBounds.w=this.onNotes.width,r.visualBounds.h=t.visualBounds.h,r.realBounds=new It,r.realBounds.x=e+this.x,r.realBounds.y=t.realBounds.y,r.realBounds.w=this.width,r.realBounds.h=t.realBounds.h,n&&(r.visualBounds.x=e+this.x,r.realBounds.x=r.visualBounds.x),t.addBeat(r),this.renderer.settings.core.includeNoteBounds&&this.onNotes.buildBoundingsLookup(r,e+this.x,i+this.y)},e}(nn),fn=function(){function t(){this.oldWidth=0,this.newWidth=0,this.settings=null}return t.prototype.core=function(){return this.settings&&this.causeIssue()?this.settings.core:new Qh},t.prototype.causeIssue=function(){return this.settings=null,!0},t}(),yn=function(t){this.bounds=null,this.beat=t},gn=function(){function e(t,e){var i=this;this._startTime=0,this._trackIndexes=null,this.score=null,this.tracks=[],this._tickCache=null,this.player=null,this._cursorWrapper=null,this._barCursor=null,this._beatCursor=null,this._selectionWrapper=null,this._previousTick=0,this._playerState=Ne.Paused,this._currentBeat=null,this._previousStateForCursor=Ne.Paused,this._previousCursorCache=null,this._lastScroll=0,this.playedBeatChanged=new ui,this._beatMouseDown=!1,this._selectionStart=null,this._selectionEnd=null,this.beatMouseDown=new ui,this.beatMouseMove=new ui,this.beatMouseUp=new ui,this.scoreLoaded=new ui,this.resize=new ui,this.renderStarted=new ui,this.renderFinished=new ui,this.postRenderFinished=new li,this.error=new ui,this.playerReady=new li,this.playerFinished=new li,this.soundFontLoaded=new li,this.midiLoaded=new li,this.playerStateChanged=new ui,this.playerPositionChanged=new ui,this.uiFacade=t,this.container=t.rootContainer,t.initialize(this,e),et.logLevel=this.settings.core.logLevel,this.canvasElement=t.createCanvasElement(),this.container.appendChild(this.canvasElement),this.container.resize.on(qh.throttle((function(){i.container.width!==i.renderer.width&&i.triggerResize()}),t.resizeThrottle)),this.settings.core.useWorkers&&this.uiFacade.areWorkersSupported&&qh.getRenderEngineFactory(this.settings).supportsWorkers?this.renderer=this.uiFacade.createWorkerRenderer():this.renderer=new Hi(this.settings);var n=new fn;n.oldWidth=this.renderer.width,n.newWidth=0|this.container.width,n.settings=this.settings,this.onResize(n),this.renderer.preRender.on(this.onRenderStarted.bind(this)),this.renderer.renderFinished.on((function(t){i.onRenderFinished(t)})),this.renderer.postRenderFinished.on((function(){var t=Date.now()-i._startTime;et.debug("rendering","Rendering completed in "+t+"ms"),i.onPostRenderFinished()})),this.renderer.preRender.on((function(t){i._startTime=Date.now()})),this.renderer.partialRenderFinished.on(this.appendRenderResult.bind(this)),this.renderer.renderFinished.on((function(t){i.appendRenderResult(t),i.appendRenderResult(null)})),this.renderer.error.on(this.onError.bind(this)),this.settings.player.enablePlayer&&this.setupPlayer(),this.setupClickHandling(),this.uiFacade.beginInvoke((function(){i.uiFacade.initialRender()}))}return e.prototype.destroy=function(){this.player&&this.player.destroy(),this.uiFacade.destroy(),this.renderer.destroy()},e.prototype.updateSettings=function(){this.renderer.updateSettings(this.settings),this.settings.player.enablePlayer?this.setupPlayer():this.destroyPlayer()},e.prototype.load=function(t,e){var i=this;try{return this.uiFacade.load(t,(function(t){i.renderScore(t,e)}),(function(t){i.onError(t)}))}catch(t){return this.onError(t),!1}},e.prototype.renderScore=function(t,e){var i=[];if(e)if(0===e.length)t.tracks.length>0&&i.push(t.tracks[0]);else if(1===e.length&&-1===e[0])for(var n=0,r=t.tracks;n<r.length;n++){var a=r[n];i.push(a)}else for(var o=0,s=e;o<s.length;o++){var h=s[o];h>=0&&h<=t.tracks.length&&i.push(t.tracks[h])}else t.tracks.length>0&&i.push(t.tracks[0]);this.internalRenderTracks(t,i)},e.prototype.renderTracks=function(e){if(e.length>0){for(var i=e[0].score,n=0,r=e;n<r.length;n++){if(r[n].score!==i)return void this.onError(new c(t.AlphaTabErrorType.General,"All rendered tracks must belong to the same score."))}this.internalRenderTracks(i,e)}},e.prototype.internalRenderTracks=function(t,e){if(t!==this.score){g.applyPitchOffsets(this.settings,t),this.score=t,this.tracks=e,this._trackIndexes=[];for(var i=0,n=e;i<n.length;i++){var r=n[i];this._trackIndexes.push(r.index)}this.onScoreLoaded(t),this.loadMidiForScore(),this.render()}else{this.tracks=e,this._trackIndexes=[];for(var a=0,o=e;a<o.length;a++){r=o[a];this._trackIndexes.push(r.index)}this.render()}},e.prototype.triggerResize=function(){var t=this;if(this.container.isVisible){var e=new fn;e.oldWidth=this.renderer.width,e.newWidth=this.container.width,e.settings=this.settings,this.onResize(e),this.renderer.updateSettings(this.settings),this.renderer.width=this.container.width,this.renderer.resizeRender()}else et.warning("Rendering","AlphaTab container was invisible while autosizing, waiting for element to become visible",null),this.uiFacade.rootContainerBecameVisible.on((function(){et.debug("Rendering","AlphaTab container became visible, doing autosizing",null),t.triggerResize()}))},e.prototype.appendRenderResult=function(t){t&&(this.canvasElement.width=t.totalWidth,this.canvasElement.height=t.totalHeight,this._cursorWrapper&&(this._cursorWrapper.width=t.totalWidth,this._cursorWrapper.height=t.totalHeight)),t&&!t.renderResult||this.uiFacade.beginAppendRenderResults(t)},e.prototype.tex=function(t,e){try{var i=new xt,n=At.fromString(t);i.init(n,this.settings);var r=i.readScore();this.renderScore(r,e)}catch(t){this.onError(t)}},e.prototype.loadSoundFont=function(t,e){return void 0===e&&(e=!1),!!this.player&&this.uiFacade.loadSoundFont(t,e)},e.prototype.resetSoundFonts=function(){this.player&&this.player.resetSoundFonts()},e.prototype.render=function(){var t=this;this.renderer&&(this.uiFacade.canRender?(this.renderer.width=this.container.width,this.renderer.renderScore(this.score,this._trackIndexes)):this.uiFacade.canRenderChanged.on((function(){return t.render()})))},Object.defineProperty(e.prototype,"isReadyForPlayback",{get:function(){return!!this.player&&this.player.isReadyForPlayback},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerState",{get:function(){return this.player?this.player.state:Ne.Paused},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"masterVolume",{get:function(){return this.player?this.player.masterVolume:0},set:function(t){this.player&&(this.player.masterVolume=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metronomeVolume",{get:function(){return this.player?this.player.metronomeVolume:0},set:function(t){this.player&&(this.player.metronomeVolume=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"countInVolume",{get:function(){return this.player?this.player.countInVolume:0},set:function(t){this.player&&(this.player.countInVolume=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tickPosition",{get:function(){return this.player?this.player.tickPosition:0},set:function(t){this.player&&(this.player.tickPosition=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timePosition",{get:function(){return this.player?this.player.timePosition:0},set:function(t){this.player&&(this.player.timePosition=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playbackRange",{get:function(){return this.player?this.player.playbackRange:null},set:function(t){this.player&&(this.player.playbackRange=t,this.settings.player.enableCursor&&this.updateSelectionCursor(t))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playbackSpeed",{get:function(){return this.player?this.player.playbackSpeed:0},set:function(t){this.player&&(this.player.playbackSpeed=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLooping",{get:function(){return!!this.player&&this.player.isLooping},set:function(t){this.player&&(this.player.isLooping=t)},enumerable:!1,configurable:!0}),e.prototype.destroyPlayer=function(){this.player&&(this.player.destroy(),this.player=null,this.destroyCursors())},e.prototype.setupPlayer=function(){var t=this;this.player||(this.player=this.uiFacade.createWorkerPlayer(),this.player&&(this.player.ready.on((function(){t.loadMidiForScore()})),this.player.readyForPlayback.on((function(){if(t.onPlayerReady(),t.tracks)for(var e=0,i=t.tracks;e<i.length;e++){var n=i[e],r=n.playbackInfo.volume/16;t.player.setChannelVolume(n.playbackInfo.primaryChannel,r),t.player.setChannelVolume(n.playbackInfo.secondaryChannel,r)}})),this.player.soundFontLoaded.on(this.onSoundFontLoaded.bind(this)),this.player.soundFontLoadFailed.on((function(e){t.onError(e)})),this.player.midiLoaded.on(this.onMidiLoaded.bind(this)),this.player.midiLoadFailed.on((function(e){t.onError(e)})),this.player.stateChanged.on(this.onPlayerStateChanged.bind(this)),this.player.positionChanged.on(this.onPlayerPositionChanged.bind(this)),this.player.finished.on(this.onPlayerFinished.bind(this)),this.settings.player.enableCursor?this.setupCursors():this.destroyCursors()))},e.prototype.loadMidiForScore=function(){if(this.player&&this.score&&this.player.isReady){et.debug("AlphaTab","Generating Midi");var t=new di,e=new zi(t),i=new tn(this.score,this.settings,e);i.generate(),this._tickCache=i.tickLookup,this.player.loadMidiFile(t)}},e.prototype.changeTrackVolume=function(t,e){if(this.player)for(var i=0,n=t;i<n.length;i++){var r=n[i];this.player.setChannelVolume(r.playbackInfo.primaryChannel,e),this.player.setChannelVolume(r.playbackInfo.secondaryChannel,e)}},e.prototype.changeTrackSolo=function(t,e){if(this.player)for(var i=0,n=t;i<n.length;i++){var r=n[i];this.player.setChannelSolo(r.playbackInfo.primaryChannel,e),this.player.setChannelSolo(r.playbackInfo.secondaryChannel,e)}},e.prototype.changeTrackMute=function(t,e){if(this.player)for(var i=0,n=t;i<n.length;i++){var r=n[i];this.player.setChannelMute(r.playbackInfo.primaryChannel,e),this.player.setChannelMute(r.playbackInfo.secondaryChannel,e)}},e.prototype.play=function(){return!!this.player&&this.player.play()},e.prototype.pause=function(){this.player&&this.player.pause()},e.prototype.playPause=function(){this.player&&this.player.playPause()},e.prototype.stop=function(){this.player&&this.player.stop()},e.prototype.playBeat=function(t){if(this.player){var e=new di,i=new zi(e);new tn(t.voice.bar.staff.track.score,this.settings,i).generateSingleBeat(t),this.player.playOneTimeMidiFile(e)}},e.prototype.playNote=function(t){if(this.player){var e=new di,i=new zi(e);new tn(t.beat.voice.bar.staff.track.score,this.settings,i).generateSingleNote(t),this.player.playOneTimeMidiFile(e)}},e.prototype.destroyCursors=function(){this._cursorWrapper&&(this.uiFacade.destroyCursors(),this._cursorWrapper=null,this._barCursor=null,this._beatCursor=null,this._selectionWrapper=null,this._previousTick=0,this._playerState=Ne.Paused)},e.prototype.setupCursors=function(){var t=this,e=this.uiFacade.createCursors();e&&(this._cursorWrapper=e.cursorWrapper,this._barCursor=e.barCursor,this._beatCursor=e.beatCursor,this._selectionWrapper=e.selectionWrapper,this._previousTick=0,this._playerState=Ne.Paused,this.renderer.postRenderFinished.on((function(){t.cursorUpdateTick(t._previousTick,!1)})),this.player&&(this.player.positionChanged.on((function(e){t._previousTick=e.currentTick,t.uiFacade.beginInvoke((function(){t.cursorUpdateTick(e.currentTick,!1)}))})),this.player.stateChanged.on((function(e){if(t._playerState=e.state,!e.stopped&&e.state===Ne.Paused){var i=t._currentBeat,n=t._tickCache;i&&n&&(t.player.tickPosition=n.getMasterBarStart(i.voice.bar.masterBar)+i.playbackStart)}}))))},e.prototype.cursorUpdateTick=function(t,e){var i=this;void 0===e&&(e=!1),this.uiFacade.beginInvoke((function(){var n=i._tickCache;if(n){var r=i.tracks;if(r.length>0){var a=n.findBeat(r,t);a&&i.cursorUpdateBeat(a.currentBeat,a.nextBeat,a.duration,e,a.beatsToHighlight)}}}))},e.prototype.cursorUpdateBeat=function(e,i,n,r,a){if(void 0===a&&(a=null),e){var o=this.renderer.boundsLookup;if(o){var s=this._currentBeat,h=this._previousCursorCache,c=this._previousStateForCursor;if(this._currentBeat=e,this._previousCursorCache=o,this._previousStateForCursor=this._playerState,e!==s||o!==h||c!==this._playerState){var l=this._barCursor,u=this._beatCursor,p=o.findBeat(e);if(p){var d=p.barBounds.masterBarBounds,f=d.visualBounds;if(l&&(l.top=f.y,l.left=f.x,l.width=f.w,l.height=f.h),u&&(u.stopAnimation(),u.top=f.y,u.left=p.visualBounds.x,u.height=f.h),this.uiFacade.removeHighlights(),this._playerState===Ne.Playing||r){if(n/=this.playbackSpeed,!r){if(a)for(var y=0,g=a;y<g.length;y++){var m=g[y],b=dn.getGroupId(m);this.uiFacade.highlightElements(b)}var v=d.visualBounds.x+d.visualBounds.w;if(i&&(i.voice.bar.index===e.voice.bar.index||i.voice.bar.index===e.voice.bar.index+1)){var _=o.findBeat(i);_&&_.barBounds.masterBarBounds.staveGroupBounds===d.staveGroupBounds&&(v=_.visualBounds.x)}u&&this.uiFacade.beginInvoke((function(){u.transitionToX(n,v)}))}if(!this._beatMouseDown&&this.settings.player.scrollMode!==t.ScrollMode.Off){var w=this.uiFacade.getScrollContainer(),S=qh.getLayoutEngineFactory(this.settings).vertical,B=this.settings.player.scrollMode,T=this.uiFacade.getOffset(w,this.container);if(S)switch(B){case t.ScrollMode.Continuous:var k=T.y+d.realBounds.y+this.settings.player.scrollOffsetY;k!==this._lastScroll&&(this._lastScroll=k,this.uiFacade.scrollToY(w,k,this.settings.player.scrollSpeed));break;case t.ScrollMode.OffScreen:var P=w.scrollTop+this.uiFacade.getOffset(null,w).h;if(d.visualBounds.y+d.visualBounds.h>=P||d.visualBounds.y<w.scrollTop){var N=d.realBounds.y+this.settings.player.scrollOffsetY;this._lastScroll=d.visualBounds.x,this.uiFacade.scrollToY(w,N,this.settings.player.scrollSpeed)}}else switch(B){case t.ScrollMode.Continuous:if(d.visualBounds.x!==this._lastScroll){var O=d.realBounds.x+this.settings.player.scrollOffsetX;this._lastScroll=d.visualBounds.x,this.uiFacade.scrollToX(w,O,this.settings.player.scrollSpeed)}break;case t.ScrollMode.OffScreen:var x=w.scrollLeft+this.uiFacade.getOffset(null,w).w;if(d.visualBounds.x+d.visualBounds.w>=x||d.visualBounds.x<w.scrollLeft){O=d.realBounds.x+this.settings.player.scrollOffsetX;this._lastScroll=d.visualBounds.x,this.uiFacade.scrollToX(w,O,this.settings.player.scrollSpeed)}}}this.onPlayedBeatChanged(e)}}}}}},e.prototype.onPlayedBeatChanged=function(t){this.playedBeatChanged.trigger(t),this.uiFacade.triggerEvent(this.container,"playedBeatChanged",t)},e.prototype.onBeatMouseDown=function(t,e){this.settings.player.enablePlayer&&this.settings.player.enableCursor&&this.settings.player.enableUserInteraction&&(this._selectionStart=new yn(e),this._selectionEnd=null),this._beatMouseDown=!0,this.beatMouseDown.trigger(e),this.uiFacade.triggerEvent(this.container,"beatMouseDown",e,t)},e.prototype.onBeatMouseMove=function(t,e){this.settings.player.enableUserInteraction&&(this._selectionEnd&&this._selectionEnd.beat===e||(this._selectionEnd=new yn(e),this.cursorSelectRange(this._selectionStart,this._selectionEnd))),this.beatMouseMove.trigger(e),this.uiFacade.triggerEvent(this.container,"beatMouseMove",e,t)},e.prototype.onBeatMouseUp=function(t,e){if(this.settings.player.enableUserInteraction){if(this._selectionEnd){var i=this._selectionStart.beat.absoluteDisplayStart;if(this._selectionStart.beat.absoluteDisplayStart<i){var n=this._selectionStart;this._selectionStart=this._selectionEnd,this._selectionEnd=n}}if(this._selectionStart&&this._tickCache){var r=this._tickCache,a=r.getMasterBarStart(this._selectionStart.beat.voice.bar.masterBar);if(this._currentBeat=null,this._playerState===Ne.Paused&&this.cursorUpdateBeat(this._selectionStart.beat,null,0,!1,[this._selectionStart.beat]),this.tickPosition=a+this._selectionStart.beat.playbackStart,this._selectionEnd&&this._selectionStart.beat!==this._selectionEnd.beat){var o=r.getMasterBarStart(this._selectionEnd.beat.voice.bar.masterBar),s=new en;s.startTick=a+this._selectionStart.beat.playbackStart,s.endTick=o+this._selectionEnd.beat.playbackStart+this._selectionEnd.beat.playbackDuration-50,this.playbackRange=s}else this._selectionStart=null,this.playbackRange=null,this.cursorSelectRange(this._selectionStart,this._selectionEnd)}}this.beatMouseUp.trigger(e),this.uiFacade.triggerEvent(this.container,"beatMouseUp",e,t),this._beatMouseDown=!1},e.prototype.updateSelectionCursor=function(t){if(this._tickCache)if(t){var e=this._tickCache.findBeat(this.tracks,t.startTick),i=this._tickCache.findBeat(this.tracks,t.endTick);if(e&&i){var n=new yn(e.currentBeat),r=new yn(i.currentBeat);this.cursorSelectRange(n,r)}}else this.cursorSelectRange(null,null)},e.prototype.setupClickHandling=function(){var t=this;this.canvasElement.mouseDown.on((function(e){var i,n;if(e.isLeftMouseButton){t.settings.player.enableUserInteraction&&e.preventDefault();var r=e.getX(t.canvasElement),a=e.getY(t.canvasElement),o=null!==(n=null===(i=t.renderer.boundsLookup)||void 0===i?void 0:i.getBeatAtPos(r,a))&&void 0!==n?n:null;o&&t.onBeatMouseDown(e,o)}})),this.canvasElement.mouseMove.on((function(e){var i,n;if(t._beatMouseDown){var r=e.getX(t.canvasElement),a=e.getY(t.canvasElement),o=null!==(n=null===(i=t.renderer.boundsLookup)||void 0===i?void 0:i.getBeatAtPos(r,a))&&void 0!==n?n:null;o&&t.onBeatMouseMove(e,o)}})),this.canvasElement.mouseUp.on((function(e){var i,n;if(t._beatMouseDown){t.settings.player.enableUserInteraction&&e.preventDefault();var r=e.getX(t.canvasElement),a=e.getY(t.canvasElement),o=null!==(n=null===(i=t.renderer.boundsLookup)||void 0===i?void 0:i.getBeatAtPos(r,a))&&void 0!==n?n:null;t.onBeatMouseUp(e,o)}})),this.renderer.postRenderFinished.on((function(){t._selectionStart&&t.settings.player.enablePlayer&&t.settings.player.enableCursor&&t.settings.player.enableUserInteraction&&t.cursorSelectRange(t._selectionStart,t._selectionEnd)}))},e.prototype.cursorSelectRange=function(t,e){var i=this.renderer.boundsLookup;if(i){var n=this._selectionWrapper;if(n&&(n.clear(),t&&e&&t.beat!==e.beat)){t.bounds||(t.bounds=i.findBeat(t.beat)),e.bounds||(e.bounds=i.findBeat(e.beat));var r=t.beat.absolutePlaybackStart;if(e.beat.absolutePlaybackStart<r){var a=t;t=e,e=a}var o=t.bounds.realBounds.x,s=e.bounds.realBounds.x+e.bounds.realBounds.w;if(e.beat.index===e.beat.voice.beats.length-1&&(s=e.bounds.barBounds.masterBarBounds.realBounds.x+e.bounds.barBounds.masterBarBounds.realBounds.w),t.bounds.barBounds.masterBarBounds.staveGroupBounds!==e.bounds.barBounds.masterBarBounds.staveGroupBounds){var h=t.bounds.barBounds.masterBarBounds.staveGroupBounds.visualBounds.x,c=t.bounds.barBounds.masterBarBounds.staveGroupBounds.visualBounds.x+t.bounds.barBounds.masterBarBounds.staveGroupBounds.visualBounds.w,l=this.uiFacade.createSelectionElement();l.top=t.bounds.barBounds.masterBarBounds.visualBounds.y,l.left=o,l.width=c-o,l.height=t.bounds.barBounds.masterBarBounds.visualBounds.h,n.appendChild(l);for(var u=t.bounds.barBounds.masterBarBounds.staveGroupBounds.index+1,p=e.bounds.barBounds.masterBarBounds.staveGroupBounds.index,d=u;d<p;d++){var f=i.staveGroups[d],y=this.uiFacade.createSelectionElement();y.top=f.visualBounds.y,y.left=h,y.width=c-h,y.height=f.visualBounds.h,n.appendChild(y)}var g=this.uiFacade.createSelectionElement();g.top=e.bounds.barBounds.masterBarBounds.visualBounds.y,g.left=h,g.width=s-h,g.height=e.bounds.barBounds.masterBarBounds.visualBounds.h,n.appendChild(g)}else{var m=this.uiFacade.createSelectionElement();m.top=t.bounds.barBounds.masterBarBounds.visualBounds.y,m.left=o,m.width=s-o,m.height=t.bounds.barBounds.masterBarBounds.visualBounds.h,n.appendChild(m)}}}},e.prototype.onScoreLoaded=function(t){this.scoreLoaded.trigger(t),this.uiFacade.triggerEvent(this.container,"scoreLoaded",t)},e.prototype.onResize=function(t){this.resize.trigger(t),this.uiFacade.triggerEvent(this.container,"resize",t)},e.prototype.onRenderStarted=function(t){this.renderStarted.trigger(t),this.uiFacade.triggerEvent(this.container,"renderStarted",t)},e.prototype.onRenderFinished=function(t){this.renderFinished.trigger(t),this.uiFacade.triggerEvent(this.container,"renderFinished",t)},e.prototype.onPostRenderFinished=function(){this.postRenderFinished.trigger(),this.uiFacade.triggerEvent(this.container,"postRenderFinished",null)},e.prototype.onError=function(t){et.error("API","An unexpected error occurred",t),this.error.trigger(t),this.uiFacade.triggerEvent(this.container,"error",t)},e.prototype.onPlayerReady=function(){this.playerReady.trigger(),this.uiFacade.triggerEvent(this.container,"playerReady",null)},e.prototype.onPlayerFinished=function(){this.playerFinished.trigger(),this.uiFacade.triggerEvent(this.container,"playerFinished",null)},e.prototype.onSoundFontLoaded=function(){this.soundFontLoaded.trigger(),this.uiFacade.triggerEvent(this.container,"soundFontLoaded",null)},e.prototype.onMidiLoaded=function(){this.midiLoaded.trigger(),this.uiFacade.triggerEvent(this.container,"midiFileLoaded",null)},e.prototype.onPlayerStateChanged=function(t){this.playerStateChanged.trigger(t),this.uiFacade.triggerEvent(this.container,"playerStateChanged",t)},e.prototype.onPlayerPositionChanged=function(t){this.playerPositionChanged.trigger(t),this.uiFacade.triggerEvent(this.container,"playerPositionChanged",t)},e}(),mn=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),bn=function(e){function i(n,r){var a=e.call(this,t.AlphaTabErrorType.General,n)||this;return a.xhr=r,Object.setPrototypeOf(a,i.prototype),a}return mn(i,e),i}(c),vn=function(){function t(){}return t.loadScoreAsync=function(e,i,n,r){var a=new XMLHttpRequest;if(a.open("GET",e,!0,null,null),a.responseType="arraybuffer",a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE){var e=a.response;if(200===a.status||0===a.status&&e)try{var o=a.response,s=new Uint8Array(o),h=t.loadScoreFromBytes(s,r);i(h)}catch(t){n(t)}else 0===a.status?n(new bn("You are offline!!\n Please Check Your Network.",a)):404===a.status?n(new bn("Requested URL not found.",a)):500===a.status?n(new bn("Internel Server Error.",a)):"parsererror"===a.statusText?n(new bn("Error.\nParsing JSON Request failed.",a)):"timeout"===a.statusText?n(new bn("Request Time out.",a)):n(new bn("Unknow Error: "+a.responseText,a))}},"arraybuffer"!==a.responseType){for(var o=VbAjaxLoader("GET",e).toArray(),s="",h=0;h<o.length-1;)s+=o[h].toString(),h++;var c=t.getBytesFromString(s),l=t.loadScoreFromBytes(c,r);i(l)}a.send()},t.getBytesFromString=function(t){for(var e=new Uint8Array(t.length),i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e},t.loadScoreFromBytes=function(t,e){e||(e=new Oi);var i=qh.buildImporters();et.debug("ScoreLoader","Loading score from "+t.length+" bytes using "+i.length+" importers",null);for(var n=null,r=At.fromBuffer(t),a=0,o=i;a<o.length;a++){var s=o[a];r.reset();try{et.debug("ScoreLoader","Importing using importer "+s.name),s.init(r,e),n=s.readScore(),et.debug("ScoreLoader","Score imported using "+s.name);break}catch(t){if(!(t instanceof N))throw et.error("ScoreLoader","Score import failed due to unexpected error: ",t),t;et.debug("ScoreLoader",s.name+" does not support the file")}}if(n)return n;throw et.error("ScoreLoader","No compatible importer found for file"),new N("No compatible importer found for file")},t}(),_n=function(){function t(t){this.mouseEvent=t}return Object.defineProperty(t.prototype,"isLeftMouseButton",{get:function(){return 0===this.mouseEvent.button},enumerable:!1,configurable:!0}),t.prototype.getX=function(t){var e=t.element,i=e.getBoundingClientRect().left+e.ownerDocument.defaultView.pageXOffset;return this.mouseEvent.pageX-i},t.prototype.getY=function(t){var e=t.element,i=e.getBoundingClientRect().top+e.ownerDocument.defaultView.pageYOffset;return this.mouseEvent.pageY-i},t.prototype.preventDefault=function(){this.mouseEvent.preventDefault()},t}(),wn=function(){function t(t){var e=this;this.element=t,this.mouseDown={on:function(t){e.element.addEventListener("mousedown",(function(e){t(new _n(e))}),!0)},off:function(t){}},this.mouseUp={on:function(t){e.element.addEventListener("mouseup",(function(e){t(new _n(e))}),!0)},off:function(t){}},this.mouseMove={on:function(t){e.element.addEventListener("mousemove",(function(e){t(new _n(e))}),!0)},off:function(t){}},this.scroll={on:function(t){window.addEventListener("scroll",t,!0)},off:function(t){window.removeEventListener("scroll",t,!0)}},this.resize={on:function(t){window.addEventListener("resize",t,!0)},off:function(t){window.removeEventListener("resize",t,!0)}}}return Object.defineProperty(t.prototype,"top",{get:function(){return parseFloat(this.element.style.top)},set:function(t){this.element.style.top=t+"px"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return parseFloat(this.element.style.top)},set:function(t){this.element.style.left=t+"px"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.element.offsetWidth},set:function(t){this.element.style.width=t+"px"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scrollLeft",{get:function(){return this.element.scrollLeft},set:function(t){this.element.scrollTop=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scrollTop",{get:function(){return this.element.scrollLeft},set:function(t){this.element.scrollTop=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.element.offsetHeight},set:function(t){this.element.style.height=t>=0?t+"px":"100%"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isVisible",{get:function(){return!!this.element.offsetWidth||!!this.element.offsetHeight||!!this.element.getClientRects().length},enumerable:!1,configurable:!0}),t.prototype.stopAnimation=function(){this.element.style.transition="none"},t.prototype.transitionToX=function(t,e){this.element.style.transition="all 0s linear",this.element.style.transitionDuration=t+"ms",this.element.style.left=e+"px"},t.prototype.appendChild=function(t){this.element.appendChild(t.element)},t.prototype.clear=function(){this.element.innerHTML=""},t}(),Sn=function(){function t(t,e){void 0===e&&(e="BESbwy"),this._isStarted=!1,this.isFontLoaded=!1,this.fontLoaded=new ui,this._family=t,this._fallbackText=e}return t.prototype.checkForFontAvailability=function(){var t=this;if(qh.isRunningInWorker)this.isFontLoaded=!1;else if(!this._isStarted){this._isStarted=!0;var e=0,i=window.setInterval((function(){e++,et.warning("Rendering","Could not load font '"+t._family+"' within "+5*e+" seconds",null)}),5e3);if(et.debug("Font","Start checking for font availablility: "+this._family),qh.supportsFontsApi){et.debug("Font","["+this._family+"] Font API available");var n=function(){document.fonts.load("1em "+t._family).then((function(){return et.debug("Font","["+t._family+"] Font API signaled loaded"),document.fonts.check("1em "+t._family)?(et.debug("Rendering","["+t._family+"] Font API signaled available"),t.isFontLoaded=!0,window.clearInterval(i),t.fontLoaded.trigger(t._family)):(et.debug("Font","["+t._family+"] Font API loaded reported, but font not available, checking later again",null),window.setTimeout((function(){n()}),250)),!0}))};n()}else{var r,a,o;et.debug("Font","["+this._family+"] Font API not available, using resize trick",null);var s=-1,h=-1,c=-1,l=function(){r||(r=t.createCheckerElement("sans-serif"),a=t.createCheckerElement("serif"),o=t.createCheckerElement("monospace"),document.body.appendChild(r),document.body.appendChild(a),document.body.appendChild(o),s=r.offsetWidth,h=a.offsetWidth,c=o.offsetWidth,r.style.fontFamily="'"+t._family+"',sans-serif",a.style.fontFamily="'"+t._family+"',serif",o.style.fontFamily="'"+t._family+"',monospace");var e=r.offsetWidth,n=a.offsetWidth,u=o.offsetWidth;(e!==s&&n!==h||e!==s&&u!==c||n!==h&&u!==c)&&(e===n||e===u||n===u)?(document.body.removeChild(r),document.body.removeChild(a),document.body.removeChild(o),t.isFontLoaded=!0,window.clearInterval(i),t.fontLoaded.trigger(t._family)):window.setTimeout(l,250)},u=document.readyState;"complete"===u||"loaded"===u||"interactive"===u?l():document.addEventListener("DOMContentLoaded",(function(){l()}))}}},t.prototype.createCheckerElement=function(t){var e=document.createElement("span");return e.style.display="inline-block",e.style.position="absolute",e.style.overflow="hidden",e.style.top="-1000px",e.style.fontSize="100px",e.style.fontFamily=t,e.innerHTML=this._fallbackText,document.body.appendChild(e),e},t}(),Bn=function(){function t(t){this._writePosition=0,this._readPosition=0,this.count=0,this._buffer=new Float32Array(t)}return t.prototype.clear=function(){this._readPosition=0,this._writePosition=0,this.count=0,this._buffer=new Float32Array(this._buffer.length)},t.prototype.write=function(t,e,i){var n=0;i>this._buffer.length-this.count&&(i=this._buffer.length-this.count);var r=Math.min(this._buffer.length-this._writePosition,i);return this._buffer.set(t.subarray(e,e+r),this._writePosition),this._writePosition+=r,this._writePosition%=this._buffer.length,(n+=r)<i&&(this._buffer.set(t.subarray(e+n,e+n+i-n),this._writePosition),this._writePosition+=i-n,n=i),this.count+=n,n},t.prototype.read=function(t,e,i){i>this.count&&(i=this.count);var n=0,r=Math.min(this._buffer.length-this._readPosition,i);return t.set(this._buffer.subarray(this._readPosition,this._readPosition+r),e),n+=r,this._readPosition+=r,this._readPosition%=this._buffer.length,n<i&&(t.set(this._buffer.subarray(this._readPosition,this._readPosition+i-n),e+n),this._readPosition+=i-n,n=i),this.count-=n,n},t}(),Tn=function(){function e(){this._context=null,this._buffer=null,this._source=null,this._audioNode=null,this._outputBuffer=new Float32Array(0),this.ready=new li,this.samplesPlayed=new ui,this.sampleRequest=new li}return Object.defineProperty(e.prototype,"sampleRate",{get:function(){return this._context?this._context.sampleRate:e.PreferredSampleRate},enumerable:!1,configurable:!0}),e.prototype.open=function(){this.patchIosSampleRate(),this._circularBuffer=new Bn(e.BufferSize*e.BufferCount),this._context=this.createAudioContext();var t=this._context;if("suspended"===t.state){var i=function(){t.resume(),window.setTimeout((function(){"running"===t.state&&(document.body.removeEventListener("touchend",i,!1),document.body.removeEventListener("click",i,!1))}),0)};document.body.addEventListener("touchend",i,!1),document.body.addEventListener("click",i,!1)}this.ready.trigger()},e.prototype.activate=function(){this._context||(this._context=this.createAudioContext()),this._context.resume()},e.prototype.patchIosSampleRate=function(){var t=navigator.userAgent;if(-1!==t.indexOf("iPhone")||0!==t.indexOf("iPad")){var i=this.createAudioContext(),n=i.createBuffer(1,1,e.PreferredSampleRate),r=i.createBufferSource();r.buffer=n,r.connect(i.destination),r.start(0),r.disconnect(0),i.close()}},e.prototype.createAudioContext=function(){if("AudioContext"in qh.globalThis)return new AudioContext;if("webkitAudioContext"in qh.globalThis)return new webkitAudioContext;throw new c(t.AlphaTabErrorType.General,"AudioContext not found")},e.prototype.play=function(){var t=this._context;t&&("suspended"!==t.state&&"interrupted"!==t.state||t.resume(),this._buffer=t.createBuffer(2,4096,t.sampleRate),this._audioNode=t.createScriptProcessor(4096,0,2),this._audioNode.onaudioprocess=this.generateSound.bind(this),this._circularBuffer.clear(),this.requestBuffers(),this._source=t.createBufferSource(),this._source.buffer=this._buffer,this._source.loop=!0,this._source.connect(this._audioNode,0,0),this._source.start(0),this._audioNode.connect(t.destination,0,0))},e.prototype.pause=function(){this._source&&(this._source.stop(0),this._source.disconnect(0)),this._source=null,this._audioNode&&this._audioNode.disconnect(0),this._audioNode=null},e.prototype.addSamples=function(t){this._circularBuffer.write(t,0,t.length)},e.prototype.resetSamples=function(){this._circularBuffer.clear()},e.prototype.requestBuffers=function(){if(this._circularBuffer.count<20480&&this.sampleRequest)for(var t=0;t<5;t++)this.sampleRequest.trigger()},e.prototype.generateSound=function(t){var e=t.outputBuffer.getChannelData(0),i=t.outputBuffer.getChannelData(1),n=e.length+i.length,r=this._outputBuffer;r.length!=n&&(r=new Float32Array(n),this._outputBuffer=r),this._circularBuffer.read(r,0,Math.min(r.length,this._circularBuffer.count));for(var a=0,o=0;o<e.length;o++)e[o]=r[a++],i[o]=r[a++];this.samplesPlayed.trigger(e.length),this.requestBuffers()},e.BufferSize=4096,e.BufferCount=10,e.PreferredSampleRate=44100,e}(),kn=function(){function t(t,e,i){this._workerIsReadyForPlayback=!1,this._workerIsReady=!1,this._outputIsReady=!1,this._state=Ne.Paused,this._masterVolume=0,this._metronomeVolume=0,this._countInVolume=0,this._playbackSpeed=0,this._tickPosition=0,this._timePosition=0,this._isLooping=!1,this._playbackRange=null,this.ready=new li,this.readyForPlayback=new li,this.finished=new li,this.soundFontLoaded=new li,this.soundFontLoadFailed=new ui,this.midiLoaded=new li,this.midiLoadFailed=new ui,this.stateChanged=new ui,this.positionChanged=new ui,this._workerIsReadyForPlayback=!1,this._workerIsReady=!1,this._outputIsReady=!1,this._state=Ne.Paused,this._masterVolume=0,this._metronomeVolume=0,this._playbackSpeed=0,this._tickPosition=0,this._timePosition=0,this._isLooping=!1,this._playbackRange=null,this._output=t,this._output.ready.on(this.onOutputReady.bind(this)),this._output.samplesPlayed.on(this.onOutputSamplesPlayed.bind(this)),this._output.sampleRequest.on(this.onOutputSampleRequest.bind(this)),this._output.open();try{var n=new Blob(["importScripts('"+e+"')"]);this._synth=new Worker(URL.createObjectURL(n))}catch(t){try{this._synth=new Worker(e)}catch(t){return void et.error("AlphaSynth","Failed to create WebWorker: "+t)}}this._synth.addEventListener("message",this.handleWorkerMessage.bind(this),!1),this._synth.postMessage({cmd:"alphaSynth.initialize",sampleRate:this._output.sampleRate,logLevel:i}),this.masterVolume=1,this.playbackSpeed=1,this.metronomeVolume=0}return Object.defineProperty(t.prototype,"isReady",{get:function(){return this._workerIsReady&&this._outputIsReady},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isReadyForPlayback",{get:function(){return this._workerIsReadyForPlayback},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"logLevel",{get:function(){return et.logLevel},set:function(t){et.logLevel=t,this._synth.postMessage({cmd:"alphaSynth.setLogLevel",value:t})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"masterVolume",{get:function(){return this._masterVolume},set:function(t){t=ti.clamp(t,Ce.MinVolume,Ce.MaxVolume),this._masterVolume=t,this._synth.postMessage({cmd:"alphaSynth.setMasterVolume",value:t})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metronomeVolume",{get:function(){return this._metronomeVolume},set:function(t){t=ti.clamp(t,Ce.MinVolume,Ce.MaxVolume),this._metronomeVolume=t,this._synth.postMessage({cmd:"alphaSynth.setMetronomeVolume",value:t})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"countInVolume",{get:function(){return this._countInVolume},set:function(t){t=ti.clamp(t,Ce.MinVolume,Ce.MaxVolume),this._countInVolume=t,this._synth.postMessage({cmd:"alphaSynth.setCountInVolume",value:t})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playbackSpeed",{get:function(){return this._playbackSpeed},set:function(t){t=ti.clamp(t,Ce.MinPlaybackSpeed,Ce.MaxPlaybackSpeed),this._playbackSpeed=t,this._synth.postMessage({cmd:"alphaSynth.setPlaybackSpeed",value:t})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tickPosition",{get:function(){return this._tickPosition},set:function(t){t<0&&(t=0),this._tickPosition=t,this._synth.postMessage({cmd:"alphaSynth.setTickPosition",value:t})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"timePosition",{get:function(){return this._timePosition},set:function(t){t<0&&(t=0),this._timePosition=t,this._synth.postMessage({cmd:"alphaSynth.setTimePosition",value:t})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLooping",{get:function(){return this._isLooping},set:function(t){this._isLooping=t,this._synth.postMessage({cmd:"alphaSynth.setIsLooping",value:t})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playbackRange",{get:function(){return this._playbackRange},set:function(t){t&&(t.startTick<0&&(t.startTick=0),t.endTick<0&&(t.endTick=0)),this._playbackRange=t,this._synth.postMessage({cmd:"alphaSynth.setPlaybackRange",value:t})},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){this._synth.terminate()},t.prototype.play=function(){return this._output.activate(),this._synth.postMessage({cmd:"alphaSynth.play"}),!0},t.prototype.pause=function(){this._synth.postMessage({cmd:"alphaSynth.pause"})},t.prototype.playPause=function(){this._output.activate(),this._synth.postMessage({cmd:"alphaSynth.playPause"})},t.prototype.stop=function(){this._synth.postMessage({cmd:"alphaSynth.stop"})},t.prototype.playOneTimeMidiFile=function(t){this._synth.postMessage({cmd:"alphaSynth.playOneTimeMidiFile",midi:Fi.midiFileToJsObject(t)})},t.prototype.loadSoundFont=function(t,e){this._synth.postMessage({cmd:"alphaSynth.loadSoundFontBytes",data:t,append:e})},t.prototype.loadSoundFontFromUrl=function(t,e,i){var n=this;et.debug("AlphaSynth","Start loading Soundfont from url "+t);var r=new XMLHttpRequest;r.open("GET",t,!0,null,null),r.responseType="arraybuffer",r.onload=function(t){var i=new Uint8Array(r.response);n.loadSoundFont(i,e)},r.onerror=function(t){et.error("AlphaSynth","Loading failed: "+t.message),n.soundFontLoadFailed.trigger(new bn(t.message,r))},r.onprogress=function(t){et.debug("AlphaSynth","Soundfont downloading: "+t.loaded+"/"+t.total+" bytes"),i(new Kh(t.loaded,t.total))},r.send()},t.prototype.resetSoundFonts=function(){this._synth.postMessage({cmd:"alphaSynth.resetSoundFonts"})},t.prototype.loadMidiFile=function(t){this._synth.postMessage({cmd:"alphaSynth.loadMidi",midi:Fi.midiFileToJsObject(t)})},t.prototype.setChannelMute=function(t,e){this._synth.postMessage({cmd:"alphaSynth.setChannelMute",channel:t,mute:e})},t.prototype.resetChannelStates=function(){this._synth.postMessage({cmd:"alphaSynth.resetChannelStates"})},t.prototype.setChannelSolo=function(t,e){this._synth.postMessage({cmd:"alphaSynth.setChannelSolo",channel:t,solo:e})},t.prototype.setChannelVolume=function(t,e){e=ti.clamp(e,Ce.MinVolume,Ce.MaxVolume),this._synth.postMessage({cmd:"alphaSynth.setChannelVolume",channel:t,volume:e})},t.prototype.handleWorkerMessage=function(t){var e=t.data;switch(e.cmd){case"alphaSynth.ready":this._workerIsReady=!0,this.checkReady();break;case"alphaSynth.readyForPlayback":this._workerIsReadyForPlayback=!0,this.checkReadyForPlayback();break;case"alphaSynth.positionChanged":this._timePosition=e.currentTime,this._tickPosition=e.currentTick,this.positionChanged.trigger(new Ie(e.currentTime,e.endTime,e.currentTick,e.endTick));break;case"alphaSynth.playerStateChanged":this._state=e.state,this.stateChanged.trigger(new Ae(e.state,e.stopped));break;case"alphaSynth.finished":this.finished.trigger();break;case"alphaSynth.soundFontLoaded":this.soundFontLoaded.trigger();break;case"alphaSynth.soundFontLoadFailed":this.soundFontLoadFailed.trigger(e.error);break;case"alphaSynth.midiLoaded":this.checkReadyForPlayback(),this.midiLoaded.trigger();break;case"alphaSynth.midiLoadFailed":this.checkReadyForPlayback(),this.midiLoadFailed.trigger(e.error);break;case"alphaSynth.output.addSamples":this._output.addSamples(e.samples);break;case"alphaSynth.output.play":this._output.play();break;case"alphaSynth.output.pause":this._output.pause();break;case"alphaSynth.output.resetSamples":this._output.resetSamples()}},t.prototype.checkReady=function(){this.isReady&&this.ready.trigger()},t.prototype.checkReadyForPlayback=function(){this.isReadyForPlayback&&this.readyForPlayback.trigger()},t.prototype.onOutputSampleRequest=function(){this._synth.postMessage({cmd:"alphaSynth.output.sampleRequest"})},t.prototype.onOutputSamplesPlayed=function(t){this._synth.postMessage({cmd:"alphaSynth.output.samplesPlayed",samples:t})},t.prototype.onOutputReady=function(){this._outputIsReady=!0,this.checkReady()},t}(),Pn=function(){function t(t,e){if(this._width=0,this.boundsLookup=null,this.preRender=new ui,this.partialRenderFinished=new ui,this.renderFinished=new ui,this.postRenderFinished=new li,this.error=new ui,this._api=t,e.core.scriptFile){try{var i="importScripts('"+e.core.scriptFile+"')",n=new Blob([i]);this._worker=new Worker(URL.createObjectURL(n))}catch(t){try{this._worker=new Worker(e.core.scriptFile)}catch(e){return void et.error("Rendering","Failed to create WebWorker: "+t)}}this._worker.postMessage({cmd:"alphaTab.initialize",settings:this.serializeSettingsForWorker(e)}),this._worker.addEventListener("message",this.handleWorkerMessage.bind(this))}else et.error("Rendering","Could not detect alphaTab script file, cannot initialize renderer")}return t.prototype.destroy=function(){this._worker.terminate()},t.prototype.updateSettings=function(t){this._worker.postMessage({cmd:"alphaTab.updateSettings",settings:this.serializeSettingsForWorker(t)})},t.prototype.serializeSettingsForWorker=function(t){var e=Oi.toJson(t);return e.player=null,e},t.prototype.render=function(){this._worker.postMessage({cmd:"alphaTab.render"})},t.prototype.resizeRender=function(){this._worker.postMessage({cmd:"alphaTab.resizeRender"})},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._worker.postMessage({cmd:"alphaTab.setWidth",width:t})},enumerable:!1,configurable:!0}),t.prototype.handleWorkerMessage=function(t){var e=t.data;switch(e.cmd){case"alphaTab.preRender":this.preRender.trigger(e.resize);break;case"alphaTab.partialRenderFinished":this.partialRenderFinished.trigger(e.result);break;case"alphaTab.renderFinished":this.renderFinished.trigger(e.result);break;case"alphaTab.postRenderFinished":this.boundsLookup=Vi.fromJson(e.boundsLookup,this._api.score),this.postRenderFinished.trigger();break;case"alphaTab.error":this.error.trigger(e.error)}},t.prototype.renderScore=function(t,e){var i=Fi.scoreToJsObject(t);this._worker.postMessage({cmd:"alphaTab.renderScore",score:i,trackIndexes:e,fontSizes:Mi.FontSizeLookupTables})},t}(),Nn=function(t,e,i,n){this.cursorWrapper=t,this.barCursor=e,this.beatCursor=i,this.selectionWrapper=n},On=function(){function e(t){var e=this;this._fontCheckers=new Map,this._contents=null,this._file=null,this._visibilityCheckIntervalId=0,this._visibilityCheckInterval=0,this._totalResultCount=0,this._initialTrackIndexes=null,this._rootContainerBecameVisible=new li,this.canRenderChanged=new li,t.classList.add("alphaTab"),this.rootContainer=new wn(t),this.areWorkersSupported="Worker"in window,qh.bravuraFontChecker.fontLoaded.on(this.onFontLoaded.bind(this)),this.rootContainerBecameVisible={on:function(t){e.rootContainer.isVisible?t():(e._rootContainerBecameVisible.on(t),0===e._visibilityCheckIntervalId&&(e._visibilityCheckIntervalId=window.setInterval((function(){e._api.container.isVisible&&(window.clearInterval(e._visibilityCheckIntervalId),e._visibilityCheckIntervalId=0,e._rootContainerBecameVisible.trigger())}),e._visibilityCheckInterval)))},off:function(t){e._rootContainerBecameVisible.off(t)}}}return Object.defineProperty(e.prototype,"resizeThrottle",{get:function(){return 10},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canRender",{get:function(){return this.areAllFontsLoaded()},enumerable:!1,configurable:!0}),e.prototype.areAllFontsLoaded=function(){if(qh.bravuraFontChecker.checkForFontAvailability(),!qh.bravuraFontChecker.isFontLoaded)return!1;var t=!1;return this._fontCheckers.forEach((function(e){e.isFontLoaded||(t=!0)})),!t&&(et.debug("Font","All fonts loaded: "+this._fontCheckers.size),!0)},e.prototype.onFontLoaded=function(t){Mi.generateFontLookup(t),this.areAllFontsLoaded()&&this.canRenderChanged.trigger()},e.prototype.createWorkerRenderer=function(){return new Pn(this._api,this._api.settings)},e.prototype.initialize=function(e,i){var n;this._api=e,i instanceof Oi?n=i:(n=new Oi).fillFromJson(i);var r=this.getDataAttributes();n.fillFromDataAttributes(r),n.notation.notationMode===t.NotationMode.SongBook&&n.setSongBookModeSettings(),e.settings=n,"default"!==n.core.engine&&"svg"!==n.core.engine||(e.container.scroll.on(this.showSvgsInViewPort.bind(this)),e.container.resize.on(this.showSvgsInViewPort.bind(this))),this.setupFontCheckers(n),this._initialTrackIndexes=this.parseTracks(n.core.tracks),this._contents="";var a=e.container;n.core.tex&&(this._contents=a.element.innerHTML,a.element.innerHTML=""),this.createStyleElement(n),this._file=n.core.file,this._visibilityCheckInterval=n.core.visibilityCheckInterval},e.prototype.setupFontCheckers=function(t){this.registerFontChecker(t.display.resources.copyrightFont),this.registerFontChecker(t.display.resources.effectFont),this.registerFontChecker(t.display.resources.fingeringFont),this.registerFontChecker(t.display.resources.graceFont),this.registerFontChecker(t.display.resources.markerFont),this.registerFontChecker(t.display.resources.tablatureFont),this.registerFontChecker(t.display.resources.titleFont),this.registerFontChecker(t.display.resources.wordsFont),this.registerFontChecker(t.display.resources.barNumberFont),this.registerFontChecker(t.display.resources.fretboardNumberFont),this.registerFontChecker(t.display.resources.subTitleFont)},e.prototype.registerFontChecker=function(t){if(!this._fontCheckers.has(t.family)){var e=new Sn(t.family);this._fontCheckers.set(t.family,e),e.fontLoaded.on(this.onFontLoaded.bind(this)),e.checkForFontAvailability()}},e.prototype.destroy=function(){this.rootContainer.element.innerHTML=""},e.prototype.createCanvasElement=function(){var t=document.createElement("div");return t.className="at-surface",t.style.fontSize="0",t.style.overflow="hidden",t.style.lineHeight="0",new wn(t)},e.prototype.triggerEvent=function(t,e,i,n){void 0===i&&(i=null);var r=t.element;e="alphaTab."+e;var a=document.createEvent("CustomEvent"),o=n?n.mouseEvent:null;if(a.initCustomEvent(e,!1,!1,i),o&&(a.originalEvent=o),r.dispatchEvent(a),window&&"jQuery"in window){var s=window.jQuery,h=[];h.push(i),o&&h.push(o),s(r).trigger(e,h)}},e.prototype.load=function(t,e,i){if(t instanceof bt)return e(t),!0;if(t instanceof ArrayBuffer){var n=new Uint8Array(t);return e(vn.loadScoreFromBytes(n,this._api.settings)),!0}return t instanceof Uint8Array?(e(vn.loadScoreFromBytes(t,this._api.settings)),!0):"string"==typeof t&&(vn.loadScoreAsync(t,e,i,this._api.settings),!0)},e.prototype.loadSoundFont=function(t,e){return!!this._api.player&&(t instanceof ArrayBuffer?(this._api.player.loadSoundFont(new Uint8Array(t),e),!0):t instanceof Uint8Array?(this._api.player.loadSoundFont(t,e),!0):"string"==typeof t&&(this._api.loadSoundFontFromUrl(t,e),!0))},e.prototype.initialRender=function(){var t=this;this._api.renderer.preRender.on((function(e){t._totalResultCount=0})),this.rootContainerBecameVisible.on((function(){var e;t._api.renderer.width=0|t.rootContainer.width,t._api.renderer.updateSettings(t._api.settings),t._contents?(t._api.tex(t._contents,null!==(e=t._initialTrackIndexes)&&void 0!==e?e:void 0),t._initialTrackIndexes=null):t._file&&vn.loadScoreAsync(t._file,(function(e){var i;t._api.renderScore(e,null!==(i=t._initialTrackIndexes)&&void 0!==i?i:void 0),t._initialTrackIndexes=null}),(function(e){t._api.onError(e)}),t._api.settings)}))},e.prototype.showSvgsInViewPort=function(){for(var t=this._api.canvasElement.element.querySelectorAll("[data-lazy=true]"),e=0;e<t.length;e++){var i=t.item(e);this.isElementInViewPort(i)&&this.replacePlaceholder(i,i.svg)}},e.prototype.isElementInViewPort=function(t){var e=t.getBoundingClientRect();return e.top+e.height>=0&&e.top<=window.innerHeight&&e.left+e.width>=0&&e.left<=window.innerWidth},e.prototype.createStyleElement=function(t){var e=this._api.container.element.ownerDocument;qh.createStyleElement(e,t.core.fontDirectory)},e.prototype.parseTracks=function(t){if(!t)return[];var e=[];if("string"==typeof t)try{if("all"===t)return[-1];t=JSON.parse(t)}catch(e){t=[0]}if("number"==typeof t)e.push(t);else if("length"in t)for(var i=t.length,n=t,r=0;r<i;r++){var a=n[r],o=0;((o="number"==typeof a?a:"index"in a?a.index:parseInt(a.toString()))>=0||-1===o)&&e.push(o)}else"index"in t&&e.push(t.index);return e},e.prototype.getDataAttributes=function(){var t=new Map,e=this._api.container.element;if(e.dataset)for(var i=0,n=Object.keys(e.dataset);i<n.length;i++){var r=n[i],a=e.dataset[r];try{var o=a;a=JSON.parse(o)}catch(t){""===a&&(a=null)}t.set(r,a)}else for(var s=0;s<e.attributes.length;s++){var h=e.attributes.item(s),c=h.nodeName;if(c.startsWith("data-")){for(var l=c.substr(5).split("-"),u=(r=l[0],1);u<l.length;u++)r+=l[u].substr(0,1).toUpperCase()+l[u].substr(1);a=h.nodeValue;try{a=JSON.parse(a)}catch(t){""===a&&(a=null)}t.set(r,a)}}return t},e.prototype.beginAppendRenderResults=function(t){var e=this._api.canvasElement.element;if(t){var i=t.renderResult;if("string"==typeof i){var n=void 0;this._totalResultCount<e.childElementCount?n=e.childNodes.item(this._totalResultCount):(n=document.createElement("div"),e.appendChild(n)),n.style.width=t.width+"px",n.style.height=t.height+"px",n.style.display="inline-block",!this._api.settings.core.enableLazyLoading||this.isElementInViewPort(n)?this.replacePlaceholder(n,i):(n.svg=i,n.setAttribute("data-lazy","true"))}else this._totalResultCount<e.childElementCount?e.replaceChild(t.renderResult,e.childNodes.item(this._totalResultCount)):e.appendChild(t.renderResult);this._totalResultCount++}else{for(;e.childElementCount>this._totalResultCount;)e.removeChild(e.lastChild);this._api.settings.core.enableLazyLoading&&this.showSvgsInViewPort()}},e.prototype.replacePlaceholder=function(t,e){var i;if("string"==typeof t.outerHTML)t.outerHTML=e;else{var n=document.createElement("div");n.innerHTML=e,null===(i=t.parentNode)||void 0===i||i.replaceChild(n.firstChild,t)}},e.prototype.createWorkerPlayer=function(){var t=this,e="ScriptProcessorNode"in window,i=qh.scriptFile;if(!i)return et.error("Player","alphaTab script file could not be detected, player cannot initialize"),null;var n=null;return e&&(et.debug("Player","Will use webworkers for synthesizing and web audio api for playback"),n=new kn(new Tn,i,this._api.settings.core.logLevel)),n?n.ready.on((function(){t._api.settings.player.soundFont&&t._api.loadSoundFontFromUrl(t._api.settings.player.soundFont,!1)})):et.error("Player","Player requires webworkers and web audio api, browser unsupported",null),n},e.prototype.beginInvoke=function(t){window.requestAnimationFrame((function(){t()}))},e.prototype.highlightElements=function(t){for(var e=this._api.container.element.getElementsByClassName(t),i=0;i<e.length;i++)e.item(i).classList.add("at-highlight")},e.prototype.removeHighlights=function(){for(var t=this._api.container.element.getElementsByClassName("at-highlight");t.length>0;)t.item(0).classList.remove("at-highlight")},e.prototype.destroyCursors=function(){var t=this._api.container.element,e=t.querySelector(".at-cursors");t.removeChild(e)},e.prototype.createCursors=function(){var t=this._api.container.element,e=document.createElement("div");e.classList.add("at-cursors");var i=document.createElement("div");i.classList.add("at-selection");var n=document.createElement("div");n.classList.add("at-cursor-bar");var r=document.createElement("div");return r.classList.add("at-cursor-beat"),t.style.position="relative",t.style.textAlign="left",e.style.position="absolute",e.style.zIndex="1000",e.style.display="inline",e.style.pointerEvents="none",i.style.position="absolute",n.style.position="absolute",r.style.position="absolute",r.style.transition="all 0s linear",t.insertBefore(e,t.firstChild),e.appendChild(i),e.appendChild(n),e.appendChild(r),new Nn(new wn(e),new wn(n),new wn(r),new wn(i))},e.prototype.getOffset=function(t,e){var i=e.element,n=i.getBoundingClientRect(),r=n.top+i.ownerDocument.defaultView.pageYOffset,a=n.left+i.ownerDocument.defaultView.pageXOffset;if(t){var o=t.element,s=o.nodeName.toLowerCase();if("html"!==s&&"body"!==s){var h=this.getOffset(null,t);r=r+o.scrollTop-h.y,a=a+o.scrollLeft-h.x}}var c=new It;return c.x=a,c.y=r,c.w=n.width,c.h=n.height,c},e.prototype.getScrollContainer=function(){var t="string"==typeof this._api.settings.player.scrollElement?document.querySelector(this._api.settings.player.scrollElement):this._api.settings.player.scrollElement,e=t.nodeName.toLowerCase();"html"!==e&&"body"!==e||(t="scrollingElement"in document?document.scrollingElement:-1!==navigator.userAgent.indexOf("WebKit")?document.body:document.documentElement);return new wn(t)},e.prototype.createSelectionElement=function(){var t=document.createElement("div");return t.style.position="absolute",new wn(t)},e.prototype.scrollToY=function(t,e,i){this.internalScrollToY(t.element,e,i)},e.prototype.scrollToX=function(t,e,i){this.internalScrollToX(t.element,e,i)},e.prototype.internalScrollToY=function(t,e,i){var n=t.scrollTop,r=e-n,a=0,o=function(e){0===a&&(a=e);var s=e-a,h=Math.min(s/i,1);t.scrollTop=n+r*h|0,s<i&&window.requestAnimationFrame(o)};window.requestAnimationFrame(o)},e.prototype.internalScrollToX=function(t,e,i){var n=t.scrollLeft,r=e-n,a=0,o=function(e){0===a&&(a=e);var s=e-a,h=Math.min(s/i,1);t.scrollLeft=n+r*h|0,s<i&&window.requestAnimationFrame(o)};window.requestAnimationFrame(o)},e}(),xn=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Cn=function(e){function i(t,i){var n=e.call(this,new On(t),i)||this;return n.soundFontLoad=new ui,n}return xn(i,e),i.prototype.tex=function(t,i){var n=this.uiFacade;e.prototype.tex.call(this,t,n.parseTracks(i))},i.prototype.print=function(e){var n=window.open("","","width=0,height=0"),r=n.document.createElement("div");e?r.style.width=e:this.settings.display.layoutMode===t.LayoutMode.Horizontal?r.style.width="297mm":r.style.width="210mm",n.document.write("<!DOCTYPE html><html></head><body></body></html>"),n.document.body.appendChild(r);var a=void 0!==window.screenLeft?window.screenLeft:window.left,o=void 0!==window.screenTop?window.screenTop:window.top,s="innerWidth"in window?window.innerWidth:"clientWidth"in document.documentElement?document.documentElement.clientWidth:window.screen.width,h="innerHeight"in window?window.innerHeight:"clientHeight"in document.documentElement?document.documentElement.clientHeight:window.screen.height,c=r.offsetWidth+50,l=window.innerHeight,u=(s/2|0)-(c/2|0)+a,p=(h/2|0)-(l/2|0)+o;n.resizeTo(c,l),n.moveTo(u,p),n.focus();var d=new Oi;d.core.scriptFile=this.settings.core.scriptFile,d.core.fontDirectory=this.settings.core.fontDirectory,d.core.enableLazyLoading=!1,d.core.useWorkers=!1,d.display.scale=.8,d.display.stretchForce=.8,d.display.resources=this.settings.display.resources;var f=new i(r,d);f.renderer.postRenderFinished.on((function(){f.canvasElement.height=-1,n.print()})),f.renderTracks(this.tracks)},i.prototype.downloadMidi=function(){if(this.score){var t=new di,e=new zi(t);new tn(this.score,this.settings,e).generate();var i=t.toBinary(),n=this.score.title?this.score.title+".mid":"File.mid",r=document.createElement("a");r.download=n;var a=new Blob([i],{type:"audio/midi"}),o=URL.createObjectURL(a);r.href=o,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)}},i.prototype.changeTrackMute=function(t,i){var n=this.trackIndexesToTracks(this.uiFacade.parseTracks(t));e.prototype.changeTrackMute.call(this,n,i)},i.prototype.changeTrackSolo=function(t,i){var n=this.trackIndexesToTracks(this.uiFacade.parseTracks(t));e.prototype.changeTrackSolo.call(this,n,i)},i.prototype.changeTrackVolume=function(t,i){var n=this.trackIndexesToTracks(this.uiFacade.parseTracks(t));e.prototype.changeTrackVolume.call(this,n,i)},i.prototype.trackIndexesToTracks=function(t){if(!this.score)return[];var e=[];if(1===t.length&&-1===t[0])for(var i=0,n=this.score.tracks;i<n.length;i++){var r=n[i];e.push(r)}else for(var a=0,o=t;a<o.length;a++){var s=o[a];s>=0&&s<this.score.tracks.length&&e.push(this.score.tracks[s])}return e},i.prototype.loadSoundFontFromUrl=function(t,e){var i=this;this.player&&this.player.loadSoundFontFromUrl(t,e,(function(t){i.soundFontLoad.trigger(t),i.uiFacade.triggerEvent(i.container,"soundFontLoad",t)}))},i}(gn),Fn=function(){function t(){this._initListeners=[]}return t.prototype.exec=function(t,e,i){if("string"!=typeof e&&(i=[e],e="init"),95===e.charCodeAt(0)||"exec"===e)return null;var n=new jQuery(t),r=n.data("alphaTab");if("destroy"===e&&!r)return null;if("init"!==e&&!r)throw new Error("alphaTab not initialized");var a=this[e];if(a){var o=[n,r].concat(i);return a.apply(this,o)}return et.error("Api","Method '"+e+"' does not exist on jQuery.alphaTab"),null},t.prototype.init=function(t,e,i){if(!e){e=new Cn(t[0],i),t.data("alphaTab",e);for(var n=0,r=this._initListeners;n<r.length;n++){(0,r[n])(t,e,i)}}},t.prototype.destroy=function(t,e){t.removeData("alphaTab"),e.destroy()},t.prototype.print=function(t,e,i){e.print(i)},t.prototype.load=function(t,e,i,n){return e.load(i,n)},t.prototype.render=function(t,e){e.render()},t.prototype.renderScore=function(t,e,i,n){e.renderScore(i,n)},t.prototype.renderTracks=function(t,e,i){e.renderTracks(i)},t.prototype.invalidate=function(t,e){e.render()},t.prototype.tex=function(t,e,i,n){e.tex(i,n)},t.prototype.muteTrack=function(t,e,i,n){e.changeTrackMute(i,n)},t.prototype.soloTrack=function(t,e,i,n){e.changeTrackSolo(i,n)},t.prototype.trackVolume=function(t,e,i,n){e.changeTrackVolume(i,n)},t.prototype.loadSoundFont=function(t,e,i,n){e.loadSoundFont(i,n)},t.prototype.resetSoundFonts=function(t,e){e.resetSoundFonts()},t.prototype.pause=function(t,e){e.pause()},t.prototype.play=function(t,e){return e.play()},t.prototype.playPause=function(t,e){e.playPause()},t.prototype.stop=function(t,e){e.stop()},t.prototype.api=function(t,e){return e},t.prototype.player=function(t,e){return e.player},t.prototype.isReadyForPlayback=function(t,e){return e.isReadyForPlayback},t.prototype.playerState=function(t,e){return e.playerState},t.prototype.masterVolume=function(t,e,i){return"number"==typeof i&&(e.masterVolume=i),e.masterVolume},t.prototype.metronomeVolume=function(t,e,i){return"number"==typeof i&&(e.metronomeVolume=i),e.metronomeVolume},t.prototype.countInVolume=function(t,e,i){return"number"==typeof i&&(e.countInVolume=i),e.countInVolume},t.prototype.playbackSpeed=function(t,e,i){return"number"==typeof i&&(e.playbackSpeed=i),e.playbackSpeed},t.prototype.tickPosition=function(t,e,i){return"number"==typeof i&&(e.tickPosition=i),e.tickPosition},t.prototype.timePosition=function(t,e,i){return"number"==typeof i&&(e.timePosition=i),e.timePosition},t.prototype.loop=function(t,e,i){return"boolean"==typeof i&&(e.isLooping=i),e.isLooping},t.prototype.renderer=function(t,e){return e.renderer},t.prototype.score=function(t,e){return e.score},t.prototype.settings=function(t,e){return e.settings},t.prototype.tracks=function(t,e){return e.tracks},t.prototype._oninit=function(t){this._initListeners.push(t)},t.restore=function(t){new jQuery(t).empty().removeData("alphaTab")},t}(),Ln=function(){function t(){this.buffer="",this._currentPath="",this._currentPathIsEmpty=!0,this.color=new m(255,255,255,255),this.lineWidth=1,this.font=new _("Arial",10,d.Plain),this.textAlign=K.Left,this.textBaseline=Z.Top}return t.prototype.beginRender=function(t,e){this.buffer='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+(0|t)+'px" height="'+(0|e)+'px" class="at-surface-svg">\n',this._currentPath="",this._currentPathIsEmpty=!0},t.prototype.beginGroup=function(t){this.buffer+='<g class="'+t+'">'},t.prototype.endGroup=function(){this.buffer+="</g>"},t.prototype.endRender=function(){return this.buffer+="</svg>",this.buffer},t.prototype.fillRect=function(t,e,i,n){i>0&&(this.buffer+='<rect x="'+(0|t)+'" y="'+(0|e)+'" width="'+i+'" height="'+n+'" fill="'+this.color.rgba+'" />\n')},t.prototype.strokeRect=function(t,e,i,n){this.buffer+='<rect x="'+(0|t)+'" y="'+(0|e)+'" width="'+i+'" height="'+n+'" stroke="'+this.color.rgba+'"',1!==this.lineWidth&&(this.buffer+=' stroke-width="'+this.lineWidth+'"'),this.buffer+=' fill="transparent" />\n'},t.prototype.beginPath=function(){},t.prototype.closePath=function(){this._currentPath+=" z"},t.prototype.moveTo=function(t,e){this._currentPath+=" M"+t+","+e},t.prototype.lineTo=function(t,e){this._currentPathIsEmpty=!1,this._currentPath+=" L"+t+","+e},t.prototype.quadraticCurveTo=function(t,e,i,n){this._currentPathIsEmpty=!1,this._currentPath+=" Q"+t+","+e+","+i+","+n},t.prototype.bezierCurveTo=function(t,e,i,n,r,a){this._currentPathIsEmpty=!1,this._currentPath+=" C"+t+","+e+","+i+","+n+","+r+","+a},t.prototype.fillCircle=function(t,e,i){this._currentPathIsEmpty=!1,this._currentPath+=" M"+(t-i)+","+e+" A1,1 0 0,0 "+(t+i)+","+e+" A1,1 0 0,0 "+(t-i)+","+e+" z",this.fill()},t.prototype.strokeCircle=function(t,e,i){this._currentPathIsEmpty=!1,this._currentPath+=" M"+(t-i)+","+e+" A1,1 0 0,0 "+(t+i)+","+e+" A1,1 0 0,0 "+(t-i)+","+e+" z",this.stroke()},t.prototype.fill=function(){this._currentPathIsEmpty||(this.buffer+='<path d="'+this._currentPath+'"',"#000000"!==this.color.rgba&&(this.buffer+=' fill="'+this.color.rgba+'"'),this.buffer+=' style="stroke: none"/>'),this._currentPath="",this._currentPathIsEmpty=!0},t.prototype.stroke=function(){if(!this._currentPathIsEmpty){var t='<path d="'+this._currentPath+'" stroke="'+this.color.rgba+'"';1!==this.lineWidth&&(t+=' stroke-width="'+this.lineWidth+'"'),t+=' style="fill: none" />',this.buffer+=t}this._currentPath="",this._currentPathIsEmpty=!0},t.prototype.fillText=function(t,e,i){if(""!==t){var n='<text x="'+(0|e)+'" y="'+(0|i)+'" style="stroke: none; font:'+this.font.toCssString(this.settings.display.scale)+'" '+this.getSvgBaseLine();"#000000"!==this.color.rgba&&(n+=' fill="'+this.color.rgba+'"'),this.textAlign!==K.Left&&(n+=' text-anchor="'+this.getSvgTextAlignment(this.textAlign)+'"'),n+=">"+t+"</text>",this.buffer+=n}},t.prototype.getSvgTextAlignment=function(t){switch(t){case K.Left:return"start";case K.Center:return"middle";case K.Right:return"end"}return""},t.prototype.getSvgBaseLine=function(){switch(this.textBaseline){case Z.Top:return'dy="1.25ex"';case Z.Middle:return'dy="0.5ex"';case Z.Bottom:default:return""}},t.prototype.measureText=function(t){return t?Mi.measureString(t,this.font.family,this.font.size,this.font.style):0},t.prototype.onRenderFinished=function(){return null},t.prototype.beginRotate=function(t,e,i){this.buffer+='<g transform="translate('+t+" ,"+e+") rotate( "+i+')">'},t.prototype.endRotate=function(){this.buffer+="</g>"},t}(),En=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Mn=function(t){function e(){return t.call(this)||this}return En(e,t),e.prototype.fillMusicFontSymbol=function(t,e,i,n,r){void 0===r&&(r=!1),n!==Q.None&&this.fillMusicFontSymbolText(t,e,i,"&#"+n+";",r)},e.prototype.fillMusicFontSymbols=function(t,e,i,n,r){void 0===r&&(r=!1);for(var a="",o=0,s=n;o<s.length;o++){var h=s[o];h!==Q.None&&(a+="&#"+h+";")}this.fillMusicFontSymbolText(t,e,i,a,r)},e.prototype.fillMusicFontSymbolText=function(t,e,i,n,r){void 0===r&&(r=!1),this.buffer+='<g transform="translate('+t+" "+e+')" class="at" ><text',this.buffer+=1!==i?' style="font-size: '+100*i+'%; stroke:none"':' style="stroke:none"',"#000000"!==this.color.rgba&&(this.buffer+=' fill="'+this.color.rgba+'"'),r&&(this.buffer+=' text-anchor="'+this.getSvgTextAlignment(K.Center)+'"'),this.buffer+=">"+n+"</text></g>"},e}(Ln),Dn=function(){function t(){this.isInAccolade=!0,this.isRelevantForBoundsLookup=!0,this.hideOnMultiTrack=!1,this.hideOnPercussionTrack=!1}return t.prototype.canCreate=function(t,e){return!this.hideOnPercussionTrack||!e.isPercussion},t}();!function(t){t[t.PreNotes=0]="PreNotes",t[t.OnNotes=1]="OnNotes",t[t.MiddleNotes=2]="MiddleNotes",t[t.Stem=3]="Stem",t[t.PostNotes=4]="PostNotes",t[t.EndBeat=5]="EndBeat"}(Yi||(Yi={}));var An,In=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Rn=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n.glyphs=null,n}return In(e,t),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return!this.glyphs||0===this.glyphs.length},enumerable:!1,configurable:!0}),e.prototype.doLayout=function(){if(this.glyphs&&0!==this.glyphs.length){for(var t=0,e=0,i=this.glyphs.length;e<i;e++){var n=this.glyphs[e];n.renderer=this.renderer,n.doLayout(),t=Math.max(t,n.width)}this.width=t}else this.width=0},e.prototype.addGlyph=function(t){this.glyphs||(this.glyphs=[]),this.glyphs.push(t)},e.prototype.paint=function(t,e,i){var n=this.glyphs;if(n&&0!==n.length)for(var r=0,a=n;r<a.length;r++){a[r].paint(t+this.x,e+this.y,i)}},e}(nn),Gn=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),jn=function(t){function e(){var e=t.call(this,0,0)||this;return e.glyphs=[],e}return Gn(e,t),e.prototype.addGlyph=function(e){e.x=0===this.glyphs.length?0:this.glyphs[this.glyphs.length-1].x+this.glyphs[this.glyphs.length-1].width,e.renderer=this.renderer,e.doLayout(),this.width=e.x+e.width,t.prototype.addGlyph.call(this,e)},e}(Rn),Vn=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Hn=function(t){function e(e,i,n){var r=t.call(this,e,i)||this;return r.voice=n,r.beatGlyphs=[],r.tupletGroups=[],r}return Vn(e,t),e.prototype.scaleToWidth=function(t){var e=this.renderer.layoutingInfo.spaceToForce(t);this.scaleToForce(e)},e.prototype.scaleToForce=function(t){this.width=this.renderer.layoutingInfo.calculateVoiceWidth(t);for(var e=this.renderer.layoutingInfo.buildOnTimePositions(t),i=this.beatGlyphs,n=0,r=i.length;n<r;n++){var a=i[n],o=a.beat.absoluteDisplayStart;if(a.x=e.get(o)-a.onTimeX,n>0){var s=a.x-i[n-1].x;i[n-1].scaleToWidth(s)}if(n===r-1){s=this.width-i[i.length-1].x;a.scaleToWidth(s)}}},e.prototype.registerLayoutingInfo=function(t){t.updateVoiceSize(this.width);for(var e=0,i=this.beatGlyphs;e<i.length;e++){i[e].registerLayoutingInfo(t)}},e.prototype.applyLayoutingInfo=function(t){for(var e=0,i=this.beatGlyphs;e<i.length;e++){i[e].applyLayoutingInfo(t)}this.scaleToForce(Math.max(this.renderer.settings.display.stretchForce,t.minStretchForce))},e.prototype.addGlyph=function(t){var e=t;t.x=0===this.beatGlyphs.length?0:this.beatGlyphs[this.beatGlyphs.length-1].x+this.beatGlyphs[this.beatGlyphs.length-1].width,t.renderer=this.renderer,t.doLayout(),this.beatGlyphs.push(e),this.width=t.x+t.width,e.beat.hasTuplet&&e.beat.tupletGroup.beats[0].id===e.beat.id&&this.tupletGroups.push(e.beat.tupletGroup)},e.prototype.doLayout=function(){},e.prototype.paint=function(t,e,i){i.color=0===this.voice.index?this.renderer.resources.mainGlyphColor:this.renderer.resources.secondaryGlyphColor;for(var n=0,r=this.beatGlyphs.length;n<r;n++)this.beatGlyphs[n].paint(t+this.x,e+this.y,i)},e.KeySizeBeat="Beat",e}(Rn);!function(t){t[t.None=0]="None",t[t.Natural=1]="Natural",t[t.Sharp=2]="Sharp",t[t.Flat=3]="Flat",t[t.NaturalQuarterNoteUp=4]="NaturalQuarterNoteUp",t[t.SharpQuarterNoteUp=5]="SharpQuarterNoteUp",t[t.FlatQuarterNoteUp=6]="FlatQuarterNoteUp",t[t.DoubleSharp=7]="DoubleSharp",t[t.DoubleFlat=8]="DoubleFlat"}(An||(An={}));var Wn,Un,zn=function(){this.maxLine=-1e3,this.minLine=-1e3},Xn=function(){function t(t){this._registeredAccidentals=new Map,this._appliedScoreLines=new Map,this._appliedScoreLinesByValue=new Map,this._notesByValue=new Map,this._beatLines=new Map,this.maxLineBeat=null,this.minLineBeat=null,this.maxLine=-1e3,this.minLine=-1e3,this._bar=t}return t.getPercussionLine=function(t,e){var i,n;return e<t.staff.track.percussionArticulations.length?t.staff.track.percussionArticulations[e].staffLine:null!==(n=null===(i=at.getArticulationByValue(e))||void 0===i?void 0:i.staffLine)&&void 0!==n?n:0},t.getNoteValue=function(t){if(t.isPercussion)return t.percussionArticulation;var e=t.displayValue;switch(t.accidentalMode){case j.ForceDoubleFlat:e+=2;break;case j.ForceDoubleSharp:e-=2;break;case j.ForceFlat:e+=1;break;case j.ForceSharp:e-=1}return e},t.prototype.applyAccidental=function(e){var i=t.getNoteValue(e),n=e.hasQuarterToneOffset;return this.getAccidental(i,n,e.beat,!1,e)},t.prototype.applyAccidentalForValue=function(t,e,i,n){return this.getAccidental(e,i,t,n,null)},t.computeLineWithoutAccidentals=function(e,i){var n=0,r=t.getNoteValue(i);if(e.staff.isPercussion)n=t.getPercussionLine(e,r);else{var a=i?i.accidentalMode:j.Default;n=t.calculateNoteLine(e,r,a)}return n},t.prototype.getAccidental=function(e,i,n,r,a){void 0===a&&(a=null);var o=An.None,s=0;if(this._bar.staff.isPercussion)s=t.getPercussionLine(this._bar,e);else{var h=a?a.accidentalMode:j.Default;s=t.calculateNoteLine(this._bar,e,h);var c=this._bar.masterBar.keySignature+7,l=e%12,u=c<7?An.Flat:An.Sharp,p=t.KeySignatureLookup[c][l],d=t.AccidentalNotes[l];if(i)switch(o=d?u:An.Natural){case An.Natural:o=An.NaturalQuarterNoteUp;break;case An.Sharp:o=An.SharpQuarterNoteUp;break;case An.Flat:o=An.FlatQuarterNoteUp}else{switch(h){case j.ForceSharp:o=An.Sharp,d=!0;break;case j.ForceDoubleSharp:o=An.DoubleSharp,d=!0;break;case j.ForceFlat:o=An.Flat,d=!0;break;case j.ForceDoubleFlat:o=An.DoubleFlat,d=!0;break;default:d?o=u:p&&(o=An.Natural)}o!==An.None?(this._registeredAccidentals.has(s)?this._registeredAccidentals.get(s)===o&&(o=An.None):p&&o===u&&(o=An.None),o!=An.None&&this._registeredAccidentals.set(s,o)):this._registeredAccidentals.has(s)?this._registeredAccidentals.get(s)===An.Natural?o=An.None:(o=An.Natural,this._registeredAccidentals.set(s,o)):this._registeredAccidentals.delete(s)}}if(a?(this._appliedScoreLines.set(a.id,s),this._notesByValue.set(e,a)):this._appliedScoreLinesByValue.set(e,s),(-1e3===this.minLine||this.minLine<s)&&(this.minLine=s,this.minLineBeat=n),(-1e3===this.maxLine||this.maxLine>s)&&(this.maxLine=s,this.maxLineBeat=n),!r){var f=void 0;this._beatLines.has(n.id)?f=this._beatLines.get(n.id):(f=new zn,this._beatLines.set(n.id,f)),(-1e3===f.minLine||s<f.minLine)&&(f.minLine=s),(-1e3===f.minLine||s>f.maxLine)&&(f.maxLine=s)}return o},t.prototype.getMaxLine=function(t){return this._beatLines.has(t.id)?this._beatLines.get(t.id).maxLine:0},t.prototype.getMinLine=function(t){return this._beatLines.has(t.id)?this._beatLines.get(t.id).minLine:0},t.calculateNoteLine=function(e,i,n){var r=i,a=e.masterBar.keySignature,o=e.clef,s=r%12,h=(r/12|0)-1,c=t.OctaveSteps[o];return c-=h*t.StepsPerOctave,c-=(g.keySignatureIsSharp(a)||g.keySignatureIsNatural(a)?t.SharpNoteSteps:t.FlatNoteSteps)[s]},t.prototype.getNoteLine=function(t){return this._appliedScoreLines.get(t.id)},t.prototype.getNoteLineForValue=function(t,e){return void 0===e&&(e=!1),this._appliedScoreLinesByValue.has(t)?this._appliedScoreLinesByValue.get(t):e&&this._notesByValue.has(t)?this.getNoteLine(this._notesByValue.get(t)):0},t.KeySignatureLookup=[[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0],[!1,!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0],[!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0],[!1,!1,!1,!0,!0,!1,!1,!1,!0,!0,!0,!0],[!1,!1,!1,!0,!0,!1,!1,!1,!1,!1,!0,!0],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!0],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!0,!0,!1,!1,!1,!1,!1],[!0,!0,!1,!1,!1,!0,!0,!1,!1,!1,!1,!1],[!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1],[!0,!0,!0,!0,!1,!0,!0,!0,!0,!1,!1,!1],[!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0]],t.AccidentalNotes=[!1,!0,!1,!0,!1,!1,!0,!1,!0,!1,!0,!1],t.StepsPerOctave=7,t.OctaveSteps=[38,32,30,26,38],t.SharpNoteSteps=[0,0,1,1,2,3,3,4,4,5,5,6],t.FlatNoteSteps=[0,1,1,2,2,3,4,4,5,5,6,6],t}(),Yn=function(){this.staffId="",this.up=0,this.down=0},Jn=function(){function t(t,e){this._beatLineXPositions=new Map,this.voice=null,this.beats=[],this.shortestDuration=A.QuadrupleWhole,this.fingeringCount=0,this.hasTuplet=!1,this._firstBeatLowestNote=null,this._firstBeatLowestNoteCompareValue=-1,this._firstBeatHighestNote=null,this._firstBeatHighestNoteCompareValue=-1,this._lastBeatLowestNote=null,this._lastBeatLowestNoteCompareValue=-1,this._lastBeatHighestNote=null,this._lastBeatHighestNoteCompareValue=-1,this._lowestNoteInHelper=null,this._lowestNoteCompareValueInHelper=-1,this._highestNoteInHelper=null,this._highestNoteCompareValueInHelper=-1,this.invertBeamDirection=!1,this.preferredBeamDirection=null,this.isGrace=!1,this.direction=Xt.Up,this._staff=t,this._renderer=e,this.beats=[]}return Object.defineProperty(t.prototype,"hasLine",{get:function(){return 1===this.beats.length&&this.beats[0].duration>A.Whole},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasFlag",{get:function(){return 1===this.beats.length&&(this.beats[0].duration>A.Quarter||this.beats[0].graceType!==R.None)},enumerable:!1,configurable:!0}),t.prototype.getBeatLineX=function(t){return this.hasBeatLineX(t)?this.direction===Xt.Up?this._beatLineXPositions.get(t.index).up:this._beatLineXPositions.get(t.index).down:0},t.prototype.hasBeatLineX=function(t){return this._beatLineXPositions.has(t.index)},t.prototype.registerBeatLineX=function(t,e,i,n){var r=this.getOrCreateBeatPositions(e);r.staffId=t,r.up=i,r.down=n},t.prototype.getOrCreateBeatPositions=function(t){return this._beatLineXPositions.has(t.index)||this._beatLineXPositions.set(t.index,new Yn),this._beatLineXPositions.get(t.index)},t.prototype.finish=function(){this.direction=this.calculateDirection()},t.prototype.calculateDirection=function(){var t=this.preferredBeamDirection;if(null!==t)return t;if(!this.voice)return Xt.Up;if(this.voice.index>0)return this.invert(Xt.Down);if(this.voice.bar.voices.length>1)for(var e=1;e<this.voice.bar.voices.length;e++)if(!this.voice.bar.voices[e].isEmpty)return this.invert(Xt.Up);if(this.beats[0].graceType!==R.None)return this.invert(Xt.Up);var i=(this._renderer.getNoteY(this._highestNoteInHelper,Wn.Center)+this._renderer.getNoteY(this._lowestNoteInHelper,Wn.Center))/2;return this.invert(this._renderer.middleYPosition<i?Xt.Up:Xt.Down)},t.prototype.invert=function(t){if(!this.invertBeamDirection)return t;switch(t){case Xt.Down:return Xt.Up;case Xt.Up:default:return Xt.Down}},t.prototype.checkBeat=function(e){e.invertBeamDirection&&(this.invertBeamDirection=!0),this.voice||(this.voice=e.voice);var i=!1;if(0===this.beats.length)i=!0;else switch(this.beats[this.beats.length-1].beamingMode){case nt.Auto:i=t.canJoin(this.beats[this.beats.length-1],e);break;case nt.ForceSplitToNext:i=!1;break;case nt.ForceMergeWithNext:i=!0}if(i){null!==e.preferredBeamDirection&&(this.preferredBeamDirection=e.preferredBeamDirection),this.beats.push(e),e.graceType!==R.None&&(this.isGrace=!0),e.hasTuplet&&(this.hasTuplet=!0);for(var n=0,a=0;a<e.notes.length;a++){var o=e.notes[a];o.leftHandFinger===r.Unknown&&o.rightHandFinger===r.Unknown||n++}n>this.fingeringCount&&(this.fingeringCount=n),this._lastBeatLowestNote=null,this._lastBeatHighestNote=null,this.checkNote(e.minNote),this.checkNote(e.maxNote),this.shortestDuration<e.duration&&(this.shortestDuration=e.duration),e.hasTuplet&&(this.hasTuplet=!0)}return i},t.prototype.checkNote=function(t){var e,i;t&&(this.voice&&t.isPercussion?i=e=-Xn.getPercussionLine(this.voice.bar,Xn.getNoteValue(t)):(i=e=Xn.getNoteValue(t),t.harmonicType!==G.None&&t.harmonicType!==G.Natural&&(i=t.realValue-this._staff.displayTranspositionPitch)),1===this.beats.length&&this.beats[0]===t.beat&&((!this._firstBeatLowestNote||e<this._firstBeatLowestNoteCompareValue)&&(this._firstBeatLowestNote=t,this._firstBeatLowestNoteCompareValue=e),(!this._firstBeatHighestNote||i>this._firstBeatHighestNoteCompareValue)&&(this._firstBeatHighestNote=t,this._firstBeatHighestNoteCompareValue=i)),(!this._lastBeatLowestNote||e<this._lastBeatLowestNoteCompareValue)&&(this._lastBeatLowestNote=t,this._lastBeatLowestNoteCompareValue=e),(!this._lastBeatHighestNote||i>this._lastBeatHighestNoteCompareValue)&&(this._lastBeatHighestNote=t,this._lastBeatHighestNoteCompareValue=i),(!this._lowestNoteInHelper||e<this._lowestNoteCompareValueInHelper)&&(this._lowestNoteInHelper=t,this._lowestNoteCompareValueInHelper=e),(!this._highestNoteInHelper||i>this._highestNoteCompareValueInHelper)&&(this._highestNoteInHelper=t,this._highestNoteCompareValueInHelper=i))},t.canJoin=function(e,i){if(!e||!i||e.isRest||i.isRest||e.graceType!==i.graceType||e.graceType===R.BendGrace||i.graceType===R.BendGrace)return!1;if(e.graceType!==R.None&&i.graceType!==R.None)return!0;var n=e.voice.bar;if(n!==i.voice.bar)return!1;var r=e.playbackStart,a=i.playbackStart;if(!t.canJoinDuration(e.duration)||!t.canJoinDuration(i.duration))return r===a;if(e.tupletGroup!==i.tupletGroup)return!1;if(e.hasTuplet&&i.hasTuplet&&e.tupletGroup===i.tupletGroup&&e.tupletGroup.isFull)return!0;var o=z.QuarterTime;switch(n.masterBar.timeSignatureDenominator){case 8:n.masterBar.timeSignatureNumerator%3==0&&(o+=z.QuarterTime/2|0)}return(0|(o+r)/o)===(0|(o+a)/o)},t.canJoinDuration=function(t){switch(t){case A.Whole:case A.Half:case A.Quarter:return!1;default:return!0}},t.isFullBarJoin=function(t,e,i){return g.getIndex(t.duration)-2-i>0&&g.getIndex(e.duration)-2-i>0},Object.defineProperty(t.prototype,"beatOfLowestNote",{get:function(){return this._lowestNoteInHelper.beat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"beatOfHighestNote",{get:function(){return this._highestNoteInHelper.beat},enumerable:!1,configurable:!0}),t.prototype.isPositionFrom=function(t,e){return!this._beatLineXPositions.has(e.index)||(this._beatLineXPositions.get(e.index).staffId===t||!this._beatLineXPositions.get(e.index).staffId)},t}(),qn=function(){function t(t){this.beamHelpers=[],this.beamHelperLookup=[],this._renderer=t}return t.prototype.initialize=function(){for(var t=this._renderer,e=this._renderer.bar,i=null,n=null,r=0,a=e.voices.length;r<a;r++){var o=e.voices[r];this.beamHelpers.push([]),this.beamHelperLookup.push(new Map);for(var s=0,h=o.beats.length;s<h;s++){var c=o.beats[s],l=void 0;c.graceType!==R.None?l=n:(l=i,n=null),c.isRest||l&&l.checkBeat(c)||(l&&l.finish(),(l=new Jn(e.staff,t)).checkBeat(c),c.graceType!==R.None?n=l:i=l,this.beamHelpers[o.index].push(l)),this.beamHelperLookup[o.index].set(c.index,l)}i&&i.finish(),n&&n.finish(),i=null,n=null}},t.prototype.getBeamingHelperForBeat=function(t){return this.beamHelperLookup[t.voice.index].get(t.index)},t}();!function(t){t[t.TopWithStem=0]="TopWithStem",t[t.Top=1]="Top",t[t.Center=2]="Center",t[t.Bottom=3]="Bottom",t[t.BottomWithStem=4]="BottomWithStem"}(Wn||(Wn={})),function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"}(Un||(Un={}));var Qn,Kn=function(){function t(t,e){this._preBeatGlyphs=new jn,this._voiceContainers=new Map,this._postBeatGlyphs=new jn,this.x=0,this.y=0,this.width=0,this.height=0,this.index=0,this.topOverflow=0,this.bottomOverflow=0,this.isLinkedToPrevious=!1,this.canWrap=!0,this._wasFirstOfLine=!1,this._appliedLayoutingInfo=0,this.isFinalized=!1,this.topPadding=0,this.bottomPadding=0,this.scoreRenderer=t,this.bar=e,e&&(this.helpers=new qn(this))}return Object.defineProperty(t.prototype,"nextRenderer",{get:function(){return this.bar&&this.bar.nextBar?this.scoreRenderer.layout.getRendererForBar(this.staff.staveId,this.bar.nextBar):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"previousRenderer",{get:function(){return this.bar&&this.bar.previousBar?this.scoreRenderer.layout.getRendererForBar(this.staff.staveId,this.bar.previousBar):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"middleYPosition",{get:function(){return 0},enumerable:!1,configurable:!0}),t.prototype.registerOverflowTop=function(t){t>this.topOverflow&&(this.topOverflow=t)},t.prototype.registerOverflowBottom=function(t){t>this.bottomOverflow&&(this.bottomOverflow=t)},t.prototype.scaleToWidth=function(t){var e=t-this._preBeatGlyphs.width-this._postBeatGlyphs.width;this._voiceContainers.forEach((function(t){t.scaleToWidth(e)})),this._postBeatGlyphs.x=this._preBeatGlyphs.x+this._preBeatGlyphs.width+e,this.width=t},Object.defineProperty(t.prototype,"resources",{get:function(){return this.settings.display.resources},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"settings",{get:function(){return this.scoreRenderer.settings},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.settings.display.scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isFirstOfLine",{get:function(){return 0===this.index},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLast",{get:function(){return!this.bar||this.bar.index===this.scoreRenderer.layout.lastBarIndex},enumerable:!1,configurable:!0}),t.prototype.registerLayoutingInfo=function(){var t=this.layoutingInfo,e=this._preBeatGlyphs.width;t.preBeatSize<e&&(t.preBeatSize=e),this._voiceContainers.forEach((function(e){e.registerLayoutingInfo(t)}));var i=this._postBeatGlyphs.width;t.postBeatSize<i&&(t.postBeatSize=i)},t.prototype.applyLayoutingInfo=function(){var t=this;if(this._appliedLayoutingInfo>=this.layoutingInfo.version)return!1;this._appliedLayoutingInfo=this.layoutingInfo.version,this._preBeatGlyphs.width=this.layoutingInfo.preBeatSize;var e=this._preBeatGlyphs.x+this._preBeatGlyphs.width;return this._voiceContainers.forEach((function(i){i.x=t._preBeatGlyphs.x+t._preBeatGlyphs.width,i.applyLayoutingInfo(t.layoutingInfo);var n=i.x+i.width;e<n&&(e=n)})),this._postBeatGlyphs.x=Math.floor(e),this._postBeatGlyphs.width=this.layoutingInfo.postBeatSize,this.width=Math.ceil(this._postBeatGlyphs.x+this._postBeatGlyphs.width),!0},t.prototype.finalizeRenderer=function(){this.isFinalized=!0},t.prototype.doLayout=function(){if(this.bar){this.helpers.initialize(),this._preBeatGlyphs=new jn,this._preBeatGlyphs.renderer=this,this._voiceContainers.clear(),this._postBeatGlyphs=new jn,this._postBeatGlyphs.renderer=this;for(var t=0;t<this.bar.voices.length;t++){var e=this.bar.voices[t];if(this.hasVoiceContainer(e)){var i=new Hn(0,0,e);i.renderer=this,this._voiceContainers.set(this.bar.voices[t].index,i)}}this.bar.simileMark===C.SecondOfDouble&&(this.canWrap=!1),this.createPreBeatGlyphs(),this.createBeatGlyphs(),this.createPostBeatGlyphs(),this.updateSizes();for(var n=0,r=this.helpers.beamHelpers;n<r.length;n++)for(var a=0,o=r[n];a<o.length;a++){o[a].finish()}}},t.prototype.hasVoiceContainer=function(t){return!t.isEmpty||0===t.index},t.prototype.updateSizes=function(){this.staff.registerStaffTop(this.topPadding),this.staff.registerStaffBottom(this.height-this.bottomPadding);var t=this._voiceContainers,e=this.beatGlyphsStart,i=e;t.forEach((function(t){t.x=e,t.doLayout();var n=t.x+t.width;i<n&&(i=n)})),this._postBeatGlyphs.x=Math.floor(i),this.width=Math.ceil(this._postBeatGlyphs.x+this._postBeatGlyphs.width),this.height+=this.layoutingInfo.height*this.scale},t.prototype.addPreBeatGlyph=function(t){t.renderer=this,this._preBeatGlyphs.addGlyph(t)},t.prototype.addBeatGlyph=function(t){t.renderer=this,t.preNotes.renderer=this,t.onNotes.renderer=this,t.onNotes.beamingHelper=this.helpers.beamHelperLookup[t.beat.voice.index].get(t.beat.index),this.getVoiceContainer(t.beat.voice).addGlyph(t)},t.prototype.getVoiceContainer=function(t){return this._voiceContainers.get(t.index)},t.prototype.getBeatContainer=function(t){var e;return null===(e=this.getVoiceContainer(t.voice))||void 0===e?void 0:e.beatGlyphs[t.index]},t.prototype.getPreNotesGlyphForBeat=function(t){var e;return null===(e=this.getBeatContainer(t))||void 0===e?void 0:e.preNotes},t.prototype.getOnNotesGlyphForBeat=function(t){var e;return null===(e=this.getBeatContainer(t))||void 0===e?void 0:e.onNotes},t.prototype.paint=function(t,e,i){var n=this;this.paintBackground(t,e,i),i.color=this.resources.mainGlyphColor,this._preBeatGlyphs.paint(t+this.x,e+this.y,i),this._voiceContainers.forEach((function(r){i.color=0===r.voice.index?n.resources.mainGlyphColor:n.resources.secondaryGlyphColor,r.paint(t+n.x,e+n.y,i)})),i.color=this.resources.mainGlyphColor,this._postBeatGlyphs.paint(t+this.x,e+this.y,i)},t.prototype.paintBackground=function(t,e,i){this.layoutingInfo.paint(t+this.x+this._preBeatGlyphs.x+this._preBeatGlyphs.width,e+this.y+this.height,i)},t.prototype.buildBoundingsLookup=function(t,e,i){var n=this,r=new Ai;r.bar=this.bar,r.visualBounds=new It,r.visualBounds.x=e+this.x,r.visualBounds.y=i+this.y+this.topPadding,r.visualBounds.w=this.width,r.visualBounds.h=this.height-this.topPadding-this.bottomPadding,r.realBounds=new It,r.realBounds.x=e+this.x,r.realBounds.y=i+this.y,r.realBounds.w=this.width,r.realBounds.h=this.height,t.addBar(r),this._voiceContainers.forEach((function(t,a){var o=n.bar.isEmpty&&0===a;if(!t.voice.isEmpty||o)for(var s=0,h=t.beatGlyphs.length;s<h;s++){t.beatGlyphs[s].buildBoundingsLookup(r,e+n.x+t.x,i+n.y+t.y,o)}}))},t.prototype.addPostBeatGlyph=function(t){this._postBeatGlyphs.addGlyph(t)},t.prototype.createPreBeatGlyphs=function(){this._wasFirstOfLine=this.isFirstOfLine},t.prototype.createBeatGlyphs=function(){for(var t=0;t<this.bar.voices.length;t++){var e=this.bar.voices[t];this.hasVoiceContainer(e)&&this.createVoiceGlyphs(this.bar.voices[t])}},t.prototype.createVoiceGlyphs=function(t){},t.prototype.createPostBeatGlyphs=function(){},Object.defineProperty(t.prototype,"beatGlyphsStart",{get:function(){return this._preBeatGlyphs.x+this._preBeatGlyphs.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"postBeatGlyphsStart",{get:function(){return this._postBeatGlyphs.x},enumerable:!1,configurable:!0}),t.prototype.getBeatX=function(t,e){void 0===e&&(e=Yi.PreNotes);var i=this.getBeatContainer(t);if(i)switch(e){case Yi.PreNotes:return i.voiceContainer.x+i.x;case Yi.OnNotes:return i.voiceContainer.x+i.x+i.onNotes.x;case Yi.MiddleNotes:return i.voiceContainer.x+i.x+i.onTimeX;case Yi.Stem:var n=i.onNotes.beamingHelper?i.onNotes.beamingHelper.getBeatLineX(t):i.onNotes.x+i.onNotes.width/2;return i.voiceContainer.x+n;case Yi.PostNotes:return i.voiceContainer.x+i.x+i.onNotes.x+i.onNotes.width;case Yi.EndBeat:return i.voiceContainer.x+i.x+i.width}return 0},t.prototype.getNoteX=function(t,e){var i=this.getBeatContainer(t.beat);return i?i.voiceContainer.x+i.x+i.onNotes.x+i.onNotes.getNoteX(t,e):0},t.prototype.getNoteY=function(t,e){var i=this.getOnNotesGlyphForBeat(t.beat);return i?i.getNoteY(t,e):NaN},t.prototype.reLayout=function(){(this._wasFirstOfLine&&!this.isFirstOfLine||!this._wasFirstOfLine&&this.isFirstOfLine)&&(this._preBeatGlyphs=new jn,this._preBeatGlyphs.renderer=this,this.createPreBeatGlyphs()),this.updateSizes(),this.registerLayoutingInfo()},t.prototype.paintSimileMark=function(t,e,i){switch(this.bar.simileMark){case C.Simple:i.fillMusicFontSymbol(t+this.x+(this.width-20*this.scale)/2,e+this.y+this.height/2,1,Q.Repeat1Bar,!1);break;case C.SecondOfDouble:i.fillMusicFontSymbol(t+this.x-28*this.scale/2,e+this.y+this.height/2,1,Q.Repeat2Bars,!1)}},t.LineSpacing=8,t.StemWidth=.12*t.LineSpacing,t.StaffLineThickness=.13*t.LineSpacing,t.BeamThickness=.5*t.LineSpacing,t.BeamSpacing=.25*t.LineSpacing,t}();!function(t){t[t.SinglePreBeat=0]="SinglePreBeat",t[t.SingleOnBeat=1]="SingleOnBeat",t[t.SingleOnBeatToEnd=2]="SingleOnBeatToEnd",t[t.GroupedOnBeat=3]="GroupedOnBeat",t[t.GroupedOnBeatToEnd=4]="GroupedOnBeatToEnd",t[t.FullBar=5]="FullBar"}(Qn||(Qn={}));var Zn,$n=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),tr=function(t){function e(e,i){var n=t.call(this,0,0)||this;return n._uniqueEffectGlyphs=[],n._effectGlyphs=[],n.isEmpty=!0,n.previousBand=null,n.isLinkedToPrevious=!1,n.firstBeat=null,n.lastBeat=null,n.height=0,n.slot=null,n.voice=e,n.info=i,n}return $n(e,t),e.prototype.doLayout=function(){t.prototype.doLayout.call(this);for(var e=0;e<this.renderer.bar.voices.length;e++)this._effectGlyphs.push(new Map),this._uniqueEffectGlyphs.push([])},e.prototype.createGlyph=function(t){if(t.voice===this.voice&&this.info.shouldCreateGlyph(this.renderer.settings,t)&&(!this.info.hideOnMultiTrack||0===this.renderer.staff.trackIndex)){if(this.isEmpty=!1,this.firstBeat&&!t.isBefore(this.firstBeat)||(this.firstBeat=t),!this.lastBeat||t.isAfter(this.lastBeat))switch(this.lastBeat=t,this.info.sizingMode){case Qn.SingleOnBeatToEnd:case Qn.GroupedOnBeatToEnd:this.lastBeat.nextBeat&&(this.lastBeat=this.lastBeat.nextBeat)}var e=this.createOrResizeGlyph(this.info.sizingMode,t);e.height>this.height&&(this.height=e.height)}},e.prototype.createOrResizeGlyph=function(t,e){var i;switch(t){case Qn.FullBar:return(i=this.info.createNewGlyph(this.renderer,e)).renderer=this.renderer,i.beat=e,i.doLayout(),this._effectGlyphs[e.voice.index].set(e.index,i),this._uniqueEffectGlyphs[e.voice.index].push(i),i;case Qn.SinglePreBeat:case Qn.SingleOnBeat:case Qn.SingleOnBeatToEnd:return(i=this.info.createNewGlyph(this.renderer,e)).renderer=this.renderer,i.beat=e,i.doLayout(),this._effectGlyphs[e.voice.index].set(e.index,i),this._uniqueEffectGlyphs[e.voice.index].push(i),i;case Qn.GroupedOnBeat:case Qn.GroupedOnBeatToEnd:var n=t===Qn.GroupedOnBeat?Qn.SingleOnBeat:Qn.SingleOnBeatToEnd;if(e.index>0||this.renderer.index>0){var r=e.previousBeat;if(this.info.shouldCreateGlyph(this.renderer.settings,r)){var a=null;if(e.index>0&&this._effectGlyphs[e.voice.index].has(r.index))a=this._effectGlyphs[e.voice.index].get(r.index);else if(this.renderer.index>0){var o=this.renderer.previousRenderer.getBand(this.voice,this.info.effectId)._effectGlyphs[e.voice.index];o.has(r.index)&&(a=o.get(r.index))}var s=this.createOrResizeGlyph(n,e);return a&&this.info.canExpand(r,e)&&(a.nextGlyph=s,s.previousGlyph=a,this.isLinkedToPrevious=!0),s}return this.createOrResizeGlyph(n,e)}return this.createOrResizeGlyph(n,e);default:return this.createOrResizeGlyph(Qn.SingleOnBeat,e)}},e.prototype.paint=function(e,i,n){t.prototype.paint.call(this,e,i,n);for(var r=0,a=this._uniqueEffectGlyphs.length;r<a;r++)for(var o=this._uniqueEffectGlyphs[r],s=0,h=o.length;s<h;s++){o[s].paint(e+this.x,i+this.y,n)}},e.prototype.alignGlyphs=function(){for(var t=this,e=function(e){i._effectGlyphs[e].forEach((function(i,n){t.alignGlyph(t.info.sizingMode,t.renderer.bar.voices[e].beats[n])}))},i=this,n=0;n<this._effectGlyphs.length;n++)e(n)},e.prototype.alignGlyph=function(t,e){var i,n=this._effectGlyphs[e.voice.index].get(e.index),r=this.renderer.getBeatContainer(e);switch(t){case Qn.SinglePreBeat:i=r.preNotes,n.x=this.renderer.beatGlyphsStart+i.x+r.x,n.width=i.width;break;case Qn.SingleOnBeat:case Qn.GroupedOnBeat:i=r.onNotes,n.x=this.renderer.beatGlyphsStart+i.x+r.x,n.width=i.width;break;case Qn.SingleOnBeatToEnd:case Qn.GroupedOnBeatToEnd:i=r.onNotes,n.x=this.renderer.beatGlyphsStart+i.x+r.x,r.beat.isLastOfVoice?n.width=this.renderer.width-n.x:n.width=r.width-r.preNotes.width-r.preNotes.x;break;case Qn.FullBar:n.width=this.renderer.width}},e}(nn),er=function(){this.uniqueEffectId=null,this.y=0,this.height=0,this.firstBeat=null,this.lastBeat=null},ir=function(){function t(){this.bands=[],this.shared=new er}return t.prototype.update=function(t){t.info.canShareBand||(this.shared.uniqueEffectId=t.info.effectId),t.slot=this,this.bands.push(t),t.height>this.shared.height&&(this.shared.height=t.height),this.shared.firstBeat&&!t.firstBeat.isBefore(this.shared.firstBeat)||(this.shared.firstBeat=t.firstBeat),this.shared.lastBeat&&!t.lastBeat.isAfter(this.shared.lastBeat)||(this.shared.lastBeat=t.lastBeat)},t.prototype.canBeUsed=function(t){return(!this.shared.uniqueEffectId&&t.info.canShareBand||t.info.effectId===this.shared.uniqueEffectId)&&(!this.shared.firstBeat||this.shared.lastBeat.isBefore(t.firstBeat)||this.shared.lastBeat.isBefore(this.shared.firstBeat))},t}(),nr=function(){function t(){this.slots=[],this._effectSlot=new Map}return t.prototype.getOrCreateSlot=function(t){if(this._effectSlot.has(t.info.effectId)&&(n=this._effectSlot.get(t.info.effectId)).canBeUsed(t))return n;for(var e=0,i=this.slots;e<i.length;e++){var n;if((n=i[e]).canBeUsed(t))return n}var r=new ir;return this.slots.push(r),r},t.prototype.register=function(t){var e=this.getOrCreateSlot(t);e.update(t),this._effectSlot.set(t.info.effectId,e)},t}(),rr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ar=function(t){function e(){return t.call(this,0,0)||this}return rr(e,t),e.prototype.doLayout=function(){var t=0;if(this.glyphs)for(var e=0,i=this.glyphs.length;e<i;e++){var n=this.glyphs[e];n.x=t,n.renderer=this.renderer,n.doLayout(),t+=n.width}this.width=t},e.prototype.noteLoop=function(t){for(var e=this.container.beat.notes.length-1;e>=0;e--)t(this.container.beat.notes[e])},e}(Rn),or=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),sr=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.centerX=0,e}return or(e,t),e.prototype.updateBeamingHelper=function(){},e.prototype.buildBoundingsLookup=function(t,e,i){},e.prototype.getNoteX=function(t,e){return 0},e.prototype.getNoteY=function(t,e){return 0},e}(ar),hr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),cr=function(t){function e(e,i,n){var r=t.call(this,e,i)||this;return r._bands=[],r._bandLookup=new Map,r.sizingInfo=null,r._infos=n,r}return hr(e,t),e.prototype.updateSizes=function(){this.topOverflow=0,this.bottomOverflow=0,this.topPadding=0,this.bottomPadding=0,this.updateHeight(),t.prototype.updateSizes.call(this)},e.prototype.finalizeRenderer=function(){t.prototype.finalizeRenderer.call(this),this.updateHeight()},e.prototype.updateHeight=function(){if(this.sizingInfo){for(var t=0,e=0,i=this.sizingInfo.slots;e<i.length;e++){var n=i[e];n.shared.y=t;for(var r=0,a=n.bands;r<a.length;r++){var o=a[r];o.y=t,o.height=n.shared.height}t+=n.shared.height}this.height=t}},e.prototype.applyLayoutingInfo=function(){if(!t.prototype.applyLayoutingInfo.call(this))return!1;if(this.index>0){var e=this.previousRenderer;this.sizingInfo=e.sizingInfo}else this.sizingInfo=new nr;for(var i=0,n=this._bands;i<n.length;i++){var r=n[i];r.alignGlyphs(),r.isEmpty||this.sizingInfo.register(r)}return this.updateHeight(),!0},e.prototype.scaleToWidth=function(e){t.prototype.scaleToWidth.call(this,e);for(var i=0,n=this._bands;i<n.length;i++){n[i].alignGlyphs()}},e.prototype.createBeatGlyphs=function(){this._bands=[],this._bandLookup=new Map;for(var t=0,e=this.bar.voices;t<e.length;t++){var i=e[t];if(this.hasVoiceContainer(i))for(var n=0,r=this._infos;n<r.length;n++){var a=r[n],o=new tr(i,a);o.renderer=this,o.doLayout(),this._bands.push(o),this._bandLookup.set(i.index+"."+a.effectId,o)}}for(var s=0,h=this.bar.voices;s<h.length;s++){i=h[s];this.hasVoiceContainer(i)&&this.createVoiceGlyphs(i)}for(var c=0,l=this._bands;c<l.length;c++){l[c].isLinkedToPrevious&&(this.isLinkedToPrevious=!0)}},e.prototype.createVoiceGlyphs=function(t){for(var e=0,i=t.beats;e<i.length;e++){var n=i[e],r=new dn(n,this.getVoiceContainer(t));r.preNotes=new ar,r.onNotes=new sr,this.addBeatGlyph(r);for(var a=0,o=this._bands;a<o.length;a++){o[a].createGlyph(n)}}},e.prototype.paint=function(t,e,i){this.paintBackground(t,e,i);for(var n=0,r=this._bands;n<r.length;n++){var a=r[n];i.color=0===a.voice.index?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,a.isEmpty||a.paint(t+this.x,e+this.y,i)}},e.prototype.getBand=function(t,e){var i=t.index+"."+e;return this._bandLookup.has(i)?this._bandLookup.get(i):null},e}(Kn),lr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ur=function(t){function e(e,i){var n=t.call(this)||this;return n._infos=i,n._staffId=e,n.isInAccolade=!1,n.isRelevantForBoundsLookup=!1,n}return lr(e,t),Object.defineProperty(e.prototype,"staffId",{get:function(){return this._staffId},enumerable:!1,configurable:!0}),e.prototype.create=function(t,e){return new cr(t,e,this._infos.filter((function(e){return t.settings.notation.isNotationElementVisible(e.notationElement)})))},e}(Dn),pr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),dr=function(t){function e(e,i,n){var r=t.call(this,e,i)||this;r._endingsString="",r._endings=[];for(var a=0;a<yt.MaxAlternateEndings;a++)0!=(n&1<<a)&&r._endings.push(a);return r}return pr(e,t),e.prototype.doLayout=function(){t.prototype.doLayout.call(this),this.height=this.renderer.resources.wordsFont.size+(e.Padding*this.scale+2);for(var i="",n=0,r=this._endings.length;n<r;n++)i+=this._endings[n]+1,i+=". ";this._endingsString=i},e.prototype.paint=function(i,n,r){t.prototype.paint.call(this,i,n,r);var a=r.textBaseline;if(r.textBaseline=Z.Top,this._endings.length>0){var o=this.renderer.resources;r.font=o.wordsFont,r.moveTo(i+this.x,n+this.y+this.height),r.lineTo(i+this.x,n+this.y),r.lineTo(i+this.x+this.width,n+this.y),r.stroke(),r.fillText(this._endingsString,i+this.x+e.Padding*this.scale,n+this.y*this.scale)}r.textBaseline=a},e.Padding=3,e}(an),fr=function(){function t(){}return Object.defineProperty(t.prototype,"effectId",{get:function(){return this.notationElement.toString()},enumerable:!1,configurable:!0}),t}(),yr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),gr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return yr(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectAlternateEndings},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hideOnMultiTrack",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canShareBand",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.FullBar},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyph=function(t,e){return 0===e.voice.index&&0===e.index&&0!==e.voice.bar.masterBar.alternateEndings},e.prototype.createNewGlyph=function(t,e){return new dr(0,0,e.voice.bar.masterBar.alternateEndings)},e.prototype.canExpand=function(t,e){return!0},e}(fr),mr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),br=function(t){function e(e,i,n,r,a){void 0===a&&(a=K.Left);var o=t.call(this,e,i)||this;return o._lines=n.split("\n"),o.font=r,o.textAlign=a,o}return mr(e,t),e.prototype.doLayout=function(){t.prototype.doLayout.call(this),this.height=this.font.size*this._lines.length},e.prototype.paint=function(t,e,i){var n=i.color;i.color=n,i.font=this.font;var r=i.textAlign;i.textAlign=this.textAlign;for(var a=e+this.y,o=0,s=this._lines;o<s.length;o++){var h=s[o];i.fillText(h,t+this.x,a),a+=this.font.size}i.textAlign=r},e}(an),vr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),_r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return vr(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectCapo},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hideOnMultiTrack",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canShareBand",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.SingleOnBeat},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyph=function(t,e){return 0===e.index&&0===e.voice.bar.index&&0!==e.voice.bar.staff.capo},e.prototype.createNewGlyph=function(t,e){return new br(0,0,"Capo. fret "+e.voice.bar.staff.capo,t.resources.effectFont,K.Left)},e.prototype.canExpand=function(t,e){return!1},e}(fr),wr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Sr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return wr(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectChordNames},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hideOnMultiTrack",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canShareBand",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.SingleOnBeat},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyph=function(t,e){return e.hasChord},e.prototype.createNewGlyph=function(t,e){return new br(0,0,e.chord.name,t.resources.effectFont,K.Center)},e.prototype.canExpand=function(t,e){return!1},e}(fr),Br=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Tr=function(t){function e(e){var i=t.call(this)||this;return i.forceGroupedRendering=!1,i.endOnBarLine=!1,i.endPosition=e,i}return Br(e,t),Object.defineProperty(e.prototype,"isLinkedWithPrevious",{get:function(){return!!this.previousGlyph&&this.previousGlyph.renderer.staff.staveGroup===this.renderer.staff.staveGroup},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLinkedWithNext",{get:function(){return!!this.nextGlyph&&this.nextGlyph.renderer.isFinalized&&this.nextGlyph.renderer.staff.staveGroup===this.renderer.staff.staveGroup},enumerable:!1,configurable:!0}),e.prototype.paint=function(t,e,i){if(!this.isLinkedWithPrevious)if(this.isLinkedWithNext||this.forceGroupedRendering){var n;if(!this.isLinkedWithNext&&this.forceGroupedRendering)n=this;else for(n=this.nextGlyph;n.isLinkedWithNext;)n=n.nextGlyph;var r=n.renderer,a=n.beat,o=this.endPosition,s=t-this.renderer.x,h=this.calculateEndX(r,a,s,o);this.paintGrouped(t,e,h,i)}else this.paintNonGrouped(t,e,i)},e.prototype.calculateEndX=function(t,e,i,n){return e?i+t.x+t.getBeatX(e,n):i+t.x+this.x+this.width},e.prototype.paintNonGrouped=function(t,e,i){var n=t-this.renderer.x,r=this.calculateEndX(this.renderer,this.beat,n,this.endPosition);this.paintGrouped(t,e,r,i)},e}(an),kr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Pr=function(t){function e(e,i,n){var r=t.call(this,Yi.EndBeat)||this;return r._crescendo=D.None,r._crescendo=n,r.x=e,r.y=i,r}return kr(e,t),e.prototype.doLayout=function(){t.prototype.doLayout.call(this),this.height=17*this.scale},e.prototype.paintGrouped=function(t,i,n,r){var a=t+this.x,o=this.height*this.scale;r.beginPath(),this._crescendo===D.Crescendo?(n-=e.Padding*this.scale,r.moveTo(n,i+this.y),r.lineTo(a,i+this.y+o/2),r.lineTo(n,i+this.y+o)):(n-=e.Padding*this.scale,r.moveTo(a,i+this.y),r.lineTo(n,i+this.y+o/2),r.lineTo(a,i+this.y+o)),r.stroke()},e.Padding=cn.QuarterNoteHeadWidth/2|0,e}(Tr),Nr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Or=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Nr(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectCrescendo},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hideOnMultiTrack",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canShareBand",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.GroupedOnBeatToEnd},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyph=function(t,e){return e.crescendo!==D.None},e.prototype.createNewGlyph=function(t,e){return new Pr(0,0,e.crescendo)},e.prototype.canExpand=function(t,e){return t.crescendo===e.crescendo},e}(fr),xr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Cr=function(t){function e(i,n,r){return t.call(this,i,n,.6,e.getSymbol(r))||this}return xr(e,t),e.prototype.doLayout=function(){t.prototype.doLayout.call(this),this.height=17*this.scale,this.y+=this.height/2},e.getSymbol=function(t){switch(t){case I.PPP:return Q.DynamicPPP;case I.PP:return Q.DynamicPP;case I.P:return Q.DynamicPiano;case I.MP:return Q.DynamicMP;case I.MF:return Q.DynamicMF;case I.F:return Q.DynamicForte;case I.FF:return Q.DynamicFF;case I.FFF:return Q.DynamicFFF;default:return Q.None}},e}(sn),Fr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Lr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Fr(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectDynamics},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hideOnMultiTrack",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canShareBand",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.SingleOnBeat},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyph=function(t,e){return this.internalShouldCreateGlyph(e)},e.prototype.internalShouldCreateGlyph=function(t){if(t.voice.bar.staff.track.score.stylesheet.hideDynamics||t.isEmpty||t.voice.isEmpty)return!1;var e=0===t.voice.index&&0===t.index&&0===t.voice.bar.index||!!t.previousBeat&&t.dynamics!==t.previousBeat.dynamics;if(e&&t.voice.index>0)for(var i=0,n=t.voice.bar.voices;i<n.length;i++){var r=n[i];if(r.index<t.voice.index){var a=r.getBeatAtDisplayStart(t.displayStart);a&&t.dynamics===a.dynamics&&this.internalShouldCreateGlyph(a)&&(e=!1)}}return e},e.prototype.createNewGlyph=function(t,e){return new Cr(0,0,e.dynamics)},e.prototype.canExpand=function(t,e){return!0},e}(fr),Er=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Mr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Er(e,t),e.prototype.doLayout=function(){t.prototype.doLayout.call(this),this.height=17*this.scale},e.prototype.paint=function(t,e,i){var n=6*this.scale,r=Math.max(this.width,14*this.scale),a=this.height/2;i.beginPath(),i.moveTo(t+this.x,e+this.y+a),i.quadraticCurveTo(t+this.x+r/2,e+this.y+a,t+this.x+r,e+this.y+a-n),i.moveTo(t+this.x,e+this.y+a),i.quadraticCurveTo(t+this.x+r/2,e+this.y+a,t+this.x+r,e+this.y+a+n),i.stroke()},e}(an),Dr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ar=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Dr(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectFadeIn},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hideOnMultiTrack",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canShareBand",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.SingleOnBeat},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyph=function(t,e){return e.fadeIn},e.prototype.createNewGlyph=function(t,e){return new Mr},e.prototype.canExpand=function(t,e){return!0},e}(fr),Ir=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Rr=function(t){function e(i,n,r){return t.call(this,i,n,1,e.getSymbol(r))||this}return Ir(e,t),e.getSymbol=function(t){switch(t){case Rt.Short:return Q.FermataShortAbove;case Rt.Medium:return Q.FermataAbove;case Rt.Long:return Q.FermataLongAbove;default:return Q.None}},e.prototype.doLayout=function(){this.width=23*this.scale,this.height=12*this.scale},e.prototype.paint=function(e,i,n){t.prototype.paint.call(this,e-this.width/2,i+this.height,n)},e}(sn),Gr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),jr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Gr(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectFermata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hideOnMultiTrack",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canShareBand",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.SingleOnBeat},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyph=function(t,e){return 0===e.voice.index&&!!e.fermata},e.prototype.createNewGlyph=function(t,e){return new Rr(0,0,e.fermata.type)},e.prototype.canExpand=function(t,e){return!0},e}(fr),Vr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Hr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Vr(i,e),Object.defineProperty(i.prototype,"notationElement",{get:function(){return h.EffectFingering},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hideOnMultiTrack",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"canShareBand",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sizingMode",{get:function(){return Qn.SingleOnBeat},enumerable:!1,configurable:!0}),i.prototype.shouldCreateGlyph=function(e,i){return!(0!==i.voice.index||i.isRest||e.notation.fingeringMode!==t.FingeringMode.SingleNoteEffectBand&&e.notation.fingeringMode!==t.FingeringMode.SingleNoteEffectBandForcePiano)&&(1===i.notes.length&&i.notes[0].isFingering)},i.prototype.createNewGlyph=function(t,e){var i,n=r.Unknown,a=!1,o=e.notes[0];o.leftHandFinger!==r.Unknown?(n=o.leftHandFinger,a=!0):o.rightHandFinger!==r.Unknown&&(n=o.rightHandFinger);var s=null!==(i=g.fingerToString(t.settings,e,n,a))&&void 0!==i?i:"";return new br(0,0,s,t.resources.fingeringFont,K.Left)},i.prototype.canExpand=function(t,e){return!0},i}(fr),Wr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ur=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lastCreateInfo=null,e}return Wr(e,t),e.prototype.shouldCreateGlyph=function(t,e){this.lastCreateInfo=[];for(var i=0,n=e.notes.length;i<n;i++){var r=e.notes[i];this.shouldCreateGlyphForNote(r)&&this.lastCreateInfo.push(r)}return this.lastCreateInfo.length>0},Object.defineProperty(e.prototype,"hideOnMultiTrack",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canShareBand",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.canExpand=function(t,e){return!0},e}(fr),zr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Xr=function(t){function e(e){var i=t.call(this,Yi.OnNotes)||this;return i._label=e,i}return zr(e,t),e.prototype.doLayout=function(){this.renderer.settings.notation.extendLineEffectsToBeatEnd&&(this.endPosition=Yi.EndBeat,this.forceGroupedRendering=!0),t.prototype.doLayout.call(this),this.height=this.renderer.resources.effectFont.size},e.prototype.paintNonGrouped=function(t,e,i){var n=this.renderer.resources;i.font=n.effectFont;var r=i.textAlign;i.textAlign=K.Center,i.fillText(this._label,t+this.x,e+this.y),i.textAlign=r},e.prototype.paintGrouped=function(t,e,i,n){this.paintNonGrouped(t,e,n);var r=3*this.scale,a=n.measureText(this._label),o=t+this.x+a/2+r,s=e+this.y+4*this.scale,h=8*this.scale;if(i>o){for(var c=o;c<i;)n.beginPath(),n.moveTo(c,0|s),n.lineTo(Math.min(c+h,i),0|s),c+=h+r,n.stroke();n.beginPath(),n.moveTo(i,s-5*this.scale|0),n.lineTo(i,s+5*this.scale|0),n.stroke()}},e.LineSpacing=3,e.LineTopPadding=4,e.LineTopOffset=5,e.LineSize=8,e}(Tr),Yr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Jr=function(t){function e(e){var i=t.call(this)||this;switch(i._beat=null,i._harmonicType=G.None,i._harmonicType=e,e){case G.None:i._effectId="harmonics-none";break;case G.Natural:i._effectId="harmonics-natural";break;case G.Artificial:i._effectId="harmonics-artificial";break;case G.Pinch:i._effectId="harmonics-pinch";break;case G.Tap:i._effectId="harmonics-tap";break;case G.Semi:i._effectId="harmonics-semi";break;case G.Feedback:i._effectId="harmonics-feedback"}return i}return Yr(e,t),Object.defineProperty(e.prototype,"effectId",{get:function(){return this._effectId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectHarmonics},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyphForNote=function(t){return!(!t.isHarmonic||t.harmonicType!==this._harmonicType)&&(t.beat!==this._beat&&(this._beat=t.beat),!0)},Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.GroupedOnBeat},enumerable:!1,configurable:!0}),e.prototype.createNewGlyph=function(t,i){return new Xr(e.harmonicToString(this._harmonicType))},e.harmonicToString=function(t){switch(t){case G.Natural:return"N.H.";case G.Artificial:return"A.H.";case G.Pinch:return"P.H.";case G.Tap:return"T.H.";case G.Semi:return"S.H.";case G.Feedback:return"Fdbk."}return""},e}(Ur),qr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Qr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return qr(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectLetRing},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canShareBand",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hideOnMultiTrack",{get:function(){return!1},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyph=function(t,e){return e.isLetRing},Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.GroupedOnBeat},enumerable:!1,configurable:!0}),e.prototype.createNewGlyph=function(t,e){return new Xr("LetRing")},e.prototype.canExpand=function(t,e){return!0},e}(fr),Kr=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Zr=function(t){function e(e,i,n,r,a){void 0===a&&(a=K.Center);var o=t.call(this,e,i)||this;return o._lines=n,o.font=r,o.textAlign=a,o}return Kr(e,t),e.prototype.doLayout=function(){t.prototype.doLayout.call(this),this.height=this.font.size*this._lines.length},e.prototype.paint=function(t,e,i){i.font=this.font;var n=i.textAlign;i.textAlign=this.textAlign;for(var r=0;r<this._lines.length;r++)this._lines[r]&&i.fillText(this._lines[r],t+this.x,e+this.y+r*this.font.size);i.textAlign=n},e}(an),$r=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ta=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $r(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectLyrics},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hideOnMultiTrack",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canShareBand",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.SingleOnBeat},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyph=function(t,e){return!!e.lyrics},e.prototype.createNewGlyph=function(t,e){return new Zr(0,0,e.lyrics,t.resources.effectFont,K.Center)},e.prototype.canExpand=function(t,e){return!0},e}(fr),ea=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ia=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ea(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectMarker},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hideOnMultiTrack",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canShareBand",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.SinglePreBeat},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyph=function(t,e){return 0===e.voice.bar.staff.index&&0===e.voice.index&&0===e.index&&e.voice.bar.masterBar.isSectionStart},e.prototype.createNewGlyph=function(t,e){return new br(0,0,e.voice.bar.masterBar.section.marker?"["+e.voice.bar.masterBar.section.marker+"] "+e.voice.bar.masterBar.section.text:e.voice.bar.masterBar.section.text,t.resources.markerFont,K.Left)},e.prototype.canExpand=function(t,e){return!0},e}(fr),na=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ra=function(t){function e(e,i){var n=t.call(this,Yi.PostNotes)||this;return n._ottava=e,n._aboveStaff=i,n}return na(e,t),e.prototype.doLayout=function(){t.prototype.doLayout.call(this),this.height=13*this.scale},e.prototype.paintNonGrouped=function(t,e,i){this.paintOttava(t,e,i)},e.prototype.paintOttava=function(t,e,i){var n=0;switch(this._ottava){case x._15ma:n=37*this.scale,i.fillMusicFontSymbol(t+this.x-n/2,e+this.y+this.height,.8,Q.QuindicesimaAlta,!1);break;case x._8va:n=26*this.scale,i.fillMusicFontSymbol(t+this.x-n/2,e+this.y+this.height,.8,Q.OttavaAlta,!1);break;case x._8vb:n=23*this.scale,i.fillMusicFontSymbol(t+this.x-n/2,e+this.y+this.height,.8,Q.OttavaBassaVb,!1);break;case x._15mb:n=36*this.scale,i.fillMusicFontSymbols(t+this.x-n/2,e+this.y+this.height,.8,[Q.Quindicesima,Q.OctaveBaselineM,Q.OctaveBaselineB],!1)}return n/2},e.prototype.paintGrouped=function(t,e,i,n){var r=this.paintOttava(t,e,n),a=3*this.scale,o=t+this.x+r+a,s=e+this.y;s+=this._aboveStaff?2*this.scale:this.height-2*this.scale;var h=8*this.scale;if(i>o){for(var c=o;c<i;)n.beginPath(),n.moveTo(c,0|s),n.lineTo(Math.min(c+h,i),0|s),c+=h+a,n.stroke();n.beginPath(),this._aboveStaff?(n.moveTo(i,s),n.lineTo(i,e+this.y+this.height)):(n.moveTo(i,s),n.lineTo(i,e+this.y)),n.stroke()}},e}(Tr),aa=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),oa=function(t){function e(e){var i=t.call(this)||this;return i._aboveStaff=e,i}return aa(e,t),Object.defineProperty(e.prototype,"effectId",{get:function(){return"ottavia-"+(this._aboveStaff?"above":"below")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectOttavia},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hideOnMultiTrack",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canShareBand",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.GroupedOnBeat},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyph=function(t,e){switch(e.ottava){case x._15ma:case x._8va:return this._aboveStaff;case x._8vb:case x._15mb:return!this._aboveStaff}return!1},e.prototype.createNewGlyph=function(t,e){return new ra(e.ottava,this._aboveStaff)},e.prototype.canExpand=function(t,e){return t.ottava===e.ottava},e}(fr),sa=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ha=function(t){function e(){return t.call(this)||this}return sa(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectPalmMute},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyphForNote=function(t){return t.isPalmMute},Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.GroupedOnBeat},enumerable:!1,configurable:!0}),e.prototype.createNewGlyph=function(t,e){return new Xr("P.M.")},e}(Ur),ca=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),la=function(t){function e(){return t.call(this)||this}return ca(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectPickSlide},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyphForNote=function(t){return t.slideOutType===H.PickSlideDown||t.slideOutType===H.PickSlideUp},Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.GroupedOnBeat},enumerable:!1,configurable:!0}),e.prototype.createNewGlyph=function(t,e){return new Xr("P.S.")},e}(Ur),ua=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),pa=function(t){function e(i,n,r){return t.call(this,i,n,cn.GraceScale,e.getSymbol(r))||this}return ua(e,t),e.prototype.doLayout=function(){this.width=9*this.scale,this.height=13*this.scale},e.prototype.paint=function(e,i,n){t.prototype.paint.call(this,e,i+this.height,n)},e.getSymbol=function(t){switch(t){case q.Up:return Q.StringsUpBow;case q.Down:return Q.StringsDownBow;default:return Q.None}},e}(sn),da=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),fa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return da(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectPickStroke},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hideOnMultiTrack",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canShareBand",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.SingleOnBeat},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyph=function(t,e){return e.pickStroke!==q.None},e.prototype.createNewGlyph=function(t,e){return new pa(0,0,e.pickStroke)},e.prototype.canExpand=function(t,e){return!0},e}(fr),ya=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ga=function(t){function e(e){var i=t.call(this,Yi.EndBeat)||this;return i._stepSize=0,i._type=e,i}return ya(e,t),e.prototype.doLayout=function(){switch(t.prototype.doLayout.call(this),this._type){case W.Slight:this._stepSize=12*this.scale;break;case W.Wide:this._stepSize=23*this.scale}this.height=18*this.scale},e.prototype.paintGrouped=function(t,e,i,n){var r=t+this.x,a=i-r,o=Math.max(1,a/this._stepSize);n.beginPath(),n.moveTo(r,e+this.y);for(var s=0;s<o;s++)n.lineTo(r+this._stepSize/2,e+this.y+this.height),n.lineTo(r+this._stepSize,e+this.y),r+=this._stepSize;n.stroke()},e}(Tr),ma=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ba=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ma(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectSlightBeatVibrato},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hideOnMultiTrack",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canShareBand",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.GroupedOnBeatToEnd},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyph=function(t,e){return e.vibrato===W.Slight},e.prototype.createNewGlyph=function(t,e){return new ga(W.Slight)},e.prototype.canExpand=function(t,e){return!0},e}(fr),va=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),_a=function(t){function e(e,i,n,r,a){void 0===r&&(r=1.2),void 0===a&&(a=!1);var o=t.call(this,Yi.EndBeat)||this;return o._scale=0,o._symbol=Q.None,o._symbolSize=0,o._type=n,o._scale=r,o.x=e,o.y=i,o._partialWaves=a,o}return va(e,t),e.prototype.doLayout=function(){t.prototype.doLayout.call(this);var e=0;switch(this._type){case W.Slight:this._symbol=Q.WiggleTrill,this._symbolSize=9*this._scale,e=6*this._scale;break;case W.Wide:this._symbol=Q.WiggleVibratoMediumFast,this._symbolSize=10*this._scale,e=10*this._scale}this.height=e*this.scale},e.prototype.paintGrouped=function(t,e,i,n){var r=i-(t+this.x),a=this._symbolSize*this.scale,o=r/a;this._partialWaves||(o=Math.floor(o)),o<1&&(o=1);for(var s=0,h=0;h<o;h++)n.fillMusicFontSymbol(t+this.x+s,e+this.y+2*this.height,this._scale*this.scale,this._symbol,!1),s+=a},e}(Tr),wa=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Sa=function(t){function e(){return t.call(this)||this}return wa(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectSlightNoteVibrato},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyphForNote=function(t){return t.vibrato===W.Slight||t.isTieDestination&&t.tieOrigin.vibrato===W.Slight},Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.GroupedOnBeatToEnd},enumerable:!1,configurable:!0}),e.prototype.createNewGlyph=function(t,e){return new _a(0,0,W.Slight,1.2)},e}(Ur),Ba=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ta=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ba(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectTap},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hideOnMultiTrack",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canShareBand",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.SingleOnBeat},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyph=function(t,e){return e.slap||e.pop||e.tap},e.prototype.createNewGlyph=function(t,e){var i=t.resources;return e.slap?new br(0,0,"S",i.effectFont,K.Left):e.pop?new br(0,0,"P",i.effectFont,K.Left):new br(0,0,"T",i.effectFont,K.Left)},e.prototype.canExpand=function(t,e){return!0},e}(fr),ka=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Pa=function(t){function e(e,i,n){var r=t.call(this,e,i)||this;return r._tempo=0,r._tempo=n,r}return ka(e,t),e.prototype.doLayout=function(){t.prototype.doLayout.call(this),this.height=25*this.scale},e.prototype.paint=function(t,e,i){var n=this.renderer.resources;i.font=n.markerFont,i.fillMusicFontSymbol(t+this.x,e+this.y+.8*this.height,this.scale*cn.GraceScale,Q.NoteQuarterUp,!1),i.fillText("= "+this._tempo,t+this.x+this.height/2,e+this.y+i.font.size/2)},e}(an),Na=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Oa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Na(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectTempo},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hideOnMultiTrack",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canShareBand",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.SinglePreBeat},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyph=function(t,e){return 0===e.voice.bar.staff.index&&0===e.voice.index&&0===e.index&&(!!e.voice.bar.masterBar.tempoAutomation||0===e.voice.bar.index)},e.prototype.createNewGlyph=function(t,e){var i=0;return i=e.voice.bar.masterBar.tempoAutomation?e.voice.bar.masterBar.tempoAutomation.value:e.voice.bar.staff.track.score.tempo,new Pa(0,0,i)},e.prototype.canExpand=function(t,e){return!0},e}(fr),xa=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ca=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return xa(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectText},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hideOnMultiTrack",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canShareBand",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.SingleOnBeat},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyph=function(t,e){return!!e.text},e.prototype.createNewGlyph=function(t,e){return new br(0,0,e.text,t.resources.effectFont,K.Left)},e.prototype.canExpand=function(t,e){return!0},e}(fr),Fa=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),La=function(t){function e(e,i){return t.call(this,e,i)||this}return Fa(e,t),e.prototype.doLayout=function(){t.prototype.doLayout.call(this),this.height=20*this.scale},e.prototype.paint=function(t,e,i){var n=this.renderer.resources;i.font=n.markerFont;var r=i.measureText("tr");i.fillText("tr",t+this.x,e+this.y+i.font.size/2);for(var a=r+3*this.scale,o=this.width-a,s=11*this.scale*1.2,h=Math.max(1,(o-a)/s),c=a,l=e+this.y+this.height,u=0;u<h;u++)i.fillMusicFontSymbol(t+this.x+c,l,1.2,Q.WiggleTrill,!1),c+=s},e}(an),Ea=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ma=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ea(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectTrill},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyphForNote=function(t){return t.isTrill},Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.SingleOnBeat},enumerable:!1,configurable:!0}),e.prototype.createNewGlyph=function(t,e){return new La(0,0)},e}(Ur),Da=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();!function(t){t[t.Full=0]="Full",t[t.PartialLeft=1]="PartialLeft",t[t.PartialRight=2]="PartialRight"}(Zn||(Zn={}));var Aa,Ia=function(t){function e(e){var i=t.call(this,0,0)||this;return i._tripletFeel=e,i}return Da(e,t),e.prototype.doLayout=function(){t.prototype.doLayout.call(this),this.height=25*this.scale},e.prototype.paint=function(t,i,n){t+=this.x;var r=(i+=this.y)+this.height*cn.GraceScale;n.font=this.renderer.resources.effectFont,n.fillText("(",t,i+.3*this.height);var a=t+10*this.scale,o=t+40*this.scale;switch(this._tripletFeel){case dt.NoTripletFeel:this.renderBarNote(a,r,e.NoteScale,n,[Zn.Full]),this.renderBarNote(o,r,e.NoteScale,n,[Zn.Full]);break;case dt.Triplet8th:this.renderBarNote(a,r,e.NoteScale,n,[Zn.Full]),n.fillMusicFontSymbol(o,r,e.NoteScale,Q.NoteQuarterUp,!1),n.fillMusicFontSymbol(o+e.NoteSeparation*this.scale,r,e.NoteScale,Q.NoteEighthUp,!1),this.renderTriplet(o,i,n);break;case dt.Triplet16th:this.renderBarNote(a,r,e.NoteScale,n,[Zn.Full,Zn.Full]),this.renderBarNote(o,r,e.NoteScale,n,[Zn.Full,Zn.PartialRight]),this.renderTriplet(o,i,n);break;case dt.Dotted8th:this.renderBarNote(a,r,e.NoteScale,n,[Zn.Full]),this.renderBarNote(o,r,e.NoteScale,n,[Zn.Full,Zn.PartialRight]),n.fillCircle(o+9*this.scale,r,this.scale);break;case dt.Dotted16th:this.renderBarNote(a,r,e.NoteScale,n,[Zn.Full,Zn.Full]),this.renderBarNote(o,r,e.NoteScale,n,[Zn.Full,Zn.Full,Zn.PartialRight]),n.fillCircle(o+9*this.scale,r,this.scale);break;case dt.Scottish8th:this.renderBarNote(a,r,e.NoteScale,n,[Zn.Full]),this.renderBarNote(o,r,e.NoteScale,n,[Zn.Full,Zn.PartialLeft]),n.fillCircle(o+e.NoteSeparation*this.scale+8*this.scale,r,this.scale);break;case dt.Scottish16th:this.renderBarNote(a,r,e.NoteScale,n,[Zn.Full,Zn.Full]),this.renderBarNote(o,r,e.NoteScale,n,[Zn.Full,Zn.Full,Zn.PartialLeft]),n.fillCircle(o+e.NoteSeparation*this.scale+8*this.scale,r,this.scale)}n.fillText("=",t+30*this.scale,i+5*this.scale),n.fillText(")",t+65*this.scale,i+.3*this.height)},e.prototype.renderBarNote=function(t,i,n,r,a){r.fillMusicFontSymbol(t,i,n,Q.NoteQuarterUp,!1);for(var o=e.NoteSeparation/2*this.scale,s=0;s<a.length;s++)switch(a[s]){case Zn.Full:r.fillRect(t+4*this.scale,i-e.NoteHeight*this.scale+e.BarSeparation*this.scale*s,e.NoteSeparation*this.scale,e.BarHeight*this.scale);break;case Zn.PartialLeft:r.fillRect(t+4*this.scale,i-e.NoteHeight*this.scale+e.BarSeparation*this.scale*s,o,e.BarHeight*this.scale);break;case Zn.PartialRight:r.fillRect(t+4*this.scale+o,i-e.NoteHeight*this.scale+e.BarSeparation*this.scale*s,o,e.BarHeight*this.scale)}r.fillMusicFontSymbol(t+e.NoteSeparation*this.scale,i,n,Q.NoteQuarterUp,!1)},e.prototype.renderTriplet=function(t,i,n){i+=2*this.scale;var r=this.renderer.resources.effectFont;n.font=new _(r.family,.8*r.size,r.style);var a=t+e.NoteSeparation*this.scale+3*this.scale;n.beginPath(),n.moveTo(t,i+3*this.scale),n.lineTo(t,i),n.lineTo(t+5*this.scale,i),n.moveTo(a+5*this.scale,i+3*this.scale),n.lineTo(a+5*this.scale,i),n.lineTo(a,i),n.stroke(),n.fillText("3",t+7*this.scale,i-10*this.scale),n.font=r},e.NoteScale=.4,e.NoteHeight=12,e.NoteSeparation=12,e.BarHeight=2,e.BarSeparation=3,e}(an),Ra=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ga=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ra(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectTripletFeel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hideOnMultiTrack",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canShareBand",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.SinglePreBeat},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyph=function(t,e){return 0===e.index&&(0===e.voice.bar.masterBar.index&&e.voice.bar.masterBar.tripletFeel!==dt.NoTripletFeel||e.voice.bar.masterBar.index>0&&e.voice.bar.masterBar.tripletFeel!==e.voice.bar.masterBar.previousMasterBar.tripletFeel)},e.prototype.createNewGlyph=function(t,e){return new Ia(e.voice.bar.masterBar.tripletFeel)},e.prototype.canExpand=function(t,e){return!0},e}(fr),ja=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Va=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ja(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectWhammyBar},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hideOnMultiTrack",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canShareBand",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.GroupedOnBeat},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyph=function(t,e){return e.hasWhammyBar},e.prototype.createNewGlyph=function(t,e){return new Xr("w/bar")},e.prototype.canExpand=function(t,e){return!0},e}(fr),Ha=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Wa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ha(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectWideBeatVibrato},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hideOnMultiTrack",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canShareBand",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.GroupedOnBeatToEnd},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyph=function(t,e){return e.vibrato===W.Wide},e.prototype.createNewGlyph=function(t,e){return new ga(W.Wide)},e.prototype.canExpand=function(t,e){return!0},e}(fr),Ua=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),za=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ua(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectWideNoteVibrato},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyphForNote=function(t){return t.vibrato===W.Wide||t.isTieDestination&&t.tieOrigin.vibrato===W.Wide},Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.GroupedOnBeatToEnd},enumerable:!1,configurable:!0}),e.prototype.createNewGlyph=function(t,e){return new _a(0,0,W.Wide,1.2)},e}(Ur),Xa=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ya=function(t){function e(e,i,n){var r=t.call(this,e,i)||this;return r._textRow=0,r._fretRow=0,r._firstFretSpacing=0,r._chord=n,r}return Xa(e,t),e.prototype.doLayout=function(){t.prototype.doLayout.call(this);var i=this.renderer.resources;this._textRow=1.5*i.effectFont.size,this._fretRow=1.5*i.effectFont.size,this._chord.firstFret>1?this._firstFretSpacing=e.FretSpacing*this.scale:this._firstFretSpacing=0,this.height=this._textRow+this._fretRow+(e.Frets-1)*e.FretSpacing*this.scale+2*e.Padding,this.width=this._firstFretSpacing+(this._chord.staff.tuning.length-1)*e.StringSpacing*this.scale+2*e.Padding},e.prototype.paint=function(t,i,n){var r=this;t+=this.x+e.Padding*this.scale+this._firstFretSpacing,i+=this.y;var a=this.width-2*e.Padding*this.scale+this.scale-this._firstFretSpacing,o=e.StringSpacing*this.scale,s=e.FretSpacing*this.scale,h=this.renderer.resources,c=e.CircleRadius*this.scale,l=n.textAlign,u=n.textBaseline;n.font=h.effectFont,n.textAlign=K.Center,n.textBaseline=Z.Top,this._chord.showName&&n.fillText(this._chord.name,t+this.width/2,i+h.effectFont.size/2),i+=this._textRow,t+=o/2,n.font=h.fretboardNumberFont,n.textBaseline=Z.Middle;for(var p=0;p<this._chord.staff.tuning.length;p++){var d=t+p*o,f=i+this._fretRow/2;(_=this._chord.strings[this._chord.staff.tuning.length-p-1])<0?n.fillMusicFontSymbol(d,f,this.scale,Q.FretboardX,!0):0===_?n.fillMusicFontSymbol(d,f,this.scale,Q.FretboardO,!0):(_-=this._chord.firstFret-1,n.fillText(_.toString(),d,f))}i+=this._fretRow;for(p=0;p<this._chord.staff.tuning.length;p++){d=t+p*o;n.fillRect(d,i,1,s*e.Frets+this.scale)}this._chord.firstFret>1&&(n.textAlign=K.Left,n.fillText(this._chord.firstFret.toString(),t-this._firstFretSpacing,i+s/2)),n.fillRect(t,i-this.scale,a,2*this.scale);for(p=0;p<=e.Frets;p++){f=i+p*s;n.fillRect(t,f,a,this.scale)}for(var y=new Map,g=0,m=this._chord.barreFrets;g<m.length;g++){var b=m[g];y.set(b-this._chord.firstFret,[-1,-1])}for(var v=0;v<this._chord.strings.length;v++){var _;if((_=this._chord.strings[v])>0){if(_-=this._chord.firstFret,y.has(_)){var w=y.get(_);(-1===w[0]||v<w[0])&&(w[0]=v),(-1===w[1]||v>w[1])&&(w[1]=v)}f=i+_*s+s/2+.5,d=t+(this._chord.strings.length-v-1)*o;n.fillCircle(d,f,c)}}y.forEach((function(e,a){var h=i+a*s+s/2+r.scale,l=t+(r._chord.strings.length-e[1]-1)*o,u=t+(r._chord.strings.length-e[0]-1)*o;n.fillRect(l,h-c,u-l,2*c)})),n.textAlign=l,n.textBaseline=u},e.Padding=5,e.Frets=5,e.CircleRadius=2.5,e.StringSpacing=10,e.FretSpacing=12,e}(an),Ja=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),qa=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._glyphWidth=0,n.height=0,n.glyphs=[],n}return Ja(e,t),e.prototype.doLayout=function(){for(var t=(this.width-this._glyphWidth)/2,e=0,i=this.glyphs;e<i.length;e++){var n=i[e];n.x=t,t+=n.width}},e.prototype.addChord=function(t){this.glyphs.push(t),this._glyphWidth+=t.width,t.height>this.height&&(this.height=t.height)},e}(Rn),Qa=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ka=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._rows=[],n.height=0,n.height=0,n.glyphs=[],n}return Qa(e,t),e.prototype.addChord=function(t){if(t.strings.length>0){var e=new Ya(0,0,t);e.renderer=this.renderer,e.doLayout(),this.glyphs.push(e)}},e.prototype.doLayout=function(){var t=0,i=0,n=2*e.Padding*this.scale;this._rows=[];var r=new qa(t,i);r.width=this.width;for(var a=0,o=this.glyphs;a<o.length;a++){var s=o[a];t+s.width<this.width?(r.addChord(s),t+=s.width):(r.isEmpty||(r.doLayout(),this._rows.push(r),i+=r.height+n),(r=new qa(t=0,i)).width=this.width,r.addChord(s),t+=s.width)}r.isEmpty||(r.doLayout(),this._rows.push(r),i+=r.height+n),this.height=i+n},e.prototype.paint=function(t,i,n){for(var r=0,a=this._rows;r<a.length;r++){a[r].paint(t+this.x,i+this.y+e.Padding*this.scale,n)}},e.Padding=3,e}(Rn),Za=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),$a=function(t){function e(e,i,n,r,a){var o=t.call(this,e,i)||this;return o._scale=0,o.height=0,o._scale=n,o._resources=r,o.createGlyphs(a),o}return Za(e,t),e.prototype.createGlyphs=function(t){if(this.addGlyph(new br(0,0,t.name,this._resources.effectFont,K.Left)),this.height+=15*this._scale,!t.isStandard){for(var e=0|Math.ceil(t.tunings.length/2),i=0,n=this.height,r=0,a=t.tunings.length;r<a;r++){var o="("+(r+1)+") = "+Bt.getTextForTuning(t.tunings[r],!1);this.addGlyph(new br(i,n,o,this._resources.effectFont,K.Left)),n+=this.height,r===e-1&&(n=this.height,i+=43*this._scale)}this.height+=e*(15*this._scale)}},e}(Rn),to=function(){function t(t,e,i){this._sharedLayoutData=new Map,this.barRenderers=[],this.x=0,this.y=0,this.height=0,this.index=0,this.staffIndex=0,this.trackIndex=0,this.staveTop=0,this.topSpacing=20,this.bottomSpacing=5,this.staveBottom=0,this.isFirstInAccolade=!1,this.isLastInAccolade=!1,this._factory=i,this.trackIndex=t,this.modelStaff=e}return Object.defineProperty(t.prototype,"staveId",{get:function(){return this._factory.staffId},enumerable:!1,configurable:!0}),t.prototype.getSharedLayoutData=function(t,e){return this._sharedLayoutData.has(t)?this._sharedLayoutData.get(t):e},t.prototype.setSharedLayoutData=function(t,e){this._sharedLayoutData.set(t,e)},Object.defineProperty(t.prototype,"isInAccolade",{get:function(){return this._factory.isInAccolade},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRelevantForBoundsLookup",{get:function(){return this._factory.isRelevantForBoundsLookup},enumerable:!1,configurable:!0}),t.prototype.registerStaffTop=function(t){this.staveTop=t},t.prototype.registerStaffBottom=function(t){this.staveBottom=t},t.prototype.addBarRenderer=function(t){t.staff=this,t.index=this.barRenderers.length,t.reLayout(),this.barRenderers.push(t),this.staveGroup.layout.registerBarRenderer(this.staveId,t)},t.prototype.addBar=function(t,e){var i;(i=t?this._factory.create(this.staveGroup.layout.renderer,t):new Kn(this.staveGroup.layout.renderer,t)).staff=this,i.index=this.barRenderers.length,i.layoutingInfo=e,i.doLayout(),i.registerLayoutingInfo(),this.barRenderers.push(i),t&&this.staveGroup.layout.registerBarRenderer(this.staveId,i)},t.prototype.revertLastBar=function(){var t=this.barRenderers[this.barRenderers.length-1];return this.barRenderers.splice(this.barRenderers.length-1,1),this.staveGroup.layout.unregisterBarRenderer(this.staveId,t),t},t.prototype.scaleToWidth=function(t){this._sharedLayoutData=new Map;for(var e=(t-this.staveGroup.width)/this.barRenderers.length,i=0,n=this.barRenderers.length;i<n;i++)this.barRenderers[i].scaleToWidth(this.barRenderers[i].width+e)},Object.defineProperty(t.prototype,"topOverflow",{get:function(){for(var t=0,e=0,i=this.barRenderers.length;e<i;e++){var n=this.barRenderers[e];n.topOverflow>t&&(t=n.topOverflow)}return t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottomOverflow",{get:function(){for(var t=0,e=0,i=this.barRenderers.length;e<i;e++){var n=this.barRenderers[e];n.bottomOverflow>t&&(t=n.bottomOverflow)}return t},enumerable:!1,configurable:!0}),t.prototype.finalizeStaff=function(){var t=0;this.height=0;for(var e=this.topOverflow,i=this.bottomOverflow,n=0;n<this.barRenderers.length;n++)this.barRenderers[n].x=t,this.barRenderers[n].y=this.topSpacing+e,this.height=Math.max(this.height,this.barRenderers[n].height),this.barRenderers[n].finalizeRenderer(),t+=this.barRenderers[n].width;this.height>0&&(this.height+=this.topSpacing+e+i+this.bottomSpacing)},t.prototype.paint=function(t,e,i,n,r){if(0!==this.height&&0!==r)for(var a=n,o=Math.min(n+r,this.barRenderers.length);a<o;a++)this.barRenderers[a].paint(t+this.x,e+this.y,i)},t}(),eo=function(){function t(){this.timePosition=0,this.longestDuration=0,this.smallestDuration=0,this.force=0,this.springConstant=0,this.preSpringWidth=0,this.postSpringWidth=0,this.allDurations=[]}return Object.defineProperty(t.prototype,"springWidth",{get:function(){return this.preSpringWidth+this.postSpringWidth},enumerable:!1,configurable:!0}),t}(),io=function(){function t(){this._timeSortedSprings=[],this._xMin=0,this._minTime=-1,this._onTimePositionsForce=0,this._onTimePositions=new Map,this.version=0,this.preBeatSizes=new Map,this.onBeatSizes=new Map,this.onBeatCenterX=new Map,this.preBeatSize=0,this.postBeatSize=0,this.voiceSize=0,this.minStretchForce=0,this.totalSpringConstant=0,this.springs=new Map,this.height=0}return t.prototype.updateVoiceSize=function(t){t>this.voiceSize&&(this.voiceSize=t,this.version++)},t.prototype.setPreBeatSize=function(t,e){(!this.preBeatSizes.has(t.index)||this.preBeatSizes.get(t.index)<e)&&(this.preBeatSizes.set(t.index,e),this.version++)},t.prototype.getPreBeatSize=function(t){return this.preBeatSizes.has(t.index)?this.preBeatSizes.get(t.index):0},t.prototype.setOnBeatSize=function(t,e){(!this.onBeatSizes.has(t.index)||this.onBeatSizes.get(t.index)<e)&&(this.onBeatSizes.set(t.index,e),this.version++)},t.prototype.getOnBeatSize=function(t){return this.onBeatSizes.has(t.index)?this.onBeatSizes.get(t.index):0},t.prototype.getBeatCenterX=function(t){return this.onBeatCenterX.has(t.index)?this.onBeatCenterX.get(t.index):0},t.prototype.setBeatCenterX=function(t,e){(!this.onBeatCenterX.has(t.index)||this.onBeatCenterX.get(t.index)<e)&&(this.onBeatCenterX.set(t.index,e),this.version++)},t.prototype.updateMinStretchForce=function(t){this.minStretchForce<t&&(this.minStretchForce=t)},t.prototype.addSpring=function(t,e,i,n){var r;if(this.version++,this.springs.has(t))(r=this.springs.get(t)).postSpringWidth<n&&(r.postSpringWidth=n),r.preSpringWidth<i&&(r.preSpringWidth=i),e<r.smallestDuration&&(r.smallestDuration=e),e>r.longestDuration&&(r.longestDuration=e),r.allDurations.push(e);else{if((r=new eo).timePosition=t,r.allDurations.push(e),this._timeSortedSprings.length>0)for(var a=this._timeSortedSprings[this._timeSortedSprings.length-1],o=0,s=a.allDurations;o<s.length;o++){var h=s[o];a.timePosition}r.longestDuration=e,r.postSpringWidth=n,r.preSpringWidth=i,this.springs.set(t,r);for(var c=this._timeSortedSprings,l=c.length-1;l>0&&c[l].timePosition>t;)l--;this._timeSortedSprings.splice(l+1,0,r)}return(-1===this._minTime||this._minTime>t)&&(this._minTime=t),r},t.prototype.addBeatSpring=function(t,e,i){var n=t.absoluteDisplayStart;return this.addSpring(n,t.displayDuration,e,i)},t.prototype.finish=function(){this.calculateSpringConstants(),this.version++},t.prototype.calculateSpringConstants=function(){var t=this;this._xMin=0,this.springs.forEach((function(e){e.springWidth<t._xMin&&(t._xMin=e.springWidth)}));for(var e=0,i=this._timeSortedSprings,n=0;n<i.length;n++){var r=i[n],a=0;if(n===i.length-1)a=r.longestDuration;else{var o=i[n+1];a=Math.abs(o.timePosition-r.timePosition)}r.springConstant=this.calculateSpringConstant(r,a),e+=1/r.springConstant}this.totalSpringConstant=1/e,this.minStretchForce=0;for(n=0;n<i.length;n++){r=i[n];var s=0;if(n===i.length-1)s=r.postSpringWidth;else{o=i[n+1];s=r.postSpringWidth+o.preSpringWidth}0===n&&(s+=r.preSpringWidth);var h=s*r.springConstant;this.updateMinStretchForce(h)}},t.prototype.paint=function(t,e,i){},t.prototype.calculateSpringConstant=function(e,i){return i<=0&&(i=z.toTicks(A.SixtyFourth)),0===e.smallestDuration&&(e.smallestDuration=i),e.smallestDuration/i*(1/((1+.85*Math.log2(i/t.MinDuration))*t.MinDurationWidth))},t.prototype.spaceToForce=function(t){return this._timeSortedSprings.length>0&&(t-=this._timeSortedSprings[0].preSpringWidth),t*this.totalSpringConstant},t.prototype.calculateVoiceWidth=function(t){var e=this.calculateWidth(t,this.totalSpringConstant);return this._timeSortedSprings.length>0&&(e+=this._timeSortedSprings[0].preSpringWidth),e},t.prototype.calculateWidth=function(t,e){return t/e},t.prototype.buildOnTimePositions=function(t){if(g.isAlmostEqualTo(this._onTimePositionsForce,t)&&this._onTimePositions)return this._onTimePositions;this._onTimePositionsForce=t;var e=this._onTimePositions=new Map,i=this._timeSortedSprings;if(0===i.length)return e;for(var n=i[0].preSpringWidth,r=0;r<i.length;r++)e.set(i[r].timePosition,n),n+=this.calculateWidth(t,i[r].springConstant);return e},t.MinDuration=30,t.MinDurationWidth=7,t}(),no=function(){this.width=0,this.isLinkedToPrevious=!1,this.canWrap=!0,this.renderers=[]},ro=function(){function t(t,e){this.staves=[],this.stavesRelevantForBoundsLookup=[],this.firstStaffInAccolade=null,this.lastStaffInAccolade=null,this.staveGroup=t,this.track=e}return t.prototype.addStaff=function(t){this.staves.push(t),t.isRelevantForBoundsLookup&&this.stavesRelevantForBoundsLookup.push(t)},t}(),ao=function(){function t(){this._allStaves=[],this._firstStaffInAccolade=null,this._lastStaffInAccolade=null,this._accoladeSpacingCalculated=!1,this.x=0,this.y=0,this.index=0,this.accoladeSpacing=0,this.isFull=!1,this.width=0,this.isLast=!1,this.masterBarsRenderers=[],this.staves=[]}return Object.defineProperty(t.prototype,"firstBarIndex",{get:function(){return this.masterBarsRenderers[0].masterBar.index},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastBarIndex",{get:function(){return this.masterBarsRenderers[this.masterBarsRenderers.length-1].masterBar.index},enumerable:!1,configurable:!0}),t.prototype.addMasterBarRenderers=function(t,e){if(0===t.length)return null;this.masterBarsRenderers.push(e),this.calculateAccoladeSpacing(t),e.layoutingInfo.preBeatSize=0;for(var i=0,n=0,r=this.staves.length;n<r;n++)for(var a=this.staves[n],o=0,s=a.staves.length;o<s;o++){var h=a.staves[o],c=e.renderers[i++];h.addBarRenderer(c)}return this.updateWidth(),e},t.prototype.addBars=function(t,e){if(0===t.length)return null;var i=new no;i.layoutingInfo=new io,i.masterBar=t[0].score.masterBars[e],this.masterBarsRenderers.push(i),this.calculateAccoladeSpacing(t);for(var n=i.layoutingInfo,r=0,a=this.staves;r<a.length;r++)for(var o=a[r],s=0,h=o.staves;s<h.length;s++){var c=h[s],l=o.track.staves[c.modelStaff.index].bars[e];c.addBar(l,n);var u=c.barRenderers[c.barRenderers.length-1];i.renderers.push(u),u.isLinkedToPrevious&&(i.isLinkedToPrevious=!0),u.canWrap||(i.canWrap=!1)}return n.finish(),i.width=this.updateWidth(),i},t.prototype.revertLastBar=function(){if(this.masterBarsRenderers.length>1){var t=this.masterBarsRenderers[this.masterBarsRenderers.length-1];this.masterBarsRenderers.splice(this.masterBarsRenderers.length-1,1);for(var e=0,i=0,n=this._allStaves.length;i<n;i++){var r=this._allStaves[i].revertLastBar();e=Math.max(e,r.width)}return this.width-=e,t}return null},t.prototype.updateWidth=function(){for(var t=0,e=0,i=this._allStaves.length;e<i;e++){var n=this._allStaves[e];n.barRenderers[n.barRenderers.length-1].applyLayoutingInfo(),n.barRenderers[n.barRenderers.length-1].width>t&&(t=n.barRenderers[n.barRenderers.length-1].width)}return this.width+=t,t},t.prototype.calculateAccoladeSpacing=function(e){if(!this._accoladeSpacingCalculated&&0===this.index)if(this._accoladeSpacingCalculated=!0,this.layout.renderer.settings.notation.isNotationElementVisible(h.TrackNames)){var i=this.layout.renderer.canvas,n=this.layout.renderer.settings.display.resources.effectFont;i.font=n;for(var r=0,a=e;r<a.length;r++){var o=a[r];this.accoladeSpacing=Math.ceil(Math.max(this.accoladeSpacing,i.measureText(o.shortName)))}this.accoladeSpacing*=this.layout.scale,this.accoladeSpacing+=2*t.AccoladeLabelSpacing*this.layout.scale,this.width+=this.accoladeSpacing}else this.accoladeSpacing=0},t.prototype.getStaveTrackGroup=function(t){for(var e=0,i=this.staves.length;e<i;e++){var n=this.staves[e];if(n.track===t)return n}return null},t.prototype.addStaff=function(t,e){var i=this.getStaveTrackGroup(t);i||(i=new ro(this,t),this.staves.push(i)),e.staveTrackGroup=i,e.staveGroup=this,e.index=this._allStaves.length,this._allStaves.push(e),i.addStaff(e),e.isInAccolade&&(this._firstStaffInAccolade||(this._firstStaffInAccolade=e,e.isFirstInAccolade=!0),i.firstStaffInAccolade||(i.firstStaffInAccolade=e),this._lastStaffInAccolade||(this._lastStaffInAccolade=e,e.isLastInAccolade=!0),this._lastStaffInAccolade&&(this._lastStaffInAccolade.isLastInAccolade=!1),this._lastStaffInAccolade=e,this._lastStaffInAccolade.isLastInAccolade=!0,i.lastStaffInAccolade=e)},Object.defineProperty(t.prototype,"height",{get:function(){return this._allStaves[this._allStaves.length-1].y+this._allStaves[this._allStaves.length-1].height},enumerable:!1,configurable:!0}),t.prototype.scaleToWidth=function(t){for(var e=0,i=this._allStaves.length;e<i;e++)this._allStaves[e].scaleToWidth(t);this.width=t},t.prototype.paint=function(t,e,i){this.paintPartial(t+this.x,e+this.y,i,0,this.masterBarsRenderers.length)},t.prototype.paintPartial=function(e,i,n,r,a){this.buildBoundingsLookup(e,i);for(var o=0,s=this._allStaves.length;o<s;o++)this._allStaves[o].paint(e,i,n,r,a);var c=this.layout.renderer.settings.display.resources;if(this.staves.length>0&&0===r){if(n.color=c.barSeparatorColor,this._firstStaffInAccolade&&this._lastStaffInAccolade){var l=i+this._firstStaffInAccolade.y+this._firstStaffInAccolade.staveTop+this._firstStaffInAccolade.topSpacing+this._firstStaffInAccolade.topOverflow,u=i+this._lastStaffInAccolade.y+this._lastStaffInAccolade.topSpacing+this._lastStaffInAccolade.topOverflow+this._lastStaffInAccolade.staveBottom,p=e+this._firstStaffInAccolade.x;n.beginPath(),n.moveTo(p,l),n.lineTo(p,u),n.stroke()}n.font=c.effectFont;for(o=0,s=this.staves.length;o<s;o++){var d=this.staves[o];if(d.firstStaffInAccolade&&d.lastStaffInAccolade){l=i+d.firstStaffInAccolade.y+d.firstStaffInAccolade.staveTop+d.firstStaffInAccolade.topSpacing+d.firstStaffInAccolade.topOverflow,u=i+d.lastStaffInAccolade.y+d.lastStaffInAccolade.topSpacing+d.lastStaffInAccolade.topOverflow+d.lastStaffInAccolade.staveBottom,p=e+d.firstStaffInAccolade.x;var f=3*this.layout.renderer.settings.display.scale,y=f,g=l-4*f,m=u+4*f;0===this.index&&this.layout.renderer.settings.notation.isNotationElementVisible(h.TrackNames)&&n.fillText(d.track.shortName,e+t.AccoladeLabelSpacing*this.layout.scale,l),n.fillRect(p-y-f,g,f,m-g);var b=p-y-f,v=p+2*f;n.beginPath(),n.moveTo(b,g),n.bezierCurveTo(b,g,b,g,v,g-f),n.bezierCurveTo(p,g+f,b,g+f,b,g+f),n.closePath(),n.fill(),n.beginPath(),n.moveTo(b,m),n.bezierCurveTo(b,m,p,m,v,m+f),n.bezierCurveTo(p,m-f,b,m-f,b,m-f),n.closePath(),n.fill()}}}},t.prototype.finalizeGroup=function(){for(var t=0,e=0,i=this._allStaves;e<i.length;e++){var n=i[e];n.x=this.accoladeSpacing,n.y=t,n.finalizeStaff(),t+=n.height}},t.prototype.buildBoundingsLookup=function(t,e){if(!this.layout.renderer.boundsLookup.isFinished&&this._firstStaffInAccolade&&this._lastStaffInAccolade){var i=this._allStaves[this._allStaves.length-1],n=e+this.y+this._firstStaffInAccolade.y,r=e+this.y+this._lastStaffInAccolade.y+this._lastStaffInAccolade.height,a=e+this.y+this._allStaves[0].y,o=e+this.y+i.y+i.height,s=e+this.y+this._firstStaffInAccolade.y+this._firstStaffInAccolade.topSpacing+this._firstStaffInAccolade.topOverflow+(this._firstStaffInAccolade.barRenderers.length>0?this._firstStaffInAccolade.barRenderers[0].topPadding:0),h=r-n,c=e+this.y+i.y+i.height-i.bottomSpacing-i.bottomOverflow-(i.barRenderers.length>0?i.barRenderers[0].bottomPadding:0)-s,l=o-a,u=this.x+this._firstStaffInAccolade.x,p=new ji;p.visualBounds=new It,p.visualBounds.x=t,p.visualBounds.y=e+this.y,p.visualBounds.w=this.width,p.visualBounds.h=this.height,p.realBounds=new It,p.realBounds.x=t,p.realBounds.y=e+this.y,p.realBounds.w=this.width,p.realBounds.h=this.height,this.layout.renderer.boundsLookup.addStaveGroup(p);for(var d=new Map,f=0;f<this.staves.length;f++)for(var y=0,g=this.staves[f].stavesRelevantForBoundsLookup;y<g.length;y++)for(var m=g[y],b=0,v=m.barRenderers;b<v.length;b++){var _=v[b],w=void 0;d.has(_.bar.masterBar.index)?w=d.get(_.bar.masterBar.index):((w=new Ri).index=_.bar.masterBar.index,w.isFirstOfLine=_.isFirstOfLine,w.realBounds=new It,w.realBounds.x=u+_.x,w.realBounds.y=a,w.realBounds.w=_.width,w.realBounds.h=l,w.visualBounds=new It,w.visualBounds.x=u+_.x,w.visualBounds.y=n,w.visualBounds.w=_.width,w.visualBounds.h=h,w.lineAlignedBounds=new It,w.lineAlignedBounds.x=u+_.x,w.lineAlignedBounds.y=s,w.lineAlignedBounds.w=_.width,w.lineAlignedBounds.h=c,this.layout.renderer.boundsLookup.addMasterBar(w),d.set(w.index,w)),_.buildBoundingsLookup(w,u,e+this.y+m.y)}}},t.prototype.getBarX=function(t){if(!this._firstStaffInAccolade||0===this.layout.renderer.tracks.length)return 0;var e=this.layout.renderer.tracks[0].staves[0].bars[t];return this.layout.getRendererForBar(this._firstStaffInAccolade.staveId,e).x},t.AccoladeLabelSpacing=10,t}(),oo=function(){function e(t){this._barRendererLookup=new Map,this.width=0,this.height=0,this.scoreInfoGlyphs=new Map,this.chordDiagrams=null,this.tuningGlyph=null,this.firstBarIndex=0,this.lastBarIndex=0,this.renderer=t}return e.prototype.layoutAndRender=function(){var t=this.renderer.score,e=this.renderer.settings.display.startBar;e--,e=Math.min(t.masterBars.length-1,Math.max(0,e)),this.firstBarIndex=e;var i=this.renderer.settings.display.barCount;i<0&&(i=t.masterBars.length),i=e+i-1,i=Math.min(t.masterBars.length-1,Math.max(0,i)),this.lastBarIndex=i,this.createScoreInfoGlyphs(),this.doLayoutAndRender()},e.prototype.createScoreInfoGlyphs=function(){var t=this;et.debug("ScoreLayout","Creating score info glyphs");var e=this.renderer.settings.notation,i=this.renderer.score,n=this.renderer.settings.display.resources;if(this.scoreInfoGlyphs=new Map,i.title&&e.isNotationElementVisible(h.ScoreTitle)&&this.scoreInfoGlyphs.set(h.ScoreTitle,new br(0,0,i.title,n.titleFont,K.Center)),i.subTitle&&e.isNotationElementVisible(h.ScoreSubTitle)&&this.scoreInfoGlyphs.set(h.ScoreSubTitle,new br(0,0,i.subTitle,n.subTitleFont,K.Center)),i.artist&&e.isNotationElementVisible(h.ScoreArtist)&&this.scoreInfoGlyphs.set(h.ScoreArtist,new br(0,0,i.artist,n.subTitleFont,K.Center)),i.album&&e.isNotationElementVisible(h.ScoreAlbum)&&this.scoreInfoGlyphs.set(h.ScoreAlbum,new br(0,0,i.album,n.subTitleFont,K.Center)),i.music&&i.music===i.words&&e.isNotationElementVisible(h.ScoreWordsAndMusic)?this.scoreInfoGlyphs.set(h.ScoreWordsAndMusic,new br(0,0,"Music and Words by "+i.words,n.wordsFont,K.Center)):(i.music&&e.isNotationElementVisible(h.ScoreMusic)&&this.scoreInfoGlyphs.set(h.ScoreMusic,new br(0,0,"Music by "+i.music,n.wordsFont,K.Right)),i.words&&e.isNotationElementVisible(h.ScoreWords)&&this.scoreInfoGlyphs.set(h.ScoreWords,new br(0,0,"Words by "+i.words,n.wordsFont,K.Left))),e.isNotationElementVisible(h.GuitarTuning)){for(var r=null,a=0,o=this.renderer.tracks;a<o.length;a++){for(var s=0,c=o[a].staves;s<c.length;s++){if(!(g=c[s]).isPercussion&&g.isStringed&&g.tuning.length>0){r=g;break}}if(r)break}if(r){var l=Bt.findTuning(r.tuning);l||(l=new Bt("",r.tuning,!1)),this.tuningGlyph=new $a(0,0,this.scale,n,l)}}if(e.isNotationElementVisible(h.ChordDiagrams)){this.chordDiagrams=new Ka(0,0),this.chordDiagrams.renderer=new Kn(this.renderer,this.renderer.tracks[0].staves[0].bars[0]);for(var u=new Map,p=0,d=this.renderer.tracks;p<d.length;p++)for(var f=0,y=d[p].staves;f<y.length;f++){var g;(g=y[f]).chords.forEach((function(e,i){u.has(i)||e.showDiagram&&(u.set(i,e),t.chordDiagrams.addChord(e))}))}}},Object.defineProperty(e.prototype,"scale",{get:function(){return this.renderer.settings.display.scale},enumerable:!1,configurable:!0}),e.prototype.createEmptyStaveGroup=function(){var e=new ao;e.layout=this;for(var i=0;i<this.renderer.tracks.length;i++){for(var n=this.renderer.tracks[i],r=!1,a=0,o=n.staves;a<o.length;a++){if((h=o[a]).showStandardNotation){r=!0;break}}for(var s=0;s<n.staves.length;s++){var h,c=void 0;if((h=n.staves[s]).isPercussion)c=t.StaveProfile.Score;else if(this.renderer.settings.display.staveProfile!==t.StaveProfile.Default)c=this.renderer.settings.display.staveProfile;else if(h.showTablature&&h.showStandardNotation)c=t.StaveProfile.ScoreTab;else if(h.showTablature)c=r?t.StaveProfile.TabMixed:t.StaveProfile.Tab;else{if(!h.showStandardNotation)continue;c=t.StaveProfile.Score}for(var l=0,u=qh.staveProfiles.get(c);l<u.length;l++){var p=u[l];p.canCreate(n,h)&&e.addStaff(n,new to(i,h,p))}}}return e},e.prototype.registerBarRenderer=function(t,e){this._barRendererLookup.has(t)||this._barRendererLookup.set(t,new Map),this._barRendererLookup.get(t).set(e.bar.id,e)},e.prototype.unregisterBarRenderer=function(t,e){this._barRendererLookup.has(t)&&this._barRendererLookup.get(t).delete(e.bar.id)},e.prototype.getRendererForBar=function(t,e){var i=e.id;return this._barRendererLookup.has(t)&&this._barRendererLookup.get(t).has(i)?this._barRendererLookup.get(t).get(i):null},e.prototype.renderAnnotation=function(){var t=this.renderer.canvas,e=this.renderer.settings.display.resources,i=12*this.renderer.settings.display.scale,n=2*i;this.height+=n;var r=this.width/2;t.beginRender(this.width,n),t.color=e.mainGlyphColor,t.font=new _(e.copyrightFont.family,i,d.Bold),t.textAlign=K.Center,t.fillText("rendered by alphaTab (https://alphaTab.net)",r,i);var a=t.endRender(),o=new Di;o.width=this.width,o.height=n,o.renderResult=a,o.totalWidth=this.width,o.totalHeight=this.height,o.firstMasterBarIndex=-1,o.lastMasterBarIndex=-1,this.renderer.partialRenderFinished.trigger(o)},e}(),so=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ho=function(){this.width=0,this.masterBars=[]},co=function(t){function e(e){var i=t.call(this,e)||this;return i._group=null,i._pagePadding=null,i}return so(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"HorizontalScreen"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"supportsResize",{get:function(){return!1},enumerable:!1,configurable:!0}),e.prototype.resize=function(){},e.prototype.doLayoutAndRender=function(){this._pagePadding=this.renderer.settings.display.padding,this._pagePadding||(this._pagePadding=e.PagePadding),1===this._pagePadding.length?this._pagePadding=new Float32Array([this._pagePadding[0],this._pagePadding[0],this._pagePadding[0],this._pagePadding[0]]):2===this._pagePadding.length&&(this._pagePadding=new Float32Array([this._pagePadding[0],this._pagePadding[1],this._pagePadding[0],this._pagePadding[1]]));var t=this.renderer.score,i=this.renderer.canvas,n=this.renderer.settings.display.startBar;n--;var r=n=Math.min(t.masterBars.length-1,Math.max(0,n)),a=this.renderer.settings.display.barCount;a<=0&&(a=t.masterBars.length),a=n+a-1,a=Math.min(t.masterBars.length-1,Math.max(0,a)),this._group=this.createEmptyStaveGroup(),this._group.isLast=!0,this._group.x=this._pagePadding[0],this._group.y=this._pagePadding[1];for(var o=this.renderer.settings.display.barCountPerPartial,s=[],h=new ho;r<=a;){if(d=this._group.addBars(this.renderer.tracks,r))if(0===h.masterBars.length&&d.isLinkedToPrevious&&s.length>0){var c=s[s.length-1];c.masterBars.push(t.masterBars[r]),c.width+=d.width}else h.masterBars.push(t.masterBars[r]),h.width+=d.width,h.masterBars.length>=o&&(0===s.length&&(h.width+=this._group.x+this._group.accoladeSpacing),s.push(h),et.debug(this.name,"Finished partial from bar "+h.masterBars[0].index+" to "+h.masterBars[h.masterBars.length-1].index,null),h=new ho);r++}h.masterBars.length>0&&(0===s.length&&(h.width+=this._group.x+this._group.accoladeSpacing),s.push(h),et.debug(this.name,"Finished partial from bar "+h.masterBars[0].index+" to "+h.masterBars[h.masterBars.length-1].index,null)),this._group.finalizeGroup(),this.height=this._group.y+this._group.height+this._pagePadding[3],this.width=this._group.x+this._group.width+this._pagePadding[2],r=0;for(var l=0;l<s.length;l++){var u=s[l];i.beginRender(u.width,this.height),i.color=this.renderer.settings.display.resources.mainGlyphColor,i.textAlign=K.Left;var p=this._group.getBarX(u.masterBars[0].index)+this._group.accoladeSpacing;0===l&&(p-=this._group.x+this._group.accoladeSpacing),et.debug(this.name,"Rendering partial from bar "+u.masterBars[0].index+" to "+u.masterBars[u.masterBars.length-1].index,null),this._group.paintPartial(-p,this._group.y,this.renderer.canvas,r,u.masterBars.length);var d=i.endRender(),f=new Di;f.totalWidth=this.width,f.totalHeight=this.height,f.width=u.width,f.height=this.height,f.renderResult=d,f.firstMasterBarIndex=u.masterBars[0].index,f.lastMasterBarIndex=u.masterBars[u.masterBars.length-1].index,this.renderer.partialRenderFinished.trigger(f),r+=u.masterBars.length}},e.PagePadding=new Float32Array([20,20,20,20]),e.GroupSpacing=20,e}(oo),lo=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),uo=function(t){function e(e){var i=t.call(this,e)||this;return i._groups=[],i._allMasterBarRenderers=[],i._barsFromPreviousGroup=[],i._pagePadding=null,i}return lo(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"PageView"},enumerable:!1,configurable:!0}),e.prototype.doLayoutAndRender=function(){this._pagePadding=this.renderer.settings.display.padding,this._pagePadding||(this._pagePadding=e.PagePadding),1===this._pagePadding.length?this._pagePadding=new Float32Array([this._pagePadding[0],this._pagePadding[0],this._pagePadding[0],this._pagePadding[0]]):2===this._pagePadding.length&&(this._pagePadding=new Float32Array([this._pagePadding[0],this._pagePadding[1],this._pagePadding[0],this._pagePadding[1]]));var t=this._pagePadding[0],i=this._pagePadding[1];this.width=this.renderer.width,this._allMasterBarRenderers=[],i=this.layoutAndRenderScoreInfo(t,i,-1),i=this.layoutAndRenderChordDiagrams(i,-1),i=this.layoutAndRenderScore(t,i),this.height=i+this._pagePadding[3]},Object.defineProperty(e.prototype,"supportsResize",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.resize=function(){var t=this._pagePadding[0],e=this._pagePadding[1];this.width=this.renderer.width;var i=this.height;e=this.layoutAndRenderScoreInfo(t,e,i),e=this.layoutAndRenderChordDiagrams(e,i),e=this.resizeAndRenderScore(t,e,i),this.height=e+this._pagePadding[3]},e.prototype.layoutAndRenderChordDiagrams=function(t,e){if(void 0===e&&(e=-1),!this.chordDiagrams)return t;var i=this.renderer.settings.display.resources;this.chordDiagrams.width=this.width,this.chordDiagrams.doLayout();var n=this.renderer.canvas;n.beginRender(this.width,this.chordDiagrams.height),n.color=i.scoreInfoColor,n.textAlign=K.Center,this.chordDiagrams.paint(0,0,n);var r=n.endRender();t+=this.chordDiagrams.height;var a=new Di;return a.width=this.width,a.height=this.chordDiagrams.height,a.renderResult=r,a.totalWidth=this.width,a.totalHeight=e<0?t:e,a.firstMasterBarIndex=-1,a.lastMasterBarIndex=-1,this.renderer.partialRenderFinished.trigger(a),t},e.prototype.layoutAndRenderScoreInfo=function(t,e,i){void 0===i&&(i=-1),et.debug(this.name,"Layouting score info");for(var n=this.scale,r=this.renderer.settings.display.resources,a=[h.ScoreTitle,h.ScoreSubTitle,h.ScoreArtist,h.ScoreAlbum,h.ScoreWordsAndMusic],o=0;o<a.length;o++){if(this.scoreInfoGlyphs.has(a[o]))(s=this.scoreInfoGlyphs.get(a[o])).x=this.width/2,s.y=e,s.textAlign=K.Center,e+=s.font.size*n}var s,c=!1,l=0;this.scoreInfoGlyphs.has(h.ScoreMusic)&&((s=this.scoreInfoGlyphs.get(h.ScoreMusic)).x=this.width-this._pagePadding[2],s.y=e,s.textAlign=K.Right,c=!0,l=s.font.size*n);this.scoreInfoGlyphs.has(h.ScoreWords)&&((s=this.scoreInfoGlyphs.get(h.ScoreWords)).x=t,s.y=e,s.textAlign=K.Left,c=!0,l=s.font.size*n);c&&(e+=l),this.tuningGlyph&&(e+=20*n,this.tuningGlyph.x=t,this.tuningGlyph.y=e,e+=this.tuningGlyph.height),e+=20*n;var u=this.renderer.canvas;u.beginRender(this.width,e),u.color=r.scoreInfoColor,u.textAlign=K.Center,this.scoreInfoGlyphs.forEach((function(t){t.paint(0,0,u)})),this.tuningGlyph&&this.tuningGlyph.paint(0,0,u);var p=u.endRender(),d=new Di;return d.width=this.width,d.height=e,d.renderResult=p,d.totalWidth=this.width,d.totalHeight=i<0?e:i,d.firstMasterBarIndex=-1,d.lastMasterBarIndex=-1,this.renderer.partialRenderFinished.trigger(d),e},e.prototype.resizeAndRenderScore=function(t,e,i){var n=this.renderer.canvas;if(-1!==this.renderer.settings.display.barsPerRow)for(var r=0;r<this._groups.length;r++){var a=this._groups[r];this.fitGroup(a),a.finalizeGroup(),e+=this.paintGroup(a,i,n)}else{this._groups=[];var o=0,s=this.maxWidth;for((a=this.createEmptyStaveGroup()).index=this._groups.length,a.x=t,a.y=e;o<this._allMasterBarRenderers.length;){var h=this._allMasterBarRenderers[o];if(a.width+h.width<=s||0===a.masterBarsRenderers.length)a.addMasterBarRenderers(this.renderer.tracks,h),o++;else{for(;h&&!h.canWrap&&a.masterBarsRenderers.length>1;)h=a.revertLastBar(),o--;a.isFull=!0,a.isLast=this.lastBarIndex===a.lastBarIndex,this._groups.push(a),this.fitGroup(a),a.finalizeGroup(),e+=this.paintGroup(a,i,n),(a=this.createEmptyStaveGroup()).index=this._groups.length,a.x=t,a.y=e}}a.isLast=this.lastBarIndex===a.lastBarIndex,this.fitGroup(a),a.finalizeGroup(),e+=this.paintGroup(a,i,n)}return e},e.prototype.layoutAndRenderScore=function(t,e){var i=this.renderer.canvas,n=this.firstBarIndex,r=this.lastBarIndex;for(this._groups=[];n<=r;){var a=this.createStaveGroup(n,r);this._groups.push(a),a.x=t,a.y=e,n=a.lastBarIndex+1,this.fitGroup(a),a.finalizeGroup(),et.debug(this.name,"Rendering partial from bar "+a.firstBarIndex+" to "+a.lastBarIndex,null),e+=this.paintGroup(a,e,i)}return e},e.prototype.paintGroup=function(t,e,i){var n=t.height+20*this.scale;i.beginRender(this.width,n),this.renderer.canvas.color=this.renderer.settings.display.resources.mainGlyphColor,this.renderer.canvas.textAlign=K.Left,t.paint(0,-t.y,i),e+=n;var r=i.endRender(),a=new Di;return a.totalWidth=this.width,a.totalHeight=e,a.width=this.width,a.height=n,a.renderResult=r,a.firstMasterBarIndex=t.firstBarIndex,a.lastMasterBarIndex=t.lastBarIndex,this.renderer.partialRenderFinished.trigger(a),n},e.prototype.fitGroup=function(t){(t.isFull||t.width>this.maxWidth)&&t.scaleToWidth(this.maxWidth),this.width=Math.max(this.width,t.width)},e.prototype.createStaveGroup=function(t,e){var i=this.createEmptyStaveGroup();i.index=this._groups.length;for(var n=this.renderer.settings.display.barsPerRow,r=this.maxWidth,a=e+1,o=t;o<a;o++){if(this._barsFromPreviousGroup.length>0)for(var s=0,h=this._barsFromPreviousGroup;s<h.length;s++){var c=h[s];i.addMasterBarRenderers(this.renderer.tracks,c),o=c.masterBar.index}else{var l=i.addBars(this.renderer.tracks,o);l&&this._allMasterBarRenderers.push(l)}this._barsFromPreviousGroup=[];var u=!1;if((-1===n&&i.width>=r&&0!==i.masterBarsRenderers.length||i.masterBarsRenderers.length===n+1)&&(u=!0),u){var p=i.revertLastBar();if(p)for(this._barsFromPreviousGroup.push(p);p&&!p.canWrap&&i.masterBarsRenderers.length>1;)(p=i.revertLastBar())&&this._barsFromPreviousGroup.push(p);return i.isFull=!0,i.isLast=!1,this._barsFromPreviousGroup.reverse(),i}i.x=0}return i.isLast=e===i.lastBarIndex,i},Object.defineProperty(e.prototype,"maxWidth",{get:function(){return this.renderer.width-this._pagePadding[0]-this._pagePadding[2]},enumerable:!1,configurable:!0}),e.PagePadding=new Float32Array([40,40,40,40]),e.GroupSpacing=20,e}(oo),po=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),fo=function(t){function e(i,n,r,a){void 0===a&&(a=!1);var o=t.call(this,i,n,a?cn.GraceScale:1,e.getMusicSymbol(r))||this;return o._isGrace=a,o._accidentalType=r,o}return po(e,t),e.getMusicSymbol=function(t){switch(t){case An.Natural:return Q.AccidentalNatural;case An.Sharp:return Q.AccidentalSharp;case An.Flat:return Q.AccidentalFlat;case An.NaturalQuarterNoteUp:return Q.AccidentalQuarterToneNaturalArrowUp;case An.SharpQuarterNoteUp:return Q.AccidentalQuarterToneSharpArrowUp;case An.FlatQuarterNoteUp:return Q.AccidentalQuarterToneFlatArrowUp;case An.DoubleSharp:return Q.AccidentalDoubleSharp;case An.DoubleFlat:return Q.AccidentalDoubleFlat}return Q.None},e.prototype.doLayout=function(){switch(this._accidentalType){case An.DoubleFlat:this.width=18;break;default:this.width=8}this.width=this.width*(this._isGrace?cn.GraceScale:1)*this.scale},e}(sn),yo=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),go=function(t){function e(e,i,n){var r=t.call(this,e,i)||this;return r._number=0,r._number=n,r}return yo(e,t),e.prototype.doLayout=function(){this.renderer.scoreRenderer.canvas.font=this.renderer.resources.barNumberFont,this.width=this.renderer.scoreRenderer.canvas.measureText(this._number.toString())+5*this.scale},e.prototype.paint=function(t,e,i){if(this.renderer.staff.isFirstInAccolade){var n=this.renderer.resources,r=i.color;i.color=n.barNumberColor,i.font=n.barNumberFont,i.fillText(this._number.toString(),t+this.x,e+this.y),i.color=r}},e}(nn),mo=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),bo=function(t){function e(e,i){return t.call(this,e,i)||this}return mo(e,t),e.prototype.doLayout=function(){this.renderer.isLast?this.width=15*this.scale:this.renderer.nextRenderer&&this.renderer.nextRenderer.staff===this.renderer.staff&&this.renderer.nextRenderer.bar.masterBar.isRepeatStart?this.width=2*this.scale:(this.width=2*this.scale,this.renderer.bar.masterBar.isDoubleBar&&(this.width+=2*this.scale))},e.prototype.paint=function(t,e,i){var n=4*this.scale,r=e+this.y+this.renderer.topPadding,a=e+this.y+this.renderer.height-this.renderer.bottomPadding,o=t+this.x,s=a-r;this.renderer.isLast?(i.fillRect(o+this.width-n-n,r,this.scale,s),i.fillRect(o+this.width-n,r,n,s)):this.renderer.nextRenderer&&this.renderer.nextRenderer.staff===this.renderer.staff&&this.renderer.nextRenderer.bar.masterBar.isRepeatStart||(i.fillRect(o+this.width-this.scale,r,this.scale,s),this.renderer.bar.masterBar.isDoubleBar&&i.fillRect(o+this.width-5*this.scale,r,this.scale,s))},e}(nn),vo=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),_o=function(t){function e(i,n,r,a){var o=t.call(this,i,n,1,e.getSymbol(r))||this;return o._clef=r,o._clefOttava=a,o}return vo(e,t),e.prototype.doLayout=function(){switch(this._clef){case O.Neutral:this.width=15*this.scale;break;case O.C3:case O.C4:case O.F4:case O.G2:this.width=28*this.scale}},e.getSymbol=function(t){switch(t){case O.Neutral:return Q.UnpitchedPercussionClef1;case O.C3:case O.C4:return Q.CClef;case O.F4:return Q.FClef;case O.G2:return Q.GClef;default:return Q.None}},e.prototype.paint=function(e,i,n){var r;t.prototype.paint.call(this,e,i,n);var a=!1;switch(this._clefOttava){case x._15ma:r=new sn(-4*this.scale,0,.5,Q.Quindicesima),a=!0;break;case x._8va:r=new sn(-2*this.scale,0,.5,Q.Ottava),a=!0;break;case x._8vb:r=new sn(-6*this.scale,0,.5,Q.Ottava);break;case x._15mb:r=new sn(-8*this.scale,0,.5,Q.Quindicesima);break;default:return}var o=0,s=0;switch(this._clef){case O.Neutral:o=a?-12:15,s=0;break;case O.C3:case O.C4:o=a?-19:27,s=0;break;case O.F4:o=a?-9:27,s=-4;break;case O.G2:o=a?-37:30,s=0;break;default:return}r.renderer=this.renderer,r.doLayout();var h=this.width/2;r.paint(e+this.x+h+s*this.scale,i+this.y+o*this.scale,n)},e}(sn),wo=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),So=function(t){function e(e,i){return t.call(this,e,i)||this}return wo(e,t),e.prototype.doLayout=function(){this.width=11*this.scale},e.prototype.paint=function(t,e,i){var n=4*this.scale,r=e+this.y+this.renderer.topPadding,a=e+this.y+this.renderer.height-this.renderer.bottomPadding,o=t+this.x,s=a-r,h=1.5*this.scale,c=(r+a)/2;i.fillCircle(o,c-3*h,h),i.fillCircle(o,c+3*h,h),o+=4*this.scale,i.beginPath(),i.moveTo(o,r),i.lineTo(o,a),i.stroke(),o+=3*this.scale+.5,i.fillRect(o,r,n,s)},e}(nn),Bo=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),To=function(t){function e(e,i,n){var r=t.call(this,e,i)||this;return r._count=0,r._count=0,r._count=n,r}return Bo(e,t),e.prototype.doLayout=function(){this.width=0},e.prototype.paint=function(t,e,i){var n=this.renderer.resources,r=i.textAlign;i.font=n.barNumberFont,i.textAlign=K.Right;var a="x"+this._count,o=i.measureText(a)/1.5;i.fillText(a,t+this.x-o,e+this.y),i.textAlign=r},e}(nn),ko=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Po=function(t){function e(e,i,n,r){var a=t.call(this,e,i)||this;return a._dotOffset=0,a._circleSize=0,a._dotOffset=0,a._circleSize=0,a._dotOffset=r,a._circleSize=n,a}return ko(e,t),e.prototype.doLayout=function(){this.width=13*this.scale},e.prototype.paint=function(t,e,i){var n=4*this.scale,r=e+this.y+this.renderer.topPadding,a=e+this.y+this.renderer.height-this.renderer.bottomPadding,o=t+this.x+.5,s=a-r;i.fillRect(o,r,n,s),o+=2*n-.5,i.beginPath(),i.moveTo(o,r),i.lineTo(o,a),i.stroke(),o+=3*this.scale;var h=this._circleSize*this.scale,c=(r+a)/2;i.fillCircle(o,c-h*this._dotOffset,h),i.fillCircle(o,c+h*this._dotOffset,h)},e}(nn),No=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Oo=function(t){function e(i,n,r){return t.call(this,i,n,1,e.getSymbol(r))||this}return No(e,t),e.getSymbol=function(t){switch(t){case S.None:return Q.None;case S.Normal:return Q.ArticAccentAbove;case S.Heavy:return Q.ArticMarcatoAbove;default:return Q.None}},e.prototype.doLayout=function(){this.width=9*this.scale,this.height=9*this.scale},e.prototype.paint=function(e,i,n){t.prototype.paint.call(this,e-2*this.scale,i+this.height,n)},e}(sn),xo=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Co=function(t){function e(e,i,n){var r=t.call(this,e,i)||this;return r._size=0,r._size=n,r}return xo(e,t),e.prototype.doLayout=function(){this.width=this._size+3*this.scale},e.prototype.paint=function(t,e,i){i.fillCircle(t+this.x,e+this.y,this._size)},e}(nn),Fo=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Lo=function(t){function e(e,i,n){var r=t.call(this,e,i,n?cn.GraceScale:1,Q.NoteheadXOrnate)||this;return r._isGrace=n,r}return Fo(e,t),e.prototype.doLayout=function(){this.width=9*(this._isGrace?cn.GraceScale:1)*this.scale,this.height=cn.NoteHeadHeight*this.scale},e}(sn),Eo=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Mo=function(t){function e(i,n,r,a){var o=t.call(this,i,n,a?cn.GraceScale:1,e.getSymbol(r))||this;return o._isGrace=a,o}return Eo(e,t),e.getSymbol=function(t){switch(t){case A.QuadrupleWhole:case A.DoubleWhole:case A.Whole:case A.Half:return Q.NoteheadDiamondWhiteWide;default:return Q.NoteheadDiamondBlackWide}},e.prototype.doLayout=function(){this.width=9*(this._isGrace?cn.GraceScale:1)*this.scale,this.height=cn.NoteHeadHeight*this.scale},e}(sn),Do=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ao=function(t){function e(e,i,n){var r=t.call(this,0,0)||this;return r.yOffset=0,r.startNoteRenderer=null,r.endNoteRenderer=null,r.tieDirection=Xt.Up,r.startBeat=e,r.endBeat=i,r.forEnd=n,r}return Do(e,t),e.prototype.doLayout=function(){this.width=0},e.prototype.paint=function(t,i,n){if(this.endBeat){var r=this.startNoteRenderer=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this.startBeat.voice.bar),a=this.endNoteRenderer=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this.endBeat.voice.bar),o=0,s=0,h=0,c=0,l=!1;this.tieDirection=r?this.getBeamDirection(this.startBeat,r):this.getBeamDirection(this.endBeat,a),!this.forEnd&&r?(r!==a?(o=t+r.x+this.getStartX(),h=i+r.y+this.getStartY()+this.yOffset,a&&r.staff===a.staff?(s=t+a.x+this.getEndX(),c=i+a.y+this.getEndY()+this.yOffset):(s=t+r.x+r.width,c=h)):(o=t+r.x+this.getStartX(),s=t+a.x+this.getEndX(),h=i+r.y+this.getStartY()+this.yOffset,c=i+a.y+this.getEndY()+this.yOffset),l=!0):r&&r.staff===a.staff||(o=t+a.x,s=t+a.x+this.getEndX(),c=h=i+a.y+this.getEndY()+this.yOffset,l=!0),l&&(this.shouldDrawBendSlur()?e.drawBendSlur(n,o,h,s,c,this.tieDirection===Xt.Down,this.scale):e.paintTie(n,this.scale,o,h,s,c,this.tieDirection===Xt.Down,this.getTieHeight(o,h,s,c),4))}},e.prototype.shouldDrawBendSlur=function(){return!1},e.prototype.getTieHeight=function(t,e,i,n){return 22},e.prototype.getBeamDirection=function(t,e){return Xt.Down},e.prototype.getStartY=function(){return 0},e.prototype.getEndY=function(){return 0},e.prototype.getStartX=function(){return 0},e.prototype.getEndX=function(){return 0},e.paintTie=function(t,e,i,n,r,a,o,s,h){if(void 0===o&&(o=!1),void 0===s&&(s=22),void 0===h&&(h=4),i!==r||n!==a){if(r<i){var c=i;i=r,r=c,c=n,n=a,a=c}s*=e,h*=e;var l=a-n,u=r-i,p=Math.sqrt(l*l+u*u);o?l*=-1:u*=-1;var d=(r+i)/2,f=(a+n)/2,y=d+s*(l/=p),g=f+s*(u/=p),m=d+(s-h)*l,b=f+(s-h)*u;t.beginPath(),t.moveTo(i,n),t.quadraticCurveTo(y,g,r,a),t.quadraticCurveTo(m,b,i,n),t.closePath(),t.fill()}},e.drawBendSlur=function(t,i,n,r,a,o,s,h){var c=a-n,l=r-i,u=Math.sqrt(c*c+l*l);o?c*=-1:l*=-1,c/=u,l/=u;var p=(r+i)/2,d=(a+n)/2,f=e.BendSlurHeight*s;r-i<20&&(f/=2);var y=p+f*c,g=d+f*l;if(t.beginPath(),t.moveTo(i,n),t.lineTo(y,g),t.lineTo(r,a),t.stroke(),h){var m=t.measureText(h),b=o?0:-t.font.size;t.fillText(h,y-m/2,g+b)}},e.BendSlurHeight=11,e}(nn),Io=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ro=function(t){function e(e){var i=t.call(this,0,0)||this;return i.height=0,i._isOpen=e,i}return Io(e,t),e.prototype.doLayout=function(){t.prototype.doLayout.call(this),this.width=e.Size*this.scale},e.prototype.paint=function(t,e,i){this._isOpen?Ao.paintTie(i,this.scale,t+this.x+this.width,e+this.y+this.height,t+this.x+this.width,e+this.y,!1,6,3):Ao.paintTie(i,this.scale,t+this.x,e+this.y,t+this.x,e+this.y+this.height,!1,6,3)},e.Size=6,e}(nn),Go=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),jo=function(t,e){this.line=0,this.line=t,this.isGhost=e},Vo=function(t){function e(e){var i=t.call(this,0,0)||this;return i._infos=[],i._glyphs=[],i.isEmpty=!0,i._isOpen=e,i}return Go(e,t),e.prototype.addParenthesis=function(t){var e=this.renderer,i=e.getNoteLine(t),n=t.isGhost||this.isTiedBend(t)&&e.settings.notation.isNotationElementVisible(h.ParenthesisOnTiedBends);this.addParenthesisOnLine(i,n)},e.prototype.addParenthesisOnLine=function(t,e){var i=new jo(t,e);this._infos.push(i),e&&(this.isEmpty=!1)},e.prototype.isTiedBend=function(t){return!!t.isTieDestination&&(!!t.tieOrigin.hasBend||this.isTiedBend(t.tieOrigin))},e.prototype.doLayout=function(){var t=this.renderer;this._infos.sort((function(t,e){return t.line-e.line}));for(var e=null,i=t.getScoreHeight(1),n=0,r=this._infos.length;n<r;n++){var a=void 0;if(this._infos[n].isGhost)if(e){var o=t.getScoreY(this._infos[n].line,0)+i;e.height=o-e.y}else(a=new Ro(this._isOpen)).renderer=this.renderer,a.y=t.getScoreY(this._infos[n].line,0)-i,a.height=2*i,a.doLayout(),this._glyphs.push(a),e=a;else e=null}this.width=this._glyphs.length>0?this._glyphs[0].width:0},e.prototype.paint=function(e,i,n){t.prototype.paint.call(this,e,i,n);for(var r=0,a=this._glyphs;r<a.length;r++){a[r].paint(e+this.x,i+this.y,n)}},e}(nn),Ho=function(t,e){this.line=0,this.glyph=t,this.line=e},Wo=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Uo=function(t){function e(){var e=t.call(this,0,0)||this;return e._infos=[],e._noteHeadPadding=0,e.minNote=null,e.maxNote=null,e.spacingChanged=new li,e.upLineX=0,e.downLineX=0,e.displacedX=0,e.noteStartX=0,e}return Wo(e,t),e.prototype.add=function(t,e){var i=new Ho(t,e);this._infos.push(i),(!this.minNote||this.minNote.line>i.line)&&(this.minNote=i),(!this.maxNote||this.maxNote.line<i.line)&&(this.maxNote=i)},Object.defineProperty(e.prototype,"hasTopOverflow",{get:function(){return!!this.minNote&&this.minNote.line<=0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasBottomOverflow",{get:function(){return!!this.maxNote&&this.maxNote.line>8},enumerable:!1,configurable:!0}),e.prototype.doLayout=function(){this._infos.sort((function(t,e){return e.line-t.line}));for(var t=0,e=!1,i=0,n=!1,r=this.direction,a=0,o=0,s=this._infos.length;o<s;o++){var h=this._infos[o].glyph;h.renderer=this.renderer,h.doLayout();var c=!1;0===o?t=h.width:Math.abs(i-this._infos[o].line)<=1?e?e=!1:(c=!0,h.x=t,n=!0,e=!0):e=!1,r===Xt.Down?h.x=c?0:t:h.x=c?t:0,h.x+=this.noteStartX,i=this._infos[o].line,a=Math.max(a,h.x+h.width)}n?(this._noteHeadPadding=0,this.upLineX=t,this.downLineX=t):(this._noteHeadPadding=r===Xt.Down?-t:0,a+=this._noteHeadPadding,this.upLineX=a,this.downLineX=0),this.displacedX=t,this.width=a},e.prototype.paint=function(t,e,i){t+=this.x,e+=this.y;var n=this.renderer,r=3*this.scale,a=this.width-this.noteStartX+2*r;if(this.hasTopOverflow){var o=i.color;i.color=n.resources.staffLineColor;for(var s=-2;s>=this.minNote.line;){var h=e+n.getScoreY(s,0);i.fillRect(t-r+this.noteStartX,h,a,this.scale),s-=2}i.color=o}if(this.hasBottomOverflow){o=i.color;i.color=n.resources.staffLineColor;for(s=10;s<=this.maxNote.line;){h=e+n.getScoreY(s,0);i.fillRect(t-r+this.noteStartX,h,a,this.scale),s+=2}i.color=o}for(var c=this._infos,l=t+this._noteHeadPadding,u=0,p=c;u<p.length;u++){var d=p[u];d.glyph.renderer=this.renderer,d.glyph.paint(l,e,i)}},e}(nn),zo=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Xo=function(t){function e(i,n,r){return t.call(this,i,n,1,e.getSymbol(r))||this}return zo(e,t),e.prototype.doLayout=function(){this.width=12*this.scale},e.getSymbol=function(t){switch(t){case A.ThirtySecond:return Q.Tremolo3;case A.Sixteenth:return Q.Tremolo2;case A.Eighth:return Q.Tremolo1;default:return Q.None}},e}(sn),Yo=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Jo=function(t){function e(){var e=t.call(this)||this;return e._noteGlyphLookup=new Map,e._notes=[],e._tremoloPicking=null,e.aboveBeatEffects=new Map,e.belowBeatEffects=new Map,e}return Yo(e,t),Object.defineProperty(e.prototype,"direction",{get:function(){return this.beamingHelper.direction},enumerable:!1,configurable:!0}),e.prototype.getNoteX=function(t,e){if(this._noteGlyphLookup.has(t.id)){var i=this._noteGlyphLookup.get(t.id),n=this.x+i.x+this._noteHeadPadding;switch(e){case Un.Left:break;case Un.Center:n+=i.width/2;break;case Un.Right:n+=i.width}return n}return 0},e.prototype.getNoteY=function(t,e){if(this._noteGlyphLookup.has(t.id)){var i=this._noteGlyphLookup.get(t.id),n=this.y+i.y;switch(e){case Wn.TopWithStem:n-=this.renderer.getStemSize(this.beamingHelper);break;case Wn.Top:n-=i.height/2;break;case Wn.Center:break;case Wn.Bottom:n+=i.height/2;break;case Wn.BottomWithStem:n+=this.renderer.getStemSize(this.beamingHelper)}return n}return 0},e.prototype.addNoteGlyph=function(e,i,n){t.prototype.add.call(this,e,n),this._noteGlyphLookup.set(i.id,e),this._notes.push(i)},e.prototype.updateBeamingHelper=function(t){this.beamingHelper&&this.beamingHelper.registerBeatLineX("score",this.beat,t+this.x+this.upLineX,t+this.x+this.downLineX)},e.prototype.doLayout=function(){var e=this;t.prototype.doLayout.call(this);var i=this.direction;if(this.aboveBeatEffects.forEach((function(t){t.renderer=e.renderer,t.doLayout()})),this.belowBeatEffects.forEach((function(t){t.renderer=e.renderer,t.doLayout()})),this.beat.isTremolo){var n=0,r=i===Xt.Up?this.minNote:this.maxNote,a=i===Xt.Up?this.displacedX:0,o=this.beat.tremoloSpeed;switch(o){case A.ThirtySecond:n=i===Xt.Up?-15:15;break;case A.Sixteenth:n=i===Xt.Up?-12:15;break;case A.Eighth:n=i===Xt.Up?-10:10;break;default:n=i===Xt.Up?-10:15}this._tremoloPicking=new Xo(a,r.glyph.y+n*this.scale,o),this._tremoloPicking.renderer=this.renderer,this._tremoloPicking.doLayout()}},e.prototype.buildBoundingsLookup=function(t,e,i){for(var n=0,r=this._notes;n<r.length;n++){var a=r[n];if(this._noteGlyphLookup.has(a.id)){var o=this._noteGlyphLookup.get(a.id),s=new Gi;s.note=a,s.noteHeadBounds=new It,s.noteHeadBounds.x=e+this.x+this._noteHeadPadding+o.x,s.noteHeadBounds.y=i+this.y+o.y-o.height/2,s.noteHeadBounds.w=o.width,s.noteHeadBounds.h=o.height,t.addNote(s)}}},e.prototype.paint=function(e,i,n){var r=this,a=this.renderer,o=0,s=0,h=1,c=-h;this.beamingHelper.direction===Xt.Up?(s=a.getScoreY(this.minNote.line),o=a.getScoreY(this.maxNote.line-2)):(s=a.getScoreY(this.maxNote.line-1),o=a.getScoreY(this.minNote.line+1),c*=-1,h*=-1),this.aboveBeatEffects.forEach((function(t){o+=c*t.height,t.paint(e+r.x+2*r.scale,i+r.y+o,n)})),this.belowBeatEffects.forEach((function(t){s+=h*t.height,t.paint(e+r.x+2*r.scale,i+r.y+s,n)})),t.prototype.paint.call(this,e,i,n),this._tremoloPicking&&this._tremoloPicking.paint(e,i,n)},e}(Uo),qo=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Qo=function(t){function e(i,n,r){var a=t.call(this,i,n,1,e.getSymbol(r))||this;return a._duration=r,a}return qo(e,t),e.getSymbol=function(t){switch(t){case A.QuadrupleWhole:return Q.RestLonga;case A.DoubleWhole:return Q.RestDoubleWhole;case A.Whole:return Q.RestWhole;case A.Half:return Q.RestHalf;case A.Quarter:return Q.RestQuarter;case A.Eighth:return Q.RestEighth;case A.Sixteenth:return Q.RestSixteenth;case A.ThirtySecond:return Q.RestThirtySecond;case A.SixtyFourth:return Q.RestSixtyFourth;case A.OneHundredTwentyEighth:return Q.RestOneHundredTwentyEighth;case A.TwoHundredFiftySixth:return Q.RestTwoHundredFiftySixth;default:return Q.None}},e.getSize=function(t){switch(t){case A.QuadrupleWhole:case A.DoubleWhole:case A.Whole:case A.Half:case A.Quarter:case A.Eighth:case A.Sixteenth:return 9;case A.ThirtySecond:return 12;case A.SixtyFourth:return 14;case A.OneHundredTwentyEighth:case A.TwoHundredFiftySixth:return 20}return 10},e.prototype.doLayout=function(){this.width=e.getSize(this._duration)*this.scale},e.prototype.updateBeamingHelper=function(t){this.beamingHelper&&this.beamingHelper.registerBeatLineX("score",this.beat,t+this.x+this.width/2,t+this.x+this.width/2)},e}(sn),Ko=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Zo=function(){this.x=0,this.y=-3e3,this.width=0},$o=function(t){function e(){return t.call(this,0,0)||this}return Ko(e,t),e.prototype.doLayout=function(){if(this.glyphs&&0!==this.glyphs.length){this.glyphs.sort((function(t,e){return t.y<e.y?-1:t.y>e.y?1:0}));var t=[];t.push(new Zo);for(var e=21*this.scale,i=0,n=this.glyphs.length;i<n;i++){(h=this.glyphs[i]).renderer=this.renderer,h.doLayout();for(var r=0;t[r].y>h.y;)++r===t.length&&t.push(new Zo);h.x=r,t[r].y=h.y+e,t[r].width<h.width&&(t[r].width=h.width)}this.width=0;for(var a=0,o=t;a<o.length;a++){var s=o[a];this.width+=s.width,s.x=this.width}for(i=0,n=this.glyphs.length;i<n;i++){var h;s=t[(h=this.glyphs[i]).x];h.x=this.width-s.x}}else this.width=0},e}(Rn),ts=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),es=function(t){function e(e,i){void 0===i&&(i=!1);var n=t.call(this)||this;return n._showParenthesis=!1,n._noteValueLookup=new Map,n._accidentals=new $o,n._preNoteParenthesis=null,n._postNoteParenthesis=null,n.isEmpty=!0,n.noteHeadOffset=0,n._beat=e,n._showParenthesis=i,i&&(n._preNoteParenthesis=new Vo(!0),n._postNoteParenthesis=new Vo(!1)),n}return ts(e,t),Object.defineProperty(e.prototype,"direction",{get:function(){return Xt.Up},enumerable:!1,configurable:!0}),e.prototype.containsNoteValue=function(t){return this._noteValueLookup.has(t)},e.prototype.getNoteValueY=function(t){return this._noteValueLookup.has(t)?this.y+this._noteValueLookup.get(t).y:0},e.prototype.addGlyph=function(t,e){void 0===e&&(e=!1);var i=this.renderer,n=new cn(0,0,A.Quarter,!0),r=i.accidentalHelper.applyAccidentalForValue(this._beat,t,e,!0),a=i.accidentalHelper.getNoteLineForValue(t,!1);if(n.y=i.getScoreY(a,0),this._showParenthesis&&(this._preNoteParenthesis.renderer=this.renderer,this._postNoteParenthesis.renderer=this.renderer,this._preNoteParenthesis.addParenthesisOnLine(a,!0),this._postNoteParenthesis.addParenthesisOnLine(a,!0)),r!==An.None){var o=new fo(0,n.y,r,!0);o.renderer=this.renderer,this._accidentals.addGlyph(o)}this._noteValueLookup.set(t,n),this.add(n,a),this.isEmpty=!1},e.prototype.doLayout=function(){var i=0;this._showParenthesis&&(this._preNoteParenthesis.x=i,this._preNoteParenthesis.renderer=this.renderer,this._preNoteParenthesis.doLayout(),i+=this._preNoteParenthesis.width+e.ElementPadding*this.scale),this._accidentals.isEmpty||(i+=this._accidentals.width+e.ElementPadding*this.scale,this._accidentals.x=i,this._accidentals.renderer=this.renderer,this._accidentals.doLayout(),i+=this._accidentals.width+e.ElementPadding*this.scale),this.noteStartX=i,t.prototype.doLayout.call(this),this.noteHeadOffset=this.noteStartX+(this.width-this.noteStartX)/2,this._showParenthesis&&(this._postNoteParenthesis.x=this.width+e.ElementPadding*this.scale,this._postNoteParenthesis.renderer=this.renderer,this._postNoteParenthesis.doLayout(),this.width+=this._postNoteParenthesis.width+e.ElementPadding*this.scale)},e.prototype.paint=function(e,i,n){this._accidentals.isEmpty||this._accidentals.paint(e+this.x,i+this.y,n),this._showParenthesis&&(this._preNoteParenthesis.paint(e+this.x,i+this.y,n),this._postNoteParenthesis.paint(e+this.x,i+this.y,n)),t.prototype.paint.call(this,e,i,n)},e.ElementPadding=2,e}(Uo),is=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ns=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.BendNoteHeads=[],e}return is(e,t),e.prototype.drawBendSlur=function(t,e,i,n,r,a,o,s){Ao.drawBendSlur(t,e,i,n,r,a,o,s)},e.prototype.doLayout=function(){t.prototype.doLayout.call(this),this.width=0;for(var e=0,i=this.BendNoteHeads;e<i.length;e++){var n=i[e];n.doLayout(),this.width+=n.width+10*this.scale}},e.prototype.getTieDirection=function(t,e){switch(e.getBeatDirection(t)){case Xt.Up:return Xt.Down;default:return Xt.Up}},e.EndPadding=8,e}(nn),rs=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),as=function(t){function e(e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n=t.call(this,e,i)||this;return n.lineValue=0,n.lineValue=i,n}return rs(e,t),e}(X),os=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ss=function(t){function e(){var e=t.call(this,0,0)||this;return e._notes=[],e._renderPoints=new Map,e._preBendMinValue=-1,e._bendMiddleMinValue=-1,e._bendEndMinValue=-1,e._bendEndContinuedMinValue=-1,e._releaseMinValue=-1,e._releaseContinuedMinValue=-1,e._maxBendValue=-1,e}return os(e,t),e.prototype.addBends=function(t){this._notes.push(t);var e=this.createRenderingPoints(t);this._renderPoints.set(t.id,e),(-1===this._maxBendValue||this._maxBendValue<t.maxBendPoint.value)&&(this._maxBendValue=t.maxBendPoint.value);var i=0;switch(t.bendType){case E.Bend:i=e[1].value,t.isTieOrigin?(-1===this._bendEndContinuedMinValue||i<this._bendEndContinuedMinValue)&&(this._bendEndContinuedMinValue=i):(-1===this._bendEndMinValue||i<this._bendEndMinValue)&&(this._bendEndMinValue=i);break;case E.Release:i=e[1].value,t.isTieOrigin?(-1===this._releaseContinuedMinValue||i<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=i):i>0&&(-1===this._releaseMinValue||i<this._releaseMinValue)&&(this._releaseMinValue=i);break;case E.BendRelease:i=e[1].value,(-1===this._bendMiddleMinValue||i<this._bendMiddleMinValue)&&(this._bendMiddleMinValue=i),i=e[2].value,t.isTieOrigin?(-1===this._releaseContinuedMinValue||i<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=i):i>0&&(-1===this._releaseMinValue||i<this._releaseMinValue)&&(this._releaseMinValue=i);break;case E.Prebend:i=e[0].value,(-1===this._preBendMinValue||i<this._preBendMinValue)&&(this._preBendMinValue=i);break;case E.PrebendBend:i=e[0].value,(-1===this._preBendMinValue||i<this._preBendMinValue)&&(this._preBendMinValue=i),i=e[1].value,t.isTieOrigin?(-1===this._bendEndContinuedMinValue||i<this._bendEndContinuedMinValue)&&(this._bendEndContinuedMinValue=i):(-1===this._bendEndMinValue||i<this._bendEndMinValue)&&(this._bendEndMinValue=i);break;case E.PrebendRelease:i=e[0].value,(-1===this._preBendMinValue||i<this._preBendMinValue)&&(this._preBendMinValue=i),i=e[1].value,t.isTieOrigin?(-1===this._releaseContinuedMinValue||i<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=i):i>0&&(-1===this._releaseMinValue||i<this._releaseMinValue)&&(this._releaseMinValue=i)}},e.prototype.doLayout=function(){t.prototype.doLayout.call(this);var i=this._maxBendValue*e.BendValueHeight*this.scale;this.renderer.registerOverflowTop(i);for(var n=0,r=0,a=this._notes;r<a.length;r++){var o=a[r],s=this._renderPoints.get(o.id);switch(o.bendType){case E.Bend:s[1].lineValue=o.isTieOrigin?this._bendEndContinuedMinValue:this._bendEndMinValue;break;case E.Release:(n=o.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue)>=0&&(s[1].lineValue=n);break;case E.BendRelease:s[1].lineValue=this._bendMiddleMinValue,(n=o.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue)>=0&&(s[2].lineValue=n);break;case E.Prebend:s[0].lineValue=this._preBendMinValue;break;case E.PrebendBend:s[0].lineValue=this._preBendMinValue,s[1].lineValue=o.isTieOrigin?this._bendEndContinuedMinValue:this._bendEndMinValue;break;case E.PrebendRelease:s[0].lineValue=this._preBendMinValue,(n=o.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue)>=0&&(s[1].lineValue=n)}}this.width=0,this._notes.sort((function(t,e){return t.isStringed?t.string-e.string:t.realValue-e.realValue}))},e.prototype.createRenderingPoints=function(t){var e=[];switch(t.bendType){case E.Custom:for(var i=0,n=t.bendPoints;i<n.length;i++){var r=n[i];e.push(new as(r.offset,r.value))}break;case E.BendRelease:e.push(new as(0,t.bendPoints[0].value)),e.push(new as(X.MaxPosition/2|0,t.bendPoints[1].value)),e.push(new as(X.MaxPosition,t.bendPoints[3].value));break;case E.Bend:case E.Hold:case E.Prebend:case E.PrebendBend:case E.PrebendRelease:case E.Release:e.push(new as(0,t.bendPoints[0].value)),e.push(new as(X.MaxPosition,t.bendPoints[1].value))}return e},e.prototype.paint=function(t,i,n){var r=n.color;this._notes.length>1&&(n.color=this.renderer.resources.secondaryGlyphColor);for(var a=0,o=this._notes;a<o.length;a++){for(var s=o[a],h=this._renderPoints.get(s.id),c=this.renderer,l=s,u=!1,p=null,d=!1,f=s.bendStyle===L.Gradual?"grad.":"",y=null;l.isTieOrigin;){var g=l.tieDestination;if(!(p=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,g.beat.voice.bar))||c.staff!==p.staff)break;if(u=!0,(l=g).hasBend||!this.renderer.settings.notation.extendBendArrowsOnTiedNotes){d=!0;break}}y=l.beat,p=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,y.voice.bar),y.isLastOfVoice&&!l.hasBend&&this.renderer.settings.notation.extendBendArrowsOnTiedNotes&&(y=null);var m=0,b=0,v=i+c.y;m=t+c.x,h[0].value>0||s.isContinuedBend?m+=c.getBeatX(s.beat,Yi.MiddleNotes):m+=c.getNoteX(s,Un.Right),b=!y||y.isLastOfVoice&&!d?t+p.x+p.postBeatGlyphsStart:d||!y.nextBeat?t+p.x+p.getBeatX(y,Yi.MiddleNotes):s.bendType===E.Hold?t+p.x+p.getBeatX(y.nextBeat,Yi.OnNotes):t+p.x+p.getBeatX(y.nextBeat,Yi.PreNotes),u||(b-=e.ArrowSize*this.scale);var _=(b-m)/X.MaxPosition;n.beginPath();for(var w=0,S=h.length-1;w<S;w++){var B=h[w],T=h[w+1];0!==w||0===B.value||s.isTieDestination||this.paintBend(s,new as(0,0),B,m,v,_,f,n),s.bendType!==E.Prebend?(0===w&&(m+=2*this.scale),this.paintBend(s,B,T,m,v,_,f,n)):s.isTieOrigin&&s.tieDestination.hasBend&&((T=new as(X.MaxPosition,B.value)).lineValue=B.lineValue,this.paintBend(s,B,T,m,v,_,f,n))}n.color=r}},e.prototype.paintBend=function(t,i,n,r,a,o,s,h){var c=this.renderer,l=this.renderer.resources,u=c.lineOffset/2,p=r+o*i.offset,d=e.BendValueHeight*this.scale,f=a-d*i.lineValue;0===i.value?n.offset===i.offset?f+=c.getNoteY(t.beat.maxStringNote,Wn.Top):f+=c.getNoteY(t,Wn.Center):f+=u;var y=r+o*n.offset,g=a-d*n.lineValue;0===n.lineValue?g+=c.getNoteY(t,Wn.Center):g+=u;var m=0,b=e.ArrowSize*this.scale;if(n.value>i.value?(g+b>f&&(g=f-b),h.beginPath(),h.moveTo(y,g),h.lineTo(y-.5*b,g+b),h.lineTo(y+.5*b,g+b),h.closePath(),h.fill(),m=b):n.value!==i.value&&(g<f&&(g=f+b),h.beginPath(),h.moveTo(y,g),h.lineTo(y-.5*b,g-b),h.lineTo(y+.5*b,g-b),h.closePath(),h.fill(),m=-b),h.stroke(),i.value===n.value){if(i.lineValue>0){var v=y,_=e.DashSize*this.scale,w=p+_;if((v-p)/(2*_)<1)h.moveTo(v,f),h.lineTo(p,f);else for(;v>w;)h.moveTo(v,f),h.lineTo(v-_,f),v-=2*_;h.stroke()}}else y>p?(h.moveTo(p,f),h.bezierCurveTo((p+y)/2,f,y,f,y,g+m),h.stroke()):(h.moveTo(p,f),h.lineTo(y,g),h.stroke());if(s&&i.offset<n.offset){h.font=l.graceFont;var S=h.measureText(s),B=0,T=0;if(f>g){var k=Math.abs(f-g);B=k>1.3*h.font.size?f-k/2:f,T=(p+y-S)/2}else B=f,T=y-S;h.fillText(s,T,B)}if(0!==n.value&&i.value!==n.value){var P=n.value,N=n.value>i.value,O="";if(4===(P=Math.abs(P)))O="full",P-=4;else if(P>=4||P<=-4){var x=P/4|0;O+=x,P-=4*x}if(P>0&&(O+=e.getFractionSign(P)),""!==O){var C=g=a-d*n.value;N||(C=f+1*Math.abs(g-f)/3),h.font=l.tablatureFont;S=h.measureText(O),B=C-.5*l.tablatureFont.size-2*this.scale,T=y-S/2;h.fillText(O,T,B)}}},e.getFractionSign=function(t){switch(t){case 1:return"Â¼";case 2:return"Â½";case 3:return"Â¾";default:return t+"/ 4"}},e.ArrowSize=6,e.DashSize=3,e.BendValueHeight=6,e}(nn),hs=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),cs=function(e){function i(t){var i=e.call(this,0,0)||this;return i._isSimpleDip=!1,i._beat=t,i._renderPoints=i.createRenderingPoints(t),i}return hs(i,e),i.prototype.createRenderingPoints=function(t){if(t.whammyBarType===it.Custom)return t.whammyBarPoints;var e=[];switch(t.whammyBarType){case it.Dive:case it.Hold:case it.PrediveDive:case it.Predive:e.push(new X(0,t.whammyBarPoints[0].value)),e.push(new X(X.MaxPosition,t.whammyBarPoints[1].value));break;case it.Dip:e.push(new X(0,t.whammyBarPoints[0].value)),e.push(new X(X.MaxPosition/2|0,t.whammyBarPoints[1].value)),e.push(new X(X.MaxPosition,t.whammyBarPoints[t.whammyBarPoints.length-1].value))}return e},i.prototype.doLayout=function(){e.prototype.doLayout.call(this),this._isSimpleDip=this.renderer.settings.notation.notationMode===t.NotationMode.SongBook&&this._beat.whammyBarType===it.Dip;for(var n=null,r=null,a=this._beat;a&&a.hasWhammyBar;)(!n||n.value>a.minWhammyPoint.value)&&(n=a.minWhammyPoint),(!r||r.value<a.maxWhammyPoint.value)&&(r=a.maxWhammyPoint),a=a.nextBeat;var o=r.value>0?Math.abs(this.getOffset(r.value)):0;(o>0||0!==this._beat.whammyBarPoints[0].value||this.renderer.settings.notation.isNotationElementVisible(h.ZerosOnDiveWhammys))&&(o+=2*this.renderer.resources.tablatureFont.size);var s=n.value<0?Math.abs(this.getOffset(n.value)):0;this.renderer.registerOverflowTop(o+s),o>this.renderer.staff.getSharedLayoutData(i.TopOffsetSharedDataKey,-1)&&this.renderer.staff.setSharedLayoutData(i.TopOffsetSharedDataKey,o)},i.prototype.getOffset=function(t){if(0===t)return 0;var e=i.PerHalfSize*this.scale+Math.log2(Math.abs(t)/2)*i.PerHalfSize*this.scale;return t<0&&(e=-e),e},i.prototype.paint=function(e,n,r){var a=this.renderer,o=this._beat.nextBeat,s=null,h=Yi.PreNotes;o&&((s=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,o.voice.bar))&&s.staff===a.staff&&(s===a||o.hasWhammyBar)?h=!o.hasWhammyBar||a.settings.notation.notationMode===t.NotationMode.SongBook&&o.whammyBarType===it.Dip?Yi.PreNotes:Yi.MiddleNotes:(o=null,s=null));var c=0,l=0;this._isSimpleDip?(c=e+a.x+a.getBeatX(this._beat,Yi.OnNotes)-2*this.scale,l=e+a.x+a.getBeatX(this._beat,Yi.PostNotes)+2*this.scale):(c=e+a.x+a.getBeatX(this._beat,Yi.MiddleNotes),l=s?e+s.x+s.getBeatX(o,h):e+a.x+a.width-2*this.scale);var u=r.textAlign;if(r.textAlign=K.Center,this._renderPoints.length>=2){var p=(l-c)/X.MaxPosition;r.beginPath();for(var d=n+this.renderer.staff.getSharedLayoutData(i.TopOffsetSharedDataKey,0),f=this._beat.whammyStyle===L.Gradual?"grad.":"",y=0,g=this._renderPoints.length-1;y<g;y++){var m=this._renderPoints[y],b=this._renderPoints[y+1],v=y<g-2?this._renderPoints[y+2]:null,_=0===y;0!==y||0===m.value||this._beat.isContinuedWhammy||(this.paintWhammy(!1,new X(0,0),m,b,c,d,p,r),_=!1),this.paintWhammy(_,m,b,v,c,d,p,r,f),f=""}r.stroke()}r.textAlign=u},i.prototype.paintWhammy=function(t,e,n,r,a,o,s,c,l){var u=a+s*e.offset,p=a+s*n.offset,d=o-this.getOffset(e.value),f=o-this.getOffset(n.value);if(e.offset===n.offset){var y=i.DashSize*this.scale;if(Math.abs(f-d)/(2*y)<1)c.moveTo(u,d),c.lineTo(p,f);else for(var g=Math.max(d,f),m=Math.min(d,f);g>m;)c.moveTo(u,m),c.lineTo(u,m+y),m+=2*y;c.stroke()}else if(e.value===n.value){y=i.DashSize*this.scale;if(Math.abs(p-u)/(2*y)<1)c.moveTo(u,d),c.lineTo(p,f);else for(var b=Math.max(u,p),v=Math.min(u,p);b>v;)c.moveTo(b,d),c.lineTo(b-y,d),b-=2*y;c.stroke()}else c.moveTo(u,d),c.lineTo(p,f);var _=this.renderer.resources;if(t&&!this._beat.isContinuedWhammy&&!this._isSimpleDip){var w=d;w-=_.tablatureFont.size+2*this.scale,this.renderer.settings.notation.isNotationElementVisible(h.ZerosOnDiveWhammys)&&c.fillText("0",u,w),l&&(w-=_.tablatureFont.size+2*this.scale,c.fillText(l,u,w))}var S=Math.abs(n.value);if((0!==S||this.renderer.settings.notation.isNotationElementVisible(h.ZerosOnDiveWhammys)&&!this._isSimpleDip)&&e.value!==n.value){var B="";if(n.value<0&&(B+="-"),S>=4){var T=S/4|0;B+=T,S-=4*T}else 0===S&&(B+="0");S>0&&(B+=ss.getFractionSign(S));w=0;this._isSimpleDip?w=Math.min(d,f)-_.tablatureFont.size-2*this.scale:(w=e.offset===n.offset?Math.min(d,f):f,w-=_.tablatureFont.size+2*this.scale,r&&r.value>n.value&&(w-=2*this.scale));var k=p;c.fillText(B,k,w)}},i.TopOffsetSharedDataKey="tab.whammy.topoffset",i.PerHalfSize=6,i.DashSize=3,i}(nn),ls=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),us=function(e){function i(t){var i=e.call(this,0,0)||this;return i._beat=t,i}return ls(i,e),i.prototype.doLayout=function(){var n=this.renderer.settings.notation.notationMode;switch(this._beat.whammyBarType){case it.None:case it.Custom:case it.Hold:return;case it.Dive:case it.PrediveDive:(h=new es(this._beat,!1)).renderer=this.renderer;for(var r=this._beat.whammyBarPoints[this._beat.whammyBarPoints.length-1],a=0,o=this._beat.notes;a<o.length;a++){(d=o[a]).isTieOrigin||h.addGlyph(this.getBendNoteValue(d,r),r.value%2!=0)}h.doLayout(),this.BendNoteHeads.push(h);break;case it.Dip:if(n===t.NotationMode.SongBook){var s=this.renderer.resources;this.renderer.simpleWhammyOverflow=1.5*s.tablatureFont.size+i.SimpleDipHeight*this.scale+i.SimpleDipPadding*this.scale}else{var h,c=new es(this._beat,!1);if(c.renderer=this.renderer,this.renderer.settings.notation.notationMode===t.NotationMode.GuitarPro)for(var l=this._beat.whammyBarPoints[1],u=0,p=this._beat.notes;u<p.length;u++){var d=p[u];c.addGlyph(this.getBendNoteValue(d,this._beat.whammyBarPoints[1]),l.value%2!=0)}if(c.doLayout(),this.BendNoteHeads.push(c),(h=new es(this._beat,!1)).renderer=this.renderer,this.renderer.settings.notation.notationMode===t.NotationMode.GuitarPro)for(var f=this._beat.whammyBarPoints[this._beat.whammyBarPoints.length-1],y=0,g=this._beat.notes;y<g.length;y++){d=g[y];h.addGlyph(this.getBendNoteValue(d,f),f.value%2!=0)}h.doLayout(),this.BendNoteHeads.push(h)}break;case it.Predive:}e.prototype.doLayout.call(this)},i.prototype.paint=function(e,n,r){var a=this._beat;switch(a.whammyBarType){case it.None:case it.Custom:return}for(var o=this.renderer.settings.notation.notationMode,s=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,a.voice.bar),h=e+s.x+s.getBeatX(a,Yi.MiddleNotes),c=this.getTieDirection(a,s),l=1===this._beat.notes.length?c:Xt.Up,u=r.textAlign,p=0;p<a.notes.length;p++){var d=a.notes[p],f=n+s.y;p>0&&p>=(this._beat.notes.length/2|0)&&(l=Xt.Down),l===Xt.Down?f+=s.getNoteY(d,Wn.Bottom):f+=s.getNoteY(d,Wn.Top);var y=e+s.x;a.isLastOfVoice?y+=s.width:y+=s.getBeatX(a,Yi.EndBeat),y-=8*this.scale;var g=a.whammyStyle===L.Gradual&&0===p?"grad.":"",m=null;d.isTieOrigin&&((m=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,d.tieDestination.beat.voice.bar))&&m.staff===s.staff?y=e+m.x+m.getBeatX(d.tieDestination.beat,Yi.MiddleNotes):m=null);var b=cn.NoteHeadHeight*this.scale*cn.GraceScale*.5;l===Xt.Up&&(b=-b);var v=a.whammyBarPoints.length>0?this.getBendNoteValue(d,a.whammyBarPoints[a.whammyBarPoints.length-1]):0,_=0,w=!1;switch(this.BendNoteHeads.length>0&&this.BendNoteHeads[0].containsNoteValue(v)?(_=this.BendNoteHeads[0].getNoteValueY(v)+b,w=!0):m&&(d.isTieOrigin&&d.tieDestination.beat.hasWhammyBar||d.beat.isContinuedWhammy)?(_=n+m.y+m.getNoteY(d.tieDestination,Wn.Top),w=!0,l===Xt.Down&&(_+=cn.NoteHeadHeight*this.scale)):d.isTieOrigin&&(_=m?n+m.y+m.getNoteY(d.tieDestination,Wn.Top):f,l===Xt.Down&&(_+=cn.NoteHeadHeight*this.scale)),a.whammyBarType){case it.Hold:d.isTieOrigin&&Ao.paintTie(r,this.scale,h,f,y,_,c===Xt.Down,22,4);break;case it.Dive:0===p&&(this.BendNoteHeads[0].x=y-this.BendNoteHeads[0].noteHeadOffset,this.BendNoteHeads[0].y=n+s.y,this.BendNoteHeads[0].paint(0,0,r),this.BendNoteHeads[0].containsNoteValue(v)&&(_+=this.BendNoteHeads[0].y)),w?this.drawBendSlur(r,h,f,y,_,l===Xt.Down,this.scale,g):d.isTieOrigin&&Ao.paintTie(r,this.scale,h,f,y,_,c===Xt.Down,22,4);break;case it.Dip:if(o===t.NotationMode.SongBook){if(0===p){var S=e+s.x+s.getBeatX(this._beat,Yi.OnNotes)-2*this.scale,B=e+s.x+s.getBeatX(this._beat,Yi.PostNotes)+2*this.scale,T=(S+B)/2,k=((this._beat.whammyBarPoints[1].value-this._beat.whammyBarPoints[0].value)/4|0).toString();r.font=this.renderer.resources.tablatureFont,r.fillText(k,T,n+this.y);var P=n+this.y+r.font.size+2*this.scale,N=P+i.SimpleDipHeight*this.scale;this._beat.whammyBarPoints[1].value>this._beat.whammyBarPoints[0].value?(r.moveTo(S,N),r.lineTo(T,P),r.lineTo(B,N)):(r.moveTo(S,P),r.lineTo(T,N),r.lineTo(B,P)),r.stroke()}d.isTieOrigin&&Ao.paintTie(r,this.scale,h,f,y,_,c===Xt.Down,22,4)}else{T=(h+y)/2;this.BendNoteHeads[0].x=T-this.BendNoteHeads[0].noteHeadOffset,this.BendNoteHeads[0].y=n+s.y,this.BendNoteHeads[0].paint(0,0,r);var O=this.getBendNoteValue(d,a.whammyBarPoints[1]),x=this.BendNoteHeads[0].getNoteValueY(O)+b;this.drawBendSlur(r,h,f,T,x,l===Xt.Down,this.scale,g),this.BendNoteHeads[1].x=y-this.BendNoteHeads[1].noteHeadOffset,this.BendNoteHeads[1].y=n+s.y,this.BendNoteHeads[1].paint(0,0,r),_=this.BendNoteHeads[1].getNoteValueY(v)+b,this.drawBendSlur(r,T,x,y,_,l===Xt.Down,this.scale,g)}break;case it.PrediveDive:case it.Predive:var C=e+s.x+s.getBeatX(d.beat,Yi.PreNotes);C+=s.getPreNotesGlyphForBeat(d.beat).prebendNoteHeadOffset;var F=n+s.y+s.getScoreY(s.accidentalHelper.getNoteLineForValue(d.displayValue-(d.beat.whammyBarPoints[0].value/2|0),!1),0)+b;this.drawBendSlur(r,C,F,h,f,l===Xt.Down,this.scale,g),this.BendNoteHeads.length>0&&(this.BendNoteHeads[0].x=y-this.BendNoteHeads[0].noteHeadOffset,this.BendNoteHeads[0].y=n+s.y,this.BendNoteHeads[0].paint(0,0,r),this.drawBendSlur(r,h,f,y,_,l===Xt.Down,this.scale,g))}}r.textAlign=u},i.prototype.getBendNoteValue=function(t,e){return t.displayValueWithoutBend+(e.value/2|0)},i.SimpleDipHeight=2*cs.PerHalfSize,i.SimpleDipPadding=2,i}(ns),ps=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ds=function(t){function e(e,i,n){var r=t.call(this,e,i)||this;return r.width=n,r}return ps(e,t),e}(nn),fs=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ys=function(t){function e(e,i,n,r,a){var o=t.call(this,e,i,a?cn.GraceScale:1,n.getSymbol(r))||this;return o._isGrace=a,o._articulation=n,o}return fs(e,t),e.prototype.paint=function(t,e,i){var n=this._isGrace?this.scale:0;i.fillMusicFontSymbol(t+this.x,e+this.y+n,this.glyphScale*this.scale,this.symbol,!1),this._articulation.techniqueSymbol!==Q.None&&this._articulation.techniqueSymbolPlacement===Z.Middle&&i.fillMusicFontSymbol(t+this.x,e+this.y+n,this.glyphScale*this.scale,this._articulation.techniqueSymbol,!1)},e.prototype.doLayout=function(){var t=(this._isGrace?cn.GraceScale:1)*this.scale;switch(this.symbol){case Q.NoteheadWhole:this.width=14;break;case Q.NoteheadCircleX:case Q.NoteheadDiamondWhite:this.width=9;break;case Q.NoteheadHeavyXHat:case Q.NoteheadHeavyX:this.width=13;break;default:this.width=10}this.width=this.width*(this._isGrace?cn.GraceScale:1)*this.scale,this.height=cn.NoteHeadHeight*t},e}(sn),gs=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ms=function(t){function e(e,i){return t.call(this,e,i,cn.GraceScale,Q.ArticStaccatoAbove)||this}return gs(e,t),e.prototype.doLayout=function(){this.width=cn.QuarterNoteHeadWidth*this.scale,this.height=7*this.scale},e.prototype.paint=function(e,i,n){t.prototype.paint.call(this,e+3*this.scale,i+5*this.scale,n)},e}(sn),bs=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),vs=function(t){function e(e,i){return t.call(this,e,i,.5,Q.PictEdgeOfCymbal)||this}return bs(e,t),e.prototype.doLayout=function(){this.width=22*this.scale,this.height=15*this.scale},e.prototype.paint=function(e,i,n){t.prototype.paint.call(this,e-3*this.scale,i+this.height,n)},e}(sn),_s=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ws=function(t){function e(e,i){return t.call(this,e,i,cn.GraceScale,Q.GuitarGolpe)||this}return _s(e,t),e.prototype.doLayout=function(){this.width=9*this.scale,this.height=10*this.scale},e.prototype.paint=function(e,i,n){t.prototype.paint.call(this,e,i+this.height,n)},e}(sn),Ss=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Bs=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.noteHeads=null,e.restGlyph=null,e}return Ss(e,t),e.prototype.getNoteX=function(t,e){return this.noteHeads?this.noteHeads.getNoteX(t,e):0},e.prototype.buildBoundingsLookup=function(t,e,i){this.noteHeads&&this.noteHeads.buildBoundingsLookup(t,e+this.x,i+this.y)},e.prototype.getNoteY=function(t,e){return this.noteHeads?this.noteHeads.getNoteY(t,e):0},e.prototype.updateBeamingHelper=function(){this.noteHeads?this.noteHeads.updateBeamingHelper(this.container.x+this.x):this.restGlyph&&this.restGlyph.updateBeamingHelper(this.container.x+this.x)},e.prototype.doLayout=function(){var e=this.renderer;if(!this.container.beat.isEmpty)if(this.container.beat.isRest){var i=2*Math.ceil((this.renderer.bar.staff.standardNotationLineCount-1)/2);this.container.beat.duration===A.Whole&&1!==this.renderer.bar.staff.standardNotationLineCount&&3!==this.renderer.bar.staff.standardNotationLineCount&&(i-=2);var n=e.getScoreY(i,0);if(this.restGlyph=new Qo(0,n,this.container.beat.duration),this.restGlyph.beat=this.container.beat,this.restGlyph.beamingHelper=this.beamingHelper,this.addGlyph(this.restGlyph),this.container.beat.dots>0){this.addGlyph(new ds(0,0,5*this.scale));for(h=0;h<this.container.beat.dots;h++){c=new Rn(0,0);this.createBeatDot(i,c),this.addGlyph(c)}}}else{this.noteHeads=new Jo,this.noteHeads.beat=this.container.beat,this.noteHeads.beamingHelper=this.beamingHelper;var r=new Vo(!1);r.renderer=this.renderer;for(var a=0,o=this.container.beat.notes;a<o.length;a++){(p=o[a]).isVisible&&(this.createNoteGlyph(p),r.addParenthesis(p))}if(this.addGlyph(this.noteHeads),r.isEmpty||(this.addGlyph(new ds(0,0,4*(this.container.beat.graceType!==R.None?cn.GraceScale:1)*this.scale)),this.addGlyph(r)),this.container.beat.hasWhammyBar){var s=new us(this.container.beat);s.renderer=this.renderer,s.doLayout(),this.container.ties.push(s)}if(this.container.beat.dots>0){this.addGlyph(new ds(0,0,5*this.scale));for(var h=0;h<this.container.beat.dots;h++){for(var c=new Rn(0,0),l=0,u=this.container.beat.notes;l<u.length;l++){var p=u[l];this.createBeatDot(e.getNoteLine(p),c)}this.addGlyph(c)}}}t.prototype.doLayout.call(this),this.container.beat.isEmpty?this.centerX=this.width/2:this.container.beat.isRest?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.centerX=this.noteHeads.x+this.noteHeads.width/2},e.prototype.createBeatDot=function(t,e){var i=this.renderer;e.addGlyph(new Co(0,i.getScoreY(t,0),1.5*this.scale))},e.prototype.createNoteHeadGlyph=function(t){var e=this.container.beat.graceType!==R.None;if(t.beat.voice.bar.staff.isPercussion){var i=at.getArticulation(t);if(i)return new ys(0,0,i,t.beat.duration,e);et.warning("Rendering","No articulation found for percussion instrument "+t.percussionArticulation)}return t.isDead?new Lo(0,0,e):t.beat.graceType===R.BendGrace?new cn(0,0,A.Quarter,!0):t.harmonicType===G.Natural?new Mo(0,0,t.beat.duration,e):new cn(0,0,t.beat.duration,e)},e.prototype.createNoteGlyph=function(t){if(t.beat.graceType!==R.BendGrace||t.hasBend){var e=this.renderer,i=this.createNoteHeadGlyph(t),n=e.getNoteLine(t);if(i.y=e.getScoreY(n,0),this.noteHeads.addNoteGlyph(i,t,n),t.harmonicType!==G.None&&t.harmonicType!==G.Natural){var r=t.displayValue+t.harmonicPitch;i=new Mo(0,0,t.beat.duration,this.container.beat.graceType!==R.None),n=e.accidentalHelper.getNoteLineForValue(r,!1),i.y=e.getScoreY(n,0),this.noteHeads.addNoteGlyph(i,t,n)}if(t.isStaccato&&!this.noteHeads.aboveBeatEffects.has("Staccato")&&this.noteHeads.belowBeatEffects.set("Staccato",new ms(0,0)),t.accentuated!==S.Normal||this.noteHeads.aboveBeatEffects.has("Accent")||this.noteHeads.belowBeatEffects.set("Accent",new Oo(0,0,S.Normal)),t.accentuated!==S.Heavy||this.noteHeads.aboveBeatEffects.has("HAccent")||this.noteHeads.belowBeatEffects.set("HAccent",new Oo(0,0,S.Heavy)),t.isPercussion){var a=at.getArticulation(t);if(a&&a.techniqueSymbolPlacement!==Z.Middle){var o=a.techniqueSymbolPlacement===Z.Top?this.noteHeads.aboveBeatEffects:this.noteHeads.belowBeatEffects;switch(a.techniqueSymbol){case Q.PictEdgeOfCymbal:o.set("PictEdgeOfCymbal",new vs(0,0));break;case Q.ArticStaccatoAbove:o.set("ArticStaccatoAbove",new ms(0,0));break;case Q.StringsUpBow:o.set("StringsUpBow",new pa(0,0,q.Up));break;case Q.StringsDownBow:o.set("StringsDownBow",new pa(0,0,q.Down));break;case Q.GuitarGolpe:o.set("GuitarGolpe",new ws(0,0))}}}}},e}(sr),Ts=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ks=function(t){function e(e){var i=t.call(this,0,0)||this;return i._beat=e,i}return Ts(e,t),e.prototype.doLayout=function(){this.width=10*this.scale},e.prototype.paint=function(t,e,i){var n=this.renderer,r=n.lineOffset,a=e+this.y+(n.getNoteY(this._beat.maxNote,Wn.Bottom)-r),o=e+this.y+n.getNoteY(this._beat.minNote,Wn.Top)+r,s=t+this.x+this.width/2,h=8*this.scale;if(this._beat.brushType!==M.None){var c=new _a(0,0,W.Slight,1.2,!0);c.renderer=this.renderer,c.doLayout();var l=-c.height/2;if(this._beat.brushType===M.ArpeggioUp){var u=a+h,p=o-h;c.width=Math.abs(p-u),i.beginRotate(t+this.x+5*this.scale,p,-90),c.paint(0,l,i),i.endRotate(),i.beginPath(),i.moveTo(s,o),i.lineTo(s+h/2,o-h),i.lineTo(s-h/2,o-h),i.closePath(),i.fill()}else if(this._beat.brushType===M.ArpeggioDown){u=a+h,p=o;c.width=Math.abs(p-u),i.beginRotate(t+this.x+5*this.scale,u,90),c.paint(0,l,i),i.endRotate(),i.beginPath(),i.moveTo(s,a),i.lineTo(s+h/2,a+h),i.lineTo(s-h/2,a+h),i.closePath(),i.fill()}}},e}(nn),Ps=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ns=function(t){function e(){var e=t.call(this)||this;return e._prebends=null,e.accidentals=null,e}return Ps(e,t),Object.defineProperty(e.prototype,"prebendNoteHeadOffset",{get:function(){return this._prebends?this._prebends.x+this._prebends.noteHeadOffset:0},enumerable:!1,configurable:!0}),e.prototype.doLayout=function(){if(!this.container.beat.isRest){var e=new $o,i=new Vo(!0);i.renderer=this.renderer,this._prebends=new es(this.container.beat,!0),this._prebends.renderer=this.renderer;for(var n=0,r=this.container.beat.notes;n<r.length;n++){var a=r[n];if(a.isVisible){if(a.hasBend)switch(a.bendType){case E.PrebendBend:case E.Prebend:case E.PrebendRelease:this._prebends.addGlyph(a.displayValue-(a.bendPoints[0].value/2|0),!1)}else if(a.beat.hasWhammyBar)switch(a.beat.whammyBarType){case it.PrediveDive:case it.Predive:this._prebends.addGlyph(a.displayValue-(a.beat.whammyBarPoints[0].value/2|0),!1)}this.createAccidentalGlyph(a,e),i.addParenthesis(a)}}this._prebends.isEmpty||(this.addGlyph(this._prebends),this.addGlyph(new ds(0,0,4*(this.container.beat.graceType!==R.None?cn.GraceScale:1)*this.scale))),this.container.beat.brushType!==M.None&&(this.addGlyph(new ks(this.container.beat)),this.addGlyph(new ds(0,0,4*this.scale))),i.isEmpty||(this.addGlyph(i),this.addGlyph(new ds(0,0,4*(this.container.beat.graceType!==R.None?cn.GraceScale:1)*this.scale))),e.isEmpty||(this.accidentals=e,this.addGlyph(new ds(0,0,2*(this.container.beat.graceType!==R.None?cn.GraceScale:1)*this.scale)),this.addGlyph(e),this.addGlyph(new ds(0,0,2*(this.container.beat.graceType!==R.None?cn.GraceScale:1)*this.scale)))}t.prototype.doLayout.call(this)},e.prototype.createAccidentalGlyph=function(t,e){var i=this.renderer,n=i.accidentalHelper.applyAccidental(t),r=i.getNoteLine(t),a=this.container.beat.graceType!==R.None;n!==An.None&&((o=new fo(0,i.getScoreY(r,0),n,a)).renderer=this.renderer,e.addGlyph(o));if(t.harmonicType!==G.None&&t.harmonicType!==G.Natural){var o,s=t.displayValue+t.harmonicPitch;n=i.accidentalHelper.applyAccidentalForValue(t.beat,s,a,!1),r=i.accidentalHelper.getNoteLineForValue(s,!1),(o=new fo(0,i.getScoreY(r,0),n,a)).renderer=this.renderer,e.addGlyph(o)}},e}(ar),Os=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),xs=function(t){function e(i,n,r,a){var o=t.call(this,i,n,a,e.getSymbol(r))||this;return o._digit=0,o._scale=0,o._digit=r,o._scale=a,o}return Os(e,t),e.prototype.doLayout=function(){this.width=this.getDigitWidth(this._digit)*this.scale*this._scale},e.prototype.getDigitWidth=function(t){switch(t){case 0:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:return 14;case 1:return 10;default:return 0}},e.getSymbol=function(t){switch(t){case 0:return Q.TimeSig0;case 1:return Q.TimeSig1;case 2:return Q.TimeSig2;case 3:return Q.TimeSig3;case 4:return Q.TimeSig4;case 5:return Q.TimeSig5;case 6:return Q.TimeSig6;case 7:return Q.TimeSig7;case 8:return Q.TimeSig8;case 9:return Q.TimeSig9;default:return Q.None}},e}(sn),Cs=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Fs=function(t){function e(e,i,n,r){void 0===r&&(r=1);var a=t.call(this,e,i)||this;return a._number=0,a._scale=0,a._number=n,a._scale=r,a}return Cs(e,t),e.prototype.doLayout=function(){for(var t=this._number;t>0;){var e=new xs(0,0,t%10,this._scale);this.addGlyph(e),t=t/10|0}if(this.glyphs){this.glyphs.reverse();for(var i=0,n=0,r=this.glyphs.length;n<r;n++){var a=this.glyphs[n];a.x=i,a.y=0,a.renderer=this.renderer,a.doLayout(),i+=a.width}this.width=i}},e.height=18,e}(Rn),Ls=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Es=function(t){function e(e,i,n,r,a){var o=t.call(this,e,i)||this;return o._numerator=0,o._denominator=0,o._numerator=n,o._denominator=r,o._isCommon=a,o}return Ls(e,t),e.prototype.doLayout=function(){if(this._isCommon&&2===this._numerator&&2===this._denominator)(e=new sn(0,0,this.commonScale,Q.TimeSigCutCommon)).width=14*this.scale,this.addGlyph(e),t.prototype.doLayout.call(this);else if(this._isCommon&&4===this._numerator&&4===this._denominator){var e;(e=new sn(0,0,this.commonScale,Q.TimeSigCommon)).width=14*this.scale,this.addGlyph(e),t.prototype.doLayout.call(this)}else{var i=Fs.height*this.scale,n=new Fs(0,-i/2,this._numerator,this.numberScale),r=new Fs(0,i/2,this._denominator,this.numberScale);this.addGlyph(n),this.addGlyph(r),t.prototype.doLayout.call(this);for(var a=0,o=this.glyphs.length;a<o;a++){var s=this.glyphs[a];s.x=(this.width-s.width)/2}}},e}(Rn),Ms=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ds=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ms(e,t),Object.defineProperty(e.prototype,"commonScale",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"numberScale",{get:function(){return 1},enumerable:!1,configurable:!0}),e}(Es),As=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Is=function(t){function e(e){var i=t.call(this,0,0)||this;return i._notes=[],i._endNoteGlyph=null,i._middleNoteGlyph=null,i._beat=e,i}return As(e,t),e.prototype.addBends=function(t){if(this._notes.push(t),!t.isTieOrigin)switch(t.bendType){case E.Bend:case E.PrebendRelease:case E.PrebendBend:(n=this._endNoteGlyph)||((n=this._endNoteGlyph=new es(t.beat,!1)).renderer=this.renderer,this.BendNoteHeads.push(n));var e=t.bendPoints[t.bendPoints.length-1];n.addGlyph(this.getBendNoteValue(t,e),e.value%2!=0);break;case E.Release:if(!t.isTieOrigin){(n=this._endNoteGlyph)||((n=this._endNoteGlyph=new es(t.beat,!1)).renderer=this.renderer,this.BendNoteHeads.push(n));e=t.bendPoints[t.bendPoints.length-1];n.addGlyph(this.getBendNoteValue(t,e),e.value%2!=0)}break;case E.BendRelease:var i=this._middleNoteGlyph;i||((i=this._middleNoteGlyph=new es(t.beat,!1)).renderer=this.renderer,this.BendNoteHeads.push(i));var n,r=t.bendPoints[1];i.addGlyph(this.getBendNoteValue(t,t.bendPoints[1]),r.value%2!=0),(n=this._endNoteGlyph)||((n=this._endNoteGlyph=new es(t.beat,!1)).renderer=this.renderer,this.BendNoteHeads.push(n));e=t.bendPoints[t.bendPoints.length-1];n.addGlyph(this.getBendNoteValue(t,e),e.value%2!=0)}},e.prototype.paint=function(t,e,i){var n=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this._beat.voice.bar),r=t+n.x+n.getBeatX(this._beat,Yi.MiddleNotes),a=t+n.x;this._beat.isLastOfVoice?a+=n.postBeatGlyphsStart:a+=n.getBeatX(this._beat.nextBeat,Yi.PreNotes);var o=(r+(a-=8*this.scale))/2;this._middleNoteGlyph&&(this._middleNoteGlyph.x=o-this._middleNoteGlyph.noteHeadOffset,this._middleNoteGlyph.y=e+n.y,this._middleNoteGlyph.paint(0,0,i)),this._endNoteGlyph&&(this._endNoteGlyph.x=a-this._endNoteGlyph.noteHeadOffset,this._endNoteGlyph.y=e+n.y,this._endNoteGlyph.paint(0,0,i)),this._notes.sort((function(t,e){return e.displayValue-t.displayValue}));for(var s=this._beat.graceType===R.BendGrace?this._beat.nextBeat:this._beat,h=1===this._notes.length?this.getTieDirection(s,n):Xt.Up,c=0;c<this._notes.length;c++){var l=this._notes[c];c>0&&c>=(this._notes.length/2|0)&&(h=Xt.Down);var u=e+n.y+n.getNoteY(l,Wn.Top),p=cn.NoteHeadHeight*this.scale*cn.GraceScale*.5;h===Xt.Down&&(u+=cn.NoteHeadHeight*this.scale);var d=l.bendStyle===L.Gradual?"grad.":"";if(l.isTieOrigin){var f=l.tieDestination,y=f?this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,f.beat.voice.bar):null;if(y&&y.staff===n.staff){g=t+y.x+y.getBeatX(f.beat,Yi.MiddleNotes),b=e+y.y+y.getNoteY(f,Wn.Top);h===Xt.Down&&(b+=cn.NoteHeadHeight*this.scale),l.bendType===E.Hold||l.bendType===E.Prebend?Ao.paintTie(i,this.scale,r,u,g,b,h===Xt.Down,22,4):this.drawBendSlur(i,r,u,g,b,h===Xt.Down,this.scale,d)}else{var g=t+n.x+n.width,m=l.tieDestination.realValue;n.accidentalHelper.applyAccidentalForValue(l.beat,m,!1,!0);var b=e+n.y+n.getScoreY(n.accidentalHelper.getNoteLineForValue(m,!1),0);l.bendType===E.Hold||l.bendType===E.Prebend?Ao.paintTie(i,this.scale,r,u,g,b,h===Xt.Down,22,4):this.drawBendSlur(i,r,u,g,b,h===Xt.Down,this.scale,d)}switch(l.bendType){case E.Prebend:case E.PrebendBend:case E.PrebendRelease:var v=t+n.x+n.getBeatX(l.beat,Yi.PreNotes);v+=n.getPreNotesGlyphForBeat(l.beat).prebendNoteHeadOffset;var _=e+n.y+n.getScoreY(n.accidentalHelper.getNoteLineForValue(l.displayValue-(l.bendPoints[0].value/2|0),!1),0)+p;this.drawBendSlur(i,v,_,r,u,h===Xt.Down,this.scale)}}else{h===Xt.Up&&(p=-p);var w=0;b=0;switch(l.bendType){case E.Bend:w=this.getBendNoteValue(l,l.bendPoints[l.bendPoints.length-1]),b=this._endNoteGlyph.getNoteValueY(w)+p,this.drawBendSlur(i,r,u,a,b,h===Xt.Down,this.scale,d);break;case E.BendRelease:var S=this.getBendNoteValue(l,l.bendPoints[1]),B=this._middleNoteGlyph.getNoteValueY(S)+p;this.drawBendSlur(i,r,u,o,B,h===Xt.Down,this.scale,d),w=this.getBendNoteValue(l,l.bendPoints[l.bendPoints.length-1]),b=this._endNoteGlyph.getNoteValueY(w)+p,this.drawBendSlur(i,o,B,a,b,h===Xt.Down,this.scale,d);break;case E.Release:this.BendNoteHeads.length>0&&(w=this.getBendNoteValue(l,l.bendPoints[l.bendPoints.length-1]),b=this.BendNoteHeads[0].getNoteValueY(w)+p,this.drawBendSlur(i,r,u,a,b,h===Xt.Down,this.scale,d));break;case E.Prebend:case E.PrebendBend:case E.PrebendRelease:v=t+n.x+n.getBeatX(l.beat,Yi.PreNotes);v+=n.getPreNotesGlyphForBeat(l.beat).prebendNoteHeadOffset;_=e+n.y+n.getScoreY(n.accidentalHelper.getNoteLineForValue(l.displayValue-(l.bendPoints[0].value/2|0),!1),0)+p;this.drawBendSlur(i,v,_,r,u,h===Xt.Down,this.scale),this.BendNoteHeads.length>0&&(w=this.getBendNoteValue(l,l.bendPoints[l.bendPoints.length-1]),b=this.BendNoteHeads[0].getNoteValueY(w)+p,this.drawBendSlur(i,r,u,a,b,h===Xt.Down,this.scale,d))}}}},e.prototype.getBendNoteValue=function(t,e){return t.displayValueWithoutBend+(e.value/2|0)},e}(ns),Rs=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Gs=function(t){function e(e,i,n){return void 0===n&&(n=!1),t.call(this,e,i,n)||this}return Rs(e,t),e.prototype.doLayout=function(){t.prototype.doLayout.call(this)},e.prototype.getBeamDirection=function(t,e){if(t.isRest)return Xt.Up;switch(e.getBeatDirection(t)){case Xt.Up:return Xt.Down;default:return Xt.Up}},e.prototype.getStartY=function(){if(this.startBeat.isRest)return this.startNoteRenderer.getScoreY(9,0);switch(this.tieDirection){case Xt.Up:return this.startNoteRenderer.getNoteY(this.startBeat.maxNote,Wn.Top);default:return this.startNoteRenderer.getNoteY(this.startBeat.minNote,Wn.Bottom)}},e.prototype.getEndY=function(){var t=this.endNoteRenderer;if(this.endBeat.isRest)switch(this.tieDirection){case Xt.Up:return t.getScoreY(9,0);default:return t.getScoreY(0,0)}var e=this.startNoteRenderer.getBeatDirection(this.startBeat),i=t.getBeatDirection(this.endBeat);if(e!==i&&this.startBeat.graceType===R.None)if(i===this.tieDirection)switch(this.tieDirection){case Xt.Up:return t.getNoteY(this.endBeat.maxNote,Wn.TopWithStem);default:return t.getNoteY(this.endBeat.minNote,Wn.BottomWithStem)}else switch(this.tieDirection){case Xt.Up:return t.getNoteY(this.endBeat.maxNote,Wn.BottomWithStem);default:return t.getNoteY(this.endBeat.minNote,Wn.TopWithStem)}switch(this.tieDirection){case Xt.Up:return t.getNoteY(this.endBeat.maxNote,Wn.Top);default:return t.getNoteY(this.endBeat.minNote,Wn.Bottom)}},e.prototype.getStartX=function(){return this.startNoteRenderer.getBeatX(this.startBeat,Yi.MiddleNotes)},e.prototype.getEndX=function(){var t=this.endNoteRenderer.getBeatDirection(this.endBeat);return this.endNoteRenderer.getBeatX(this.endBeat,this.endBeat.duration>A.Whole&&t===this.tieDirection?Yi.Stem:Yi.MiddleNotes)},e}(Ao),js=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Vs=function(t){function e(e,i,n,r){var a=t.call(this,0,0)||this;return a._outType=i,a._inType=e,a._startNote=n,a._parent=r,a}return js(e,t),e.prototype.doLayout=function(){this.width=0},e.prototype.paint=function(t,e,i){this.paintSlideIn(t,e,i),this.drawSlideOut(t,e,i)},e.prototype.paintSlideIn=function(t,e,i){var n=this.renderer,r=12*this.scale,a=t+n.x+n.getNoteX(this._startNote,Un.Left)-2*this.scale,o=e+n.y+n.getNoteY(this._startNote,Wn.Center),s=a-r,h=e+n.y;switch(this._inType){case V.IntoFromBelow:h+=n.getNoteY(this._startNote,Wn.Bottom);break;case V.IntoFromAbove:h+=n.getNoteY(this._startNote,Wn.Top);break;default:return}var c=this.getAccidentalsWidth(n,this._startNote.beat);s-=c,a-=c,this.paintSlideLine(i,!1,s,a,h,o)},e.prototype.getAccidentalsWidth=function(t,e){var i=t.getPreNotesGlyphForBeat(e);return i&&i.accidentals?i.accidentals.width:0},e.prototype.drawSlideOut=function(t,e,i){var n=this.renderer,r=12*this.scale,a=3*this.scale,o=1*this.scale,s=2*this.scale,h=0,c=0,l=0,u=0,p=!1;switch(this._outType){case H.Shift:case H.Legato:if(h=t+n.x+n.getBeatX(this._startNote.beat,Yi.PostNotes)+a,c=e+n.y+n.getNoteY(this._startNote,Wn.Center),this._startNote.slideTarget){var d=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this._startNote.slideTarget.beat.voice.bar);d&&d.staff===n.staff?(l=t+d.x+d.getBeatX(this._startNote.slideTarget.beat,Yi.PreNotes)-o,u=e+d.y+d.getNoteY(this._startNote.slideTarget,Wn.Center)):(l=t+n.x+this._parent.x,u=c),this._startNote.slideTarget.realValue>this._startNote.realValue?(c+=s,u-=s):(c-=s,u+=s)}else l=t+n.x+this._parent.x,u=c;break;case H.OutUp:h=t+n.x+n.getNoteX(this._startNote,Un.Right),c=e+n.y+n.getNoteY(this._startNote,Wn.Center),l=h+r,u=e+n.y+n.getNoteY(this._startNote,Wn.Top);break;case H.OutDown:h=t+n.x+n.getNoteX(this._startNote,Un.Right),c=e+n.y+n.getNoteY(this._startNote,Wn.Center),l=h+r,u=e+n.y+n.getNoteY(this._startNote,Wn.Bottom);break;case H.PickSlideUp:h=t+n.x+n.getNoteX(this._startNote,Un.Right)+a,c=e+n.y+n.getNoteY(this._startNote,Wn.Center),u=e+n.y+n.getNoteY(this._startNote,Wn.Top),l=t+n.x+n.width,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(l=t+n.x+n.getBeatX(this._startNote.beat.nextBeat,Yi.PreNotes)),p=!0;break;case H.PickSlideDown:h=t+n.x+n.getNoteX(this._startNote,Un.Right)+a,c=e+n.y+n.getNoteY(this._startNote,Wn.Center),u=e+n.y+n.getNoteY(this._startNote,Wn.Bottom),l=t+n.x+n.width,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(l=t+n.x+n.getBeatX(this._startNote.beat.nextBeat,Yi.PreNotes)),p=!0;break;default:return}this.paintSlideLine(i,p,h,l,c,u)},e.prototype.paintSlideLine=function(t,e,i,n,r,a){if(e){var o=new _a(0,0,W.Slight,1.2);o.renderer=this.renderer,o.doLayout(),r-=o.height/2;var s=n-i,h=(a-=o.height/2)-r,c=Math.sqrt(Math.pow(h,2)+Math.pow(s,2));o.width=s;var l=Math.asin(h/c)*(180/Math.PI);t.beginRotate(i,r,l),o.paint(0,0,t),t.endRotate()}else t.beginPath(),t.moveTo(i,r),t.lineTo(n,a),t.stroke()},e}(nn),Hs=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ws=function(t){function e(e,i,n){void 0===n&&(n=!1);var r=t.call(this,e.beat,i.beat,n)||this;return r._startNote=e,r._endNote=i,r}return Hs(e,t),e.prototype.getTieHeight=function(t,e,i,n){return Math.log2(i-t+1)*this.renderer.settings.notation.slurHeight},e.prototype.getStartY=function(){if(this.isStartCentered())switch(this.tieDirection){case Xt.Up:return this.startNoteRenderer.getNoteY(this._startNote,Wn.Top);default:return this.startNoteRenderer.getNoteY(this._startNote,Wn.Bottom)}return this.startNoteRenderer.getNoteY(this._startNote,Wn.Center)},e.prototype.getEndY=function(){if(!this.isEndCentered())return this.endNoteRenderer.getNoteY(this._endNote,Wn.Center);if(this.isEndOnStem())switch(this.tieDirection){case Xt.Up:return this.endNoteRenderer.getNoteY(this._endNote,Wn.TopWithStem);default:return this.endNoteRenderer.getNoteY(this._endNote,Wn.BottomWithStem)}else switch(this.tieDirection){case Xt.Up:return this.endNoteRenderer.getNoteY(this._endNote,Wn.Top);default:return this.endNoteRenderer.getNoteY(this._endNote,Wn.Bottom)}},e.prototype.isStartCentered=function(){return this._startNote===this._startNote.beat.maxNote&&this.tieDirection===Xt.Up||this._startNote===this._startNote.beat.minNote&&this.tieDirection===Xt.Down},e.prototype.isEndCentered=function(){return this._startNote.beat.graceType===R.None&&(this._endNote===this._endNote.beat.maxNote&&this.tieDirection===Xt.Up||this._endNote===this._endNote.beat.minNote&&this.tieDirection===Xt.Down)},e.prototype.isEndOnStem=function(){var t=this.endNoteRenderer;return this.startNoteRenderer.getBeatDirection(this.startBeat)!==t.getBeatDirection(this.endBeat)&&this.startBeat.graceType===R.None},e.prototype.getStartX=function(){return this.isStartCentered()?this.startNoteRenderer.getBeatX(this._startNote.beat,Yi.MiddleNotes):this.startNoteRenderer.getNoteX(this._startNote,Un.Right)},e.prototype.getEndX=function(){return this.isEndCentered()?this.isEndOnStem()?this.endNoteRenderer.getBeatX(this._endNote.beat,Yi.Stem):this.endNoteRenderer.getNoteX(this._endNote,Un.Center):this.endNoteRenderer.getBeatX(this._endNote.beat,Yi.PreNotes)},e}(Gs),Us=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),zs=function(t){function e(e,i,n){void 0===n&&(n=!1);var r=t.call(this,e?e.beat:null,i?i.beat:null,n)||this;return r.startNote=e,r.endNote=i,r}return Us(e,t),e.prototype.shouldDrawBendSlur=function(){return this.renderer.settings.notation.extendBendArrowsOnTiedNotes&&!!this.startNote.bendOrigin&&this.startNote.isTieOrigin},e.prototype.doLayout=function(){t.prototype.doLayout.call(this)},e.prototype.getBeamDirection=function(t,e){switch(e.getBeatDirection(t)){case Xt.Up:return Xt.Down;default:return Xt.Up}},e.prototype.getStartY=function(){if(this.startBeat.isRest)return this.startNoteRenderer.getScoreY(9,0);switch(this.tieDirection){case Xt.Up:return this.startNoteRenderer.getNoteY(this.startNote,Wn.Top);default:return this.startNoteRenderer.getNoteY(this.startNote,Wn.Bottom)}},e.prototype.getEndY=function(){var t=this.endNoteRenderer;if(this.endBeat.isRest)switch(this.tieDirection){case Xt.Up:return t.getScoreY(9,0);default:return t.getScoreY(0,0)}switch(this.tieDirection){case Xt.Up:return t.getNoteY(this.endNote,Wn.Top);default:return t.getNoteY(this.endNote,Wn.Bottom)}},e.prototype.getStartX=function(){return this.startNoteRenderer.getBeatX(this.startNote.beat,Yi.PostNotes)},e.prototype.getEndX=function(){return this.endNoteRenderer.getBeatX(this.endNote.beat,Yi.PreNotes)},e}(Ao),Xs=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ys=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._bend=null,n._effectSlur=null,n._effectEndSlur=null,n}return Xs(e,t),e.prototype.doLayout=function(){if(this._effectSlur=null,this._effectEndSlur=null,t.prototype.doLayout.call(this),this.beat.isLegatoOrigin){if(!this.beat.previousBeat||!this.beat.previousBeat.isLegatoOrigin){for(var e=this.beat.nextBeat;e.nextBeat&&e.nextBeat.isLegatoDestination;)e=e.nextBeat;this.ties.push(new Gs(this.beat,e,!1))}}else if(this.beat.isLegatoDestination&&!this.beat.isLegatoOrigin){for(var i=this.beat.previousBeat;i.previousBeat&&i.previousBeat.isLegatoOrigin;)i=i.previousBeat;this.ties.push(new Gs(i,this.beat,!0))}this._bend&&(this._bend.renderer=this.renderer,this._bend.doLayout(),this.updateWidth())},e.prototype.createTies=function(t){if(t.isVisible){if(t.isTieOrigin&&!t.hasBend&&!t.beat.hasWhammyBar&&t.beat.graceType!==R.BendGrace&&t.tieDestination&&t.tieDestination.isVisible){var e=new zs(t,t.tieDestination,!1);this.ties.push(e)}if(t.isTieDestination&&!t.tieOrigin.hasBend&&!t.beat.hasWhammyBar){e=new zs(t.tieOrigin,t,!0);this.ties.push(e)}if(t.slideInType!==V.None||t.slideOutType!==H.None){var i=new Vs(t.slideInType,t.slideOutType,t,this);this.ties.push(i)}if(t.isSlurOrigin&&t.slurDestination&&t.slurDestination.isVisible){e=new Ws(t,t.slurDestination,!1);this.ties.push(e)}if(t.isSlurDestination){e=new Ws(t.slurOrigin,t,!0);this.ties.push(e)}if(!this._effectSlur&&t.isEffectSlurOrigin&&t.effectSlurDestination&&(this._effectSlur=new Ws(t,t.effectSlurDestination,!1),this.ties.push(this._effectSlur)),!this._effectEndSlur&&t.beat.isEffectSlurDestination&&t.beat.effectSlurOrigin){var n=this.onNotes.beamingHelper.direction,r=n===Xt.Up?t.beat.effectSlurOrigin.minNote:t.beat.effectSlurOrigin.maxNote,a=n===Xt.Up?t.beat.minNote:t.beat.maxNote;this._effectEndSlur=new Ws(r,a,!0),this.ties.push(this._effectEndSlur)}t.hasBend&&(this._bend||(this._bend=new Is(t.beat),this._bend.renderer=this.renderer,this.ties.push(this._bend)),this._bend.addBends(t))}},e}(dn),Js=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),qs=function(e){function i(t,i){var n=e.call(this,t,i)||this;return n.simpleWhammyOverflow=0,n._firstLineY=0,n._startSpacing=!1,n.accidentalHelper=new Xn(i),n}return Js(i,e),i.prototype.getBeatDirection=function(t){return this.helpers.getBeamingHelperForBeat(t).direction},Object.defineProperty(i.prototype,"lineOffset",{get:function(){return(Kn.LineSpacing+1)*this.scale},enumerable:!1,configurable:!0}),i.prototype.updateSizes=function(){var t=this.resources,i=t.tablatureFont.size/2+.2*t.tablatureFont.size;this.topPadding=i*this.scale,this.bottomPadding=i*this.scale,this.height=4*this.lineOffset+this.topPadding+this.bottomPadding,this.updateFirstLineY(),e.prototype.updateSizes.call(this)},i.prototype.updateFirstLineY=function(){var t=4*this.lineOffset,e=(this.bar.staff.standardNotationLineCount-1)*this.lineOffset;this._firstLineY=(t-e)/2},i.prototype.doLayout=function(){if(this.updateFirstLineY(),e.prototype.doLayout.call(this),!this.bar.isEmpty&&this.accidentalHelper.maxLineBeat){var t=this.getScoreY(-2,0),i=this.getScoreY(6,0),n=this.simpleWhammyOverflow;this.registerOverflowTop(n);var r=this.getScoreY(this.accidentalHelper.maxLine,0),a=this.helpers.getBeamingHelperForBeat(this.accidentalHelper.maxLineBeat);a.direction===Xt.Up&&(r-=this.getStemSize(a),r-=a.fingeringCount*this.resources.graceFont.size,a.hasTuplet&&(r-=2*this.resources.effectFont.size)),a.hasTuplet&&(r-=1.5*this.resources.effectFont.size),r<t&&this.registerOverflowTop(Math.abs(r)+n);var o=this.getScoreY(this.accidentalHelper.minLine,0),s=this.helpers.getBeamingHelperForBeat(this.accidentalHelper.minLineBeat);s.direction===Xt.Down&&(o+=this.getStemSize(s),o+=s.fingeringCount*this.resources.graceFont.size),o>i&&this.registerOverflowBottom(Math.abs(o)-i)}},i.prototype.paint=function(t,i,n){e.prototype.paint.call(this,t,i,n),this.paintBeams(t,i,n),this.paintTuplets(t,i,n)},i.prototype.paintTuplets=function(t,e,i){for(var n=0,r=this.bar.voices;n<r.length;n++){var a=r[n];if(this.hasVoiceContainer(a))for(var o=0,s=this.getVoiceContainer(a).tupletGroups;o<s.length;o++){var h=s[o];this.paintTupletHelper(t+this.beatGlyphsStart,e,i,h)}}},i.prototype.paintBeams=function(t,e,i){for(var n=0,r=this.helpers.beamHelpers.length;n<r;n++)for(var a=this.helpers.beamHelpers[n],o=0,s=a.length;o<s;o++){var h=a[o];this.paintBeamHelper(t+this.beatGlyphsStart,e,i,h)}},i.prototype.paintBeamHelper=function(t,e,i,n){i.color=0===n.voice.index?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,1===n.beats.length?this.paintFlag(t,e,i,n):this.paintBar(t,e,i,n)},i.prototype.paintTupletHelper=function(t,e,i,n){var r,a=this.resources,o=i.textAlign;i.color=0===n.voice.index?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,i.textAlign=K.Center;var s=n.beats[0].tupletNumerator,h=n.beats[0].tupletDenominator;if(r=2===s&&3===h?"2":3===s&&2===h?"3":4===s&&6===h?"4":5===s&&4===h?"5":6===s&&4===h?"6":7===s&&4===h?"7":9===s&&8===h?"9":10===s&&8===h?"10":11===s&&8===h?"11":12===s&&8===h?"12":13===s&&8===h?"13":s+":"+h,1!==n.beats.length&&n.isFull){var c=n.beats[0],l=n.beats[n.beats.length-1],u=this.helpers.beamHelperLookup[n.voice.index].get(c.index),p=this.helpers.beamHelperLookup[n.voice.index].get(l.index);if(u&&p){L=u.direction;var d=u.getBeatLineX(c),f=p.getBeatLineX(l);i.font=a.effectFont;var y=i.measureText(r),g=3*this.scale,m=(d+f)/2,b=m-y/2-g,v=m+y/2+g,_=this.calculateBeamYWithDirection(u,d,u.direction),w=this.calculateBeamYWithDirection(p,f,u.direction),S=(w-_)/(f-d),B=_-S*d,T=S*b+B,k=S*m+B,P=S*v+B,N=(D=10*this.scale,5*this.scale);L===Xt.Down&&(D*=-1,N*=-1),i.beginPath(),i.moveTo(t+this.x+d,e+this.y+_-D|0),i.lineTo(t+this.x+d,e+this.y+_-D-N|0),i.lineTo(t+this.x+b,e+this.y+T-D-N|0),i.stroke(),i.beginPath(),i.moveTo(t+this.x+v,e+this.y+P-D-N|0),i.lineTo(t+this.x+f,e+this.y+w-D-N|0),i.lineTo(t+this.x+f,e+this.y+w-D|0),i.stroke(),i.fillText(r,t+this.x+m,e+this.y+k-D-N-a.effectFont.size/2)}}else for(var O=0,x=n.beats.length;O<x;O++){var C=n.beats[O],F=this.helpers.beamHelperLookup[n.voice.index].get(C.index);if(F){var L=F.direction,E=F.getBeatLineX(C),M=e+this.y+this.calculateBeamY(F,E),D=L===Xt.Up?1.5*a.effectFont.size:-3*this.scale;i.font=a.effectFont,i.fillText(r,t+this.x+E,M-D)}}i.textAlign=o},i.prototype.getStemSize=function(t){var e=1===t.beats.length?this.getFlagStemSize(t.shortestDuration):this.getBarStemSize(t.shortestDuration);return t.isGrace&&(e*=cn.GraceScale),e},i.prototype.getBarStemSize=function(t){var e=0;switch(t){case A.QuadrupleWhole:case A.Half:case A.Quarter:case A.Eighth:case A.Sixteenth:e=6;break;case A.ThirtySecond:e=8;break;case A.SixtyFourth:case A.OneHundredTwentyEighth:e=9;break;case A.TwoHundredFiftySixth:e=10;break;default:e=0}return this.getScoreHeight(e)},i.prototype.getFlagStemSize=function(t){var e=0;switch(t){case A.QuadrupleWhole:case A.Half:case A.Quarter:case A.Eighth:case A.Sixteenth:case A.ThirtySecond:case A.SixtyFourth:case A.OneHundredTwentyEighth:case A.TwoHundredFiftySixth:e=6;break;default:e=0}return this.getScoreHeight(e)},Object.defineProperty(i.prototype,"middleYPosition",{get:function(){return this.getScoreY(this.bar.staff.standardNotationLineCount-1)},enumerable:!1,configurable:!0}),i.prototype.getNoteY=function(t,i){var n=e.prototype.getNoteY.call(this,t,i);if(isNaN(n)){var r=Xn.computeLineWithoutAccidentals(this.bar,t);n=this.getScoreY(r)}return n},i.prototype.calculateBeamY=function(t,e){return this.calculateBeamYWithDirection(t,e,t.direction)},i.prototype.calculateBeamYWithDirection=function(t,e,i){var n=this.getStemSize(t),r=t.beats[0];if(1===t.beats.length)return i===Xt.Up?this.getScoreY(this.accidentalHelper.getMinLine(r))-n:this.getScoreY(this.accidentalHelper.getMaxLine(r))+n;var a=t.beats[t.beats.length-1],o=10*this.scale,s=t.beatOfLowestNote,h=t.beatOfHighestNote;if(i===Xt.Down&&s!==r&&s!==a)return this.getScoreY(this.accidentalHelper.getMaxLine(s))+n;if(i===Xt.Up&&h!==r&&h!==a)return this.getScoreY(this.accidentalHelper.getMinLine(h))-n;var c=t.getBeatLineX(r),l=i===Xt.Up?this.getScoreY(this.accidentalHelper.getMinLine(r))-n:this.getScoreY(this.accidentalHelper.getMaxLine(r))+n,u=t.getBeatLineX(a),p=i===Xt.Up?this.getScoreY(this.accidentalHelper.getMinLine(a))-n:this.getScoreY(this.accidentalHelper.getMaxLine(a))+n;return i===Xt.Down&&l>p&&l-p>o&&(p=l-o),i===Xt.Down&&p>l&&p-l>o&&(l=p-o),i===Xt.Up&&l<p&&p-l>o&&(p=l+o),i===Xt.Up&&p<l&&l-p>o&&(l=p+o),c===u?l:(p-l)/(u-c)*(e-c)+l},i.prototype.paintBar=function(t,e,n,r){for(var a=0,o=r.beats.length;a<o;a++){var s=r.beats[a],h=s.graceType!==R.None?cn.GraceScale:1,c=r.getBeatLineX(s),l=r.direction,u=e+this.y;u+=l===Xt.Up?this.getScoreY(this.accidentalHelper.getMaxLine(s)):this.getScoreY(this.accidentalHelper.getMinLine(s));var p=e+this.y;p+=this.calculateBeamY(r,c),n.lineWidth=i.StemWidth*this.scale,n.beginPath(),n.moveTo(t+this.x+c,u),n.lineTo(t+this.x+c,p),n.stroke(),n.lineWidth=this.scale;var d=p;l===Xt.Down?d+=2*n.font.size:0!==a&&(d-=1.5*n.font.size),this.paintFingering(n,s,t+this.x+c,l,d);var f=6*this.scale*h,y=(Kn.BeamSpacing+Kn.BeamThickness)*this.scale*h,m=Kn.BeamThickness*this.scale*h,b=g.getIndex(s.duration)-2,v=e+this.y;l===Xt.Down&&(y=-y,m=-m);for(var _=0;_<b;_++){var w=0,S=0,B=0,T=0,k=v+_*y;if(a<r.beats.length-1){if(Jn.isFullBarJoin(s,r.beats[a+1],_))w=c,S=r.getBeatLineX(r.beats[a+1]);else{if(0!==a&&Jn.isFullBarJoin(r.beats[a-1],s,_))continue;S=(w=c)+f}B=k+this.calculateBeamY(r,w),T=k+this.calculateBeamY(r,S),i.paintSingleBar(n,t+this.x+w,B,t+this.x+S,T,m)}else a>0&&!Jn.isFullBarJoin(s,r.beats[a-1],_)&&(w=c-f,S=c,B=k+this.calculateBeamY(r,w),T=k+this.calculateBeamY(r,S),i.paintSingleBar(n,t+this.x+w,B,t+this.x+S,T,m))}}},i.paintSingleBar=function(t,e,i,n,r,a){t.beginPath(),t.moveTo(e,i),t.lineTo(n,r),t.lineTo(n,r+a),t.lineTo(e,i+a),t.closePath(),t.fill()},i.prototype.paintFlag=function(e,i,n,r){var a=r.beats[0];if(a.graceType!==R.BendGrace&&(a.graceType===R.None||this.settings.notation.notationMode!==t.NotationMode.SongBook)){var o=a.graceType!==R.None,s=o?cn.GraceScale:1,h=this.getFlagStemSize(r.shortestDuration),c=r.getBeatLineX(a),l=r.direction,u=this.getScoreY(this.accidentalHelper.getMinLine(a)),p=this.getScoreY(this.accidentalHelper.getMaxLine(a)),d=0,f=0;if(l===Xt.Down?(d=p+=h*s,f=i+this.y+p):(d=u-=h*s,f=i+this.y+u),this.paintFingering(n,a,e+this.x+c,l,f),r.hasLine){if(n.lineWidth=Kn.StemWidth*this.scale,n.beginPath(),n.moveTo(e+this.x+c,i+this.y+u),n.lineTo(e+this.x+c,i+this.y+p),n.stroke(),n.lineWidth=this.scale,a.graceType===R.BeforeBeat){var y=15*this.scale,g=12*this.scale;n.beginPath(),l===Xt.Down?(n.moveTo(e+this.x+c-g/2,i+this.y+p-y),n.lineTo(e+this.x+c+g/2,i+this.y+p)):(n.moveTo(e+this.x+c-g/2,i+this.y+u+y),n.lineTo(e+this.x+c+g/2,i+this.y+u)),n.stroke()}if(r.hasFlag){var m=new un(c-this.scale/2,d,a.duration,l,o);m.renderer=this,m.doLayout(),m.paint(e+this.x,i+this.y,n)}}}},i.prototype.paintFingering=function(e,i,n,a,o){var s=this.settings;if(s.notation.fingeringMode===t.FingeringMode.ScoreDefault||s.notation.fingeringMode===t.FingeringMode.ScoreForcePiano){a===Xt.Up?n-=10*this.scale:n+=3*this.scale;var h=i.notes.slice(0);h.sort((function(t,e){return t.realValue-e.realValue}));for(var c=0;c<h.length;c++){var l=h[c],u=null;l.leftHandFinger!==r.Unknown?u=g.fingerToString(s,i,l.leftHandFinger,!0):l.rightHandFinger!==r.Unknown&&(u=g.fingerToString(s,i,l.rightHandFinger,!1)),u&&(e.fillText(u,n,o),o-=0|e.font.size)}}},i.prototype.createPreBeatGlyphs=function(){if(e.prototype.createPreBeatGlyphs.call(this),this.bar.masterBar.isRepeatStart&&this.addPreBeatGlyph(new Po(0,0,1.5,3)),this.isFirstOfLine||this.bar.clef!==this.bar.previousBar.clef||this.bar.clefOttava!==this.bar.previousBar.clefOttava){var t=0;switch(this.bar.clef){case O.Neutral:t=this.bar.staff.standardNotationLineCount-1;break;case O.F4:t=2;break;case O.C3:t=4;break;case O.C4:t=2;break;case O.G2:t=6}this.createStartSpacing(),this.addPreBeatGlyph(new _o(0,this.getScoreY(t,.5),this.bar.clef,this.bar.clefOttava))}(0===this.index&&0!==this.bar.masterBar.keySignature||this.bar.previousBar&&this.bar.masterBar.keySignature!==this.bar.previousBar.masterBar.keySignature)&&(this.createStartSpacing(),this.createKeySignatureGlyphs()),(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs()),this.addPreBeatGlyph(new go(0,this.getScoreHeight(-.5),this.bar.index+1))},i.prototype.createBeatGlyphs=function(){for(var t=0;t<this.bar.voices.length;t++){var e=this.bar.voices[t];this.hasVoiceContainer(e)&&this.createVoiceGlyphs(e)}},i.prototype.createPostBeatGlyphs=function(){e.prototype.createPostBeatGlyphs.call(this),this.bar.masterBar.isRepeatEnd?(this.addPostBeatGlyph(new So(this.x,0)),this.bar.masterBar.repeatCount>2&&this.addPostBeatGlyph(new To(0,this.getScoreY(-4),this.bar.masterBar.repeatCount))):this.addPostBeatGlyph(new bo(0,0))},i.prototype.createStartSpacing=function(){this._startSpacing||(this.addPreBeatGlyph(new ds(0,0,2*this.scale)),this._startSpacing=!0)},i.prototype.createKeySignatureGlyphs=function(){var t=0,e=this.bar.masterBar.keySignature,n=this.bar.previousBar?this.bar.previousBar.masterBar.keySignature:0;switch(this.bar.clef){case O.Neutral:t=0;break;case O.G2:t=1;break;case O.F4:t=2;break;case O.C3:t=-1;break;case O.C4:t=1}var r=new Map,a=[];if(g.keySignatureIsSharp(e))for(var o=0;o<Math.abs(e);o++){var s=i.SharpKsSteps[o]+t;a.push(new fo(0,this.getScoreY(s,0),An.Sharp,!1)),r.set(s,!0)}else for(o=0;o<Math.abs(e);o++){s=i.FlatKsSteps[o]+t;a.push(new fo(0,this.getScoreY(s,0),An.Flat,!1)),r.set(s,!0)}var h=Math.abs(n),c=g.keySignatureIsSharp(n)?i.SharpKsSteps:i.FlatKsSteps;for(o=0;o<h;o++){s=c[o]+t;r.has(s)||this.addPreBeatGlyph(new fo(0,this.getScoreY(c[o]+t,0),An.Natural,!1))}for(var l=0,u=a;l<u.length;l++){var p=u[l];this.addPreBeatGlyph(p)}},i.prototype.createTimeSignatureGlyphs=function(){this.addPreBeatGlyph(new ds(0,0,5*this.scale));var t=this.bar.staff.standardNotationLineCount-1;this.addPreBeatGlyph(new Ds(0,this.getScoreY(t,0),this.bar.masterBar.timeSignatureNumerator,this.bar.masterBar.timeSignatureDenominator,this.bar.masterBar.timeSignatureCommon))},i.prototype.createVoiceGlyphs=function(t){for(var e=0,i=t.beats.length;e<i;e++){var n=t.beats[e],r=new Ys(n,this.getVoiceContainer(t));r.preNotes=new Ns,r.onNotes=new Bs,this.addBeatGlyph(r)}},i.prototype.getNoteLine=function(t){return this.accidentalHelper.getNoteLine(t)},i.prototype.getScoreY=function(t,e){return void 0===e&&(e=0),this._firstLineY+this.lineOffset+this.getScoreHeight(t)+e*this.scale*Kn.StaffLineThickness},i.prototype.getScoreHeight=function(t){return this.lineOffset/2*t},i.prototype.paintBackground=function(t,i,n){e.prototype.paintBackground.call(this,t,i,n);var r=this.resources;n.color=r.staffLineColor;for(var a=0;a<this.bar.staff.standardNotationLineCount;a++){var o=i+this.y+this.getScoreY(2*a);n.fillRect(t+this.x,0|o,this.width,this.scale*Kn.StaffLineThickness)}n.color=r.mainGlyphColor,this.paintSimileMark(t,i,n)},i.StaffId="score",i.SharpKsSteps=[-1,2,-2,1,4,0,3],i.FlatKsSteps=[3,0,4,1,5,2,6],i}(Kn),Qs=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ks=function(t){function e(){return t.call(this)||this}return Qs(e,t),Object.defineProperty(e.prototype,"staffId",{get:function(){return qs.StaffId},enumerable:!1,configurable:!0}),e.prototype.create=function(t,e){return new qs(t,e)},e}(Dn),Zs=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),$s=function(t){function e(e,i,n,r){var a=t.call(this,0,0)||this;return a._inType=e,a._outType=i,a._startNote=n,a._parent=r,a}return Zs(e,t),e.prototype.doLayout=function(){this.width=0},e.prototype.paint=function(t,e,i){this.paintSlideIn(t,e,i),this.paintSlideOut(t,e,i)},e.prototype.paintSlideIn=function(t,e,i){var n=this.renderer,r=12*this.scale,a=3*this.scale,o=0,s=0,h=0,c=0;switch(this._inType){case V.IntoFromBelow:h=t+n.x+n.getNoteX(this._startNote,Un.Left),c=e+n.y+n.getNoteY(this._startNote,Wn.Center),o=h-r,s=e+n.y+n.getNoteY(this._startNote,Wn.Center)+a;break;case V.IntoFromAbove:h=t+n.x+n.getNoteX(this._startNote,Un.Left),c=e+n.y+n.getNoteY(this._startNote,Wn.Center),o=h-r,s=e+n.y+n.getNoteY(this._startNote,Wn.Center)-a;break;default:return}this.paintSlideLine(i,!1,o,h,s,c)},e.prototype.paintSlideOut=function(t,e,i){var n=this.renderer,r=12*this.scale,a=3*this.scale,o=0,s=0,h=0,c=0,l=!1,u=2*this.scale;switch(this._outType){case H.Shift:case H.Legato:if(o=t+n.x+n.getBeatX(this._startNote.beat,Yi.PostNotes),s=e+n.y+n.getNoteY(this._startNote,Wn.Center),this._startNote.slideTarget){var p=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this._startNote.slideTarget.beat.voice.bar);p&&p.staff===n.staff?(h=t+p.x+p.getBeatX(this._startNote.slideTarget.beat,Yi.OnNotes)-u,c=e+p.y+p.getNoteY(this._startNote.slideTarget,Wn.Center)):(h=t+n.x+this._parent.x,c=s),this._startNote.slideTarget.fret>this._startNote.fret?(s+=a,c-=a):(s-=a,c+=a)}else h=t+n.x+this._parent.x,c=s;break;case H.OutUp:o=t+n.x+n.getNoteX(this._startNote,Un.Right),s=e+n.y+n.getNoteY(this._startNote,Wn.Center),h=o+r-u,c=e+n.y+n.getNoteY(this._startNote,Wn.Center)-a;break;case H.OutDown:o=t+n.x+n.getNoteX(this._startNote,Un.Right),s=e+n.y+n.getNoteY(this._startNote,Wn.Center),h=o+r-u,c=e+n.y+n.getNoteY(this._startNote,Wn.Center)+a;break;case H.PickSlideDown:o=t+n.x+n.getNoteX(this._startNote,Un.Right),s=e+n.y+n.getNoteY(this._startNote,Wn.Center),h=t+n.x+n.getBeatX(this._startNote.beat,Yi.EndBeat),c=s+3*a,l=!0;break;case H.PickSlideUp:o=t+n.x+n.getNoteX(this._startNote,Un.Right),s=e+n.y+n.getNoteY(this._startNote,Wn.Center),h=t+n.x+n.getBeatX(this._startNote.beat,Yi.EndBeat),c=s-3*a,l=!0;break;default:return}this.paintSlideLine(i,l,o,h,s,c)},e.prototype.paintSlideLine=function(t,e,i,n,r,a){if(e){var o=new _a(0,0,W.Slight,1.2);o.renderer=this.renderer,o.doLayout(),r-=o.height/2;var s=n-i,h=(a-=o.height/2)-r,c=Math.sqrt(Math.pow(h,2)+Math.pow(s,2));o.width=s;var l=Math.asin(h/c)*(180/Math.PI);t.beginRotate(i,r,l),o.paint(0,0,t),t.endRotate()}else t.beginPath(),t.moveTo(i,r),t.lineTo(n,a),t.stroke()},e}(nn),th=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),eh=function(t){function e(e,i,n){void 0===n&&(n=!1);var r=t.call(this,e.beat,i.beat,n)||this;return r.startNote=e,r.endNote=i,r}return th(e,t),e.prototype.getTieHeight=function(e,i,n,r){return this.startNote===this.endNote?15:t.prototype.getTieHeight.call(this,e,i,n,r)},e.prototype.getBeamDirection=function(t,i){return this.startNote===this.endNote?Xt.Up:e.getBeamDirectionForNote(this.startNote)},e.getBeamDirectionForNote=function(t){return t.string>3?Xt.Up:Xt.Down},e.prototype.getStartY=function(){return this.startNote===this.endNote?this.startNoteRenderer.getNoteY(this.startNote,Wn.Center):this.tieDirection===Xt.Up?this.startNoteRenderer.getNoteY(this.startNote,Wn.Top):this.startNoteRenderer.getNoteY(this.startNote,Wn.Bottom)},e.prototype.getEndY=function(){return this.getStartY()},e.prototype.getStartX=function(){return this.startNote===this.endNote?this.getEndX()-20*this.scale:this.startNoteRenderer.getNoteX(this.startNote,Un.Center)},e.prototype.getEndX=function(){return this.startNote===this.endNote?this.endNoteRenderer.getNoteX(this.endNote,Un.Left):this.endNoteRenderer.getNoteX(this.endNote,Un.Center)},e}(Ao),ih=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),nh=function(t){function e(e,i,n,r){void 0===r&&(r=!1);var a=t.call(this,e,i,r)||this;return a._direction=eh.getBeamDirectionForNote(e),a._forSlide=n,a}return ih(e,t),e.prototype.getTieHeight=function(t,e,i,n){return Math.log(i-t+1)*this.renderer.settings.notation.slurHeight},e.prototype.tryExpand=function(t,e,i,n){if(this._forSlide!==i)return!1;if(this.forEnd!==n)return!1;if(this.startNote.beat.id!==t.beat.id)return!1;if(this.endNote.beat.id!==e.beat.id)return!1;if(this._direction!==eh.getBeamDirectionForNote(t))return!1;switch(this._direction){case Xt.Up:t.realValue>this.startNote.realValue&&(this.startNote=t,this.startBeat=t.beat),e.realValue>this.endNote.realValue&&(this.endNote=e,this.endBeat=e.beat);break;case Xt.Down:t.realValue<this.startNote.realValue&&(this.startNote=t,this.startBeat=t.beat),e.realValue<this.endNote.realValue&&(this.endNote=e,this.endBeat=e.beat)}return!0},e.prototype.paint=function(e,i,n){var r=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this.startBeat.voice.bar),a=this.getBeamDirection(this.startBeat,r),o="tab.slur."+this.startNote.beat.id+"."+this.endNote.beat.id+"."+a,s=this.renderer;s.staff.getSharedLayoutData(o,!1)||(s.staff.setSharedLayoutData(o,!0),t.prototype.paint.call(this,e,i,n))},e}(eh),rh=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ah=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._bend=null,n._effectSlurs=[],n}return rh(e,t),e.prototype.doLayout=function(){this._effectSlurs=[],t.prototype.doLayout.call(this),this._bend&&(this._bend.renderer=this.renderer,this._bend.doLayout(),this.updateWidth())},e.prototype.createTies=function(t){if(t.isVisible){var e=this.renderer;if(t.isTieOrigin&&e.showTiedNotes&&t.tieDestination.isVisible){var i=new eh(t,t.tieDestination,!1);this.ties.push(i)}if(t.isTieDestination&&e.showTiedNotes){i=new eh(t.tieOrigin,t,!0);this.ties.push(i)}if(t.isLeftHandTapped&&!t.isHammerPullDestination){var n=new eh(t,t,!1);this.ties.push(n)}if(t.isEffectSlurOrigin&&t.effectSlurDestination){for(var r=!1,a=0,o=this._effectSlurs;a<o.length;a++){if(o[a].tryExpand(t,t.effectSlurDestination,!1,!1)){r=!0;break}}if(!r){var s=new nh(t,t.effectSlurDestination,!1,!1);this._effectSlurs.push(s),this.ties.push(s)}}if(t.isEffectSlurDestination&&t.effectSlurOrigin){r=!1;for(var h=0,c=this._effectSlurs;h<c.length;h++){if(c[h].tryExpand(t.effectSlurOrigin,t,!1,!0)){r=!0;break}}if(!r){s=new nh(t.effectSlurOrigin,t,!1,!0);this._effectSlurs.push(s),this.ties.push(s)}}if(t.slideInType!==V.None||t.slideOutType!==H.None){var l=new $s(t.slideInType,t.slideOutType,t,this);this.ties.push(l)}t.hasBend&&(this._bend||(this._bend=new ss,this._bend.renderer=this.renderer,this.ties.push(this._bend)),this._bend.addBends(t))}},e}(dn),oh=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),sh=function(e){function i(t,i,n){var r=e.call(this,t,i)||this;return r._noteString=null,r._trillNoteString=null,r._trillNoteStringWidth=0,r.isEmpty=!1,r.height=0,r.noteStringWidth=0,r._note=n,r}return oh(i,e),i.prototype.doLayout=function(){var e=this._note,i=e.fret-e.beat.voice.bar.staff.transpositionPitch;if(e.harmonicType===G.Natural&&0!==e.harmonicValue&&(i=e.harmonicValue-e.beat.voice.bar.staff.transpositionPitch),e.isTieDestination)0===e.beat.index&&this.renderer.settings.notation.notationMode==t.NotationMode.GuitarPro||(e.bendType===E.Bend||e.bendType===E.BendRelease)&&this.renderer.settings.notation.isNotationElementVisible(h.TabNotesOnTiedBends)?this._noteString="("+(e.tieOrigin.fret-e.beat.voice.bar.staff.transpositionPitch)+")":this._noteString="";else if(this._noteString=e.isDead?"x":i.toString(),e.isGhost)this._noteString="("+this._noteString+")";else if(e.harmonicType===G.Natural){(n=this._noteString.indexOf(String.fromCharCode(46)))>=0&&(this._noteString=this._noteString.substr(0,n+2)),this._noteString="<"+this._noteString+">"}if(e.isTrill)this._trillNoteString="("+(e.trillFret-e.beat.voice.bar.staff.transpositionPitch)+")";else if(g.isAlmostEqualTo(e.harmonicValue,0))this._trillNoteString="";else switch(e.harmonicType){case G.Artificial:case G.Pinch:case G.Tap:case G.Semi:case G.Feedback:var n,r=(i+e.harmonicValue).toString();(n=r.indexOf(String.fromCharCode(46)))>=0&&(r=r.substr(0,n+2)),this._trillNoteString="<"+r+">";break;default:this._trillNoteString=""}(this.isEmpty=!this._noteString,this.isEmpty)||(this.renderer.scoreRenderer.canvas.font=this.renderer.resources.tablatureFont,this.width=this.noteStringWidth=this.renderer.scoreRenderer.canvas.measureText(this._noteString),this.height=this.renderer.scoreRenderer.canvas.font.size,!!this._trillNoteString&&(this.renderer.scoreRenderer.canvas.font=this.renderer.resources.graceFont,this._trillNoteStringWidth=3*this.scale+this.renderer.scoreRenderer.canvas.measureText(this._trillNoteString),this.width+=this._trillNoteStringWidth))},i.prototype.paint=function(t,e,i){if(!this.isEmpty){var n=this.noteStringWidth+this._trillNoteStringWidth,r=t+this.x+(this.width-n)/2,a=this.renderer.scoreRenderer.canvas.font;this.renderer.scoreRenderer.canvas.font=this.renderer.resources.graceFont,i.fillText(this._trillNoteString,r+this.noteStringWidth+3*this.scale,e+this.y),this.renderer.scoreRenderer.canvas.font=a,i.fillText(this._noteString,r,e+this.y)}},i.prototype.buildBoundingsLookup=function(t,e,i){var n=new Gi;n.note=this._note,n.noteHeadBounds=new It,n.noteHeadBounds.x=e+this.x,n.noteHeadBounds.y=i+this.y-this.height/2,n.noteHeadBounds.w=this.width,n.noteHeadBounds.h=this.height,this.renderer.scoreRenderer.boundsLookup.addNote(n)},i}(nn),hh=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ch=function(t){function e(e,i,n){var r=t.call(this,e,i)||this;return r._notes=[],r.minStringNote=null,r.beatEffects=new Map,r.notesPerString=new Map,r.noteStringWidth=0,r._isGrace=n,r}return hh(e,t),e.prototype.buildBoundingsLookup=function(t,e,i){for(var n=0,r=this._notes;n<r.length;n++){r[n].buildBoundingsLookup(t,e+this.x,i+this.y)}},e.prototype.getNoteX=function(t,e){if(this.notesPerString.has(t.string)){var i=this.notesPerString.get(t.string),n=this.x+i.x;switch(e){case Un.Left:break;case Un.Center:n+=i.noteStringWidth/2;break;case Un.Right:n+=i.width}return n}return 0},e.prototype.getNoteY=function(t,e){if(this.notesPerString.has(t.string)){var i=this.notesPerString.get(t.string),n=this.y+i.y;switch(e){case Wn.Top:case Wn.TopWithStem:n-=i.height/2+2*this.scale;break;case Wn.Center:break;case Wn.Bottom:case Wn.BottomWithStem:n+=i.height/2}return n}return 0},e.prototype.doLayout=function(){for(var t=this,e=0,i=0,n=0,r=this._notes.length;n<r;n++){var a=this._notes[n];a.renderer=this.renderer,a.doLayout(),a.width>e&&(e=a.width),a.noteStringWidth>i&&(i=a.noteStringWidth)}this.noteStringWidth=i;var o=this.renderer.resources.tablatureFont.size,s=this.getNoteY(this.minStringNote,Wn.Center)+o/2,h=7*this.scale;this.beatEffects.forEach((function(e){e.y+=s,e.x+=t.width/2,e.renderer=t.renderer,s+=h,e.doLayout()})),this.width=e},e.prototype.addNoteGlyph=function(t,e){this._notes.push(t),this.notesPerString.set(e.string,t),(!this.minStringNote||e.string<this.minStringNote.string)&&(this.minStringNote=e)},e.prototype.paint=function(t,e,i){t+=this.x,e+=this.y;var n=this.renderer.resources,r=i.textBaseline;i.textBaseline=Z.Middle,i.font=this._isGrace?n.graceFont:n.tablatureFont;for(var a=this._notes,o=this.width,s=0,h=a;s<h.length;s++){var c=h[s];c.renderer=this.renderer,c.width=o,c.paint(t,e,i)}i.textBaseline=r,this.beatEffects.forEach((function(n){n.paint(t,e,i)}))},e.prototype.updateBeamingHelper=function(t){this.beamingHelper&&this.beamingHelper.isPositionFrom("tab",this.beat)&&this.beamingHelper.registerBeatLineX("tab",this.beat,t+this.x+this.width,t+this.x)},e}(nn),lh=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),uh=function(t){function e(e,i,n,r){var a=t.call(this,e,i,1,Qo.getSymbol(r))||this;return a._isVisibleRest=n,a._duration=r,a}return lh(e,t),e.prototype.doLayout=function(){this._isVisibleRest?this.width=Qo.getSize(this._duration)*this.scale:this.width=10*this.scale},e.prototype.updateBeamingHelper=function(t){this.beamingHelper&&this.beamingHelper.isPositionFrom("tab",this.beat)&&this.beamingHelper.registerBeatLineX("tab",this.beat,t+this.x+this.width,t+this.x)},e.prototype.paint=function(e,i,n){this._isVisibleRest&&t.prototype.paint.call(this,e,i,n)},e}(sn),ph=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),dh=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.noteNumbers=null,t.restGlyph=null,t}return ph(i,e),i.prototype.getNoteX=function(t,e){return this.noteNumbers?this.noteNumbers.getNoteX(t,e):0},i.prototype.getNoteY=function(t,e){return this.noteNumbers?this.noteNumbers.getNoteY(t,e):0},i.prototype.buildBoundingsLookup=function(t,e,i){this.noteNumbers&&this.noteNumbers.buildBoundingsLookup(t,e+this.x,i+this.y)},i.prototype.doLayout=function(){var e=this.renderer;if(this.container.beat.isRest){var i=0;c=0;switch(this.container.beat.duration){case A.QuadrupleWhole:case A.DoubleWhole:i=3;break;case A.Whole:i=2;break;case A.Half:case A.Quarter:i=3;break;case A.Eighth:case A.Sixteenth:i=2,c=5;break;case A.ThirtySecond:case A.SixtyFourth:case A.OneHundredTwentyEighth:case A.TwoHundredFiftySixth:i=3}var n=e.getTabY(i,c);if(this.restGlyph=new uh(0,n,e.showRests,this.container.beat.duration),this.restGlyph.beat=this.container.beat,this.restGlyph.beamingHelper=this.beamingHelper,this.addGlyph(this.restGlyph),this.container.beat.dots>0&&e.showRests){this.addGlyph(new ds(0,0,5*this.scale));for(u=0;u<this.container.beat.dots;u++)this.addGlyph(new Co(0,n,1.5*this.scale))}}else{var r=this.renderer.settings.notation.smallGraceTabNotes&&this.container.beat.graceType!==R.None;this.noteNumbers=new ch(0,0,r),this.noteNumbers.beat=this.container.beat,this.noteNumbers.beamingHelper=this.beamingHelper;for(var a=0,o=this.container.beat.notes;a<o.length;a++){var s=o[a];s.isVisible&&this.createNoteGlyph(s)}if(this.addGlyph(this.noteNumbers),this.container.beat.hasWhammyBar){var h=new cs(this.container.beat);h.renderer=this.renderer,h.doLayout(),this.container.ties.push(h)}if(this.container.beat.isTremolo&&!this.noteNumbers.beatEffects.has("tremolo")){var c=0,l=this.container.beat.tremoloSpeed;switch(l){case A.ThirtySecond:c=10;break;case A.Sixteenth:c=5;break;case A.Eighth:c=0}this.noteNumbers.beatEffects.set("tremolo",new Xo(5*this.scale,c*this.scale,l))}if(this.container.beat.dots>0&&e.settings.notation.rhythmMode!==t.TabRhythmMode.Hidden){this.addGlyph(new ds(0,0,5*this.scale));for(var u=0;u<this.container.beat.dots;u++)this.addGlyph(new Co(0,e.lineOffset*e.bar.staff.tuning.length+e.settings.notation.rhythmHeight*e.scale,1.5*this.scale))}}if(this.glyphs){for(var p=0,d=(u=0,this.glyphs.length);u<d;u++){var f=this.glyphs[u];f.x=p,f.renderer=this.renderer,f.doLayout(),p+=f.width}this.width=p,this.container.beat.isEmpty?this.centerX=this.width/2:this.container.beat.isRest?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.centerX=this.noteNumbers.x+this.noteNumbers.noteStringWidth/2}},i.prototype.updateBeamingHelper=function(){this.container.beat.isRest?this.restGlyph.updateBeamingHelper(this.container.x+this.x):this.noteNumbers.updateBeamingHelper(this.container.x+this.x)},i.prototype.createNoteGlyph=function(t){var e=this.renderer,i=new sh(0,0,t),n=t.beat.voice.bar.staff.tuning.length-t.string+1;i.y=e.getTabY(n,-2),i.renderer=this.renderer,i.doLayout(),this.noteNumbers.addNoteGlyph(i,t)},i}(sr),fh=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),yh=function(t){function e(e){var i=t.call(this,0,0)||this;return i._beat=e,i}return fh(e,t),e.prototype.doLayout=function(){this.width=10*this.scale},e.prototype.paint=function(t,e,i){var n=this.renderer,r=e+this.x+n.getNoteY(this._beat.maxNote,Wn.Top),a=e+this.y+n.getNoteY(this._beat.minNote,Wn.Bottom),o=t+this.x+this.width/2|0,s=8*this.scale;if(this._beat.brushType!==M.None){if(this._beat.brushType===M.BrushUp||this._beat.brushType===M.BrushDown)i.beginPath(),i.moveTo(o,r),i.lineTo(o,a),i.stroke();else if(this._beat.brushType===M.ArpeggioUp){(l=new _a(0,0,W.Slight,1.2,!0)).renderer=this.renderer,l.doLayout();var h=r,c=a-s;l.width=Math.abs(c-h),i.beginRotate(t+this.x+4*this.scale,c,-90),l.paint(0,-l.height/2,i),i.endRotate()}else if(this._beat.brushType===M.ArpeggioDown){var l;(l=new _a(0,0,W.Slight,1.2,!0)).renderer=this.renderer,l.doLayout();h=r+s,c=a;l.width=Math.abs(c-h),i.beginRotate(t+this.x+4*this.scale,h,90),l.paint(0,-l.height/2,i),i.endRotate()}this._beat.brushType===M.BrushUp||this._beat.brushType===M.ArpeggioUp?(i.beginPath(),i.moveTo(o,a),i.lineTo(o+s/2,a-s),i.lineTo(o-s/2,a-s),i.closePath(),i.fill()):(i.beginPath(),i.moveTo(o,r),i.lineTo(o+s/2,r+s),i.lineTo(o-s/2,r+s),i.closePath(),i.fill())}},e}(nn),gh=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),mh=function(t){function e(){return t.call(this)||this}return gh(e,t),e.prototype.doLayout=function(){this.container.beat.brushType===M.None||this.container.beat.isRest||(this.addGlyph(new yh(this.container.beat)),this.addGlyph(new ds(0,0,4*this.scale))),t.prototype.doLayout.call(this)},e}(ar),bh=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),vh=function(t){function e(e,i){return t.call(this,e,i)||this}return bh(e,t),e.prototype.doLayout=function(){this.width=28*this.scale},e.prototype.paint=function(t,e,i){var n=this.renderer.bar.staff.tuning.length,r=n*this.scale*.5,a=n<=4?Q.FourStringTabClef:Q.SixStringTabClef,o=n<=4?n/4.5:n/6.5;i.fillMusicFontSymbol(t+this.x+5*this.scale,e+this.y-r,o*this.scale,a,!1)},e}(nn),_h=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),wh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return _h(e,t),Object.defineProperty(e.prototype,"commonScale",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"numberScale",{get:function(){return this.renderer.bar.staff.tuning.length<=4?cn.GraceScale:1},enumerable:!1,configurable:!0}),e}(Es),Sh=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Bh=function(e){function i(t,i){var n=e.call(this,t,i)||this;return n._tupletSize=0,n.showTimeSignature=!1,n.showRests=!1,n.showTiedNotes=!1,n._startSpacing=!1,n}return Sh(i,e),Object.defineProperty(i.prototype,"lineOffset",{get:function(){return(i.LineSpacing+1)*this.scale},enumerable:!1,configurable:!0}),i.prototype.updateSizes=function(){var i=this.resources,n=i.tablatureFont.size/2+.2*i.tablatureFont.size;this.topPadding=n,this.bottomPadding=n,this.height=this.lineOffset*(this.bar.staff.tuning.length-1)+2*n,this.settings.notation.rhythmMode!==t.TabRhythmMode.Hidden&&(this.height+=this.settings.notation.rhythmHeight*this.settings.display.scale,this.bottomPadding+=this.settings.notation.rhythmHeight*this.settings.display.scale),e.prototype.updateSizes.call(this)},i.prototype.doLayout=function(){if(e.prototype.doLayout.call(this),this.settings.notation.rhythmMode!==t.TabRhythmMode.Hidden){for(var i=!1,n=0,r=this.bar.voices;n<r.length;n++){var a=r[n];if(this.hasVoiceContainer(a))if(this.getVoiceContainer(a).tupletGroups.length>0){i=!0;break}}i&&(this._tupletSize=.8*this.resources.effectFont.size,this.registerOverflowBottom(this._tupletSize))}},i.prototype.createPreBeatGlyphs=function(){if(e.prototype.createPreBeatGlyphs.call(this),this.bar.masterBar.isRepeatStart&&this.addPreBeatGlyph(new Po(0,0,1.5,3)),this.isFirstOfLine){var t=(this.bar.staff.tuning.length+1)/2;this.addPreBeatGlyph(new vh(5*this.scale,this.getTabY(t,0)))}this.showTimeSignature&&(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs()),this.addPreBeatGlyph(new go(0,this.getTabY(-.5,0),this.bar.index+1))},i.prototype.createStartSpacing=function(){this._startSpacing||(this.addPreBeatGlyph(new ds(0,0,2*this.scale)),this._startSpacing=!0)},i.prototype.createTimeSignatureGlyphs=function(){this.addPreBeatGlyph(new ds(0,0,5*this.scale));var t=(this.bar.staff.tuning.length+1)/2;this.addPreBeatGlyph(new wh(0,this.getTabY(t,0),this.bar.masterBar.timeSignatureNumerator,this.bar.masterBar.timeSignatureDenominator,this.bar.masterBar.timeSignatureCommon))},i.prototype.createVoiceGlyphs=function(t){for(var e=0,i=t.beats.length;e<i;e++){var n=t.beats[e],r=new ah(n,this.getVoiceContainer(t));r.preNotes=new mh,r.onNotes=new dh,this.addBeatGlyph(r)}},i.prototype.createPostBeatGlyphs=function(){e.prototype.createPostBeatGlyphs.call(this),this.bar.masterBar.isRepeatEnd?(this.addPostBeatGlyph(new So(this.x,0)),this.bar.masterBar.repeatCount>2&&this.addPostBeatGlyph(new To(0,this.getTabY(-.5,-3),this.bar.masterBar.repeatCount))):this.addPostBeatGlyph(new bo(0,0))},i.prototype.getTabY=function(t,e){return void 0===e&&(e=0),this.lineOffset*t+e*this.scale},Object.defineProperty(i.prototype,"middleYPosition",{get:function(){return this.getTabY(this.bar.staff.tuning.length-1)},enumerable:!1,configurable:!0}),i.prototype.paintBackground=function(t,i,n){var r=this;e.prototype.paintBackground.call(this,t,i,n);var a=this.resources;n.color=a.staffLineColor;for(var o=i+this.y+this.topPadding,s=this.scale,h=[],c=0,l=this.bar.staff.tuning.length;c<l;c++)h.push([]);for(var u=function(t){if(p.hasVoiceContainer(t))for(var e=p.getVoiceContainer(t),i=function(t){var i=t.onNotes,n=i.noteNumbers;n&&n.notesPerString.forEach((function(a,o){a.isEmpty||h[r.bar.staff.tuning.length-o].push(new Float32Array([e.x+t.x+i.x+n.x,n.width+s]))}))},n=0,a=e.beatGlyphs;n<a.length;n++){i(a[n])}},p=this,d=0,f=this.bar.voices;d<f.length;d++){u(f[d])}for(var y=0,g=h;y<g.length;y++){(w=g[y]).sort((function(t,e){return t[0]>e[0]?1:t[0]<e[0]?-1:0}))}var m=this.lineOffset;for(c=0,l=this.bar.staff.tuning.length;c<l;c++){c>0&&(o+=m);for(var b=0,v=0,_=h[c];v<_.length;v++){var w=_[v];n.fillRect(t+this.x+b,0|o,w[0]-b,this.scale*Kn.StaffLineThickness),b=w[0]+w[1]}n.fillRect(t+this.x+b,0|o,this.width-b,this.scale*Kn.StaffLineThickness)}n.color=a.mainGlyphColor,this.paintSimileMark(t,i,n)},i.prototype.paint=function(i,n,r){e.prototype.paint.call(this,i,n,r),this.settings.notation.rhythmMode!==t.TabRhythmMode.Hidden&&(this.paintBeams(i,n,r),this.paintTuplets(i,n,r))},i.prototype.paintBeams=function(t,e,i){for(var n=0,r=this.helpers.beamHelpers.length;n<r;n++)for(var a=this.helpers.beamHelpers[n],o=0,s=a.length;o<s;o++){var h=a[o];this.paintBeamHelper(t+this.beatGlyphsStart,e,i,h)}},i.prototype.paintTuplets=function(t,e,i){for(var n=0,r=this.bar.voices;n<r.length;n++){var a=r[n];if(this.hasVoiceContainer(a))for(var o=0,s=this.getVoiceContainer(a).tupletGroups;o<s.length;o++){var h=s[o];this.paintTupletHelper(t+this.beatGlyphsStart,e,i,h)}}},i.prototype.paintBeamHelper=function(e,i,n,r){n.color=0===r.voice.index?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,1===r.beats.length||this.settings.notation.rhythmMode===t.TabRhythmMode.ShowWithBeams?this.paintFooter(e,i,n,r):this.paintBar(e,i,n,r)},i.prototype.paintBar=function(t,e,n,r){for(var a=0,o=r.beats.length;a<o;a++){var s=r.beats[a];if(r.hasBeatLineX(s)){var h=r.getBeatLineX(s),c=e+this.y,l=e+this.y+this.height-this._tupletSize,u=this.getOnNotesGlyphForBeat(s);u.noteNumbers?c+=u.noteNumbers.getNoteY(u.noteNumbers.minStringNote,Wn.Bottom)+this.lineOffset/2:c+=this.height-this.settings.notation.rhythmHeight*this.settings.display.scale-this._tupletSize,r.direction===Xt.Up?h-=u.width/2:h+=u.width/2,n.beginPath(),n.moveTo(t+this.x+h,c),n.lineTo(t+this.x+h,l),n.stroke();for(var p=6*this.scale,d=-6*this.scale,f=3*this.scale,y=g.getIndex(s.duration)-2,m=l,b=0;b<y;b++){var v=0,_=0,w=0,S=0,B=m+b*d;if(1===r.beats.length)v=h,_=h+p,w=B,S=B,i.paintSingleBar(n,t+this.x+v,w,t+this.x+_,S,f);else if(a<r.beats.length-1){if(Jn.isFullBarJoin(s,r.beats[a+1],b)){v=h,_=r.getBeatLineX(r.beats[a+1]);var T=this.getOnNotesGlyphForBeat(r.beats[a+1]);r.direction===Xt.Up?_-=T.width/2:_+=T.width/2}else{if(0!==a&&Jn.isFullBarJoin(r.beats[a-1],s,b))continue;_=(v=h)+p}w=B,S=B,i.paintSingleBar(n,t+this.x+v,w,t+this.x+_,S,f)}else a>0&&!Jn.isFullBarJoin(s,r.beats[a-1],b)&&(v=h-p,_=h,w=B,S=B,i.paintSingleBar(n,t+this.x+v,w,t+this.x+_,S,f))}}}},i.prototype.paintTupletHelper=function(t,e,i,n){var r,a=this.resources,o=i.textAlign;i.color=0===n.voice.index?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,i.textAlign=K.Center;var s=n.beats[0].tupletNumerator,h=n.beats[0].tupletDenominator;if(r=2===s&&3===h?"2":3===s&&2===h?"3":4===s&&6===h?"4":5===s&&4===h?"5":6===s&&4===h?"6":7===s&&4===h?"7":9===s&&8===h?"9":10===s&&8===h?"10":11===s&&8===h?"11":12===s&&8===h?"12":13===s&&8===h?"13":s+":"+h,1!==n.beats.length&&n.isFull){var c=n.beats[0],l=n.beats[n.beats.length-1],u=this.helpers.beamHelperLookup[n.voice.index].get(c.index),p=this.helpers.beamHelperLookup[n.voice.index].get(l.index);if(u&&p){var d=u.getBeatLineX(c),f=p.getBeatLineX(l),y=(x=this.getOnNotesGlyphForBeat(c),this.getOnNotesGlyphForBeat(c));u.direction===Xt.Up?(d-=x.width/2,f-=y.width/2):(d+=x.width/2,f+=y.width/2),i.font=a.effectFont;var g=i.measureText(r),m=3*this.scale,b=(d+f)/2,v=b-g/2-m,_=b+g/2+m,w=e+this.y+this.height-this._tupletSize+.5*a.effectFont.size,S=.25*-a.effectFont.size,B=-5*this.scale;i.beginPath(),i.moveTo(t+this.x+d,w-S|0),i.lineTo(t+this.x+d,w-S-B|0),i.lineTo(t+this.x+v,w-S-B|0),i.stroke(),i.beginPath(),i.moveTo(t+this.x+_,w-S-B|0),i.lineTo(t+this.x+f,w-S-B|0),i.lineTo(t+this.x+f,w-S|0),i.stroke(),i.fillText(r,t+this.x+b,w)}}else for(var T=0,k=n.beats.length;T<k;T++){var P=n.beats[T],N=this.helpers.beamHelperLookup[n.voice.index].get(P.index);if(N){var O=N.getBeatLineX(P),x=this.getOnNotesGlyphForBeat(P);N.direction===Xt.Up?O-=x.width/2:O+=x.width/2;var C=e+this.y+this.height-this._tupletSize+.5*a.effectFont.size;i.font=a.effectFont,i.fillText(r,t+this.x+O,C)}}i.textAlign=o},i.paintSingleBar=function(t,e,i,n,r,a){t.beginPath(),t.moveTo(e,i),t.lineTo(n,r),t.lineTo(n,r-a),t.lineTo(e,i-a),t.closePath(),t.fill()},i.prototype.paintFooter=function(t,e,i,n){for(var r=0,a=n.beats;r<a.length;r++){var o=a[r];if(o.graceType!==R.None||o.duration===A.Whole||o.duration===A.DoubleWhole||o.duration===A.QuadrupleWhole)return;var s=n.getBeatLineX(o),h=e+this.y,c=e+this.y+this.height-this._tupletSize,l=this.getOnNotesGlyphForBeat(o);if(l.noteNumbers?h+=l.noteNumbers.getNoteY(l.noteNumbers.minStringNote,Wn.Bottom):h+=this.height-this.settings.notation.rhythmHeight*this.settings.display.scale-this._tupletSize,n.direction===Xt.Up?s-=l.width/2:s+=l.width/2,i.beginPath(),i.moveTo(t+this.x+s,h),i.lineTo(t+this.x+s,c),i.stroke(),o.duration>A.Quarter){var u=new un(0,0,o.duration,Xt.Down,!1);u.renderer=this,u.doLayout(),u.paint(t+this.x+s,c,i)}}},i.StaffId="tab",i.LineSpacing=10,i}(Kn),Th=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),kh=function(t){function e(e,i,n){var r=t.call(this)||this;return r._showTimeSignature=e,r._showRests=i,r._showTiedNotes=n,r.hideOnPercussionTrack=!0,r}return Th(e,t),Object.defineProperty(e.prototype,"staffId",{get:function(){return Bh.StaffId},enumerable:!1,configurable:!0}),e.prototype.canCreate=function(e,i){return i.tuning.length>0&&t.prototype.canCreate.call(this,e,i)},e.prototype.create=function(t,e){var i=new Bh(t,e);return i.showRests=this._showRests,i.showTimeSignature=this._showTimeSignature,i.showTiedNotes=this._showTiedNotes,i},e}(Dn),Ph=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Nh=function(t){function e(){return t.call(this,0,0)||this}return Ph(e,t),e.prototype.doLayout=function(){t.prototype.doLayout.call(this);var i=this.renderer.resources.effectFont;this.height=i.size+e.Padding*this.scale},e.prototype.paint=function(t,i,n){var r=this.renderer.resources;n.font=r.effectFont;var a=n.textAlign;n.textAlign=K.Center,n.fillText("T",t+this.x,i+this.y+n.font.size/2),n.textAlign=a,n.strokeCircle(t+this.x,i+this.y+n.font.size/2+(e.Padding-1)*this.scale,n.font.size/1.6)},e.Padding=4,e}(an),Oh=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),xh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Oh(e,t),Object.defineProperty(e.prototype,"notationElement",{get:function(){return h.EffectTap},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizingMode",{get:function(){return Qn.SingleOnBeat},enumerable:!1,configurable:!0}),e.prototype.shouldCreateGlyphForNote=function(t){return t.isLeftHandTapped},e.prototype.createNewGlyph=function(t,e){return new Nh},e}(Ur),Ch=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Fh=function(){this.noteRange=1,this.x=0,this.y=0};!function(t){t[t.None=0]="None",t[t.Rectangle=1]="Rectangle",t[t.Ellipse=2]="Ellipse",t[t.Circle=3]="Circle"}(Aa||(Aa={}));var Lh=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.align=K.Left,e.frame=Aa.None,e.text="",e.fontFace="",e.weight=0,e.height=0,e}return Ch(e,t),e}(Fh),Eh=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.chord=new lt,e}return Ch(e,t),e}(Fh),Mh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ch(e,t),e}(Fh),Dh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ch(e,t),e}(Fh),Ah=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.number=0,e}return Ch(e,t),e}(Fh),Ih=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.decrescendo=!1,e}return Ch(e,t),e}(Fh),Rh=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.allNumbers=!1,e.firstNumber=0,e.lastNumber=0,e}return Ch(e,t),e}(Fh),Gh=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.octave=1,e}return Ch(e,t),e}(Fh),jh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ch(e,t),e}(Fh),Vh=function(){this.defaultClef=O.G2,this.description="",this.percussion=!1,this.instrument=0,this.volume=0,this.transpose=0,this.index=0},Hh=function(){this.from=0,this.to=0,this.curly=!1},Wh=function(){this.currentBarIndex=-1,this.currentBarComplete=!0,this.currentBarDuration=0,this.currentPosition=0,this.voiceStemDir=null,this.repeatCount=0,this.repeatEnd=null},Uh=function(){function t(){this._trackChannel=0,this._beamingMode=nt.Auto,this._isFirstSystem=!0,this._staffLookup=new Map,this._brackets=[],this._staffLayoutLookup=new Map,this._staffLayouts=[],this._timeSignature=new yt,this._voiceStates=new Map}return t.prototype.parseXml=function(t,e){var i;this._galleryObjects=new Map,this._tieStarts=[],this._tieStartIds=new Map,this._voiceCounts=new Map,this._slurs=new Map,this._crescendo=new Map,this._isFirstSystem=!0;try{i=new qt(t)}catch(t){throw new N("Could not parse XML",t)}this.parseDom(i),this.consolidate(),this.score.finish(e)},t.prototype.consolidate=function(){for(var e=this.score.tempo,i=0,n=this.score.tracks;i<n.length;i++)for(var r=n[i],a=this._voiceCounts.get(r.index),o=0,s=r.staves;o<s.length;o++){for(var h=s[o];h.bars.length<this.score.masterBars.length;)this.addNewBar(h);for(var c=0,l=h.bars;c<l.length;c++){for(var u=l[c];u.voices.length<a;)u.addVoice(new kt);for(var p=0,d=u.voices;p<d.length;p++){var f=d[p];if(0===f.beats.length){var y=new ct;y.isEmpty=!0,f.addBeat(y)}}var g=u.masterBar;g.tempoAutomation&&(g.tempoAutomation.value!==e?e=g.tempoAutomation.value:g.tempoAutomation=null)}}t.applyEffectRange(this._slurs,(function(t,e){e.isLegatoOrigin=!0})),t.applyEffectRange(this._crescendo,(function(t,e){e.crescendo=t.decrescendo?D.Decrescendo:D.Crescendo}))},t.applyEffectRange=function(t,e){t.forEach((function(t,i){for(var n=t.noteRange,r=i,a=0;a<n;a++)if(e(t,r),r.index+1<r.voice.beats.length)r=r.voice.beats[r.index+1];else{if(!(r.voice.bar.index+1<r.voice.bar.staff.bars.length))break;r=r.voice.bar.staff.bars[r.voice.bar.index+1].voices[r.voice.index].beats[0]}}))},t.prototype.parseDom=function(t){var e=t.documentElement;if(e){if("score"!==e.localName)throw new N("Root node of XML was not GPIF");this.score=new bt,this.score.tempo=120;for(var i=0,n=e.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"info":this.parseInfo(r);break;case"layout":this.parseLayout(r);break;case"gallery":this.parseGallery(r);break;case"pageObjects":this.parsePageObjects(r);break;case"systems":this.parseSystems(r)}}}},t.prototype.parseLayout=function(t){for(var e=0,i=t.childNodes;e<i.length;e++){var n=i[e];if(n.nodeType===jt.Element)switch(n.localName){case"staves":this.parseLayoutStaves(n);break;case"brackets":this.parseBrackets(n)}}var r=this._brackets.filter((function(t){return t.curly}));r.sort((function(t,e){return t.from-e.from}));for(var a=0,o=null,s=0;s<this._staffLayouts.length;s++){for(var h=this._staffLayouts[s];a<r.length&&s>r[a].to;)a++;o&&a<r.length&&s>r[a].from&&s<=r[a].to?o.ensureStaveCount(o.staves.length+1):((o=new St).ensureStaveCount(1),o.name=h.description,o.playbackInfo.volume=Math.floor(h.volume/128*16),o.playbackInfo.program=h.instrument,h.percussion?(o.playbackInfo.primaryChannel=9,o.playbackInfo.secondaryChannel=9):(o.playbackInfo.primaryChannel=this._trackChannel++,o.playbackInfo.secondaryChannel=this._trackChannel++),this.score.addTrack(o));var c=o.staves[o.staves.length-1];c.isPercussion=h.percussion,c.transpositionPitch=h.transpose,c.displayTranspositionPitch=0,c.showTablature=!1,this._staffLookup.set(h.index,c)}},t.prototype.parseBrackets=function(t){for(var e=0,i=t.childNodes;e<i.length;e++){var n=i[e];if(n.nodeType===jt.Element)switch(n.localName){case"bracket":this.parseBracket(n)}}},t.prototype.parseBracket=function(t){var e=new Hh;e.from=parseInt(t.getAttribute("from")),e.to=parseInt(t.getAttribute("to")),t.attributes.has("curly")&&(e.curly="true"===t.attributes.get("curly")),this._brackets.push(e)},t.prototype.parseLayoutStaves=function(t){for(var e=0,i=t.childNodes;e<i.length;e++){var n=i[e];if(n.nodeType===jt.Element)switch(n.localName){case"staffLayout":this.parseStaffLayout(n)}}},t.prototype.parseStaffLayout=function(t){var e=new Vh;e.description=t.getAttribute("description");for(var i=0,n=t.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"notation":r.attributes.has("defaultClef")&&(e.defaultClef=this.parseClef(r.attributes.get("defaultClef")));break;case"sound":r.attributes.has("percussion")&&(e.percussion="true"===r.attributes.get("percussion")),r.attributes.has("instr")&&(e.instrument=parseInt(r.attributes.get("instr"))),r.attributes.has("volume")&&(e.volume=parseInt(r.attributes.get("volume"))),r.attributes.has("transpose")&&(e.transpose=parseInt(r.attributes.get("transpose")))}}this._staffLayoutLookup.set(e.description,e),e.index=this._staffLayouts.length,this._staffLayouts.push(e)},t.prototype.parseClef=function(t){switch(t){case"treble":return O.G2;case"bass":return O.F4;case"alto":case"tenor":return O.C4}return O.G2},t.prototype.parseClefOttava=function(t){return t.endsWith("-")?x._8vb:t.endsWith("+")?x._8va:x.Regular},t.prototype.parseSystems=function(t){for(var e=0,i=t.childNodes;e<i.length;e++){var n=i[e];if(n.nodeType===jt.Element)switch(n.localName){case"system":this.parseSystem(n)}}},t.prototype.parseSystem=function(t){t.attributes.has("tempo")&&0===this.score.masterBars.length&&(this.score.tempo=parseInt(t.attributes.get("tempo"))),"0"===t.getAttribute("beamGrouping")&&(this._beamingMode=nt.ForceSplitToNext);for(var e=0,i=t.childNodes;e<i.length;e++){var n=i[e];if(n.nodeType===jt.Element)switch(n.localName){case"staves":this.parseStaves(t,n)}}this._isFirstSystem=!1},t.prototype.parseStaves=function(t,e){for(var i=this.score.masterBars.length,n=0,r=e.childNodes;n<r.length;n++){var a=r[n];if(a.nodeType===jt.Element)switch(a.localName){case"staff":this.parseStaff(t,i,a)}}},t.prototype.parseStaff=function(t,e,i){var n=i.getAttribute("layout");this._currentStaffLayout=this._staffLayoutLookup.get(n),this._timeSignature.timeSignatureNumerator=4,this._timeSignature.timeSignatureDenominator=4,this._timeSignature.timeSignatureCommon=!1,this.parseTime(i.getAttribute("defaultTime"));for(var r=this._staffLookup.get(this._currentStaffLayout.index);r.bars.length<e;)this.addNewBar(r);for(var a=0,o=i.childNodes;a<o.length;a++){var s=o[a];if(s.nodeType===jt.Element)switch(s.localName){case"voices":this.parseVoices(n,r,t,e,s)}}},t.prototype.parseTime=function(t){switch(t){case"allaBreve":case"C":this._timeSignature.timeSignatureNumerator=2,this._timeSignature.timeSignatureDenominator=2,this._timeSignature.timeSignatureCommon=!0;break;case"longAllaBreve":this._timeSignature.timeSignatureNumerator=4,this._timeSignature.timeSignatureDenominator=4,this._timeSignature.timeSignatureCommon=!0;break;default:if(t.indexOf("/")>0){var e=t.split("/");this._timeSignature.timeSignatureNumerator=parseInt(e[0]),this._timeSignature.timeSignatureDenominator=parseInt(e[1]),this._timeSignature.timeSignatureCommon=!1}}},t.prototype.parseVoices=function(t,e,i,n,r){for(var a=0,o=0,s=r.childNodes;o<s.length;o++){var h=s[o];if(h.nodeType===jt.Element)switch(h.localName){case"voice":this.parseVoice(t,e,i,a,n,h),a++}}},t.prototype.getOrCreateBar=function(t,e){return e<t.bars.length?t.bars[e]:this.addNewBar(t)},t.prototype.addNewBar=function(t){var e=new U;if(t.bars.length>0?(e.clef=t.bars[t.bars.length-1].clef,e.clefOttava=t.bars[t.bars.length-1].clefOttava):e.clef=this._currentStaffLayout.defaultClef,t.addBar(e),t.bars.length>this.score.masterBars.length){var i=new yt;this.score.addMasterBar(i),i.index>0&&(i.keySignature=i.previousMasterBar.keySignature,i.keySignatureType=i.previousMasterBar.keySignatureType,i.tripletFeel=i.previousMasterBar.tripletFeel),i.timeSignatureDenominator=this._timeSignature.timeSignatureDenominator,i.timeSignatureNumerator=this._timeSignature.timeSignatureNumerator,i.timeSignatureCommon=this._timeSignature.timeSignatureCommon}return e},t.prototype.newBar=function(t,e){this._currentVoiceState.currentBarIndex++,this._currentBar=this.getOrCreateBar(t,this._currentVoiceState.currentBarIndex),this._currentVoiceState.currentBarDuration=this._currentBar.masterBar.calculateDuration(!1),this._currentVoiceState.currentBarComplete=!1,this._currentVoiceState.currentPosition=0,this.ensureVoice(t,e)},t.prototype.parseVoice=function(t,e,i,n,r,a){var o=t+"_"+n;if(this._currentVoiceState&&!this._currentVoiceState.currentBarComplete&&(this._currentBar.masterBar.isAnacrusis=!0),this._voiceStates.has(o)?(this._currentVoiceState=this._voiceStates.get(o),this._currentBar=this.getOrCreateBar(e,this._currentVoiceState.currentBarIndex),this.ensureVoice(e,n)):(this._currentVoiceState=new Wh,this._currentVoiceState.currentBarIndex=r-1,this._voiceStates.set(o,this._currentVoiceState),this.newBar(e,n)),a.attributes.has("stemDir"))switch(a.attributes.get("stemDir")){case"up":this._currentVoiceState.voiceStemDir=Xt.Up;break;case"down":this._currentVoiceState.voiceStemDir=Xt.Down;break;default:this._currentVoiceState.voiceStemDir=null}else this._currentVoiceState.voiceStemDir=null;var s=a.findChildElement("noteObjects");if(i.attributes.has("tempo")&&(this._currentBar.masterBar.tempoAutomation=new F,this._currentBar.masterBar.tempoAutomation.isLinear=!0,this._currentBar.masterBar.tempoAutomation.type=B.Tempo,this._currentBar.masterBar.tempoAutomation.value=parseInt(i.attributes.get("tempo"))),s)for(var h=0,c=s.childNodes;h<c.length;h++){var l=c[h];if(l.nodeType===jt.Element)switch(this._currentVoiceState.currentBarComplete&&"barline"!==l.localName&&this.newBar(e,n),l.localName){case"clefSign":this._currentBar.clef=this.parseClef(l.getAttribute("clef")),this._currentBar.clefOttava=this.parseClefOttava(l.getAttribute("clef"));break;case"keySign":this._currentBar.masterBar.keySignature=parseInt(l.getAttribute("fifths"));break;case"timeSign":this.parseTime(l.getAttribute("time")),this._currentBar.masterBar.timeSignatureDenominator=this._timeSignature.timeSignatureDenominator,this._currentBar.masterBar.timeSignatureNumerator=this._timeSignature.timeSignatureNumerator,this._currentBar.masterBar.timeSignatureCommon=this._timeSignature.timeSignatureCommon,this._currentVoiceState.currentPosition=0,this._currentVoiceState.currentBarDuration=this._currentBar.masterBar.calculateDuration(!1);break;case"barline":switch(l.getAttribute("type")){case"double":this._currentBar.masterBar.isDoubleBar=!0,this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break;case"end":this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0);break;case"repEnd":this._currentVoiceState.repeatEnd=this._currentBar.masterBar,this._currentBar.masterBar.repeatCount<this._currentVoiceState.repeatCount&&(this._currentBar.masterBar.repeatCount=this._currentVoiceState.repeatCount),this.parseBarDrawObject(l),this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break;case"repBegin":this.newBar(e,n),this._currentBar.masterBar.isRepeatStart=!0,this._currentVoiceState.repeatEnd=null,this._currentVoiceState.repeatCount=0;break;case"repEndBegin":this._currentVoiceState.repeatEnd=this._currentBar.masterBar,this._currentBar.masterBar.repeatCount<this._currentVoiceState.repeatCount&&(this._currentBar.masterBar.repeatCount=this._currentVoiceState.repeatCount),this.parseBarDrawObject(l),this.newBar(e,n),this._currentBar.masterBar.isRepeatStart=!0;break;case"dashed":this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break;case"single":default:this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0}break;case"chord":var u=new ct;this.initFromPreviousBeat(u,this._currentVoice),u.beamingMode=this._beamingMode,this._currentVoiceState.voiceStemDir&&(u.preferredBeamDirection=this._currentVoiceState.voiceStemDir),this.parseDuration(this._currentBar,u,l.findChildElement("duration")),u.updateDurations(),this._currentVoiceState.currentPosition+=u.playbackDuration,this._currentVoice.addBeat(u),this.parseChord(u,l),this._currentVoiceState.currentPosition>=this._currentVoiceState.currentBarDuration&&(this._currentVoiceState.currentBarComplete=!0);break;case"rest":for(var p=0,d=this.parseRestDurations(this._currentBar,l.findChildElement("duration"));p<d.length;p++){var f=d[p];this.initFromPreviousBeat(f,this._currentVoice),f.updateDurations(),this._currentVoiceState.currentPosition+=f.playbackDuration,this._currentVoice.addBeat(f),this._currentVoiceState.currentPosition>=this._currentVoiceState.currentBarDuration&&(this._currentVoiceState.currentBarComplete=!0)}}}},t.prototype.initFromPreviousBeat=function(t,e){var i=this.getLastBeat(e);i&&(t.dynamics=i.dynamics)},t.prototype.getLastBeat=function(t){if(t.beats.length>0)return t.beats[t.beats.length-1];if(t.bar.index>0){var e=t.bar.staff.bars[t.bar.index-1];if(t.index<e.voices.length){var i=e.voices[t.index];return this.getLastBeat(i)}}return null},t.prototype.ensureVoice=function(t,e){for(;this._currentBar.voices.length<e+1;)this._currentBar.addVoice(new kt);(!this._voiceCounts.has(t.track.index)||this._voiceCounts.get(t.track.index)<this._currentBar.voices.length)&&this._voiceCounts.set(t.track.index,this._currentBar.voices.length),this._currentVoice=this._currentBar.voices[e]},t.prototype.parseChord=function(t,e){for(var i=new ot,n=0,r=e.childNodes;n<r.length;n++){var a=r[n];if(a.nodeType===jt.Element)switch(a.localName){case"stem":switch(a.getAttribute("dir")){case"up":t.preferredBeamDirection=Xt.Up;break;case"down":t.preferredBeamDirection=Xt.Down}break;case"articulation":switch(a.getAttribute("type")){case"staccato":i.isStaccato=!0;break;case"normalAccent":i.accentuated=S.Normal;break;case"strongAccent":i.accentuated=S.Heavy}break;case"lyric":this.parseLyric(t,a);break;case"drawObjects":this.parseBeatDrawObject(t,a);break;case"heads":this.parseHeads(t,i,a);break;case"beam":switch(a.getAttribute("group")){case"force":t.beamingMode=nt.ForceMergeWithNext;break;case"divide":t.beamingMode=nt.ForceSplitToNext}}}},t.prototype.parseHeads=function(t,e,i){for(var n=0,r=i.childNodes;n<r.length;n++){var a=r[n];if(a.nodeType===jt.Element)switch(a.localName){case"head":this.parseHead(t,e,a)}}},t.prototype.parseHead=function(t,e,i){var n=new ot,r=g.parseTuning(i.getAttribute("pitch"));n.octave=r.octave-1,n.tone=r.noteValue,n.isStaccato=e.isStaccato,n.accentuated=e.accentuated,t.addNote(n);for(var a=0,o=i.childNodes;a<o.length;a++){var s=o[a];if(s.nodeType===jt.Element)switch(s.localName){case"alter":s.attributes.has("step")&&(n.tone+=parseInt(s.attributes.get("step")));break;case"tie":s.attributes.has("begin")?this._tieStartIds.has(n.id)||(this._tieStartIds.set(n.id,!0),this._tieStarts.push(n)):s.attributes.has("end")&&this._tieStarts.length>0&&!n.isTieDestination&&(n.isTieDestination=!0,n.tieOrigin=this._tieStarts[0],this._tieStarts.splice(0,1),this._tieStartIds.delete(n.id))}}},t.prototype.parseBeatDrawObject=function(t,e){for(var i=0,n=e.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"drawObj":var a=this.parseDrawObj(r);if(a)if(a instanceof Lh)a.fontFace.startsWith("capella")?"u"===a.text?(t.fermata=new Vt,t.fermata.type=Rt.Medium):"f"===a.text?t.dynamics=I.F:"j"===a.text&&(t.dynamics=I.MF):this._isFirstSystem&&""===this.score.title&&a.align===K.Center&&a.height>16&&a.weight>400?this.score.title=a.text:this._isFirstSystem&&""===this.score.artist&&a.align===K.Center&&a.y<0?this.score.artist=a.text:this._isFirstSystem&&""===this.score.music&&a.align===K.Right&&a.y<0?this.score.music=a.text:a.text.startsWith("by capella")||(t.text=a.text);else if(a instanceof Eh);else if(a instanceof Dh)t.vibrato=W.Slight;else if(a instanceof Ih)t.crescendo=a.decrescendo?D.Decrescendo:D.Crescendo,a.noteRange++,this._crescendo.set(t,a);else if(a instanceof Mh){var o=a;this._slurs.set(t,o)}else a instanceof Rh&&this.applyVolta(a)}}},t.prototype.parseBarDrawObject=function(t){for(var e=0,i=t.childNodes;e<i.length;e++){var n=i[e];if(n.nodeType===jt.Element)switch(n.localName){case"drawObj":var r=this.parseDrawObj(n);r&&r instanceof Rh&&this.applyVolta(r)}}},t.prototype.applyVolta=function(t){if(t.lastNumber>0?(this._currentVoiceState.repeatCount=t.lastNumber,this._currentVoiceState.repeatEnd&&this._currentVoiceState.repeatEnd.repeatCount<this._currentVoiceState.repeatCount&&(this._currentVoiceState.repeatEnd.repeatCount=this._currentVoiceState.repeatCount)):t.firstNumber>0&&(this._currentVoiceState.repeatCount=t.firstNumber,this._currentVoiceState.repeatEnd&&this._currentVoiceState.repeatEnd.repeatCount<this._currentVoiceState.repeatCount&&(this._currentVoiceState.repeatEnd.repeatCount=this._currentVoiceState.repeatCount)),t.lastNumber>0&&t.firstNumber>0){for(var e=0,i=t.firstNumber;i<=t.lastNumber;i++)e|=1<<i-1;this._currentBar.masterBar.alternateEndings=e}else t.lastNumber>0?this._currentBar.masterBar.alternateEndings=1<<t.lastNumber-1:t.firstNumber>0&&(this._currentBar.masterBar.alternateEndings=1<<t.firstNumber-1)},t.prototype.parseLyric=function(t,e){for(var i=0,n=e.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"verse":t.lyrics||(t.lyrics=[]);var a=r.innerText;"true"===r.getAttribute("hyphen")&&(a+="-"),t.lyrics.push(a)}}},t.prototype.parseRestDurations=function(t,e){var i=e.getAttribute("base");if(-1!==i.indexOf("/"))return(h=new ct).beamingMode=this._beamingMode,this.parseDuration(t,h,e),[h];var n=parseInt(i);if(1===n){for(var r=[],a=t.masterBar.calculateDuration(!1)*n,o=A.Whole,s=z.toTicks(o);a>0;){for(;s>a&&o<A.TwoHundredFiftySixth;)o*=2,s=z.toTicks(o);if(s>a)break;var h;(h=new ct).beamingMode=this._beamingMode,h.duration=o,r.push(h),a-=s}return r}return et.warning("Importer","Multi-Bar rests are not supported"),[]},t.prototype.parseDurationValue=function(t){switch(t){case"2/1":return A.DoubleWhole;case"1/1":return A.Whole;case"1/2":return A.Half;case"1/4":return A.Quarter;case"1/8":return A.Eighth;case"1/16":return A.Sixteenth;case"1/32":return A.ThirtySecond;case"1/64":return A.SixtyFourth;case"1/128":return A.OneHundredTwentyEighth;default:return et.warning("Importer","Unsupported duration"),A.Quarter}},t.prototype.parseDuration=function(t,e,i){var n=i.getAttribute("base");e.duration=this.parseDurationValue(n),i.attributes.has("dots")&&(e.dots=parseInt(i.attributes.get("dots")));var r=i.findChildElement("tuplet");if(r){e.tupletNumerator=parseInt(r.getAttribute("count"));for(var a="true"===r.getAttribute("tripartite")?3:1,o="true"===r.getAttribute("prolong")?0:1,s=0;a*Math.pow(2,s+o)<e.tupletNumerator;)s++;e.tupletDenominator=a*Math.pow(2,s)}},t.prototype.parsePageObjects=function(t){for(var e=0,i=t.childNodes;e<i.length;e++){var n=i[e];if(n.nodeType===jt.Element)switch(n.localName){case"drawObj":var r=this.parseDrawObj(n);if(r&&r instanceof Lh)switch(r.align){case K.Center:this.score.title?this.score.subTitle||(this.score.subTitle=n.innerText):this.score.title=n.innerText;break;case K.Right:this.score.artist||(this.score.artist=n.innerText)}}}},t.prototype.parseGallery=function(t){for(var e=0,i=t.childNodes;e<i.length;e++){var n=i[e];if(n.nodeType===jt.Element)switch(n.localName){case"drawObj":var r=this.parseDrawObj(n);r&&this._galleryObjects.set(n.getAttribute("name"),r)}}},t.prototype.parseDrawObj=function(t){for(var e=null,i=1,n=0,r=t.childNodes;n<r.length;n++){var a=r[n];if(a.nodeType===jt.Element)switch(a.localName){case"text":e=this.parseText(a);break;case"guitar":e=this.parseGuitar(a);break;case"slur":e=this.parseSlur(a);break;case"wavyLine":e=this.parseWavyLine(a);break;case"bracket":e=this.parseTupletBracket(a);break;case"wedge":e=this.parseWedge(a);break;case"volta":e=this.parseVolta(a);break;case"octaveClef":e=this.parseOctaveClef(a);break;case"trill":e=this.parseTrill(a);break;case"basic":a.attributes.has("noteRange")&&(i=parseInt(a.attributes.get("noteRange")))}}return e&&(e.noteRange=i),e},t.prototype.parseTrill=function(t){return new jh},t.prototype.parseOctaveClef=function(t){var e=new Gh;return t.attributes.has("octave")&&(e.octave=parseInt(t.attributes.get("octave"))),e},t.prototype.parseVolta=function(t){var e=new Rh;return e.allNumbers="true"===t.attributes.get("allNumbers"),t.attributes.has("firstNumber")&&(e.firstNumber=parseInt(t.attributes.get("firstNumber"))),t.attributes.has("lastNumber")&&(e.lastNumber=parseInt(t.attributes.get("lastNumber"))),e},t.prototype.parseWedge=function(t){var e=new Ih;return e.decrescendo="true"===t.attributes.get("decrescendo"),e},t.prototype.parseTupletBracket=function(t){var e=new Ah;return t.attributes.has("number")&&(e.number=parseInt(t.attributes.get("number"))),e},t.prototype.parseWavyLine=function(t){return new Dh},t.prototype.parseSlur=function(t){return new Mh},t.prototype.parseGuitar=function(t){for(var e=new Eh,i=t.innerText.trim(),n=0;n<i.length;n++)"/"===i.charAt(n)?e.chord.strings.push(0):e.chord.strings.push(parseInt(i.charAt(n)));return e},t.prototype.parseText=function(t){var e=new Lh;switch(t.attributes.has("x")&&(e.x=parseFloat(t.attributes.get("x"))),t.attributes.has("x")&&(e.y=parseFloat(t.attributes.get("y"))),t.getAttribute("align")){case"left":e.align=K.Left;break;case"center":e.align=K.Center;break;case"right":e.align=K.Right}switch(t.getAttribute("frame")){case"rectangle":e.frame=Aa.Rectangle;break;case"ellipse":e.frame=Aa.Ellipse;break;case"circle":e.frame=Aa.Circle;break;case"none":e.frame=Aa.None}if(t.firstElement)for(var i=0,n=t.childNodes;i<n.length;i++){var r=n[i];if(r.nodeType===jt.Element)switch(r.localName){case"font":e.fontFace=r.getAttribute("face"),r.attributes.has("weight")&&(e.weight=parseInt(r.attributes.get("weight"))),r.attributes.has("height")&&(e.height=parseInt(r.attributes.get("height")));break;case"content":e.text=r.innerText}}else e.text=t.innerText;return e},t.prototype.parseInfo=function(t){for(var e=0,i=t.childNodes;e<i.length;e++){var n=i[e];if(n.nodeType===jt.Element)switch(n.localName){case"author":this.score.tab=n.firstChild.innerText;break;case"comment":this.score.notices=n.firstChild.innerText}}},t}(),zh=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Xh=function(t){function e(){return t.call(this)||this}return zh(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"Capella"},enumerable:!1,configurable:!0}),e.prototype.readScore=function(){et.debug(this.name,"Loading ZIP entries");var t,e=null;if(t=new pe(this.data).read(),et.debug(this.name,"Zip entries loaded"),t.length>0)for(var i=0,n=t;i<n.length;i++){var r=n[i];switch(r.fileName){case"score.xml":e=Ft.toString(r.data,this.settings.importer.encoding)}}else this.data.reset(),e=Ft.toString(this.data.readAll(),this.settings.importer.encoding);if(!e)throw new N("No valid capella file");et.debug(this.name,"Start Parsing score.xml");try{var a=new Uh;return a.parseXml(e,this.settings),et.debug(this.name,"score.xml parsed"),a.score}catch(t){throw new N("Failed to parse CapXML",t)}},e}(k),Yh=function(t,e){this.vertical=t,this.createLayout=e},Jh=function(t,e){this.supportsWorkers=t,this.createCanvas=e},qh=function(){function e(){}return e.createStyleElement=function(t,i){var n=t.getElementById("alphaTabStyle");if(!n){if(!i)return void et.error("AlphaTab","Font directory could not be detected, cannot create style element");(n=t.createElement("style")).id="alphaTabStyle";var r="\n            @font-face {\n                font-family: 'alphaTab';\n                 src: url('"+i+"Bravura.eot');\n                 src: url('"+i+"Bravura.eot?#iefix') format('embedded-opentype')\n                      , url('"+i+"Bravura.woff') format('woff')\n                      , url('"+i+"Bravura.otf') format('opentype')\n                      , url('"+i+"Bravura.svg#Bravura') format('svg');\n                 font-weight: normal;\n                 font-style: normal;\n            }\n            .at-surface * {\n                cursor: default;\n                vertical-align: top;\n                overflow: visible;\n            }\n            .at {\n                 font-family: 'alphaTab';\n                 speak: none;\n                 font-style: normal;\n                 font-weight: normal;\n                 font-variant: normal;\n                 text-transform: none;\n                 line-height: 1;\n                 line-height: 1;\n                 -webkit-font-smoothing: antialiased;\n                 -moz-osx-font-smoothing: grayscale;\n                 font-size: "+e.MusicFontSize+"px;\n                 overflow: visible !important;\n            }";n.innerHTML=r,t.getElementsByTagName("head").item(0).appendChild(n),e.bravuraFontChecker.checkForFontAvailability()}},Object.defineProperty(e,"globalThis",{get:function(){if(void 0===e._globalThis){try{e._globalThis=globalThis}catch(t){}void 0===e._globalThis&&(e._globalThis=self),void 0===e._globalThis&&(e._globalThis=window),void 0===e._globalThis&&(e._globalThis=Function("return this")())}return this._globalThis},enumerable:!1,configurable:!0}),Object.defineProperty(e,"isRunningInWorker",{get:function(){return"WorkerGlobalScope"in e.globalThis},enumerable:!1,configurable:!0}),Object.defineProperty(e,"supportsFontsApi",{get:function(){return"fonts"in document&&"load"in document.fonts},enumerable:!1,configurable:!0}),Object.defineProperty(e,"supportsTextDecoder",{get:function(){return"TextDecoder"in e.globalThis},enumerable:!1,configurable:!0}),e.throttle=function(t,e){var i=0;return function(){window.clearTimeout(i),i=window.setTimeout(t,e)}},e.detectScriptFile=function(){if(e.isRunningInWorker)return null;var t=document.currentScript,i=null;if(!t)try{var n=new Error;if(!(r=n.stack))throw n;i=e.scriptFileFromStack(r)}catch(n){if(!(n instanceof Error))throw n;var r;(r=n.stack)?i=e.scriptFileFromStack(r):t=document.querySelector("script[data-alphatab]")}return i||(t?i=t.src:et.warning("Environment","Could not automatically find alphaTab script file for worker, please add the data-alphatab attribute to the script tag that includes alphaTab or provide it when initializing alphaTab",null)),i},e.registerJQueryPlugin=function(){if(!e.isRunningInWorker&&e.globalThis&&"jQuery"in e.globalThis){var t=e.globalThis.jQuery,i=new Fn;t.fn.alphaTab=function(t){var e=Array.prototype.slice.call(arguments,1);return 1===this.length?i.exec(this[0],t,e):this.each((function(n,r){i.exec(r,t,e)}))},t.alphaTab={restore:Fn.restore},t.fn.alphaTab.fn=i}},e.scriptFileFromStack=function(t){var e=t.match("(data:text\\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\\/\\/[\\/]?.+?\\/[^:\\)]*?)(?::\\d+)(?::\\d+)?");return e||(e=t.match("^(?:|[^:@]*@|.+\\)@(?=data:text\\/javascript|blob|http[s]?|file)|.+?\\s+(?: at |@)(?:[^:\\(]+ )*[\\(]?)(data:text\\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\\/\\/[\\/]?.+?\\/[^:\\)]*?)(?::\\d+)(?::\\d+)?"))||(e=t.match("\\)@(data:text\\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\\/\\/[\\/]?.+?\\/[^:\\)]*?)(?::\\d+)(?::\\d+)?"))?e[1]:null},e.createScoreRenderer=function(t){return new Hi(t)},e.getRenderEngineFactory=function(t){return t.core.engine&&e.renderEngines.has(t.core.engine)?e.renderEngines.get(t.core.engine):e.renderEngines.get("default")},e.getLayoutEngineFactory=function(i){return i.display.layoutMode&&e.layoutEngines.has(i.display.layoutMode)?e.layoutEngines.get(i.display.layoutMode):e.layoutEngines.get(t.LayoutMode.Page)},e.buildImporters=function(){return[new Et,new we,new fe,new Be,new Xh,new xt]},e.createDefaultRenderEngines=function(){var t=new Map;return t.set("svg",new Jh(!0,(function(){return new Mn}))),t.set("default",t.get("svg")),e.createPlatformSpecificRenderEngines(t),t},e.createPlatformSpecificRenderEngines=function(t){t.set("html5",new Jh(!1,(function(){return new Ui})))},e.createDefaultStaveProfiles=function(){var e=new Map;e.set(t.StaveProfile.ScoreTab,[new ur("score-effects",[new Oa,new Ga,new ia,new Ca,new Sr,new jr,new Va,new Ma,new oa(!0),new Wa,new ba,new za,new Sa,new xh,new gr]),new Ks,new ur("tab-effects",[new Or,new oa(!1),new Lr,new ta,new Ma,new Wa,new ba,new za,new Sa,new Ta,new Ar,new Jr(G.Natural),new Jr(G.Artificial),new Jr(G.Pinch),new Jr(G.Tap),new Jr(G.Semi),new Jr(G.Feedback),new Qr,new _r,new Hr,new ha,new fa,new la,new xh]),new kh(!1,!1,!1)]),e.set(t.StaveProfile.Score,[new ur("score-effects",[new Oa,new Ga,new ia,new Ca,new Sr,new jr,new Va,new Ma,new oa(!0),new Wa,new ba,new za,new Sa,new Ar,new Qr,new ha,new fa,new la,new xh,new gr]),new Ks,new ur("score-bottom-effects",[new Or,new oa(!1),new Lr,new ta])]);var i=[new Oa,new Ga,new ia,new Ca,new Sr,new jr,new Ma,new Wa,new ba,new za,new Sa,new Ta,new Ar,new Jr(G.Artificial),new Jr(G.Pinch),new Jr(G.Tap),new Jr(G.Semi),new Jr(G.Feedback),new Qr,new _r,new Hr,new ha,new fa,new la,new xh,new gr];return e.set(t.StaveProfile.Tab,[new ur("tab-effects",i),new kh(!0,!0,!0),new ur("tab-bottom-effects",[new ta])]),e.set(t.StaveProfile.TabMixed,[new ur("tab-effects",i),new kh(!1,!1,!1),new ur("tab-bottom-effects",[new ta])]),e},e.createDefaultLayoutEngines=function(){var e=new Map;return e.set(t.LayoutMode.Page,new Yh(!0,(function(t){return new uo(t)}))),e.set(t.LayoutMode.Horizontal,new Yh(!1,(function(t){return new co(t)}))),e},e.platformInit=function(){if(e.registerJQueryPlugin(),Math.log2=Math.log2?Math.log2:function(t){return Math.log(t)*Math.LOG2E},e.isRunningInWorker)Wi.init(),Ei.init();else{"Function VbAjaxLoader(method, fileName)\r\n","    Dim xhr\r\n",'    Set xhr = CreateObject("Microsoft.XMLHTTP")\r\n',"    xhr.Open method, fileName, False\r\n",'    xhr.setRequestHeader "Accept-Charset", "x-user-defined"\r\n',"    xhr.send\r\n","    Dim byteArray()\r\n","    if xhr.Status = 200 Then\r\n","        Dim byteString\r\n","        Dim i\r\n","        byteString=xhr.responseBody\r\n","        ReDim byteArray(LenB(byteString))\r\n","        For i = 1 To LenB(byteString)\r\n","            byteArray(i-1) = AscB(MidB(byteString, i, 1))\r\n","        Next\r\n","    End If\r\n","    VbAjaxLoader=byteArray\r\n","End Function\r\n";var t=document.createElement("script");t.setAttribute("type","text/vbscript");var i=document.createTextNode('Function VbAjaxLoader(method, fileName)\r\n    Dim xhr\r\n    Set xhr = CreateObject("Microsoft.XMLHTTP")\r\n    xhr.Open method, fileName, False\r\n    xhr.setRequestHeader "Accept-Charset", "x-user-defined"\r\n    xhr.send\r\n    Dim byteArray()\r\n    if xhr.Status = 200 Then\r\n        Dim byteString\r\n        Dim i\r\n        byteString=xhr.responseBody\r\n        ReDim byteArray(LenB(byteString))\r\n        For i = 1 To LenB(byteString)\r\n            byteArray(i-1) = AscB(MidB(byteString, i, 1))\r\n        Next\r\n    End If\r\n    VbAjaxLoader=byteArray\r\nEnd Function\r\n');t.appendChild(i),document.addEventListener("DOMContentLoaded",(function(){document.body.appendChild(t)}),!1)}},e.MusicFontSize=34,e._globalThis=void 0,e.scriptFile=e.detectScriptFile(),e.bravuraFontChecker=new Sn("alphaTab","&#"+Q.GClef+";"),e.renderEngines=e.createDefaultRenderEngines(),e.layoutEngines=e.createDefaultLayoutEngines(),e.staveProfiles=e.createDefaultStaveProfiles(),e}();qh.platformInit();var Qh=function(){function e(){if(this.scriptFile=null,this.fontDirectory=null,this.file=null,this.tex=!1,this.tracks=null,this.visibilityCheckInterval=500,this.enableLazyLoading=!0,this.engine="default",this.logLevel=t.LogLevel.Info,this.useWorkers=!0,this.includeNoteBounds=!1,!qh.isRunningInWorker&&qh.globalThis.ALPHATAB_ROOT?(this.scriptFile=qh.globalThis.ALPHATAB_ROOT,this.scriptFile=e.ensureFullUrl(this.scriptFile),this.scriptFile=e.appendScriptName(this.scriptFile)):this.scriptFile=qh.scriptFile,!qh.isRunningInWorker&&qh.globalThis.ALPHATAB_FONT)this.fontDirectory=qh.globalThis.ALPHATAB_FONT,this.fontDirectory=e.ensureFullUrl(this.fontDirectory);else if(this.fontDirectory=this.scriptFile,this.fontDirectory){var i=this.fontDirectory.lastIndexOf(String.fromCharCode(47));i>=0&&(this.fontDirectory=this.fontDirectory.substr(0,i)+"/font/")}}return e.ensureFullUrl=function(t){var e,i,n;if(!t)return"";if(!t.startsWith("http")&&!t.startsWith("https")&&!t.startsWith("file")){var r="",a=qh.globalThis.location;if(r+=null===(e=a.protocol)||void 0===e?void 0:e.toString(),r+="//".toString(),a.hostname&&(r+=null===(i=a.hostname)||void 0===i?void 0:i.toString()),a.port&&(r+=":".toString(),r+=null===(n=a.port)||void 0===n?void 0:n.toString()),!t.startsWith("/")){var o=a.pathname.split("/").slice(0,-1).join("/");o.length>0&&(o.startsWith("/")||(r+="/".toString()),r+=null==o?void 0:o.toString())}return t.startsWith("/")||(r+="/".toString()),r+=null==t?void 0:t.toString()}return t},e.appendScriptName=function(t){return t&&!t.endsWith(".js")&&(t.endsWith("/")||(t+="/"),t+="alphaTab.js"),t},e.toJson=function(t){var e={};return t.fillToJson(e),e},e.prototype.fillToJson=function(t){t.scriptFile=this.scriptFile,t.fontDirectory=this.fontDirectory,t.file=this.file,t.tex=this.tex,t.tracks=this.tracks,t.visibilityCheckInterval=this.visibilityCheckInterval,t.enableLazyLoading=this.enableLazyLoading,t.engine=this.engine,t.logLevel=this.logLevel,t.useWorkers=this.useWorkers,t.includeNoteBounds=this.includeNoteBounds},e.fromJson=function(t){if(!t)return null;var i=new e;return i.fillFromJson(t),i},e.prototype.fillFromJson=function(t){if(t)for(var e in t)this.setProperty(e.toLowerCase(),t[e])},e.prototype.setProperty=function(e,i){switch(e){case"scriptfile":return this.scriptFile=i,!0;case"fontdirectory":return this.fontDirectory=i,!0;case"file":return this.file=i,!0;case"tex":return this.tex=i,!0;case"tracks":return this.tracks=i,!0;case"visibilitycheckinterval":return this.visibilityCheckInterval=i,!0;case"enablelazyloading":return this.enableLazyLoading=i,!0;case"engine":return this.engine=i,!0;case"loglevel":return this.logLevel=isNaN(parseInt(i))?t.LogLevel[Object.keys(t.LogLevel).find((function(t){return t.toLowerCase()===i.toLowerCase()}))]:parseInt(i),!0;case"useworkers":return this.useWorkers=i,!0;case"includenotebounds":return this.includeNoteBounds=i,!0}return!1},e}(),Kh=function(t,e){this.loaded=t,this.total=e};"WorkerGlobalScope"in self||(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(t){var e=this;do{if(Element.prototype.matches.call(e,t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null}),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach)),String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return e=e||0,this.indexOf(t,e)===e}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(t){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),i=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var n=arguments[1],r=0;r<i;){var a=e[r];if(t.call(n,a,r,e))return a;r++}},configurable:!0,writable:!0});var Zh={ScoreImporter:k,ScoreLoader:vn,UnsupportedFormatError:N},$h={BeatTickLookup:Xi,MasterBarTickLookup:qi,MidiTickLookup:Ki,MidiTickLookupFindBeatResult:Qi,MidiFile:di,ControllerType:Ti,MetaDataEvent:yi,MetaEvent:Oe,MetaEventType:Te,MetaNumberEvent:mi,MidiEvent:ke,MidiEventType:he,SystemCommonEvent:_i,SystemCommonType:ri,SystemExclusiveEvent:Si,MidiFileGenerator:tn,AlphaSynthMidiFileHandler:zi},tc={AccentuationType:S,AccidentalType:An,AutomationType:B,Automation:F,Bar:U,Beat:ct,BendPoint:X,BendStyle:L,BendType:E,BrushType:M,Chord:lt,Clef:O,Color:m,CrescendoType:D,Duration:A,DynamicValue:I,FermataType:Rt,Fermata:Vt,Fingers:r,FontStyle:d,Font:_,GraceType:R,HarmonicType:G,InstrumentArticulation:rt,JsonConverter:Fi,KeySignature:ut,KeySignatureType:pt,Lyrics:ft,MasterBar:yt,MusicFontSymbol:Q,Note:ot,NoteAccidentalMode:j,Ottavia:x,PickStroke:q,PlaybackInformation:_t,RenderStylesheet:gt,RepeatGroup:mt,Score:bt,Section:vt,SimileMark:C,SlideInType:V,SlideOutType:H,Staff:wt,Track:St,TripletFeel:dt,Tuning:Bt,TupletGroup:st,VibratoType:W,Voice:kt,WhammyType:it},ec={ScoreRenderer:Hi,RenderFinishedEventArgs:Di,BarBounds:Ai,BeatBounds:Ii,Bounds:It,BoundsLookup:Vi,MasterBarBounds:Ri,NoteBounds:Gi,StaveGroupBounds:ji},ic={AlphaSynth:pi,PlaybackRange:en,PlayerState:Ne,PlayerStateChangedEventArgs:Ae,PositionChangedEventArgs:Ie,AlphaSynthWebWorkerApi:kn};t.AlphaTabApi=Cn,t.AlphaTabError=c,t.CoreSettings=Qh,t.DisplaySettings=T,t.FileLoadError=bn,t.FormatError=u,t.ImporterSettings=Bi,t.Logger=et,t.NotationSettings=f,t.PlayerSettings=Ni,t.ProgressEventArgs=Kh,t.RenderingResources=w,t.ResizeEventArgs=fn,t.Settings=Oi,t.VibratoPlaybackSettings=ki,t.importer=Zh,t.midi=$h,t.model=tc,t.rendering=ec,t.synth=ic,Object.defineProperty(t,"__esModule",{value:!0})}));
